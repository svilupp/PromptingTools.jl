import { _ as _export_sfc, c as createElementBlock, o as openBlock, ai as createStaticVNode } from "./chunks/framework.CTN6q6GT.js";
const __pageData = JSON.parse('{"title":"Reference for AgentTools","description":"","frontmatter":{},"headers":[],"relativePath":"reference_agenttools.md","filePath":"reference_agenttools.md","lastUpdated":null}');
const _sfc_main = { name: "reference_agenttools.md" };
function _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {
  return openBlock(), createElementBlock("div", null, _cache[0] || (_cache[0] = [
    createStaticVNode('<h1 id="Reference-for-AgentTools" tabindex="-1">Reference for AgentTools <a class="header-anchor" href="#Reference-for-AgentTools" aria-label="Permalink to &quot;Reference for AgentTools {#Reference-for-AgentTools}&quot;">​</a></h1><ul><li><a href="#PromptingTools.Experimental.AgentTools.AICall"><code>PromptingTools.Experimental.AgentTools.AICall</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.AICodeFixer"><code>PromptingTools.Experimental.AgentTools.AICodeFixer</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.RetryConfig"><code>PromptingTools.Experimental.AgentTools.RetryConfig</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.SampleNode"><code>PromptingTools.Experimental.AgentTools.SampleNode</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.ThompsonSampling"><code>PromptingTools.Experimental.AgentTools.ThompsonSampling</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.UCT"><code>PromptingTools.Experimental.AgentTools.UCT</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.AIClassify-Tuple"><code>PromptingTools.Experimental.AgentTools.AIClassify</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.AIEmbed-Tuple"><code>PromptingTools.Experimental.AgentTools.AIEmbed</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.AIExtract-Tuple"><code>PromptingTools.Experimental.AgentTools.AIExtract</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.AIGenerate-Tuple"><code>PromptingTools.Experimental.AgentTools.AIGenerate</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.AIScan-Tuple"><code>PromptingTools.Experimental.AgentTools.AIScan</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.add_feedback!-Tuple{AbstractVector{&lt;:PromptingTools.AbstractMessage}, PromptingTools.Experimental.AgentTools.SampleNode}"><code>PromptingTools.Experimental.AgentTools.add_feedback!</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.aicodefixer_feedback-Tuple{AICode}"><code>PromptingTools.Experimental.AgentTools.aicodefixer_feedback</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.airetry!"><code>PromptingTools.Experimental.AgentTools.airetry!</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.backpropagate!-Tuple{PromptingTools.Experimental.AgentTools.SampleNode}"><code>PromptingTools.Experimental.AgentTools.backpropagate!</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.beta_sample-Tuple{Real, Real}"><code>PromptingTools.Experimental.AgentTools.beta_sample</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.collect_all_feedback-Tuple{PromptingTools.Experimental.AgentTools.SampleNode}"><code>PromptingTools.Experimental.AgentTools.collect_all_feedback</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.error_feedback-Tuple{Any}"><code>PromptingTools.Experimental.AgentTools.error_feedback</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.evaluate_condition!"><code>PromptingTools.Experimental.AgentTools.evaluate_condition!</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.expand!-Tuple{PromptingTools.Experimental.AgentTools.SampleNode, Any}"><code>PromptingTools.Experimental.AgentTools.expand!</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.extract_config-Union{Tuple{T}, Tuple{Any, T}} where T"><code>PromptingTools.Experimental.AgentTools.extract_config</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.find_node-Tuple{PromptingTools.Experimental.AgentTools.SampleNode, Integer}"><code>PromptingTools.Experimental.AgentTools.find_node</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.gamma_sample-Tuple{Real, Real}"><code>PromptingTools.Experimental.AgentTools.gamma_sample</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.print_samples-Tuple{PromptingTools.Experimental.AgentTools.SampleNode}"><code>PromptingTools.Experimental.AgentTools.print_samples</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.remove_used_kwargs-Tuple{NamedTuple, AbstractVector{&lt;:PromptingTools.AbstractMessage}}"><code>PromptingTools.Experimental.AgentTools.remove_used_kwargs</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.reset_success!"><code>PromptingTools.Experimental.AgentTools.reset_success!</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.run!-Tuple{PromptingTools.Experimental.AgentTools.AICallBlock}"><code>PromptingTools.Experimental.AgentTools.run!</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.run!-Tuple{AICodeFixer}"><code>PromptingTools.Experimental.AgentTools.run!</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.score-Tuple{PromptingTools.Experimental.AgentTools.SampleNode, PromptingTools.Experimental.AgentTools.ThompsonSampling}"><code>PromptingTools.Experimental.AgentTools.score</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.score-Tuple{PromptingTools.Experimental.AgentTools.SampleNode, PromptingTools.Experimental.AgentTools.UCT}"><code>PromptingTools.Experimental.AgentTools.score</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.select_best"><code>PromptingTools.Experimental.AgentTools.select_best</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.split_multi_samples-Tuple{Any}"><code>PromptingTools.Experimental.AgentTools.split_multi_samples</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.truncate_conversation-Tuple{AbstractVector{&lt;:PromptingTools.AbstractMessage}}"><code>PromptingTools.Experimental.AgentTools.truncate_conversation</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.unwrap_aicall_args-Tuple{Any}"><code>PromptingTools.Experimental.AgentTools.unwrap_aicall_args</code></a></li></ul><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools" href="#PromptingTools.Experimental.AgentTools">#</a> <b><u>PromptingTools.Experimental.AgentTools</u></b> — <i>Module</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AgentTools</span></span></code></pre></div><p>Provides Agentic functionality providing lazy calls for building pipelines (eg, <code>AIGenerate</code>) and <code>AICodeFixer</code>.</p><p>This module is experimental and may change at any time. It is intended to be moved to a separate package in the future.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/AgentTools.jl#L1-L7" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.AICall" href="#PromptingTools.Experimental.AgentTools.AICall">#</a> <b><u>PromptingTools.Experimental.AgentTools.AICall</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AICall</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(func</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">F</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {F</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AIGenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AIEmbed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AIExtract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>A lazy call wrapper for AI functions in the <code>PromptingTools</code> module, such as <code>aigenerate</code>.</p><p>The <code>AICall</code> struct is designed to facilitate a deferred execution model (lazy evaluation) for AI functions that interact with a Language Learning Model (LLM). It stores the necessary information for an AI call and executes the underlying AI function only when supplied with a <code>UserMessage</code> or when the <code>run!</code> method is applied. This approach allows for more flexible and efficient handling of AI function calls, especially in interactive environments.</p><p>Seel also: <code>run!</code>, <code>AICodeFixer</code></p><p><strong>Fields</strong></p><ul><li><p><code>func::F</code>: The AI function to be called lazily. This should be a function like <code>aigenerate</code> or other <code>ai*</code> functions.</p></li><li><p><code>schema::Union{Nothing, PT.AbstractPromptSchema}</code>: Optional schema to structure the prompt for the AI function.</p></li><li><p><code>conversation::Vector{PT.AbstractMessage}</code>: A vector of messages that forms the conversation context for the AI call.</p></li><li><p><code>kwargs::NamedTuple</code>: Keyword arguments to be passed to the AI function.</p></li><li><p><code>success::Union{Nothing, Bool}</code>: Indicates whether the last call was successful (true) or not (false). <code>Nothing</code> if the call hasn&#39;t been made yet.</p></li><li><p><code>error::Union{Nothing, Exception}</code>: Stores any exception that occurred during the last call. <code>Nothing</code> if no error occurred or if the call hasn&#39;t been made yet.</p></li></ul><p><strong>Example</strong></p><p>Initiate an <code>AICall</code> like any ai* function, eg, <code>AIGenerate</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">aicall </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AICall</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aigenerate)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># With arguments and kwargs like ai* functions</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># from `aigenerate(schema, conversation; model=&quot;abc&quot;, api_kwargs=(; temperature=0.1))`</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># to</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">aicall </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AICall</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aigenerate, schema, conversation; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;abc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Or with a template</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">aicall </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AIGenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:JuliaExpertAsk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; ask</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xyz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;abc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><p>Trigger the AICall with <code>run!</code> (it returns the update <code>AICall</code> struct back):</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">aicall </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> run!</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">````</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">You can also use `AICall` as a functor to trigger the AI call with a `UserMessage` or simply the text to send:</span></span></code></pre></div><p>julia aicall(UserMessage(&quot;Hello, world!&quot;)) # Triggers the lazy call result = run!(aicall) # Explicitly runs the AI call ``` This can be used to &quot;reply&quot; to previous message / continue the stored conversation</p><p><strong>Notes</strong></p><ul><li><p>The <code>AICall</code> struct is a key component in building flexible and efficient Agentic pipelines</p></li><li><p>The lazy evaluation model allows for setting up the call parameters in advance and deferring the actual execution until it is explicitly triggered.</p></li><li><p>This struct is particularly useful in scenarios where the timing of AI function execution needs to be deferred or where multiple potential calls need to be prepared and selectively executed.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/lazy_types.jl#L50-L103" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.AICodeFixer" href="#PromptingTools.Experimental.AgentTools.AICodeFixer">#</a> <b><u>PromptingTools.Experimental.AgentTools.AICodeFixer</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AICodeFixer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aicall</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AICall</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, templates</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:PT.UserMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; num_rounds</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, feedback_func</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Function</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aicodefixer_feedback; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AICodeFixer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aicall</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AICall</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, template</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{AITemplate, Symbol}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :CodeFixerRCI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>An AIAgent that iteratively evaluates any received Julia code and provides feedback back to the AI model if <code>num_rounds&gt;0</code>. <code>AICodeFixer</code> manages the lifecycle of a code fixing session, including tracking conversation history, rounds of interaction, and applying user feedback through a specialized feedback function.</p><p>It integrates with lazy AI call structures like <code>AIGenerate</code>.</p><p>The operation is &quot;lazy&quot;, ie, the agent is only executed when needed, eg, when <code>run!</code> is called.</p><p><strong>Fields</strong></p><ul><li><p><code>call::AICall</code>: The AI call that is being used for code generation or processing, eg, AIGenerate (same as <code>aigenerate</code> but &quot;lazy&quot;, ie, called only when needed</p></li><li><p><code>templates::Union{Symbol, AITemplate, Vector{PT.UserMessage}}</code>: A set of user messages or templates that guide the AI&#39;s code fixing process. The first UserMessage is used in the first round of code fixing, the second UserMessage is used for every subsequent iteration.</p></li><li><p><code>num_rounds::Int</code>: The number of rounds for the code fixing session. Defaults to 3.</p></li><li><p><code>round_counter::Int</code>: Counter to track the current round of interaction.</p></li><li><p><code>feedback_func::Function</code>: Function to generate feedback based on the AI&#39;s proposed code, defaults to <code>aicodefixer_feedback</code> (modular thanks to type dispatch on <code>AbstractOutcomes</code>)</p></li><li><p><code>kwargs::NamedTuple</code>: Additional keyword arguments for customizing the AI call.</p></li></ul><p>Note: Any kwargs provided to <code>run!()</code> will be passed to the underlying AICall.</p><p><strong>Example</strong></p><p>Let&#39;s create an AIGenerate call and then pipe it to AICodeFixer to run a few rounds of the coding fixing:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create an AIGenerate call</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lazy_call </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AIGenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Write a function to do XYZ...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># the action starts only when `run!` is called</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lazy_call </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AICodeFixer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> run!</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Access the result of the code fixing session</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># result.call refers to the AIGenerate lazy call above</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conversation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">call</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conversation</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fixed_code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> last</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(conversation) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># usually in the last message</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Preview the conversation history</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">preview</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(conversation)</span></span></code></pre></div><p>You can change the template used to provide user feedback and number of counds via arguments:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Setup an AIGenerate call</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lazy_call </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AIGenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aigenerate, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Write code to do XYZ...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Custom template and 2 fixing rounds</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AICodeFixer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lazy_call, [PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UserMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Please fix the code.</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Feedback: {{feedback}}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]; num_rounds </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> run!</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The result now contains the AI&#39;s attempts to fix the code</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">preview</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">call</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conversation)</span></span></code></pre></div><p><strong>Notes</strong></p><ul><li><p><code>AICodeFixer</code> is particularly useful when code is hard to get right in one shot (eg, smaller models, complex syntax)</p></li><li><p>The structure leverages the lazy evaluation model of <code>AICall</code> (/AIGenerate) to efficiently manage AI interactions and be able to repeatedly call it.</p></li><li><p>The <code>run!</code> function executes the AI call and applies the feedback loop for the specified number of rounds, enabling an interactive code fixing process.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/lazy_types.jl#L362-L424" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.RetryConfig" href="#PromptingTools.Experimental.AgentTools.RetryConfig">#</a> <b><u>PromptingTools.Experimental.AgentTools.RetryConfig</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RetryConfig</span></span></code></pre></div><p>Configuration for self-fixing the AI calls. It includes the following fields:</p><p><strong>Fields</strong></p><ul><li><p><code>retries::Int</code>: The number of retries (&quot;fixing rounds&quot;) that have been attempted so far.</p></li><li><p><code>calls::Int</code>: The total number of SUCCESSFULLY generated ai* function calls made so far (across all samples/retry rounds). Ie, if a call fails, because of an API error, it&#39;s not counted, because it didn&#39;t reach the LLM.</p></li><li><p><code>max_retries::Int</code>: The maximum number of retries (&quot;fixing rounds&quot;) allowed for the AI call. Defaults to 10.</p></li><li><p><code>max_calls::Int</code>: The maximum number of ai* function calls allowed for the AI call. Defaults to 99.</p></li><li><p><code>retry_delay::Int</code>: The delay (in seconds) between retry rounds. Defaults to 0s.</p></li><li><p><code>n_samples::Int</code>: The number of samples to generate in each ai* call round (to increase changes of successful pass). Defaults to 1.</p></li><li><p><code>scoring::AbstractScoringMethod</code>: The scoring method to use for generating multiple samples. Defaults to <code>UCT(sqrt(2))</code>.</p></li><li><p><code>ordering::Symbol</code>: The ordering to use for select the best samples. With <code>:PostOrderDFS</code> we prioritize leaves, with <code>:PreOrderDFS</code> we prioritize the root. Defaults to <code>:PostOrderDFS</code>.</p></li><li><p><code>feedback_inplace::Bool</code>: Whether to provide feedback in previous UserMessage (and remove the past AIMessage) or to create a new UserMessage. Defaults to <code>false</code>.</p></li><li><p><code>feedback_template::Symbol</code>: Template to use for feedback in place. Defaults to <code>:FeedbackFromEvaluator</code>.</p></li><li><p><code>temperature::Float64</code>: The temperature to use for sampling. Relevant only if not defined in <code>api_kwargs</code> provided. Defaults to 0.7.</p></li><li><p><code>catch_errors::Bool</code>: Whether to catch errors during <code>run!</code> of AICall. Saves them in <code>aicall.error</code>. Defaults to <code>false</code>.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/lazy_types.jl#L6-L25" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.SampleNode" href="#PromptingTools.Experimental.AgentTools.SampleNode">#</a> <b><u>PromptingTools.Experimental.AgentTools.SampleNode</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SampleNode{T}</span></span></code></pre></div><p>A node in the Monte Carlo Tree Search tree.</p><p>It&#39;s used to hold the <code>data</code> we&#39;re trying to optimize/discover (eg, a conversation), the scores from evaluation (<code>wins</code>, <code>visits</code>) and the results of the evaluations upon failure (<code>feedback</code>).</p><p><strong>Fields</strong></p><ul><li><p><code>id::UInt16</code>: Unique identifier for the node</p></li><li><p><code>parent::Union{SampleNode, Nothing}</code>: Parent node that current node was built on</p></li><li><p><code>children::Vector{SampleNode}</code>: Children nodes</p></li><li><p><code>wins::Int</code>: Number of successful outcomes</p></li><li><p><code>visits::Int</code>: Number of condition checks done (eg, losses are <code>checks - wins</code>)</p></li><li><p><code>data::T</code>: eg, the conversation or some parameter to be optimized</p></li><li><p><code>feedback::String</code>: Feedback from the evaluation, always a string! Defaults to empty string.</p></li><li><p><code>success::Union{Nothing, Bool}</code>: Success of the generation and subsequent evaluations, proxy for whether it should be further evaluated. Defaults to nothing.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/mcts.jl#L31-L47" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.ThompsonSampling" href="#PromptingTools.Experimental.AgentTools.ThompsonSampling">#</a> <b><u>PromptingTools.Experimental.AgentTools.ThompsonSampling</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ThompsonSampling </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractScoringMethod</span></span></code></pre></div><p>Implements scoring and selection for Thompson Sampling method. See <a href="https://en.wikipedia.org/wiki/Thompson_sampling" target="_blank" rel="noreferrer">https://en.wikipedia.org/wiki/Thompson_sampling</a> for more details.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/mcts.jl#L12-L16" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.UCT" href="#PromptingTools.Experimental.AgentTools.UCT">#</a> <b><u>PromptingTools.Experimental.AgentTools.UCT</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">UCT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractScoringMethod</span></span></code></pre></div><p>Implements scoring and selection for UCT (Upper Confidence Bound for Trees) sampling method. See <a href="https://en.wikipedia.org/wiki/Monte_Carlo_tree_search#Exploration_and_exploitation" target="_blank" rel="noreferrer">https://en.wikipedia.org/wiki/Monte_Carlo_tree_search#Exploration_and_exploitation</a> for more details.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/mcts.jl#L22-L26" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.AIClassify-Tuple" href="#PromptingTools.Experimental.AgentTools.AIClassify-Tuple">#</a> <b><u>PromptingTools.Experimental.AgentTools.AIClassify</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AIClassify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Creates a lazy instance of <code>aiclassify</code>. It is an instance of <code>AICall</code> with <code>aiclassify</code> as the function.</p><p>Use exactly the same arguments and keyword arguments as <code>aiclassify</code> (see <code>?aiclassify</code> for details).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/lazy_types.jl#L164-L172" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.AIEmbed-Tuple" href="#PromptingTools.Experimental.AgentTools.AIEmbed-Tuple">#</a> <b><u>PromptingTools.Experimental.AgentTools.AIEmbed</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AIEmbed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Creates a lazy instance of <code>aiembed</code>. It is an instance of <code>AICall</code> with <code>aiembed</code> as the function.</p><p>Use exactly the same arguments and keyword arguments as <code>aiembed</code> (see <code>?aiembed</code> for details).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/lazy_types.jl#L151-L159" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.AIExtract-Tuple" href="#PromptingTools.Experimental.AgentTools.AIExtract-Tuple">#</a> <b><u>PromptingTools.Experimental.AgentTools.AIExtract</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AIExtract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Creates a lazy instance of <code>aiextract</code>. It is an instance of <code>AICall</code> with <code>aiextract</code> as the function.</p><p>Use exactly the same arguments and keyword arguments as <code>aiextract</code> (see <code>?aiextract</code> for details).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/lazy_types.jl#L138-L146" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.AIGenerate-Tuple" href="#PromptingTools.Experimental.AgentTools.AIGenerate-Tuple">#</a> <b><u>PromptingTools.Experimental.AgentTools.AIGenerate</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AIGenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Creates a lazy instance of <code>aigenerate</code>. It is an instance of <code>AICall</code> with <code>aigenerate</code> as the function.</p><p>Use exactly the same arguments and keyword arguments as <code>aigenerate</code> (see <code>?aigenerate</code> for details).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/lazy_types.jl#L125-L133" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.AIScan-Tuple" href="#PromptingTools.Experimental.AgentTools.AIScan-Tuple">#</a> <b><u>PromptingTools.Experimental.AgentTools.AIScan</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AIScan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Creates a lazy instance of <code>aiscan</code>. It is an instance of <code>AICall</code> with <code>aiscan</code> as the function.</p><p>Use exactly the same arguments and keyword arguments as <code>aiscan</code> (see <code>?aiscan</code> for details).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/lazy_types.jl#L177-L185" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.add_feedback!-Tuple{AbstractVector{&lt;:PromptingTools.AbstractMessage}, PromptingTools.Experimental.AgentTools.SampleNode}" href="#PromptingTools.Experimental.AgentTools.add_feedback!-Tuple{AbstractVector{&lt;:PromptingTools.AbstractMessage}, PromptingTools.Experimental.AgentTools.SampleNode}">#</a> <b><u>PromptingTools.Experimental.AgentTools.add_feedback!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">add_feedback!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:PT.AbstractMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, sample</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SampleNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; feedback_inplace</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    feedback_template</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Symbol</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :FeedbackFromEvaluator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Adds formatted feedback to the <code>conversation</code> based on the <code>sample</code> node feedback (and its ancestors).</p><p><strong>Arguments</strong></p><ul><li><p><code>conversation::AbstractVector{&lt;:PT.AbstractMessage}</code>: The conversation to add the feedback to.</p></li><li><p><code>sample::SampleNode</code>: The sample node to extract the feedback from.</p></li><li><p><code>feedback_inplace::Bool=false</code>: If true, it will add the feedback to the last user message inplace (and pop the last AIMessage). Otherwise, it will append the feedback as a new message.</p></li><li><p><code>feedback_template::Symbol=:FeedbackFromEvaluator</code>: The template to use for the feedback message. It must be a valid <code>AITemplate</code> name.</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sample </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SampleNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, feedback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Feedback X&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conversation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UserMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AIMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;I say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conversation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">add_feedback!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(conversation, sample)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conversation[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;### Feedback from Evaluator</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Feedback X</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Inplace feedback</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span></span></code></pre></div><p>julia conversation = [PT.UserMessage(&quot;I say hi!&quot;), PT.AIMessage(; content = &quot;I say hi!&quot;)] conversation = AT.add_feedback!(conversation, sample; feedback_inplace = true) conversation[end].content == &quot;I say hi!\\n\\n### Feedback from Evaluator\\nFeedback X\\n&quot;</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>\n<span class="line"><span>Sample with ancestors with feedback:</span></span></code></pre></div><p>julia sample_p = SampleNode(; data = nothing, feedback = &quot;\\nFeedback X&quot;) sample = expand!(sample_p, nothing) sample.feedback = &quot;\\nFeedback Y&quot; conversation = [PT.UserMessage(&quot;I say hi!&quot;), PT.AIMessage(; content = &quot;I say hi!&quot;)] conversation = AT.add_feedback!(conversation, sample)</p><p>conversation[end].content == &quot;### Feedback from Evaluator\\n\\nFeedback X\\n–––––\\n\\nFeedback Y\\n&quot; ```</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/retry.jl#L471-L510" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.aicodefixer_feedback-Tuple{AICode}" href="#PromptingTools.Experimental.AgentTools.aicodefixer_feedback-Tuple{AICode}">#</a> <b><u>PromptingTools.Experimental.AgentTools.aicodefixer_feedback</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aicodefixer_feedback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AICode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 512</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; feedback</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aicodefixer_feedback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:PT.AbstractMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 512</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; feedback</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aicodefixer_feedback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PT.AIMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 512</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; feedback</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aicodefixer_feedback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aicall</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AICall</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 512</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; feedback</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Generate feedback for an AI code fixing session based on the AICode block /or conversation history (that will be used to extract and evaluate a code block). Function is designed to be extensible for different types of feedback and code evaluation outcomes.</p><p>The highlevel wrapper accepts a conversation and returns new kwargs for the AICall.</p><p>Individual feedback functions are dispatched on different subtypes of <code>AbstractCodeOutcome</code> and can be extended/overwritten to provide more detailed feedback.</p><p>See also: <code>AIGenerate</code>, <code>AICodeFixer</code></p><p><strong>Arguments</strong></p><ul><li><p><code>cb::AICode</code>: AICode block to evaluate and provide feedback on.</p></li><li><p><code>max_length::Int=512</code>: An optional argument that specifies the maximum length of the feedback message.</p></li></ul><p><strong>Returns</strong></p><ul><li><code>NamedTuple</code>: A feedback message as a kwarg in NamedTuple based on the analysis of the code provided in the conversation.</li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AICode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg; skip_unsafe </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, capture_stdout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">new_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aicodefixer_feedback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cb)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">new_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aicodefixer_feedback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">new_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aicodefixer_feedback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(conversation)</span></span></code></pre></div><p><strong>Notes</strong></p><p>This function is part of the AI code fixing system, intended to interact with code in AIMessage and provide feedback on improving it.</p><p>The highlevel wrapper accepts a conversation and returns new kwargs for the AICall.</p><p>It dispatches for the code feedback based on the subtypes of <code>AbstractCodeOutcome</code> below:</p><ul><li><p><code>CodeEmpty</code>: No code found in the message.</p></li><li><p><code>CodeFailedParse</code>: Code parsing error.</p></li><li><p><code>CodeFailedEval</code>: Runtime evaluation error.</p></li><li><p><code>CodeFailedTimeout</code>: Code execution timed out.</p></li><li><p><code>CodeSuccess</code>: Successful code execution.</p></li></ul><p>You can override the individual methods to customize the feedback.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/code_feedback.jl#L10-L54" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.airetry!" href="#PromptingTools.Experimental.AgentTools.airetry!">#</a> <b><u>PromptingTools.Experimental.AgentTools.airetry!</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">airetry!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    f_cond</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, aicall</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AICallBlock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, feedback</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{AbstractString, Function}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, evaluate_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, feedback_expensive</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    max_retries</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Int}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, retry_delay</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Int}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Evaluates the condition <code>f_cond</code> on the <code>aicall</code> object. If the condition is not met, it will return the best sample to retry from and provide <code>feedback</code> (string or function) to <code>aicall</code>. That&#39;s why it&#39;s mutating. It will retry maximum <code>max_retries</code> times, with <code>throw=true</code>, an error will be thrown if the condition is not met after <code>max_retries</code> retries.</p><p>Note: <code>aicall</code> must be run first via <code>run!(aicall)</code> before calling <code>airetry!</code>.</p><p>Function signatures</p><ul><li><p><code>f_cond(aicall::AICallBlock) -&gt; Bool</code>, ie, it must accept the aicall object and return a boolean value.</p></li><li><p><code>feedback</code> can be a string or <code>feedback(aicall::AICallBlock) -&gt; String</code>, ie, it must accept the aicall object and return a string.</p></li></ul><p>You can leverage the <code>last_message</code>, <code>last_output</code>, and <code>AICode</code> functions to access the last message, last output and execute code blocks in the conversation, respectively. See examples below.</p><p><strong>Good Use Cases</strong></p><ul><li><p>Retry with API failures/drops (add <code>retry_delay=2</code> to wait 2s between retries)</p></li><li><p>Check the output format / type / length / etc</p></li><li><p>Check the output with <code>aiclassify</code> call (LLM Judge) to catch unsafe/NSFW/out-of-scope content</p></li><li><p>Provide hints to the model to guide it to the correct answer</p></li></ul><p><strong>Gotchas</strong></p><ul><li><p>If controlling keyword arguments are set to nothing, they will fall back to the default values in <code>aicall.config</code>. You can override them by passing the keyword arguments explicitly.</p></li><li><p>If there multiple <code>airetry!</code> checks, they are evaluted sequentially. As long as <code>throw==false</code>, they will be all evaluated even if they failed previous checks.</p></li><li><p>Only samples which passed previous evaluations are evaluated (<code>sample.success</code> is <code>true</code>). If there are no successful samples, the function will evaluate only the active sample (<code>aicall.active_sample_id</code>) and nothing else.</p></li><li><p>Feedback from all &quot;ancestor&quot; evaluations is added upon retry, not feedback from the &quot;sibblings&quot; or other branches. To have only ONE long BRANCH (no sibblings), make sure to keep <code>RetryConfig(; n_samples=1)</code>. That way the model will always see ALL previous feedback.</p></li><li><p>We implement a version of Monte Carlo Tree Search (MCTS) to always pick the most promising sample to restart from (you can tweak the options in <code>RetryConfig</code> to change the behaviour).</p></li><li><p>For large number of parallel branches (ie, &quot;shallow and wide trees&quot;), you might benefit from switching scoring to <code>scoring=ThompsonSampling()</code> (similar to how Bandit algorithms work).</p></li><li><p>Open-source/local models can struggle with too long conversation, you might want to experiment with <code>in-place feedback</code> (set <code>RetryConfig(; feedback_inplace=true)</code>).</p></li></ul><p><strong>Arguments</strong></p><ul><li><p><code>f_cond::Function</code>: A function that accepts the <code>aicall</code> object and returns a boolean value. Retry will be attempted if the condition is not met (<code>f_cond -&gt; false</code>).</p></li><li><p><code>aicall::AICallBlock</code>: The <code>aicall</code> object to evaluate the condition on.</p></li><li><p><code>feedback::Union{AbstractString, Function}</code>: Feedback to provide if the condition is not met. If a function is provided, it must accept the <code>aicall</code> object as the only argument and return a string.</p></li><li><p><code>verbose::Integer=1</code>: A verbosity level for logging the retry attempts and warnings. A higher value indicates more detailed logging.</p></li><li><p><code>throw::Bool=false</code>: If true, it will throw an error if the function <code>f_cond</code> does not return <code>true</code> after <code>max_retries</code> retries.</p></li><li><p><code>evaluate_all::Bool=false</code>: If true, it will evaluate all the &quot;successful&quot; samples in the <code>aicall</code> object. Otherwise, it will only evaluate the active sample.</p></li><li><p><code>feedback_expensive::Bool=false</code>: If false, it will provide feedback to all samples that fail the condition. If <code>feedback</code> function is expensive to call (eg, another ai* function), set this to <code>true</code> and feedback will be provided only to the sample we will retry from.</p></li><li><p><code>max_retries::Union{Nothing, Int}=nothing</code>: Maximum number of retries. If not provided, it will fall back to the <code>max_retries</code> in <code>aicall.config</code>.</p></li><li><p><code>retry_delay::Union{Nothing, Int}=nothing</code>: Delay between retries in seconds. If not provided, it will fall back to the <code>retry_delay</code> in <code>aicall.config</code>.</p></li></ul><p><strong>Returns</strong></p><ul><li>The <code>aicall</code> object with the updated <code>conversation</code>, and <code>samples</code> (saves the evaluations and their scores/feedback).</li></ul><p><strong>Example</strong></p><p>You can use <code>airetry!</code> to catch API errors in <code>run!</code> and auto-retry the call. <code>RetryConfig</code> is how you influence all the subsequent retry behaviours - see <code>?RetryConfig</code> for more details.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># API failure because of a non-existent model</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">out </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AIGenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> RetryConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; catch_errors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;NOTEXIST&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">run!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(out) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># fails</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># we ask to wait 2s between retries and retry 2 times (can be set in `config` in aicall as well)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">airetry!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(isvalid, out; retry_delay </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, max_retries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>If you provide arguments to the aicall, we try to honor them as much as possible in the following calls, eg, set low verbosity</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">out </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AIGenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> RetryConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; catch_errors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;NOTEXIST&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">run!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(out)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># No info message, you just see `success = false` in the properties of the AICall</span></span></code></pre></div><p>Let&#39;s show a toy example to demonstrate the runtime checks / guardrails for the model output. We&#39;ll play a color guessing game (I&#39;m thinking &quot;yellow&quot;):</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Notice that we ask for two samples (`n_samples=2`) at each attempt (to improve our chances). </span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Both guesses are scored at each time step, and the best one is chosen for the next step.</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># And with OpenAI, we can set `api_kwargs = (;n=2)` to get both samples simultaneously (cheaper and faster)!</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">out </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AIGenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;Guess what color I&#39;m thinking. It could be: blue, red, black, white, yellow. Answer with 1 word only&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> RetryConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; n_samples </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), api_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">run!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(out)</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Check that the output is 1 word only, third argument is the feedback that will be provided if the condition fails</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Notice: functions operate on `aicall` as the only argument. We can use utilities like `last_output` and `last_message` to access the last message and output in the conversation.</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">airetry!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">split</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_output</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x), </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">r&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> |</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\\.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, out,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;You must answer with 1 word only.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Let&#39;s ensure that the output is in lowercase - simple and short</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">airetry!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(islowercase, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_output</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x)), out, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You must answer in lowercase.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [ Info: Condition not met. Retrying...</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Let&#39;s add final hint - it took us 2 retries</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">airetry!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> startswith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_output</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x), </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;y&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), out, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;It starts with &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [ Info: Condition not met. Retrying...</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [ Info: Condition not met. Retrying...</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## We end up with the correct answer</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_output</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(out)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: &quot;yellow&quot;</span></span></code></pre></div><p>Let&#39;s explore how we got here. We save the various attempts in a &quot;tree&quot; (SampleNode object) You can access it in <code>out.samples</code>, which is the ROOT of the tree (top level). Currently &quot;active&quot; sample ID is <code>out.active_sample_id</code> -&gt; that&#39;s the same as <code>conversation</code> field in your AICall.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Root node:</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">samples</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: SampleNode(id: 46839, stats: 6/12, length: 2)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Active sample (our correct answer):</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">active_sample_id </span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: 50086</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Let&#39;s obtain the active sample node with this ID  - use getindex notation or function find_node</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">samples[out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">active_sample_id]</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: SampleNode(id: 50086, stats: 1/1, length: 7)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The SampleNode has two key fields: data and feedback. Data is where the conversation is stored:</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">active_sample </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">samples[out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">active_sample_id]</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">active_sample</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conversation </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: true -&gt; This is the winning guess!</span></span></code></pre></div><p>We also get a clear view of the tree structure of all samples with <code>print_samples</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">julia</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> print_samples</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">samples)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SampleNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 46839</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, stats</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">12</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">├─ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SampleNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 12940</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, stats</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.41</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">│  ├─ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SampleNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 34315</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, stats</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.77</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">│  │  ├─ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SampleNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20493</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, stats</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2.67</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">│  │  └─ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SampleNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 50086</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, stats</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2.67</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">│  └─ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SampleNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2733</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, stats</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.94</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">└─ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SampleNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 48343</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, stats</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.36</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   ├─ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SampleNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30088</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, stats</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.67</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   └─ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SampleNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 44816</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, stats</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.67</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>You can use the <code>id</code> to grab and inspect any of these nodes, eg,</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">samples[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2733</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: SampleNode(id: 2733, stats: 1/2, length: 5)</span></span></code></pre></div><p>We can also iterate through all samples and extract whatever information we want with <code>PostOrderDFS</code> or <code>PreOrderDFS</code> (exported from AbstractTrees.jl)</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sample </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> PostOrderDFS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">samples)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Data is the universal field for samples, we put `conversation` in there</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Last item in data is the last message in coversation</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sample</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">isa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AIMessage </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># skip feedback</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # get only the message content, ie, the guess</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ID: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(sample</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, Answer: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">content)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ID: 20493, Answer: yellow</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ID: 50086, Answer: yellow</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ID: 2733, Answer: red</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ID: 30088, Answer: blue</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ID: 44816, Answer: blue</span></span></code></pre></div><p>Note: <code>airetry!</code> will attempt to fix the model <code>max_retries</code> times. If you set <code>throw=true</code>, it will throw an ErrorException if the condition is not met after <code>max_retries</code> retries.</p><p>Let&#39;s define a mini program to guess the number and use <code>airetry!</code> to guide the model to the correct answer:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    llm_guesser()</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Mini program to guess the number provided by the user (betwee 1-100).</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> llm_guesser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(user_number</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    @assert</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user_number </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;&quot;</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">I&#39;m thinking a number between 1-100. Guess which one it is. </span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">You must respond only with digits and nothing else. </span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Your guess:&quot;&quot;&quot;</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## 2 samples at a time, max 5 fixing rounds</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    out </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AIGenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt; config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> RetryConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; n_samples </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, max_retries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        api_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> run!</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## Check the proper output format - must parse to Int, use do-syntax</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## We can provide feedback via a function!</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> feedback_f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aicall)</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;Output: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(last_output(aicall))</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Feedback: You must respond only with digits!!&quot;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    airetry!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(out, feedback_f) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aicall</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        !</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isnothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tryparse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Int, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_output</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aicall)))</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## Give a hint on bounds</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lower_bound </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (user_number </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">÷</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    upper_bound </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lower_bound </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    airetry!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        out, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;The number is between or equal to </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$lower_bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$upper_bound</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aicall</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        guess </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tryparse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Int, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_output</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aicall))</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        lower_bound </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> guess </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> upper_bound</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## You can make at most 3x guess now -- if there is max_retries in `config.max_retries` left</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    max_retries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">retries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> feedback_f2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aicall)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        guess </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tryparse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Int, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_output</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aicall))</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;Your guess of </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(guess)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is wrong, it&#39;s </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(abs(guess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">user_number))</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> numbers away.&quot;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    airetry!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(out, feedback_f2; max_retries) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aicall</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        tryparse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Int, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_output</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aicall)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user_number</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## Evaluate the best guess</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    @info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Results: Guess: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(last_output(out))</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vs User: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$user_number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> (Number of calls made: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">calls)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)&quot;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> out</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Let&#39;s play the game</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">out </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> llm_guesser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">33</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ Info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Condition not met. Retrying</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ Info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Condition not met. Retrying</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ Info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Condition not met. Retrying</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ Info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Condition not met. Retrying</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ Info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Results</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Guess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 33</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vs User</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 33</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Number of calls made</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Yay! We got it 😃</p><p>Now, we could explore different samples (eg, <code>print_samples(out.samples)</code>) or see what the model guessed at each step:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print_samples</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">samples)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## SampleNode(id: 57694, stats: 6/14, score: 0.43, length: 2)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## ├─ SampleNode(id: 35603, stats: 5/10, score: 1.23, length: 4)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## │  ├─ SampleNode(id: 55394, stats: 1/4, score: 1.32, length: 6)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## │  │  ├─ SampleNode(id: 20737, stats: 0/1, score: 1.67, length: 7)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## │  │  └─ SampleNode(id: 52910, stats: 0/1, score: 1.67, length: 7)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## │  └─ SampleNode(id: 43094, stats: 3/4, score: 1.82, length: 6)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## │     ├─ SampleNode(id: 14966, stats: 1/1, score: 2.67, length: 7)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## │     └─ SampleNode(id: 32991, stats: 1/1, score: 2.67, length: 7)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## └─ SampleNode(id: 20506, stats: 1/4, score: 1.4, length: 4)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##    ├─ SampleNode(id: 37581, stats: 0/1, score: 1.67, length: 5)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##    └─ SampleNode(id: 46632, stats: 0/1, score: 1.67, length: 5)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Lastly, let&#39;s check all the guesses AI made across all samples. </span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Our winning guess was ID 32991 (`out.active_sample_id`)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sample </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> PostOrderDFS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">samples)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ID: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(sample</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, Guess: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">content)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sample</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">isa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AIMessage]</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## ID: 20737, Guess: 50</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## ID: 20737, Guess: 35</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## ID: 20737, Guess: 37</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## ID: 52910, Guess: 50</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## ID: 52910, Guess: 35</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## ID: 52910, Guess: 32</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## ID: 14966, Guess: 50</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## ID: 14966, Guess: 35</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## ID: 14966, Guess: 33</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## ID: 32991, Guess: 50</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## ID: 32991, Guess: 35</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## ID: 32991, Guess: 33</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## etc...</span></span></code></pre></div><p>Note that if there are multiple &quot;branches&quot; the model will see only the feedback of its own and its ancestors not the other &quot;branches&quot;. If you wanted to provide ALL feedback, set <code>RetryConfig(; n_samples=1)</code> to remove any &quot;branching&quot;. It fixing will be done sequentially in one conversation and the model will see all feedback (less powerful if the model falls into a bad state). Alternatively, you can tweak the feedback function.</p><p><strong>See Also</strong></p><p>References: <code>airetry</code> is inspired by the <a href="https://arxiv.org/abs/2310.04406" target="_blank" rel="noreferrer">Language Agent Tree Search paper</a> and by <a href="https://arxiv.org/abs/2312.13382" target="_blank" rel="noreferrer">DSPy Assertions paper</a>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/retry.jl#L1-L283" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.backpropagate!-Tuple{PromptingTools.Experimental.AgentTools.SampleNode}" href="#PromptingTools.Experimental.AgentTools.backpropagate!-Tuple{PromptingTools.Experimental.AgentTools.SampleNode}">#</a> <b><u>PromptingTools.Experimental.AgentTools.backpropagate!</u></b> — <i>Method</i>. <p>Provides scores for a given node (and all its ancestors) based on the evaluation (<code>wins</code>, <code>visits</code>).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/mcts.jl#L108" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.beta_sample-Tuple{Real, Real}" href="#PromptingTools.Experimental.AgentTools.beta_sample-Tuple{Real, Real}">#</a> <b><u>PromptingTools.Experimental.AgentTools.beta_sample</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">beta_sample</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(α</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Real</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, β</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Real</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Approximates a sample from the Beta distribution by generating two independent Gamma distributed samples and using their ratio.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/utils.jl#L137-L141" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.collect_all_feedback-Tuple{PromptingTools.Experimental.AgentTools.SampleNode}" href="#PromptingTools.Experimental.AgentTools.collect_all_feedback-Tuple{PromptingTools.Experimental.AgentTools.SampleNode}">#</a> <b><u>PromptingTools.Experimental.AgentTools.collect_all_feedback</u></b> — <i>Method</i>. <p>Collects all feedback from the node and its ancestors (parents). Returns a string separated by <code>separator</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/mcts.jl#L234" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.error_feedback-Tuple{Any}" href="#PromptingTools.Experimental.AgentTools.error_feedback-Tuple{Any}">#</a> <b><u>PromptingTools.Experimental.AgentTools.error_feedback</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">error_feedback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 512</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Set of specialized methods to provide feedback on different types of errors (<code>e</code>).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/code_feedback.jl#L175-L179" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.evaluate_condition!" href="#PromptingTools.Experimental.AgentTools.evaluate_condition!">#</a> <b><u>PromptingTools.Experimental.AgentTools.evaluate_condition!</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">evaluate_condition!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(f_cond</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, aicall</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AICallBlock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    feedback</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{AbstractString, Function}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    evaluate_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, feedback_expensive</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Evalutes the condition <code>f_cond</code> (must return Bool) on the <code>aicall</code> object. If the condition is not met, it will return the best sample to retry from and provide <code>feedback</code>.</p><p>Mutating as the results are saved in <code>aicall.samples</code></p><p>If <code>evaluate_all</code> is <code>true</code>, it will evaluate all the &quot;successful&quot; samples in the <code>aicall</code> object. Otherwise, it will only evaluate the active sample..</p><p>For <code>f_cond</code> and <code>feedback</code> functions, you can use the <code>last_message</code> and <code>last_output</code> utilities to access the last message and last output in the conversation, respectively.</p><p><strong>Arguments</strong></p><ul><li><p><code>f_cond::Function</code>: A function that accepts the <code>aicall</code> object and returns a boolean value. Retry will be attempted if the condition is not met (<code>f_cond -&gt; false</code>).</p></li><li><p><code>aicall::AICallBlock</code>: The <code>aicall</code> object to evaluate the condition on.</p></li><li><p><code>feedback::Union{AbstractString, Function}</code>: Feedback to provide if the condition is not met. If a function is provided, it must accept the <code>aicall</code> object as the only argument and return a string.</p></li><li><p><code>evaluate_all::Bool=false</code>: If true, it will evaluate all the &quot;successful&quot; samples in the <code>aicall</code> object. Otherwise, it will only evaluate the active sample.</p></li><li><p><code>feedback_expensive::Bool=false</code>: If false, it will provide feedback to all samples that fail the condition. If <code>feedback</code> function is expensive to call (eg, another ai* function), set this to <code>true</code> and feedback will be provided only to the sample we will retry from.</p></li></ul><p><strong>Returns</strong></p><ul><li>a tuple <code>(condition_passed, sample)</code>, where <code>condition_passed</code> is a boolean indicating whether the condition was met, and <code>sample</code> is the best sample to retry from.</li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Mimic AIGenerate run!</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">aicall </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AIGenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> RetryConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; n_samples </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sample </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> expand!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aicall</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">samples, aicall</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conversation; success </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">aicall</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">active_sample_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sample</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Return whether it passed and node to take the next action from</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cond, node </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">evaluate_condition!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> occursin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_output</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x)), aicall)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Checks:</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cond </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">node </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sample</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wins </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span></code></pre></div><p>With feedback: ```julia</p><p><strong>Mimic AIGenerate run with feedback</strong></p><p>aicall = AIGenerate( :BlankSystemUser; system = &quot;a&quot;, user = &quot;b&quot;) sample = expand!(aicall.samples, aicall.conversation; success = true) aicall.active_sample_id = sample.id</p><p><strong>Evaluate</strong></p><p>cond, node = AT.evaluate_condition!( x -&gt; occursin(&quot;NOTFOUND&quot;, last_output(x)), aicall, &quot;Feedback X&quot;) cond == false # fail sample == node # same node (no other choice) node.wins == 0 node.feedback == &quot; Feedback X&quot;</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/retry.jl#L344-L401" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.expand!-Tuple{PromptingTools.Experimental.AgentTools.SampleNode, Any}" href="#PromptingTools.Experimental.AgentTools.expand!-Tuple{PromptingTools.Experimental.AgentTools.SampleNode, Any}">#</a> <b><u>PromptingTools.Experimental.AgentTools.expand!</u></b> — <i>Method</i>. <p>Expands the tree with a new node from <code>parent</code> using the given <code>data</code> and <code>success</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/mcts.jl#L100" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.extract_config-Union{Tuple{T}, Tuple{Any, T}} where T" href="#PromptingTools.Experimental.AgentTools.extract_config-Union{Tuple{T}, Tuple{Any, T}} where T">#</a> <b><u>PromptingTools.Experimental.AgentTools.extract_config</u></b> — <i>Method</i>. <p>Extracts <code>config::RetryConfig</code> from kwargs and returns the rest of the kwargs.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/utils.jl#L37" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.find_node-Tuple{PromptingTools.Experimental.AgentTools.SampleNode, Integer}" href="#PromptingTools.Experimental.AgentTools.find_node-Tuple{PromptingTools.Experimental.AgentTools.SampleNode, Integer}">#</a> <b><u>PromptingTools.Experimental.AgentTools.find_node</u></b> — <i>Method</i>. <p>Finds a node with a given <code>id</code> in the tree starting from <code>node</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/mcts.jl#L208" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.gamma_sample-Tuple{Real, Real}" href="#PromptingTools.Experimental.AgentTools.gamma_sample-Tuple{Real, Real}">#</a> <b><u>PromptingTools.Experimental.AgentTools.gamma_sample</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">gamma_sample</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(α</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Real</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, θ</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Real</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Approximates a sample from the Gamma distribution using the Marsaglia and Tsang method.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/utils.jl#L111-L115" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.print_samples-Tuple{PromptingTools.Experimental.AgentTools.SampleNode}" href="#PromptingTools.Experimental.AgentTools.print_samples-Tuple{PromptingTools.Experimental.AgentTools.SampleNode}">#</a> <b><u>PromptingTools.Experimental.AgentTools.print_samples</u></b> — <i>Method</i>. <p>Pretty prints the samples tree starting from <code>node</code>. Usually, <code>node</code> is the root of the tree. Example: <code>print_samples(aicall.samples)</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/mcts.jl#L218" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.remove_used_kwargs-Tuple{NamedTuple, AbstractVector{&lt;:PromptingTools.AbstractMessage}}" href="#PromptingTools.Experimental.AgentTools.remove_used_kwargs-Tuple{NamedTuple, AbstractVector{&lt;:PromptingTools.AbstractMessage}}">#</a> <b><u>PromptingTools.Experimental.AgentTools.remove_used_kwargs</u></b> — <i>Method</i>. <p>Removes the kwargs that have already been used in the conversation. Returns NamedTuple.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/utils.jl#L1" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.reset_success!" href="#PromptingTools.Experimental.AgentTools.reset_success!">#</a> <b><u>PromptingTools.Experimental.AgentTools.reset_success!</u></b> — <i>Function</i>. <p>Sets the <code>success</code> field of all nodes in the tree to <code>success</code> value.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/mcts.jl#L226" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.run!-Tuple{AICodeFixer}" href="#PromptingTools.Experimental.AgentTools.run!-Tuple{AICodeFixer}">#</a> <b><u>PromptingTools.Experimental.AgentTools.run!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">run!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(codefixer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AICodeFixer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, max_conversation_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, run_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Executes the code fixing process encapsulated by the <code>AICodeFixer</code> instance. This method iteratively refines and fixes code by running the AI call in a loop for a specified number of rounds, using feedback from the code evaluation (<code>aicodefixer_feedback</code>) to improve the outcome in each iteration.</p><p><strong>Arguments</strong></p><ul><li><p><code>codefixer::AICodeFixer</code>: An instance of <code>AICodeFixer</code> containing the AI call, templates, and settings for the code fixing session.</p></li><li><p><code>verbose::Int=1</code>: Verbosity level for logging. A higher value indicates more detailed logging.</p></li><li><p><code>max_conversation_length::Int=32000</code>: Maximum length in characters for the conversation history to keep it within manageable limits, especially for large code fixing sessions.</p></li><li><p><code>num_rounds::Union{Nothing, Int}=nothing</code>: Number of additional rounds for the code fixing session. If <code>nothing</code>, the value from the <code>AICodeFixer</code> instance is used.</p></li><li><p><code>run_kwargs...</code>: Additional keyword arguments that are passed to the AI function.</p></li></ul><p><strong>Returns</strong></p><ul><li><code>AICodeFixer</code>: The updated <code>AICodeFixer</code> instance with the results of the code fixing session.</li></ul><p><strong>Usage</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">aicall </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AICall</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aigenerate, schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mySchema, conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">myConversation)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">codefixer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AICodeFixer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aicall, myTemplates; num_rounds</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> run!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(codefixer, verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>Notes</strong></p><ul><li><p>The <code>run!</code> method drives the core logic of the <code>AICodeFixer</code>, iterating through rounds of AI interactions to refine and fix code.</p></li><li><p>In each round, it applies feedback based on the current state of the conversation, allowing the AI to respond more effectively.</p></li><li><p>The conversation history is managed to ensure it stays within the specified <code>max_conversation_length</code>, keeping the AI&#39;s focus on relevant parts of the conversation.</p></li><li><p>This iterative process is essential for complex code fixing tasks where multiple interactions and refinements are required to achieve the desired outcome.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/lazy_types.jl#L474-L502" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.run!-Tuple{PromptingTools.Experimental.AgentTools.AICallBlock}" href="#PromptingTools.Experimental.AgentTools.run!-Tuple{PromptingTools.Experimental.AgentTools.AICallBlock}">#</a> <b><u>PromptingTools.Experimental.AgentTools.run!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">run!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aicall</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AICallBlock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, catch_errors</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Executes the AI call wrapped by an <code>AICallBlock</code> instance. This method triggers the actual communication with the AI model and processes the response based on the provided conversation context and parameters.</p><p>Note: Currently <code>return_all</code> must always be set to true.</p><p><strong>Arguments</strong></p><ul><li><p><code>aicall::AICallBlock</code>: An instance of <code>AICallBlock</code> which encapsulates the AI function call along with its context and parameters (eg, <code>AICall</code>, <code>AIGenerate</code>)</p></li><li><p><code>verbose::Integer=1</code>: A verbosity level for logging. A higher value indicates more detailed logging.</p></li><li><p><code>catch_errors::Union{Nothing, Bool}=nothing</code>: A flag to indicate whether errors should be caught and saved to <code>aicall.error</code>. If <code>nothing</code>, it defaults to <code>aicall.config.catch_errors</code>.</p></li><li><p><code>return_all::Bool=true</code>: A flag to indicate whether the whole conversation from the AI call should be returned. It should always be true.</p></li><li><p><code>kwargs...</code>: Additional keyword arguments that are passed to the AI function.</p></li></ul><p><strong>Returns</strong></p><ul><li><code>AICallBlock</code>: The same <code>AICallBlock</code> instance, updated with the results of the AI call. This includes updated conversation, success status, and potential error information.</li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">aicall </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AICall</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aigenerate)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">run!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aicall)</span></span></code></pre></div><p>Alternatively, you can trigger the <code>run!</code> call by using the AICall as a functor and calling it with a string or a UserMessage:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">aicall </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AICall</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(aigenerate)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aicall</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>Notes</strong></p><ul><li><p>The <code>run!</code> method is a key component of the lazy evaluation model in <code>AICall</code>. It allows for the deferred execution of AI function calls, providing flexibility in how and when AI interactions are conducted.</p></li><li><p>The method updates the <code>AICallBlock</code> instance with the outcome of the AI call, including any generated responses, success or failure status, and error information if an error occurred.</p></li><li><p>This method is essential for scenarios where AI interactions are based on dynamic or evolving contexts, as it allows for real-time updates and responses based on the latest information.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/lazy_types.jl#L190-L223" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.score-Tuple{PromptingTools.Experimental.AgentTools.SampleNode, PromptingTools.Experimental.AgentTools.ThompsonSampling}" href="#PromptingTools.Experimental.AgentTools.score-Tuple{PromptingTools.Experimental.AgentTools.SampleNode, PromptingTools.Experimental.AgentTools.ThompsonSampling}">#</a> <b><u>PromptingTools.Experimental.AgentTools.score</u></b> — <i>Method</i>. <p>Scores a node using the ThomsonSampling method, similar to Bandit algorithms.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/mcts.jl#L131" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.score-Tuple{PromptingTools.Experimental.AgentTools.SampleNode, PromptingTools.Experimental.AgentTools.UCT}" href="#PromptingTools.Experimental.AgentTools.score-Tuple{PromptingTools.Experimental.AgentTools.SampleNode, PromptingTools.Experimental.AgentTools.UCT}">#</a> <b><u>PromptingTools.Experimental.AgentTools.score</u></b> — <i>Method</i>. <p>Scores a node using the UCT (Upper Confidence Bound for Trees) method.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/mcts.jl#L123" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.select_best" href="#PromptingTools.Experimental.AgentTools.select_best">#</a> <b><u>PromptingTools.Experimental.AgentTools.select_best</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">select_best</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SampleNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, scoring</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractScoringMethod</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> UCT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ordering</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Symbol</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :PostOrderDFS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Selects the best node from the tree using the given <code>scoring</code> (<code>UCT</code> or <code>ThompsonSampling</code>). Defaults to UCT. Thompson Sampling is more random with small samples, while UCT stabilizes much quicker thanks to looking at parent nodes as well.</p><p>Ordering can be either <code>:PreOrderDFS</code> or <code>:PostOrderDFS</code>. Defaults to <code>:PostOrderDFS</code>, which favors the leaves (end points of the tree).</p><p><strong>Example</strong></p><p>Compare the different scoring methods:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Set up mock samples and scores</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AbstractMessage[]</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">root </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SampleNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; data)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">child1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> expand!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(root, data)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">backpropagate!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(child1; wins </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, visits </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">child2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> expand!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(root, data)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">backpropagate!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(child2; wins </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, visits </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">child11 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> expand!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(child1, data)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">backpropagate!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(child11; wins </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, visits </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Select with UCT</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> select_best</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(root, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UCT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SampleNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 29826</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, stats</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Show the tree:</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print_samples</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(root; scoring </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> UCT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## SampleNode(id: 13184, stats: 2/3, score: 0.67, length: 0)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## ├─ SampleNode(id: 26078, stats: 2/2, score: 2.05, length: 0)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## │  └─ SampleNode(id: 29826, stats: 1/1, score: 2.18, length: 0)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## └─ SampleNode(id: 39931, stats: 0/1, score: 1.48, length: 0)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Select with ThompsonSampling - much more random with small samples</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> select_best</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(root, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ThompsonSampling</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SampleNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 26078</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, stats</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Show the tree (run it a few times and see how the scores jump around):</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print_samples</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(root; scoring </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ThompsonSampling</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## SampleNode(id: 13184, stats: 2/3, score: 0.6, length: 0)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## ├─ SampleNode(id: 26078, stats: 2/2, score: 0.93, length: 0)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## │  └─ SampleNode(id: 29826, stats: 1/1, score: 0.22, length: 0)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## └─ SampleNode(id: 39931, stats: 0/1, score: 0.84, length: 0)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/mcts.jl#L137-L182" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.split_multi_samples-Tuple{Any}" href="#PromptingTools.Experimental.AgentTools.split_multi_samples-Tuple{Any}">#</a> <b><u>PromptingTools.Experimental.AgentTools.split_multi_samples</u></b> — <i>Method</i>. <p>If the conversation has multiple AIMessage samples, split them into separate conversations with the common past.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/utils.jl#L51" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.truncate_conversation-Tuple{AbstractVector{&lt;:PromptingTools.AbstractMessage}}" href="#PromptingTools.Experimental.AgentTools.truncate_conversation-Tuple{AbstractVector{&lt;:PromptingTools.AbstractMessage}}">#</a> <b><u>PromptingTools.Experimental.AgentTools.truncate_conversation</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">truncate_conversation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:PT.AbstractMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    max_conversation_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Truncates a given conversation to a <code>max_conversation_length</code> characters by removing messages &quot;in the middle&quot;. It tries to retain the original system+user message and also the most recent messages.</p><p>Practically, if a conversation is too long, it will start by removing the most recent message EXCEPT for the last two (assumed to be the last AIMessage with the code and UserMessage with the feedback</p><p><strong>Arguments</strong></p><p><code>max_conversation_length</code> is in characters; assume c. 2-3 characters per LLM token, so 32000 should correspond to 16K context window.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/utils.jl#L71-L82" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.AgentTools.unwrap_aicall_args-Tuple{Any}" href="#PromptingTools.Experimental.AgentTools.unwrap_aicall_args-Tuple{Any}">#</a> <b><u>PromptingTools.Experimental.AgentTools.unwrap_aicall_args</u></b> — <i>Method</i>. <p>Unwraps the arguments for AICall and returns the schema and conversation (if provided). Expands any provided AITemplate.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/utils.jl#L13" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.last_message-Tuple{PromptingTools.Experimental.AgentTools.AICallBlock}" href="#PromptingTools.last_message-Tuple{PromptingTools.Experimental.AgentTools.AICallBlock}">#</a> <b><u>PromptingTools.last_message</u></b> — <i>Method</i>. <p>Helpful accessor for AICall blocks. Returns the last message in the conversation.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/lazy_types.jl#L326" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.last_output-Tuple{PromptingTools.Experimental.AgentTools.AICallBlock}" href="#PromptingTools.last_output-Tuple{PromptingTools.Experimental.AgentTools.AICallBlock}">#</a> <b><u>PromptingTools.last_output</u></b> — <i>Method</i>. <p>Helpful accessor for AICall blocks. Returns the last output in the conversation (eg, the string/data in the last message).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/ed10099e0ddb3cf865485049cbacdc2bab95f9b9/src/Experimental/AgentTools/lazy_types.jl#L331" target="_blank" rel="noreferrer">source</a></p></div><br>', 76)
  ]));
}
const reference_agenttools = /* @__PURE__ */ _export_sfc(_sfc_main, [["render", _sfc_render]]);
export {
  __pageData,
  reference_agenttools as default
};
