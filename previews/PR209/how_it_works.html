<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How It Works | PromptingTools.jl</title>
    <meta name="description" content="Streamline Your Interactions with GenAI Models. Discover the power of GenerativeAI and build mini workflows to save you 20 minutes every day.">
    <meta name="generator" content="VitePress v1.3.4">
    <link rel="preload stylesheet" href="/PromptingTools.jl/previews/PR209/assets/style.-1v4JHgs.css" as="style">
    
    <script type="module" src="/PromptingTools.jl/previews/PR209/assets/app.Dwgrq7Ox.js"></script>
    <link rel="preload" href="/PromptingTools.jl/previews/PR209/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/PromptingTools.jl/previews/PR209/assets/chunks/theme.RwEGEYAa.js">
    <link rel="modulepreload" href="/PromptingTools.jl/previews/PR209/assets/chunks/framework.DbPo4xPY.js">
    <link rel="modulepreload" href="/PromptingTools.jl/previews/PR209/assets/how_it_works.md.CDZ0Zluk.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-a9a9e638><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c3508ec8></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c3508ec8> Skip to content </a><!--]--><!----><header class="VPNav" data-v-a9a9e638 data-v-f1e365da><div class="VPNavBar" data-v-f1e365da data-v-822684d1><div class="wrapper" data-v-822684d1><div class="container" data-v-822684d1><div class="title" data-v-822684d1><div class="VPNavBarTitle has-sidebar" data-v-822684d1 data-v-28a961f9><a class="title" href="/PromptingTools.jl/previews/PR209/" data-v-28a961f9><!--[--><!--]--><!--[--><img class="VPImage logo" src="/PromptingTools.jl/previews/PR209/logo.png" width="24" height="24" alt data-v-35a7d0b8><!--]--><span data-v-28a961f9>PromptingTools.jl</span><!--[--><!--]--></a></div></div><div class="content" data-v-822684d1><div class="content-body" data-v-822684d1><!--[--><!--]--><div class="VPNavBarSearch search" data-v-822684d1><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-822684d1 data-v-e6d46098><span id="main-nav-aria-label" class="visually-hidden" data-v-e6d46098> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/PromptingTools.jl/previews/PR209/index" tabindex="0" data-v-e6d46098 data-v-ed5ac1f6><!--[--><span data-v-ed5ac1f6>Home</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-e6d46098 data-v-e5380155><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-e5380155><span class="text" data-v-e5380155><!----><span data-v-e5380155>Manual</span><span class="vpi-chevron-down text-icon" data-v-e5380155></span></span></button><div class="menu" data-v-e5380155><div class="VPMenu" data-v-e5380155 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/getting_started" data-v-8b74d055><!--[-->Getting Started<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-8b74d055><a class="VPLink link active" href="/PromptingTools.jl/previews/PR209/how_it_works" data-v-8b74d055><!--[-->How It Works<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/coverage_of_model_providers" data-v-8b74d055><!--[-->Coverage of Model Providers<!--]--></a></div><!--]--><!--[--><div class="VPMenuGroup" data-v-7dd3104a data-v-48c802d0><p class="title" data-v-48c802d0>Examples</p><!--[--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/examples/readme_examples" data-v-8b74d055><!--[-->Various examples<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/examples/working_with_aitemplates" data-v-8b74d055><!--[-->Using AITemplates<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/examples/working_with_ollama" data-v-8b74d055><!--[-->Local models with Ollama.ai<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/examples/working_with_google_ai_studio" data-v-8b74d055><!--[-->Google AIStudio<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/examples/working_with_custom_apis" data-v-8b74d055><!--[-->Custom APIs (Mistral, Llama.cpp)<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/examples/building_RAG" data-v-8b74d055><!--[-->Building RAG Application<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-7dd3104a data-v-48c802d0><p class="title" data-v-48c802d0>Extra Tools</p><!--[--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/extra_tools/text_utilities_intro" data-v-8b74d055><!--[-->Text Utilities<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/extra_tools/agent_tools_intro" data-v-8b74d055><!--[-->AgentTools<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/extra_tools/rag_tools_intro" data-v-8b74d055><!--[-->RAGTools<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/extra_tools/api_tools_intro" data-v-8b74d055><!--[-->APITools<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/PromptingTools.jl/previews/PR209/frequently_asked_questions" tabindex="0" data-v-e6d46098 data-v-ed5ac1f6><!--[--><span data-v-ed5ac1f6>F.A.Q.</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e6d46098 data-v-e5380155><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-e5380155><span class="text" data-v-e5380155><!----><span data-v-e5380155>Prompt Templates</span><span class="vpi-chevron-down text-icon" data-v-e5380155></span></span></button><div class="menu" data-v-e5380155><div class="VPMenu" data-v-e5380155 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/prompts/general" data-v-8b74d055><!--[-->General<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/prompts/persona-task" data-v-8b74d055><!--[-->Persona-Task<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/prompts/visual" data-v-8b74d055><!--[-->Visual<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/prompts/classification" data-v-8b74d055><!--[-->Classification<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/prompts/extraction" data-v-8b74d055><!--[-->Extraction<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/prompts/agents" data-v-8b74d055><!--[-->Agents<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/prompts/RAG" data-v-8b74d055><!--[-->RAG<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e6d46098 data-v-e5380155><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-e5380155><span class="text" data-v-e5380155><!----><span data-v-e5380155>Reference</span><span class="vpi-chevron-down text-icon" data-v-e5380155></span></span></button><div class="menu" data-v-e5380155><div class="VPMenu" data-v-e5380155 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/reference" data-v-8b74d055><!--[-->PromptingTools.jl<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/reference_experimental" data-v-8b74d055><!--[-->Experimental Modules<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/reference_ragtools" data-v-8b74d055><!--[-->RAGTools<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/reference_agenttools" data-v-8b74d055><!--[-->AgentTools<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-8b74d055><a class="VPLink link" href="/PromptingTools.jl/previews/PR209/reference_apitools" data-v-8b74d055><!--[-->APITools<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-822684d1 data-v-af096f4a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-af096f4a data-v-e40a8bb6 data-v-4a1c76db><span class="check" data-v-4a1c76db><span class="icon" data-v-4a1c76db><!--[--><span class="vpi-sun sun" data-v-e40a8bb6></span><span class="vpi-moon moon" data-v-e40a8bb6></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-822684d1 data-v-164c457f data-v-ee7a9424><!--[--><a class="VPSocialLink no-icon" href="https://github.com/svilupp/PromptingTools.jl" aria-label="github" target="_blank" rel="noopener" data-v-ee7a9424 data-v-717b8b75><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-822684d1 data-v-925effce data-v-e5380155><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-e5380155><span class="vpi-more-horizontal icon" data-v-e5380155></span></button><div class="menu" data-v-e5380155><div class="VPMenu" data-v-e5380155 data-v-7dd3104a><!----><!--[--><!--[--><!----><div class="group" data-v-925effce><div class="item appearance" data-v-925effce><p class="label" data-v-925effce>Appearance</p><div class="appearance-action" data-v-925effce><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-925effce data-v-e40a8bb6 data-v-4a1c76db><span class="check" data-v-4a1c76db><span class="icon" data-v-4a1c76db><!--[--><span class="vpi-sun sun" data-v-e40a8bb6></span><span class="vpi-moon moon" data-v-e40a8bb6></span><!--]--></span></span></button></div></div></div><div class="group" data-v-925effce><div class="item social-links" data-v-925effce><div class="VPSocialLinks social-links-list" data-v-925effce data-v-ee7a9424><!--[--><a class="VPSocialLink no-icon" href="https://github.com/svilupp/PromptingTools.jl" aria-label="github" target="_blank" rel="noopener" data-v-ee7a9424 data-v-717b8b75><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-822684d1 data-v-5dea55bf><span class="container" data-v-5dea55bf><span class="top" data-v-5dea55bf></span><span class="middle" data-v-5dea55bf></span><span class="bottom" data-v-5dea55bf></span></span></button></div></div></div></div><div class="divider" data-v-822684d1><div class="divider-line" data-v-822684d1></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-a9a9e638 data-v-070ab83d><div class="container" data-v-070ab83d><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-070ab83d><span class="vpi-align-left menu-icon" data-v-070ab83d></span><span class="menu-text" data-v-070ab83d>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-070ab83d data-v-bc9dc845><button data-v-bc9dc845>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-a9a9e638 data-v-18756405><div class="curtain" data-v-18756405></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-18756405><span class="visually-hidden" id="sidebar-aria-label" data-v-18756405> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-196b2e5f><!----><div class="items" data-v-196b2e5f><!--[--><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/index" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Home</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0 has-active" data-v-9e426adc data-v-196b2e5f><div class="item" role="button" tabindex="0" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><h2 class="text" data-v-196b2e5f>Manual</h2><!----></div><div class="items" data-v-196b2e5f><!--[--><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/getting_started" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Getting Started</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/how_it_works" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>How It Works</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/coverage_of_model_providers" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Coverage of Model Providers</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 collapsible collapsed" data-v-196b2e5f data-v-196b2e5f><div class="item" role="button" tabindex="0" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><h3 class="text" data-v-196b2e5f>Examples</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-196b2e5f><span class="vpi-chevron-right caret-icon" data-v-196b2e5f></span></div></div><div class="items" data-v-196b2e5f><!--[--><div class="VPSidebarItem level-2 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/examples/readme_examples" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Various examples</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/examples/working_with_aitemplates" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Using AITemplates</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/examples/working_with_ollama" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Local models with Ollama.ai</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/examples/working_with_google_ai_studio" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Google AIStudio</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/examples/working_with_custom_apis" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Custom APIs (Mistral, Llama.cpp)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/examples/building_RAG" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Building RAG Application</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-196b2e5f data-v-196b2e5f><div class="item" role="button" tabindex="0" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><h3 class="text" data-v-196b2e5f>Extra Tools</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-196b2e5f><span class="vpi-chevron-right caret-icon" data-v-196b2e5f></span></div></div><div class="items" data-v-196b2e5f><!--[--><div class="VPSidebarItem level-2 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/extra_tools/text_utilities_intro" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Text Utilities</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/extra_tools/agent_tools_intro" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>AgentTools</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/extra_tools/rag_tools_intro" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>RAGTools</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/extra_tools/api_tools_intro" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>APITools</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-196b2e5f><!----><div class="items" data-v-196b2e5f><!--[--><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/frequently_asked_questions" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>F.A.Q.</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0 collapsible collapsed" data-v-9e426adc data-v-196b2e5f><div class="item" role="button" tabindex="0" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><h2 class="text" data-v-196b2e5f>Prompt Templates</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-196b2e5f><span class="vpi-chevron-right caret-icon" data-v-196b2e5f></span></div></div><div class="items" data-v-196b2e5f><!--[--><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/prompts/general" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>General</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/prompts/persona-task" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Persona-Task</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/prompts/visual" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Visual</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/prompts/classification" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Classification</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/prompts/extraction" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Extraction</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/prompts/agents" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Agents</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/prompts/RAG" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>RAG</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0 collapsible collapsed" data-v-9e426adc data-v-196b2e5f><div class="item" role="button" tabindex="0" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><h2 class="text" data-v-196b2e5f>Reference</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-196b2e5f><span class="vpi-chevron-right caret-icon" data-v-196b2e5f></span></div></div><div class="items" data-v-196b2e5f><!--[--><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/reference" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>PromptingTools.jl</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/reference_experimental" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Experimental Modules</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/reference_ragtools" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>RAGTools</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/reference_agenttools" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>AgentTools</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/PromptingTools.jl/previews/PR209/reference_apitools" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>APITools</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-a9a9e638 data-v-91765379><div class="VPDoc has-sidebar has-aside" data-v-91765379 data-v-83890dd9><!--[--><!--]--><div class="container" data-v-83890dd9><div class="aside" data-v-83890dd9><div class="aside-curtain" data-v-83890dd9></div><div class="aside-container" data-v-83890dd9><div class="aside-content" data-v-83890dd9><div class="VPDocAside" data-v-83890dd9 data-v-6d7b3c46><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-6d7b3c46 data-v-b38bf2ff><div class="content" data-v-b38bf2ff><div class="outline-marker" data-v-b38bf2ff></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-b38bf2ff>On this page</div><ul class="VPDocOutlineItem root" data-v-b38bf2ff data-v-3f927ebe><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-6d7b3c46></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-83890dd9><div class="content-container" data-v-83890dd9><!--[--><!--]--><main class="main" data-v-83890dd9><div style="position:relative;" class="vp-doc _PromptingTools_jl_previews_PR209_how_it_works" data-v-83890dd9><div><h1 id="How-It-Works" tabindex="-1">How It Works <a class="header-anchor" href="#How-It-Works" aria-label="Permalink to &quot;How It Works {#How-It-Works}&quot;">​</a></h1><p>This is an advanced section that explains how PromptingTools.jl works under the hood. It is not necessary to understand this to use the package, but it can be helpful for debugging and understanding the limitations of the package.</p><p>We&#39;ll start with the key concepts and then walk through an example of <code>aigenerate</code> to see how it all fits together.</p><h2 id="Key-Concepts" tabindex="-1">Key Concepts <a class="header-anchor" href="#Key-Concepts" aria-label="Permalink to &quot;Key Concepts {#Key-Concepts}&quot;">​</a></h2><p>5 Key Concepts (/Objects):</p><ul><li><p><strong>API/Model Providers</strong> -&gt; The method that gives you access to Large Language Models (LLM), it can be an API (eg, OpenAI) or a locally-hosted application (eg, Llama.cpp or Ollama)</p></li><li><p><strong>Schemas</strong> -&gt; object of type <code>AbstractPromptSchema</code> that determines which methods are called and, hence, what providers/APIs are used</p></li><li><p><strong>Prompts</strong> -&gt; the information you want to convey to the AI model</p></li><li><p><strong>Messages</strong> -&gt; the basic unit of communication between the user and the AI model (eg, <code>UserMessage</code> vs <code>AIMessage</code>)</p></li><li><p><strong>Prompt Templates</strong> -&gt; re-usable &quot;prompts&quot; with placeholders that you can replace with your inputs at the time of making the request</p></li></ul><p>When you call <code>aigenerate</code>, roughly the following happens: <code>render</code> -&gt; <code>UserMessage</code>(s) -&gt; <code>render</code> -&gt; <code>OpenAI.create_chat</code> -&gt; ... -&gt; <code>AIMessage</code>.</p><h3 id="API/Model-Providers" tabindex="-1">API/Model Providers <a class="header-anchor" href="#API/Model-Providers" aria-label="Permalink to &quot;API/Model Providers {#API/Model-Providers}&quot;">​</a></h3><p>You can think of &quot;API/Model Providers&quot; as the method that gives you access to Large Language Models (LLM). It can be an API (eg, OpenAI) or a locally-hosted application (eg, Llama.cpp or Ollama).</p><p>You interact with them via the <code>schema</code> object, which is a subtype of <code>AbstractPromptSchema</code>, eg, there is an <code>OpenAISchema</code> for the provider &quot;OpenAI&quot; and its supertype <code>AbstractOpenAISchema</code> is for all other providers that mimic the OpenAI API.</p><h3 id="Schemas" tabindex="-1">Schemas <a class="header-anchor" href="#Schemas" aria-label="Permalink to &quot;Schemas {#Schemas}&quot;">​</a></h3><p>For your &quot;message&quot; to reach an AI model, it needs to be formatted and sent to the right place (-&gt; provider!).</p><p>We leverage the multiple dispatch around the &quot;schemas&quot; to pick the right logic. All schemas are subtypes of <code>AbstractPromptSchema</code> and there are many subtypes, eg, <code>OpenAISchema &lt;: AbstractOpenAISchema &lt;:AbstractPromptSchema</code>.</p><p>For example, if you provide <code>schema = OpenAISchema()</code>, the system knows that:</p><ul><li><p>it will have to format any user inputs to OpenAI&#39;s &quot;message specification&quot; (a vector of dictionaries, see their API documentation). Function <code>render(OpenAISchema(),...)</code> will take care of the rendering.</p></li><li><p>it will have to send the message to OpenAI&#39;s API. We will use the amazing <code>OpenAI.jl</code> package to handle the communication.</p></li></ul><h3 id="Prompts" tabindex="-1">Prompts <a class="header-anchor" href="#Prompts" aria-label="Permalink to &quot;Prompts {#Prompts}&quot;">​</a></h3><p>Prompt is loosely the information you want to convey to the AI model. It can be a question, a statement, or a command. It can have instructions or some context, eg, previous conversation.</p><p>You need to remember that Large Language Models (LLMs) are <strong>stateless</strong>. They don&#39;t remember the previous conversation/request, so you need to provide the whole history/context every time (similar to how REST APIs work).</p><p>Prompts that we send to the LLMs are effectively a sequence of messages (<code>&lt;:AbstractMessage</code>).</p><h3 id="Messages" tabindex="-1">Messages <a class="header-anchor" href="#Messages" aria-label="Permalink to &quot;Messages {#Messages}&quot;">​</a></h3><p>Messages are the basic unit of communication between the user and the AI model.</p><p>There are 5 main types of messages (<code>&lt;:AbstractMessage</code>):</p><ul><li><p><code>SystemMessage</code> - this contains information about the &quot;system&quot;, eg, how it should behave, format its output, etc. (eg, `You&#39;re a world-class Julia programmer. You write brief and concise code.)</p></li><li><p><code>UserMessage</code> - the information &quot;from the user&quot;, ie, your question/statement/task</p></li><li><p><code>UserMessageWithImages</code> - the same as <code>UserMessage</code>, but with images (URLs or Base64-encoded images)</p></li><li><p><code>AIMessage</code> - the response from the AI model, when the &quot;output&quot; is text</p></li><li><p><code>DataMessage</code> - the response from the AI model, when the &quot;output&quot; is data, eg, embeddings with <code>aiembed</code> or user-defined structs with <code>aiextract</code></p></li></ul><h3 id="Prompt-Templates" tabindex="-1">Prompt Templates <a class="header-anchor" href="#Prompt-Templates" aria-label="Permalink to &quot;Prompt Templates {#Prompt-Templates}&quot;">​</a></h3><p>We want to have re-usable &quot;prompts&quot;, so we provide you with a system to retrieve pre-defined prompts with placeholders (eg, <code></code>) that you can replace with your inputs at the time of making the request.</p><p>&quot;AI Templates&quot; as we call them (<code>AITemplate</code>) are usually a vector of <code>SystemMessage</code> and a <code>UserMessage</code> with specific purpose/task.</p><p>For example, the template <code>:AssistantAsk</code> is defined loosely as:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> template </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SystemMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You are a world-class AI assistant. Your communication is brief and concise. You&#39;re precise and answer only when you&#39;re confident in the high quality of your answer.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">             UserMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;# Question</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{{ask}}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span></code></pre></div><p>Notice that we have a placeholder <code>ask</code> (<code></code>) that you can replace with your question without having to re-write the generic system instructions.</p><p>When you provide a Symbol (eg, <code>:AssistantAsk</code>) to ai* functions, thanks to the multiple dispatch, it recognizes that it&#39;s an <code>AITemplate(:AssistantAsk)</code> and looks it up.</p><p>You can discover all available templates with <code>aitemplates(&quot;some keyword&quot;)</code> or just see the details of some template <code>aitemplates(:AssistantAsk)</code>.</p><p>Note: There is a new way to create and register templates in one go with <code>create_template(;user=&lt;user prompt&gt;, system=&lt;system prompt&gt;, load_as=&lt;template name&gt;)</code> (it skips the serialization step where a template previously must have been saved somewhere on the disk). See FAQ for more details or directly <code>?create_template</code>.</p><h3 id="ai*-Functions-Overview" tabindex="-1">ai* Functions Overview <a class="header-anchor" href="#ai*-Functions-Overview" aria-label="Permalink to &quot;ai* Functions Overview {#ai*-Functions-Overview}&quot;">​</a></h3><p>The above steps are implemented in the <code>ai*</code> functions, eg, <code>aigenerate</code>, <code>aiembed</code>, <code>aiextract</code>, etc. They all have the same basic structure:</p><p><code>ai*(&lt;optional schema&gt;,&lt;prompt or conversation&gt;; &lt;optional keyword arguments&gt;)</code>,</p><p>but they differ in purpose:</p><ul><li><p><code>aigenerate</code> is the general-purpose function to generate any text response with LLMs, ie, it returns <code>AIMessage</code> with field <code>:content</code> containing the generated text (eg, <code>ans.content isa AbstractString</code>)</p></li><li><p><code>aiembed</code> is designed to extract embeddings from the AI model&#39;s response, ie, it returns <code>DataMessage</code> with field <code>:content</code> containing the embeddings (eg, <code>ans.content isa AbstractArray</code>)</p></li><li><p><code>aiextract</code> is designed to extract structured data from the AI model&#39;s response and return them as a Julia struct (eg, if we provide <code>return_type=Food</code>, we get <code>ans.content isa Food</code>). You need to define the return type first and then provide it as a keyword argument.</p></li><li><p><code>aiclassify</code> is designed to classify the input text into (or simply respond within) a set of discrete <code>choices</code> provided by the user. It can be very useful as an LLM Judge or a router for RAG systems, as it uses the &quot;logit bias trick&quot; and generates exactly 1 token. It returns <code>AIMessage</code> with field <code>:content</code>, but the <code>:content</code> can be only one of the provided <code>choices</code> (eg, <code>ans.content in choices</code>)</p></li><li><p><code>aiscan</code> is for working with images and vision-enabled models (as an input), but it returns <code>AIMessage</code> with field <code>:content</code> containing the generated text (eg, <code>ans.content isa AbstractString</code>) similar to <code>aigenerate</code>.</p></li><li><p><code>aiimage</code> is for generating images (eg, with OpenAI DALL-E 3). It returns a <code>DataMessage</code>, where the field <code>:content</code> might contain either the URL to download the image from or the Base64-encoded image depending on the user-provided kwarg <code>api_kwargs.response_format</code>.</p></li><li><p><code>aitemplates</code> is a helper function to discover available templates and see their details (eg, <code>aitemplates(&quot;some keyword&quot;)</code> or <code>aitemplates(:AssistantAsk)</code>)</p></li></ul><p>If you&#39;re using a known <code>model</code>, you do NOT need to provide a <code>schema</code> (the first argument).</p><p>Optional keyword arguments in <code>ai*</code> tend to be:</p><ul><li><p><code>model::String</code> - Which model you want to use</p></li><li><p><code>verbose::Bool</code> - Whether you went to see INFO logs around AI costs</p></li><li><p><code>return_all::Bool</code> - Whether you want the WHOLE conversation or just the AI answer (ie, whether you want to include your inputs/prompt in the output)</p></li><li><p><code>api_kwargs::NamedTuple</code> - Specific parameters for the model, eg, <code>temperature=0.0</code> to be NOT creative (and have more similar output in each run)</p></li><li><p><code>http_kwargs::NamedTuple</code> - Parameters for the HTTP.jl package, eg, <code>readtimeout = 120</code> to time out in 120 seconds if no response was received.</p></li></ul><p>In addition to the above list of <code>ai*</code> functions, you can also use the <strong>&quot;lazy&quot; counterparts</strong> of these functions from the experimental AgentTools module.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Experimental</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AgentTools</span></span></code></pre></div><p>For example, <code>AIGenerate()</code> will create a lazy instance of <code>aigenerate</code>. It is an instance of <code>AICall</code> with <code>aigenerate</code> as its ai function. It uses exactly the same arguments and keyword arguments as <code>aigenerate</code> (see <code>?aigenerate</code> for details).</p><p>&quot;lazy&quot; refers to the fact that it does NOT generate any output when instantiated (only when <code>run!</code> is called).</p><p>Or said differently, the <code>AICall</code> struct and all its flavors (<code>AIGenerate</code>, ...) are designed to facilitate a deferred execution model (lazy evaluation) for AI functions that interact with a Language Learning Model (LLM). It stores the necessary information for an AI call and executes the underlying AI function only when supplied with a <code>UserMessage</code> or when the <code>run!</code> method is applied.</p><p>This approach allows us to remember user inputs and trigger the LLM call repeatedly if needed, which enables automatic fixing (see <code>?airetry!</code>).</p><p>Example:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AIGenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:JuliaExpertAsk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; ask</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xyz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;abc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> run!</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Is equivalent to</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:JuliaExpertAsk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; ask</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xyz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;abc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The only difference is that we default to `return_all=true` with lazy types because we have a dedicated `conversation` field, which makes it much easier</span></span></code></pre></div><p>Lazy AI calls and self-healing mechanisms unlock much more robust and useful LLM workflows!</p><h2 id="Walkthrough-Example-for-aigenerate" tabindex="-1">Walkthrough Example for <code>aigenerate</code> <a class="header-anchor" href="#Walkthrough-Example-for-aigenerate" aria-label="Permalink to &quot;Walkthrough Example for `aigenerate` {#Walkthrough-Example-for-aigenerate}&quot;">​</a></h2><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Let&#39;s say this is our ask</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:AssistantAsk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; ask</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is the capital of France?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># it is effectively the same as:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AITemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:AssistantAsk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); ask</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is the capital of France?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt3t&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>There is no <code>model</code> provided, so we use the default <code>PT.MODEL_CHAT</code> (effectively GPT3.5-Turbo). Then we look it up in <code>PT.MDOEL_REGISTRY</code> and use the associated schema for it (<code>OpenAISchema</code> in this case).</p><p>The next step is to render the template, replace the placeholders and render it for the OpenAI model.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Let&#39;s remember out schema</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ask </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;What is the capital of France?&quot;</span></span></code></pre></div><p>First, we obtain the template (no placeholder replacement yet) and &quot;expand it&quot;</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">template_rendered </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AITemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:AssistantAsk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); ask)</span></span></code></pre></div><div class="language-plaintext vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plaintext</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>2-element Vector{PromptingTools.AbstractChatMessage}:</span></span>
<span class="line"><span>  PromptingTools.SystemMessage(&quot;You are a world-class AI assistant. Your communication is brief and concise. You&#39;re precise and answer only when you&#39;re confident in the high quality of your answer.&quot;)</span></span>
<span class="line"><span>  PromptingTools.UserMessage{String}(&quot;# Question\n\n{{ask}}&quot;, [:ask], :usermessage)</span></span></code></pre></div><p>Second, we replace the placeholders</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rendered_for_api </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema, template_rendered;  ask)</span></span></code></pre></div><div class="language-plaintext vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plaintext</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>2-element Vector{Dict{String, Any}}:</span></span>
<span class="line"><span>  Dict(&quot;role&quot; =&gt; &quot;system&quot;, &quot;content&quot; =&gt; &quot;You are a world-class AI assistant. Your communication is brief and concise. You&#39;re precise and answer only when you&#39;re confident in the high quality of your answer.&quot;)</span></span>
<span class="line"><span>  Dict(&quot;role&quot; =&gt; &quot;user&quot;, &quot;content&quot; =&gt; &quot;# Question\n\nWhat is the capital of France?&quot;)</span></span></code></pre></div><p>Notice that the placeholders are only replaced in the second step. The final output here is a vector of messages with &quot;role&quot; and &quot;content&quot; keys, which is the format required by the OpenAI API.</p><p>As a side note, under the hood, the second step is done in two sub-steps:</p><ul><li><p>replace the placeholders <code>messages_rendered = PT.render(PT.NoSchema(), template_rendered; ask)</code> -&gt; returns a vector of Messages!</p></li><li><p>then, we convert the messages to the format required by the provider/schema <code>PT.render(schema, messages_rendered)</code> -&gt; returns the OpenAI formatted messages</p></li></ul><p>Next, we send the above <code>rendered_for_api</code> to the OpenAI API and get the response back.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OpenAI</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">OpenAI</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">create_chat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(api_key, model, rendered_for_api)</span></span></code></pre></div><p>The last step is to take the JSON response from the API and convert it to the <code>AIMessage</code> object.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># simplification for educational purposes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AIMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:choices</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:content</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span></code></pre></div><p>In practice, there are more fields we extract, so we define a utility for it: <code>PT.response_to_message</code>. Especially, since with parameter <code>n</code>, you can request multiple AI responses at once, so we want to re-use our response processing logic.</p><p>That&#39;s it! I hope you&#39;ve learned something new about how PromptingTools.jl works under the hood.</p><h2 id="Walkthrough-Example-for-aiextract" tabindex="-1">Walkthrough Example for <code>aiextract</code> <a class="header-anchor" href="#Walkthrough-Example-for-aiextract" aria-label="Permalink to &quot;Walkthrough Example for `aiextract` {#Walkthrough-Example-for-aiextract}&quot;">​</a></h2><p>Whereas <code>aigenerate</code> is a general-purpose function to generate any text response with LLMs, <code>aiextract</code> is designed to extract structured data from the AI model&#39;s response and return them as a Julia struct.</p><p>It&#39;s a bit more complicated than <code>aigenerate</code> because it needs to handle the JSON schema of the return type (= our struct).</p><p>Let&#39;s define a toy example of a struct and see how <code>aiextract</code> works under the hood.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Extract the name of the food from the sentence. Extract any provided adjectives for the food as well.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Example: &quot;I am eating a crunchy bread.&quot; -&gt; Food(&quot;bread&quot;, [&quot;crunchy&quot;])</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Food</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # required field!</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    adjectives</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing,Vector{String}}</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # not required because `Nothing` is allowed</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiextract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I just ate a delicious and juicy apple.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; return_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Food)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Food(&quot;apple&quot;, [&quot;delicious&quot;, &quot;juicy&quot;])</span></span></code></pre></div><p>You can see that we sent a prompt to the AI model and it returned a <code>Food</code> object. We provided some light guidance as a docstring of the return type, but the AI model did the heavy lifting.</p><p><code>aiextract</code> leverages native &quot;function calling&quot; (supported by OpenAI, Fireworks, Together, and many others).</p><p>We encode the user-provided <code>return_type</code> into the corresponding JSON schema and create the payload as per the specifications of the provider.</p><p>Let&#39;s how that&#39;s done:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">function_call_signature</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Food)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Dict{String, Any} with 3 entries:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##   &quot;name&quot;        =&gt; &quot;Food_extractor&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##   &quot;parameters&quot;  =&gt; Dict{String, Any}(&quot;properties&quot;=&gt;Dict{String, Any}(&quot;name&quot;=&gt;Dict(&quot;type&quot;=&gt;&quot;string&quot;), &quot;adjectives&quot;=&gt;Dict{String, …</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##   &quot;description&quot; =&gt; &quot;Extract the food from the sentence. Extract any provided adjectives for the food as well.\n\nExample: &quot;</span></span></code></pre></div><p>You can see that we capture the field names and types in <code>parameters</code> and the description in <code>description</code> key.</p><p>Furthermore, if we zoom in on the &quot;parameter&quot; field, you can see that we encode not only the names and types but also whether the fields are required (ie, do they allow <code>Nothing</code>) You can see below that the field <code>adjectives</code> accepts <code>Nothing</code>, so it&#39;s not required. Only the <code>name</code> field is required.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sig[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;parameters&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Dict{String, Any} with 3 entries:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##   &quot;properties&quot; =&gt; Dict{String, Any}(&quot;name&quot;=&gt;Dict(&quot;type&quot;=&gt;&quot;string&quot;), &quot;adjectives&quot;=&gt;Dict{String, Any}(&quot;items&quot;=&gt;Dict(&quot;type&quot;=&gt;&quot;strin…</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##   &quot;required&quot;   =&gt; [&quot;name&quot;]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##   &quot;type&quot;       =&gt; &quot;object&quot;</span></span></code></pre></div><p>For <code>aiextract</code>, the signature is provided to the API provider via <code>tools</code> parameter, eg,</p><p><code>api_kwargs = (; tools = [Dict(:type =&gt; &quot;function&quot;, :function =&gt; sig)])</code></p><p>Optionally, we can provide also <code>tool_choice</code> parameter to specify which tool to use if we provided multiple (differs across providers).</p><p>When the message is returned, we extract the JSON object in the response and decode it into Julia object via <code>JSON3.read(obj, Food)</code>. For example,</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model_response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:tool_calls</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:function</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:arguments</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JSON3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;apple&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;adjectives&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;delicious&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;juicy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]))))])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">food </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JSON3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(model_response[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:tool_calls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:arguments</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], Food)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: Food(&quot;apple&quot;, [&quot;delicious&quot;, &quot;juicy&quot;])</span></span></code></pre></div><p>This is why you can sometimes have errors when you use abstract types in your <code>return_type</code> -&gt; to enable that, you would need to set the right <code>StructTypes</code> behavior for your abstract type (see the JSON3.jl documentation for more details on how to do that).</p><p>It works quite well for concrete types and &quot;vanilla&quot; structs, though.</p><p>Unfortunately, function calling is generally NOT supported by locally-hosted / open-source models, so let&#39;s try to build a workaround with <code>aigenerate</code></p><p>You need to pick a bigger / more powerful model, as it&#39;s NOT an easy task to output a correct JSON specification. My laptop isn&#39;t too powerful and I don&#39;t like waiting, so I&#39;m going to use Mixtral model hosted on Together.ai (you get $25 credit when you join)!</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;tmixtral&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # tmixtral is an alias for &quot;mistralai/Mixtral-8x7B-Instruct-v0.1&quot; on Together.ai and it automatically sets `schema = TogetherOpenAISchema()`</span></span></code></pre></div><p>We&#39;ll add the signature to the prompt and we&#39;ll request the JSON output in two places - in the prompt and in the <code>api_kwargs</code> (to ensure that the model outputs the JSON via &quot;grammar&quot;) NOTE: You can write much better and more specific prompt if you have a specific task / return type in mind + you should make sure that the prompt + struct description make sense together!</p><p>Let&#39;s define a prompt and <code>return_type</code>. Notice that we add several placeholders (eg, <code></code>) to fill with user inputs later.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">You&#39;re a world-class data extraction engine. </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Your task is to extract information formatted as per the user provided schema.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">You MUST response in JSON format.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">**Example:**</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">---------</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Description: &quot;Extract the Car from the sentence. Extract the corresponding brand and model as well.&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Input: &quot;I drive a black Porsche 911 Turbo.&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Schema: &quot;{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">properties</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">model</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">type</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">string</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">},</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">brand</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">type</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">string</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}},</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">required</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">brand</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">model</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">],</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">type</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">object</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Output: &quot;{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">model</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">911 Turbo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">brand</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Porsche</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">---------</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">**User Request:**</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Description: {{description}}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Input: {{input}}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Schema: {{signature}}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Output:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">You MUST OUTPUT in JSON format.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span></code></pre></div><p>We need to extract the &quot;signature of our <code>return_type</code> and put it in the right placeholders. Let&#39;s generate now!</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">function_call_signature</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Food)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt; input</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I just ate a delicious and juicy apple.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">JSON3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sig[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;parameters&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]), description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sig[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## We provide the JSON output requirement as per API docs: https://docs.together.ai/docs/json-mode</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model, api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; response_format</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;json_object&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## &quot;{\n  \&quot;adjectives\&quot;: [\&quot;delicious\&quot;, \&quot;juicy\&quot;],\n  \&quot;food\&quot;: \&quot;apple\&quot;\n}&quot;</span></span></code></pre></div><p>We&#39;re using a smaller model, so the output is not perfect. Let&#39;s try to load into our object:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JSON3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content, Food)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: ERROR: MethodError: Cannot `convert` an object of type Nothing to an object of type String</span></span></code></pre></div><p>Unfortunately, we get an error because the model mixed up the key &quot;name&quot; for &quot;food&quot;, so it cannot be parsed.</p><p>Fortunately, we can do better and use automatic fixing! All we need to do is to change from <code>aigenerate</code> -&gt; <code>AIGenerate</code> (and use <code>airetry!</code>)</p><p>The signature of <code>AIGenerate</code> is identical to <code>aigenerate</code> with the exception of <code>config</code> field, where we can influence the future <code>retry</code> behaviour.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AIGenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt; input</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I just ate a delicious and juicy apple.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">JSON3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sig[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;parameters&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]), description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sig[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## We provide the JSON output requirement as per API docs: https://docs.together.ai/docs/json-mode</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model, api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; response_format</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;json_object&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## limit the number of retries, default is 10 rounds</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RetryConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; max_retries</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">run!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># run! triggers the generation step (to have some AI output to check)</span></span></code></pre></div><p>Let&#39;s set up a retry mechanism with some practical feedback. We&#39;ll leverage <code>airetry!</code> to automatically retry the request and provide feedback to the model. Think of <code>airetry!</code> as <code>@assert</code> on steroids:</p><p><code>@assert CONDITION MESSAGE</code> → <code>airetry! CONDITION &lt;state&gt; MESSAGE</code></p><p>The main benefits of <code>airetry!</code> are:</p><ul><li><p>It can retry automatically, not just throw an error</p></li><li><p>It manages the &quot;conversation’ (list of messages) for you, including adding user-provided feedback to help generate better output</p></li></ul><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">feedback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;The output is not in the correct format. The keys should be </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(join([string(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\&quot;$f\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> f </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fieldnames(Food)],</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;, &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">))</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># We use do-syntax with provide the `CONDITION` (it must return Bool)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">airetry!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result, feedback) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> conv</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## try to convert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> try</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        JSON3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_output</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(conv), Food)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ## you could save the error and provide as feedback (eg, into a slot in the `:memory` field of the AICall object)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        e</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## Check if the conversion was successful; if it&#39;s `false`, it will retry</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    obj </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">isa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Food </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -&gt; Bool</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">food </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JSON3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_output</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result), Food)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## [ Info: Condition not met. Retrying...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Output: Food(&quot;apple&quot;, [&quot;delicious&quot;, &quot;juicy&quot;])</span></span></code></pre></div><p>It took 1 retry (see <code>result.config.retries</code>) and we have the correct output from an open-source model!</p><p>If you&#39;re interested in the <code>result</code> object, it&#39;s a struct (<code>AICall</code>) with a field <code>conversation</code>, which holds the conversation up to this point. AIGenerate is an alias for AICall using <code>aigenerate</code> function. See <code>?AICall</code> (the underlying struct type) for more details on the fields and methods available.</p></div></div></main><footer class="VPDocFooter" data-v-83890dd9 data-v-4f9813fa><!--[--><!--]--><div class="edit-info" data-v-4f9813fa><div class="edit-link" data-v-4f9813fa><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/svilupp/PromptingTools.jl/edit/main/docs/src/how_it_works.md" target="_blank" rel="noreferrer" data-v-4f9813fa><!--[--><span class="vpi-square-pen edit-link-icon" data-v-4f9813fa></span> Edit this page<!--]--></a></div><!----></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-4f9813fa><span class="visually-hidden" id="doc-footer-aria-label" data-v-4f9813fa>Pager</span><div class="pager" data-v-4f9813fa><a class="VPLink link pager-link prev" href="/PromptingTools.jl/previews/PR209/getting_started" data-v-4f9813fa><!--[--><span class="desc" data-v-4f9813fa>Previous page</span><span class="title" data-v-4f9813fa>Getting Started</span><!--]--></a></div><div class="pager" data-v-4f9813fa><a class="VPLink link pager-link next" href="/PromptingTools.jl/previews/PR209/coverage_of_model_providers" data-v-4f9813fa><!--[--><span class="desc" data-v-4f9813fa>Next page</span><span class="title" data-v-4f9813fa>Coverage of Model Providers</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-a9a9e638 data-v-c970a860><div class="container" data-v-c970a860><p class="message" data-v-c970a860>Made with <a href="https://documenter.juliadocs.org/stable/" target="_blank"><strong>Documenter.jl</strong></a> & <a href="https://vitepress.dev" target="_blank"><strong>VitePress</strong></a> & Icons by <a target="_blank" href="https://icons8.com">Icons8</a> <br></p><p class="copyright" data-v-c970a860>© Copyright 2024.</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"coverage_of_model_providers.md\":\"QG0HSIiY\",\"examples_building_rag.md\":\"D9QpRvZu\",\"examples_readme_examples.md\":\"BeLUqFMr\",\"examples_working_with_aitemplates.md\":\"DNL2A0mB\",\"examples_working_with_custom_apis.md\":\"FYlFy5T5\",\"examples_working_with_google_ai_studio.md\":\"CML1uFNn\",\"examples_working_with_ollama.md\":\"DjEOSS0m\",\"extra_tools_agent_tools_intro.md\":\"C6mhOMbZ\",\"extra_tools_api_tools_intro.md\":\"D6pLyCGx\",\"extra_tools_rag_tools_intro.md\":\"pmiS8q-u\",\"extra_tools_text_utilities_intro.md\":\"BSFHsQqB\",\"frequently_asked_questions.md\":\"B6I2w2bO\",\"getting_started.md\":\"BpLGAdLW\",\"how_it_works.md\":\"CDZ0Zluk\",\"index.md\":\"3KKa7MYV\",\"prompts_agents.md\":\"_2XizYFY\",\"prompts_classification.md\":\"cEbdnS7F\",\"prompts_critic.md\":\"DYEoV5Dr\",\"prompts_extraction.md\":\"BZCBhz4f\",\"prompts_general.md\":\"ROay2bFZ\",\"prompts_persona-task.md\":\"B4BQiwJ3\",\"prompts_rag.md\":\"wuk5JCCo\",\"prompts_visual.md\":\"BoaGmUF6\",\"reference.md\":\"Cc3cu0wH\",\"reference_agenttools.md\":\"CBMRDyrX\",\"reference_apitools.md\":\"BH5oJRR7\",\"reference_experimental.md\":\"DLu6INUk\",\"reference_ragtools.md\":\"X-GBVhG9\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"PromptingTools.jl\",\"description\":\"Streamline Your Interactions with GenAI Models. Discover the power of GenerativeAI and build mini workflows to save you 20 minutes every day.\",\"base\":\"/PromptingTools.jl/previews/PR209/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"outline\":\"deep\",\"logo\":{\"src\":\"/logo.png\",\"width\":24,\"height\":24},\"search\":{\"provider\":\"local\",\"options\":{\"detailedView\":true}},\"nav\":[{\"text\":\"Home\",\"link\":\"/index\"},{\"text\":\"Manual\",\"items\":[{\"text\":\"Getting Started\",\"link\":\"/getting_started\"},{\"text\":\"How It Works\",\"link\":\"/how_it_works\"},{\"text\":\"Coverage of Model Providers\",\"link\":\"/coverage_of_model_providers\"},{\"text\":\"Examples\",\"items\":[{\"text\":\"Various examples\",\"link\":\"/examples/readme_examples\"},{\"text\":\"Using AITemplates\",\"link\":\"/examples/working_with_aitemplates\"},{\"text\":\"Local models with Ollama.ai\",\"link\":\"/examples/working_with_ollama\"},{\"text\":\"Google AIStudio\",\"link\":\"/examples/working_with_google_ai_studio\"},{\"text\":\"Custom APIs (Mistral, Llama.cpp)\",\"link\":\"/examples/working_with_custom_apis\"},{\"text\":\"Building RAG Application\",\"link\":\"/examples/building_RAG\"}]},{\"text\":\"Extra Tools\",\"items\":[{\"text\":\"Text Utilities\",\"link\":\"/extra_tools/text_utilities_intro\"},{\"text\":\"AgentTools\",\"link\":\"/extra_tools/agent_tools_intro\"},{\"text\":\"RAGTools\",\"link\":\"/extra_tools/rag_tools_intro\"},{\"text\":\"APITools\",\"link\":\"/extra_tools/api_tools_intro\"}]}]},{\"text\":\"F.A.Q.\",\"link\":\"/frequently_asked_questions\"},{\"text\":\"Prompt Templates\",\"items\":[{\"text\":\"General\",\"link\":\"/prompts/general\"},{\"text\":\"Persona-Task\",\"link\":\"/prompts/persona-task\"},{\"text\":\"Visual\",\"link\":\"/prompts/visual\"},{\"text\":\"Classification\",\"link\":\"/prompts/classification\"},{\"text\":\"Extraction\",\"link\":\"/prompts/extraction\"},{\"text\":\"Agents\",\"link\":\"/prompts/agents\"},{\"text\":\"RAG\",\"link\":\"/prompts/RAG\"}]},{\"text\":\"Reference\",\"items\":[{\"text\":\"PromptingTools.jl\",\"link\":\"/reference\"},{\"text\":\"Experimental Modules\",\"link\":\"/reference_experimental\"},{\"text\":\"RAGTools\",\"link\":\"/reference_ragtools\"},{\"text\":\"AgentTools\",\"link\":\"/reference_agenttools\"},{\"text\":\"APITools\",\"link\":\"/reference_apitools\"}]}],\"sidebar\":[{\"text\":\"Home\",\"link\":\"/index\"},{\"text\":\"Manual\",\"items\":[{\"text\":\"Getting Started\",\"link\":\"/getting_started\"},{\"text\":\"How It Works\",\"link\":\"/how_it_works\"},{\"text\":\"Coverage of Model Providers\",\"link\":\"/coverage_of_model_providers\"},{\"text\":\"Examples\",\"collapsed\":true,\"items\":[{\"text\":\"Various examples\",\"link\":\"/examples/readme_examples\"},{\"text\":\"Using AITemplates\",\"link\":\"/examples/working_with_aitemplates\"},{\"text\":\"Local models with Ollama.ai\",\"link\":\"/examples/working_with_ollama\"},{\"text\":\"Google AIStudio\",\"link\":\"/examples/working_with_google_ai_studio\"},{\"text\":\"Custom APIs (Mistral, Llama.cpp)\",\"link\":\"/examples/working_with_custom_apis\"},{\"text\":\"Building RAG Application\",\"link\":\"/examples/building_RAG\"}]},{\"text\":\"Extra Tools\",\"collapsed\":true,\"items\":[{\"text\":\"Text Utilities\",\"link\":\"/extra_tools/text_utilities_intro\"},{\"text\":\"AgentTools\",\"link\":\"/extra_tools/agent_tools_intro\"},{\"text\":\"RAGTools\",\"link\":\"/extra_tools/rag_tools_intro\"},{\"text\":\"APITools\",\"link\":\"/extra_tools/api_tools_intro\"}]}]},{\"text\":\"F.A.Q.\",\"link\":\"/frequently_asked_questions\"},{\"text\":\"Prompt Templates\",\"collapsed\":true,\"items\":[{\"text\":\"General\",\"link\":\"/prompts/general\"},{\"text\":\"Persona-Task\",\"link\":\"/prompts/persona-task\"},{\"text\":\"Visual\",\"link\":\"/prompts/visual\"},{\"text\":\"Classification\",\"link\":\"/prompts/classification\"},{\"text\":\"Extraction\",\"link\":\"/prompts/extraction\"},{\"text\":\"Agents\",\"link\":\"/prompts/agents\"},{\"text\":\"RAG\",\"link\":\"/prompts/RAG\"}]},{\"text\":\"Reference\",\"collapsed\":true,\"items\":[{\"text\":\"PromptingTools.jl\",\"link\":\"/reference\"},{\"text\":\"Experimental Modules\",\"link\":\"/reference_experimental\"},{\"text\":\"RAGTools\",\"link\":\"/reference_ragtools\"},{\"text\":\"AgentTools\",\"link\":\"/reference_agenttools\"},{\"text\":\"APITools\",\"link\":\"/reference_apitools\"}]}],\"editLink\":{\"pattern\":\"https://github.com/svilupp/PromptingTools.jl/edit/main/docs/src/:path\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/svilupp/PromptingTools.jl\"}],\"footer\":{\"message\":\"Made with <a href=\\\"https://documenter.juliadocs.org/stable/\\\" target=\\\"_blank\\\"><strong>Documenter.jl</strong></a> & <a href=\\\"https://vitepress.dev\\\" target=\\\"_blank\\\"><strong>VitePress</strong></a> & Icons by <a target=\\\"_blank\\\" href=\\\"https://icons8.com\\\">Icons8</a> <br>\",\"copyright\":\"© Copyright 2024.\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>