import { _ as _export_sfc, c as createElementBlock, a5 as createStaticVNode, o as openBlock } from "./chunks/framework.Cb3EfeEY.js";
const __pageData = JSON.parse('{"title":"Reference for RAGTools","description":"","frontmatter":{},"headers":[],"relativePath":"reference_ragtools.md","filePath":"reference_ragtools.md","lastUpdated":null}');
const _sfc_main = { name: "reference_ragtools.md" };
function _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {
  return openBlock(), createElementBlock("div", null, _cache[0] || (_cache[0] = [
    createStaticVNode('<h1 id="Reference-for-RAGTools" tabindex="-1">Reference for RAGTools <a class="header-anchor" href="#Reference-for-RAGTools" aria-label="Permalink to &quot;Reference for RAGTools {#Reference-for-RAGTools}&quot;">​</a></h1><ul><li><a href="#PromptingTools.Experimental.RAGTools.AbstractCandidateChunks"><code>PromptingTools.Experimental.RAGTools.AbstractCandidateChunks</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.AbstractChunkIndex"><code>PromptingTools.Experimental.RAGTools.AbstractChunkIndex</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.AbstractGenerator"><code>PromptingTools.Experimental.RAGTools.AbstractGenerator</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.AbstractIndexBuilder"><code>PromptingTools.Experimental.RAGTools.AbstractIndexBuilder</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.AbstractMultiIndex"><code>PromptingTools.Experimental.RAGTools.AbstractMultiIndex</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.AbstractRetriever"><code>PromptingTools.Experimental.RAGTools.AbstractRetriever</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.AdvancedGenerator"><code>PromptingTools.Experimental.RAGTools.AdvancedGenerator</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.AdvancedRetriever"><code>PromptingTools.Experimental.RAGTools.AdvancedRetriever</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.AllTagFilter"><code>PromptingTools.Experimental.RAGTools.AllTagFilter</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.AnnotatedNode"><code>PromptingTools.Experimental.RAGTools.AnnotatedNode</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.AnyTagFilter"><code>PromptingTools.Experimental.RAGTools.AnyTagFilter</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.BM25Similarity"><code>PromptingTools.Experimental.RAGTools.BM25Similarity</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.BatchEmbedder"><code>PromptingTools.Experimental.RAGTools.BatchEmbedder</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.BinaryBatchEmbedder"><code>PromptingTools.Experimental.RAGTools.BinaryBatchEmbedder</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.BinaryCosineSimilarity"><code>PromptingTools.Experimental.RAGTools.BinaryCosineSimilarity</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.BitPackedBatchEmbedder"><code>PromptingTools.Experimental.RAGTools.BitPackedBatchEmbedder</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.BitPackedCosineSimilarity"><code>PromptingTools.Experimental.RAGTools.BitPackedCosineSimilarity</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.CandidateChunks"><code>PromptingTools.Experimental.RAGTools.CandidateChunks</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.ChunkEmbeddingsIndex"><code>PromptingTools.Experimental.RAGTools.ChunkEmbeddingsIndex</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.ChunkKeywordsIndex"><code>PromptingTools.Experimental.RAGTools.ChunkKeywordsIndex</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.ChunkKeywordsIndex-Tuple{PromptingTools.Experimental.RAGTools.AbstractProcessor, ChunkEmbeddingsIndex}"><code>PromptingTools.Experimental.RAGTools.ChunkKeywordsIndex</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.CohereReranker"><code>PromptingTools.Experimental.RAGTools.CohereReranker</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.ContextEnumerator"><code>PromptingTools.Experimental.RAGTools.ContextEnumerator</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.CosineSimilarity"><code>PromptingTools.Experimental.RAGTools.CosineSimilarity</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.DocumentTermMatrix"><code>PromptingTools.Experimental.RAGTools.DocumentTermMatrix</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.FileChunker"><code>PromptingTools.Experimental.RAGTools.FileChunker</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.FlashRanker"><code>PromptingTools.Experimental.RAGTools.FlashRanker</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.HTMLStyler"><code>PromptingTools.Experimental.RAGTools.HTMLStyler</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.HyDERephraser"><code>PromptingTools.Experimental.RAGTools.HyDERephraser</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.JudgeAllScores"><code>PromptingTools.Experimental.RAGTools.JudgeAllScores</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.JudgeRating"><code>PromptingTools.Experimental.RAGTools.JudgeRating</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.KeywordsIndexer"><code>PromptingTools.Experimental.RAGTools.KeywordsIndexer</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.KeywordsProcessor"><code>PromptingTools.Experimental.RAGTools.KeywordsProcessor</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.MultiCandidateChunks"><code>PromptingTools.Experimental.RAGTools.MultiCandidateChunks</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.MultiFinder"><code>PromptingTools.Experimental.RAGTools.MultiFinder</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.MultiIndex"><code>PromptingTools.Experimental.RAGTools.MultiIndex</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.NoEmbedder"><code>PromptingTools.Experimental.RAGTools.NoEmbedder</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.NoPostprocessor"><code>PromptingTools.Experimental.RAGTools.NoPostprocessor</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.NoProcessor"><code>PromptingTools.Experimental.RAGTools.NoProcessor</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.NoRefiner"><code>PromptingTools.Experimental.RAGTools.NoRefiner</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.NoRephraser"><code>PromptingTools.Experimental.RAGTools.NoRephraser</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.NoReranker"><code>PromptingTools.Experimental.RAGTools.NoReranker</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.NoTagFilter"><code>PromptingTools.Experimental.RAGTools.NoTagFilter</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.NoTagger"><code>PromptingTools.Experimental.RAGTools.NoTagger</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.OpenTagger"><code>PromptingTools.Experimental.RAGTools.OpenTagger</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.PassthroughTagger"><code>PromptingTools.Experimental.RAGTools.PassthroughTagger</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.RAGConfig"><code>PromptingTools.Experimental.RAGTools.RAGConfig</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.RAGResult"><code>PromptingTools.Experimental.RAGTools.RAGResult</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.RankGPTReranker"><code>PromptingTools.Experimental.RAGTools.RankGPTReranker</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.RankGPTResult"><code>PromptingTools.Experimental.RAGTools.RankGPTResult</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.SimpleAnswerer"><code>PromptingTools.Experimental.RAGTools.SimpleAnswerer</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.SimpleBM25Retriever"><code>PromptingTools.Experimental.RAGTools.SimpleBM25Retriever</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.SimpleGenerator"><code>PromptingTools.Experimental.RAGTools.SimpleGenerator</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.SimpleIndexer"><code>PromptingTools.Experimental.RAGTools.SimpleIndexer</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.SimpleRefiner"><code>PromptingTools.Experimental.RAGTools.SimpleRefiner</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.SimpleRephraser"><code>PromptingTools.Experimental.RAGTools.SimpleRephraser</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.SimpleRetriever"><code>PromptingTools.Experimental.RAGTools.SimpleRetriever</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.Styler"><code>PromptingTools.Experimental.RAGTools.Styler</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.SubChunkIndex"><code>PromptingTools.Experimental.RAGTools.SubChunkIndex</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.SubDocumentTermMatrix"><code>PromptingTools.Experimental.RAGTools.SubDocumentTermMatrix</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.TavilySearchRefiner"><code>PromptingTools.Experimental.RAGTools.TavilySearchRefiner</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.TextChunker"><code>PromptingTools.Experimental.RAGTools.TextChunker</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.TrigramAnnotater"><code>PromptingTools.Experimental.RAGTools.TrigramAnnotater</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools._normalize"><code>PromptingTools.Experimental.RAGTools._normalize</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.add_node_metadata!-Tuple{TrigramAnnotater, PromptingTools.Experimental.RAGTools.AnnotatedNode}"><code>PromptingTools.Experimental.RAGTools.add_node_metadata!</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.airag-Tuple{PromptingTools.Experimental.RAGTools.AbstractRAGConfig, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex}"><code>PromptingTools.Experimental.RAGTools.airag</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.align_node_styles!-Tuple{TrigramAnnotater, AbstractVector{&lt;:PromptingTools.Experimental.RAGTools.AnnotatedNode}}"><code>PromptingTools.Experimental.RAGTools.align_node_styles!</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.annotate_support-Tuple{TrigramAnnotater, AbstractString, AbstractVector}"><code>PromptingTools.Experimental.RAGTools.annotate_support</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.annotate_support-Tuple{TrigramAnnotater, PromptingTools.Experimental.RAGTools.AbstractRAGResult}"><code>PromptingTools.Experimental.RAGTools.annotate_support</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.answer!-Tuple{PromptingTools.Experimental.RAGTools.SimpleAnswerer, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractRAGResult}"><code>PromptingTools.Experimental.RAGTools.answer!</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.build_context-Tuple{PromptingTools.Experimental.RAGTools.ContextEnumerator, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractCandidateChunks}"><code>PromptingTools.Experimental.RAGTools.build_context</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.build_index-Tuple{PromptingTools.Experimental.RAGTools.AbstractIndexBuilder, Vector{&lt;:AbstractString}}"><code>PromptingTools.Experimental.RAGTools.build_index</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.build_index-Tuple{KeywordsIndexer, Vector{&lt;:AbstractString}}"><code>PromptingTools.Experimental.RAGTools.build_index</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.build_qa_evals-Tuple{Vector{&lt;:AbstractString}, Vector{&lt;:AbstractString}}"><code>PromptingTools.Experimental.RAGTools.build_qa_evals</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.build_tags"><code>PromptingTools.Experimental.RAGTools.build_tags</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.build_tags-Tuple{PromptingTools.Experimental.RAGTools.AbstractTagger, Nothing}"><code>PromptingTools.Experimental.RAGTools.build_tags</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.chunkdata-Tuple{SubChunkIndex, AbstractVector{&lt;:Integer}}"><code>PromptingTools.Experimental.RAGTools.chunkdata</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.chunkdata-Tuple{PromptingTools.Experimental.RAGTools.AbstractChunkIndex, AbstractVector{&lt;:Integer}}"><code>PromptingTools.Experimental.RAGTools.chunkdata</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.chunkdata-Tuple{ChunkKeywordsIndex, AbstractVector{&lt;:Integer}}"><code>PromptingTools.Experimental.RAGTools.chunkdata</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.cohere_api-Tuple{}"><code>PromptingTools.Experimental.RAGTools.cohere_api</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.create_permutation_instruction-Tuple{AbstractVector{&lt;:AbstractString}}"><code>PromptingTools.Experimental.RAGTools.create_permutation_instruction</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.extract_ranking-Tuple{AbstractString}"><code>PromptingTools.Experimental.RAGTools.extract_ranking</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.find_closest"><code>PromptingTools.Experimental.RAGTools.find_closest</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.find_closest"><code>PromptingTools.Experimental.RAGTools.find_closest</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.find_closest"><code>PromptingTools.Experimental.RAGTools.find_closest</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.find_closest"><code>PromptingTools.Experimental.RAGTools.find_closest</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.find_closest"><code>PromptingTools.Experimental.RAGTools.find_closest</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.find_tags-Union{Tuple{T}, Tuple{PromptingTools.Experimental.RAGTools.NoTagFilter, PromptingTools.Experimental.RAGTools.AbstractChunkIndex, Union{AbstractVector{&lt;:T}, T}}} where T&lt;:Union{Nothing, Regex, AbstractString}"><code>PromptingTools.Experimental.RAGTools.find_tags</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.find_tags-Union{Tuple{T}, Tuple{PromptingTools.Experimental.RAGTools.AllTagFilter, PromptingTools.Experimental.RAGTools.AbstractChunkIndex, Vector{T}}} where T&lt;:Union{Regex, AbstractString}"><code>PromptingTools.Experimental.RAGTools.find_tags</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.find_tags-Tuple{PromptingTools.Experimental.RAGTools.AnyTagFilter, PromptingTools.Experimental.RAGTools.AbstractChunkIndex, Union{Regex, AbstractString}}"><code>PromptingTools.Experimental.RAGTools.find_tags</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.generate!-Tuple{PromptingTools.Experimental.RAGTools.AbstractGenerator, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractRAGResult}"><code>PromptingTools.Experimental.RAGTools.generate!</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.get_chunks-Tuple{PromptingTools.Experimental.RAGTools.AbstractChunker, Vector{&lt;:AbstractString}}"><code>PromptingTools.Experimental.RAGTools.get_chunks</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.get_embeddings-Tuple{PromptingTools.Experimental.RAGTools.BatchEmbedder, AbstractVector{&lt;:AbstractString}}"><code>PromptingTools.Experimental.RAGTools.get_embeddings</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.get_embeddings-Tuple{PromptingTools.Experimental.RAGTools.BitPackedBatchEmbedder, AbstractVector{&lt;:AbstractString}}"><code>PromptingTools.Experimental.RAGTools.get_embeddings</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.get_embeddings-Tuple{PromptingTools.Experimental.RAGTools.BinaryBatchEmbedder, AbstractVector{&lt;:AbstractString}}"><code>PromptingTools.Experimental.RAGTools.get_embeddings</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.get_tags-Tuple{PromptingTools.Experimental.RAGTools.OpenTagger, AbstractVector{&lt;:AbstractString}}"><code>PromptingTools.Experimental.RAGTools.get_tags</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.get_tags-Tuple{PromptingTools.Experimental.RAGTools.PassthroughTagger, AbstractVector{&lt;:AbstractString}}"><code>PromptingTools.Experimental.RAGTools.get_tags</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.get_tags-Tuple{PromptingTools.Experimental.RAGTools.NoTagger, AbstractVector{&lt;:AbstractString}}"><code>PromptingTools.Experimental.RAGTools.get_tags</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.getpropertynested"><code>PromptingTools.Experimental.RAGTools.getpropertynested</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.hamming_distance-Union{Tuple{T}, Tuple{AbstractMatrix{T}, AbstractVector{T}}} where T&lt;:Integer"><code>PromptingTools.Experimental.RAGTools.hamming_distance</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.hcat_truncate-Union{Tuple{AbstractVector{&lt;:AbstractMatrix{T}}}, Tuple{T}, Tuple{AbstractVector{&lt;:AbstractMatrix{T}}, Union{Nothing, Int64}}} where T&lt;:Real"><code>PromptingTools.Experimental.RAGTools.hcat_truncate</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.load_text-Tuple{PromptingTools.Experimental.RAGTools.AbstractChunker, Any}"><code>PromptingTools.Experimental.RAGTools.load_text</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.merge_kwargs_nested-Tuple{NamedTuple, NamedTuple}"><code>PromptingTools.Experimental.RAGTools.merge_kwargs_nested</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.pack_bits-Tuple{AbstractMatrix{&lt;:Bool}}"><code>PromptingTools.Experimental.RAGTools.pack_bits</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.permutation_step!-Tuple{PromptingTools.Experimental.RAGTools.RankGPTResult}"><code>PromptingTools.Experimental.RAGTools.permutation_step!</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.preprocess_tokens"><code>PromptingTools.Experimental.RAGTools.preprocess_tokens</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.print_html-Tuple{IO, PromptingTools.Experimental.RAGTools.AbstractAnnotatedNode}"><code>PromptingTools.Experimental.RAGTools.print_html</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.rank_gpt-Tuple{AbstractVector{&lt;:AbstractString}, AbstractString}"><code>PromptingTools.Experimental.RAGTools.rank_gpt</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.rank_sliding_window!-Tuple{PromptingTools.Experimental.RAGTools.RankGPTResult}"><code>PromptingTools.Experimental.RAGTools.rank_sliding_window!</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.receive_permutation!-Tuple{AbstractVector{&lt;:Integer}, AbstractString}"><code>PromptingTools.Experimental.RAGTools.receive_permutation!</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.reciprocal_rank_fusion-Union{Tuple{T}, Tuple{AbstractVector{&lt;:Integer}, AbstractVector{&lt;:T}, AbstractVector{&lt;:Integer}, AbstractVector{&lt;:T}}} where T&lt;:Real"><code>PromptingTools.Experimental.RAGTools.reciprocal_rank_fusion</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.reciprocal_rank_fusion-Tuple"><code>PromptingTools.Experimental.RAGTools.reciprocal_rank_fusion</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.refine!-Tuple{PromptingTools.Experimental.RAGTools.NoRefiner, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractRAGResult}"><code>PromptingTools.Experimental.RAGTools.refine!</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.refine!-Tuple{PromptingTools.Experimental.RAGTools.SimpleRefiner, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractRAGResult}"><code>PromptingTools.Experimental.RAGTools.refine!</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.refine!-Tuple{PromptingTools.Experimental.RAGTools.TavilySearchRefiner, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractRAGResult}"><code>PromptingTools.Experimental.RAGTools.refine!</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.rephrase-Tuple{PromptingTools.Experimental.RAGTools.SimpleRephraser, AbstractString}"><code>PromptingTools.Experimental.RAGTools.rephrase</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.rephrase-Tuple{PromptingTools.Experimental.RAGTools.HyDERephraser, AbstractString}"><code>PromptingTools.Experimental.RAGTools.rephrase</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.rephrase-Tuple{PromptingTools.Experimental.RAGTools.NoRephraser, AbstractString}"><code>PromptingTools.Experimental.RAGTools.rephrase</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.rerank-Tuple{PromptingTools.Experimental.RAGTools.RankGPTReranker, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, AbstractString, PromptingTools.Experimental.RAGTools.AbstractCandidateChunks}"><code>PromptingTools.Experimental.RAGTools.rerank</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.rerank-Tuple{PromptingTools.Experimental.RAGTools.CohereReranker, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, AbstractString, PromptingTools.Experimental.RAGTools.AbstractCandidateChunks}"><code>PromptingTools.Experimental.RAGTools.rerank</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.retrieve-Tuple{PromptingTools.Experimental.RAGTools.AbstractRetriever, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, AbstractString}"><code>PromptingTools.Experimental.RAGTools.retrieve</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.run_qa_evals-Tuple{PromptingTools.Experimental.RAGTools.QAEvalItem, RAGResult}"><code>PromptingTools.Experimental.RAGTools.run_qa_evals</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.run_qa_evals-Tuple{PromptingTools.Experimental.RAGTools.AbstractChunkIndex, AbstractVector{&lt;:PromptingTools.Experimental.RAGTools.QAEvalItem}}"><code>PromptingTools.Experimental.RAGTools.run_qa_evals</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.score_retrieval_hit-Tuple{AbstractString, Vector{&lt;:AbstractString}}"><code>PromptingTools.Experimental.RAGTools.score_retrieval_hit</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.score_retrieval_rank-Tuple{AbstractString, Vector{&lt;:AbstractString}}"><code>PromptingTools.Experimental.RAGTools.score_retrieval_rank</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.score_to_unit_scale-Union{Tuple{AbstractVector{T}}, Tuple{T}} where T&lt;:Real"><code>PromptingTools.Experimental.RAGTools.score_to_unit_scale</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.set_node_style!-Tuple{TrigramAnnotater, PromptingTools.Experimental.RAGTools.AnnotatedNode}"><code>PromptingTools.Experimental.RAGTools.set_node_style!</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.setpropertynested-Tuple{NamedTuple, Vector{Symbol}, Symbol, Any}"><code>PromptingTools.Experimental.RAGTools.setpropertynested</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.split_into_code_and_sentences-Tuple{Union{SubString{String}, String}}"><code>PromptingTools.Experimental.RAGTools.split_into_code_and_sentences</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.tags_extract-Tuple{PromptingTools.Experimental.RAGTools.Tag}"><code>PromptingTools.Experimental.RAGTools.tags_extract</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.token_with_boundaries-Tuple{Union{Nothing, AbstractString}, AbstractString, Union{Nothing, AbstractString}}"><code>PromptingTools.Experimental.RAGTools.token_with_boundaries</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.tokenize-Tuple{Union{SubString{String}, String}}"><code>PromptingTools.Experimental.RAGTools.tokenize</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.translate_positions_to_parent-Tuple{PromptingTools.Experimental.RAGTools.AbstractChunkIndex, AbstractVector{&lt;:Integer}}"><code>PromptingTools.Experimental.RAGTools.translate_positions_to_parent</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.translate_positions_to_parent-Tuple{SubChunkIndex, AbstractVector{&lt;:Integer}}"><code>PromptingTools.Experimental.RAGTools.translate_positions_to_parent</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.trigram_support!-Union{Tuple{F2}, Tuple{F1}, Tuple{PromptingTools.Experimental.RAGTools.AnnotatedNode, AbstractVector}, Tuple{PromptingTools.Experimental.RAGTools.AnnotatedNode, AbstractVector, F1}, Tuple{PromptingTools.Experimental.RAGTools.AnnotatedNode, AbstractVector, F1, F2}} where {F1&lt;:Function, F2&lt;:Function}"><code>PromptingTools.Experimental.RAGTools.trigram_support!</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.trigrams-Tuple{AbstractString}"><code>PromptingTools.Experimental.RAGTools.trigrams</code></a></li><li><a href="#PromptingTools.Experimental.RAGTools.trigrams_hashed-Tuple{AbstractString}"><code>PromptingTools.Experimental.RAGTools.trigrams_hashed</code></a></li></ul><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools" href="#PromptingTools.Experimental.RAGTools">#</a> <b><u>PromptingTools.Experimental.RAGTools</u></b> — <i>Module</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RAGTools</span></span></code></pre></div><p>Provides Retrieval-Augmented Generation (RAG) functionality.</p><p>Requires: LinearAlgebra, SparseArrays, Unicode, PromptingTools for proper functionality.</p><p>This module is experimental and may change at any time. It is intended to be moved to a separate package in the future.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/RAGTools.jl#L1-L9" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.AbstractCandidateChunks" href="#PromptingTools.Experimental.RAGTools.AbstractCandidateChunks">#</a> <b><u>PromptingTools.Experimental.RAGTools.AbstractCandidateChunks</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AbstractCandidateChunks</span></span></code></pre></div><p>Abstract type for storing candidate chunks, ie, references to items in a <code>AbstractChunkIndex</code>.</p><p>Return type from <code>find_closest</code> and <code>find_tags</code> functions.</p><p><strong>Required Fields</strong></p><ul><li><p><code>index_id::Symbol</code>: the id of the index from which the candidates are drawn</p></li><li><p><code>positions::Vector{Int}</code>: the positions of the candidates in the index</p></li><li><p><code>scores::Vector{Float32}</code>: the similarity scores of the candidates from the query (higher is better)</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/rag_interface.jl#L166-L177" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.AbstractChunkIndex" href="#PromptingTools.Experimental.RAGTools.AbstractChunkIndex">#</a> <b><u>PromptingTools.Experimental.RAGTools.AbstractChunkIndex</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AbstractChunkIndex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractDocumentIndex</span></span></code></pre></div><p>Main abstract type for storing document chunks and their embeddings. It also stores tags and sources for each chunk.</p><p><strong>Required Fields</strong></p><ul><li><p><code>id::Symbol</code>: unique identifier of each index (to ensure we&#39;re using the right index with <code>CandidateChunks</code>)</p></li><li><p><code>chunks::Vector{&lt;:AbstractString}</code>: underlying document chunks / snippets</p></li><li><p><code>embeddings::Union{Nothing, Matrix{&lt;:Real}}</code>: for semantic search</p></li><li><p><code>tags::Union{Nothing, AbstractMatrix{&lt;:Bool}}</code>: for exact search, filtering, etc. This is often a sparse matrix indicating which chunks have the given <code>tag</code> (see <code>tag_vocab</code> for the position lookup)</p></li><li><p><code>tags_vocab::Union{Nothing, Vector{&lt;:AbstractString}}</code>: vocabulary for the <code>tags</code> matrix (each column in <code>tags</code> is one item in <code>tags_vocab</code> and rows are the chunks)</p></li><li><p><code>sources::Vector{&lt;:AbstractString}</code>: sources of the chunks</p></li><li><p><code>extras::Union{Nothing, AbstractVector}</code>: additional data, eg, metadata, source code, etc.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/rag_interface.jl#L148-L161" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.AbstractGenerator" href="#PromptingTools.Experimental.RAGTools.AbstractGenerator">#</a> <b><u>PromptingTools.Experimental.RAGTools.AbstractGenerator</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AbstractGenerator </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractGenerationMethod</span></span></code></pre></div><p>Abstract type for generating an answer with <code>generate!</code> (use to change the process / return type of <code>generate</code>).</p><p><strong>Required Fields</strong></p><ul><li><p><code>contexter::AbstractContextBuilder</code>: the context building method, dispatching `build_context!</p></li><li><p><code>answerer::AbstractAnswerer</code>: the answer generation method, dispatching <code>answer!</code></p></li><li><p><code>refiner::AbstractRefiner</code>: the answer refining method, dispatching <code>refine!</code></p></li><li><p><code>postprocessor::AbstractPostprocessor</code>: the postprocessing method, dispatching <code>postprocess!</code></p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/rag_interface.jl#L213-L223" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.AbstractIndexBuilder" href="#PromptingTools.Experimental.RAGTools.AbstractIndexBuilder">#</a> <b><u>PromptingTools.Experimental.RAGTools.AbstractIndexBuilder</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AbstractIndexBuilder</span></span></code></pre></div><p>Abstract type for building an index with <code>build_index</code> (use to change the process / return type of <code>build_index</code>).</p><p><strong>Required Fields</strong></p><ul><li><p><code>chunker::AbstractChunker</code>: the chunking method, dispatching <code>get_chunks</code></p></li><li><p><code>embedder::AbstractEmbedder</code>: the embedding method, dispatching <code>get_embeddings</code></p></li><li><p><code>tagger::AbstractTagger</code>: the tagging method, dispatching <code>get_tags</code></p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/rag_interface.jl#L117-L126" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.AbstractMultiIndex" href="#PromptingTools.Experimental.RAGTools.AbstractMultiIndex">#</a> <b><u>PromptingTools.Experimental.RAGTools.AbstractMultiIndex</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AbstractMultiIndex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractDocumentIndex</span></span></code></pre></div><p>Experimental abstract type for storing multiple document indexes. Not yet implemented.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/rag_interface.jl#L141-L145" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.AbstractRetriever" href="#PromptingTools.Experimental.RAGTools.AbstractRetriever">#</a> <b><u>PromptingTools.Experimental.RAGTools.AbstractRetriever</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AbstractRetriever </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractRetrievalMethod</span></span></code></pre></div><p>Abstract type for retrieving chunks from an index with <code>retrieve</code> (use to change the process / return type of <code>retrieve</code>).</p><p><strong>Required Fields</strong></p><ul><li><p><code>rephraser::AbstractRephraser</code>: the rephrasing method, dispatching <code>rephrase</code></p></li><li><p><code>finder::AbstractSimilarityFinder</code>: the similarity search method, dispatching <code>find_closest</code></p></li><li><p><code>filter::AbstractTagFilter</code>: the tag matching method, dispatching <code>find_tags</code></p></li><li><p><code>reranker::AbstractReranker</code>: the reranking method, dispatching <code>rerank</code></p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/rag_interface.jl#L184-L194" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.AdvancedGenerator" href="#PromptingTools.Experimental.RAGTools.AdvancedGenerator">#</a> <b><u>PromptingTools.Experimental.RAGTools.AdvancedGenerator</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AdvancedGenerator </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractGenerator</span></span></code></pre></div><p>Default implementation for <code>generate!</code>. It simply enumerates context snippets and runs <code>aigenerate</code> (no refinement).</p><p>It uses <code>ContextEnumerator</code>, <code>SimpleAnswerer</code>, <code>SimpleRefiner</code>, and <code>NoPostprocessor</code> as default <code>contexter</code>, <code>answerer</code>, <code>refiner</code>, and <code>postprocessor</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/generation.jl#L381-L387" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.AdvancedRetriever" href="#PromptingTools.Experimental.RAGTools.AdvancedRetriever">#</a> <b><u>PromptingTools.Experimental.RAGTools.AdvancedRetriever</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AdvancedRetriever </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractRetriever</span></span></code></pre></div><p>Dispatch for <code>retrieve</code> with advanced retrieval methods to improve result quality. Compared to SimpleRetriever, it adds rephrasing the query and reranking the results.</p><p><strong>Fields</strong></p><ul><li><p><code>rephraser::AbstractRephraser</code>: the rephrasing method, dispatching <code>rephrase</code> - uses <code>HyDERephraser</code></p></li><li><p><code>embedder::AbstractEmbedder</code>: the embedding method, dispatching <code>get_embeddings</code> (see Preparation Stage for more details) - uses <code>BatchEmbedder</code></p></li><li><p><code>processor::AbstractProcessor</code>: the processor method, dispatching <code>get_keywords</code> (see Preparation Stage for more details) - uses <code>NoProcessor</code></p></li><li><p><code>finder::AbstractSimilarityFinder</code>: the similarity search method, dispatching <code>find_closest</code> - uses <code>CosineSimilarity</code></p></li><li><p><code>tagger::AbstractTagger</code>: the tag generating method, dispatching <code>get_tags</code> (see Preparation Stage for more details) - uses <code>NoTagger</code></p></li><li><p><code>filter::AbstractTagFilter</code>: the tag matching method, dispatching <code>find_tags</code> - uses <code>NoTagFilter</code></p></li><li><p><code>reranker::AbstractReranker</code>: the reranking method, dispatching <code>rerank</code> - uses <code>CohereReranker</code></p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L921-L935" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.AllTagFilter" href="#PromptingTools.Experimental.RAGTools.AllTagFilter">#</a> <b><u>PromptingTools.Experimental.RAGTools.AllTagFilter</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AllTagFilter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractTagFilter</span></span></code></pre></div><p>Finds the chunks that have ALL OF the specified tag(s). A method for <code>find_tags</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L98-L102" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.AnnotatedNode" href="#PromptingTools.Experimental.RAGTools.AnnotatedNode">#</a> <b><u>PromptingTools.Experimental.RAGTools.AnnotatedNode</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AnnotatedNode{T}  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractAnnotatedNode</span></span></code></pre></div><p>A node to add annotations to the generated answer in <code>airag</code></p><p>Annotations can be: sources, scores, whether its supported or not by the context, etc.</p><p><strong>Fields</strong></p><ul><li><p><code>group_id::Int</code>: Unique identifier for the same group of nodes (eg, different lines of the same code block)</p></li><li><p><code>parent::Union{AnnotatedNode, Nothing}</code>: Parent node that current node was built on</p></li><li><p><code>children::Vector{AnnotatedNode}</code>: Children nodes</p></li><li><p>`score::</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/annotation.jl#L53-L65" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.AnyTagFilter" href="#PromptingTools.Experimental.RAGTools.AnyTagFilter">#</a> <b><u>PromptingTools.Experimental.RAGTools.AnyTagFilter</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AnyTagFilter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractTagFilter</span></span></code></pre></div><p>Finds the chunks that have ANY OF the specified tag(s). A method for <code>find_tags</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L91-L95" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.BM25Similarity" href="#PromptingTools.Experimental.RAGTools.BM25Similarity">#</a> <b><u>PromptingTools.Experimental.RAGTools.BM25Similarity</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BM25Similarity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractSimilarityFinder</span></span></code></pre></div><p>Finds the closest chunks to a query embedding by measuring the BM25 similarity between the query and the chunks&#39; embeddings in binary form. A method for <code>find_closest</code>.</p><p>Reference: <a href="https://en.wikipedia.org/wiki/Okapi_BM25" target="_blank" rel="noreferrer">Wikipedia: BM25</a>. Implementation follows: <a href="https://opensourceconnections.com/blog/2015/10/16/bm25-the-next-generation-of-lucene-relevation/" target="_blank" rel="noreferrer">The Next Generation of Lucene Relevance</a>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L61-L68" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.BatchEmbedder" href="#PromptingTools.Experimental.RAGTools.BatchEmbedder">#</a> <b><u>PromptingTools.Experimental.RAGTools.BatchEmbedder</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BatchEmbedder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractEmbedder</span></span></code></pre></div><p>Default embedder for <code>get_embeddings</code> functions. It passes individual documents to be embedded in chunks to <code>aiembed</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L31-L35" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.BinaryBatchEmbedder" href="#PromptingTools.Experimental.RAGTools.BinaryBatchEmbedder">#</a> <b><u>PromptingTools.Experimental.RAGTools.BinaryBatchEmbedder</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BinaryBatchEmbedder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractEmbedder</span></span></code></pre></div><p>Same as <code>BatchEmbedder</code> but reduces the embeddings matrix to a binary form (eg, <code>BitMatrix</code>). Defines a method for <code>get_embeddings</code>.</p><p>Reference: <a href="https://huggingface.co/blog/embedding-quantization#binary-quantization-in-vector-databases" target="_blank" rel="noreferrer">HuggingFace: Embedding Quantization</a>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L52-L58" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.BinaryCosineSimilarity" href="#PromptingTools.Experimental.RAGTools.BinaryCosineSimilarity">#</a> <b><u>PromptingTools.Experimental.RAGTools.BinaryCosineSimilarity</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BinaryCosineSimilarity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractSimilarityFinder</span></span></code></pre></div><p>Finds the closest chunks to a query embedding by measuring the Hamming distance AND cosine similarity between the query and the chunks&#39; embeddings in binary form. A method for <code>find_closest</code>.</p><p>It follows the two-pass approach:</p><ul><li><p>First pass: Hamming distance in binary form to get the <code>top_k * rescore_multiplier</code> (ie, more than top_k) candidates.</p></li><li><p>Second pass: Rescore the candidates with float embeddings and return the top_k.</p></li></ul><p>Reference: <a href="https://huggingface.co/blog/embedding-quantization#binary-quantization-in-vector-databases" target="_blank" rel="noreferrer">HuggingFace: Embedding Quantization</a>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L36-L46" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.BitPackedBatchEmbedder" href="#PromptingTools.Experimental.RAGTools.BitPackedBatchEmbedder">#</a> <b><u>PromptingTools.Experimental.RAGTools.BitPackedBatchEmbedder</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BitPackedBatchEmbedder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractEmbedder</span></span></code></pre></div><p>Same as <code>BatchEmbedder</code> but reduces the embeddings matrix to a binary form packed in UInt64 (eg, <code>BitMatrix.chunks</code>). Defines a method for <code>get_embeddings</code>.</p><p>See also utilities <code>pack_bits</code> and <code>unpack_bits</code> to move between packed/non-packed binary forms.</p><p>Reference: <a href="https://huggingface.co/blog/embedding-quantization#binary-quantization-in-vector-databases" target="_blank" rel="noreferrer">HuggingFace: Embedding Quantization</a>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L61-L69" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.BitPackedCosineSimilarity" href="#PromptingTools.Experimental.RAGTools.BitPackedCosineSimilarity">#</a> <b><u>PromptingTools.Experimental.RAGTools.BitPackedCosineSimilarity</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BitPackedCosineSimilarity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractSimilarityFinder</span></span></code></pre></div><p>Finds the closest chunks to a query embedding by measuring the Hamming distance AND cosine similarity between the query and the chunks&#39; embeddings in binary form. A method for <code>find_closest</code>.</p><p>The difference to <code>BinaryCosineSimilarity</code> is that the binary values are packed into UInt64, which is more efficient.</p><p>Reference: <a href="https://huggingface.co/blog/embedding-quantization#binary-quantization-in-vector-databases" target="_blank" rel="noreferrer">HuggingFace: Embedding Quantization</a>. Implementation of <code>hamming_distance</code> is based on <a href="https://github.com/domluna/tinyrag/blob/main/README.md" target="_blank" rel="noreferrer">TinyRAG</a>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L49-L58" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.CandidateChunks" href="#PromptingTools.Experimental.RAGTools.CandidateChunks">#</a> <b><u>PromptingTools.Experimental.RAGTools.CandidateChunks</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CandidateChunks</span></span></code></pre></div><p>A struct for storing references to chunks in the given index (identified by <code>index_id</code>) called <code>positions</code> and <code>scores</code> holding the strength of similarity (=1 is the highest, most similar). It&#39;s the result of the retrieval stage of RAG.</p><p><strong>Fields</strong></p><ul><li><p><code>index_id::Symbol</code>: the id of the index from which the candidates are drawn</p></li><li><p><code>positions::Vector{Int}</code>: the positions of the candidates in the index (ie, <code>5</code> refers to the 5th chunk in the index - <code>chunks(index)[5]</code>)</p></li><li><p><code>scores::Vector{Float32}</code>: the similarity scores of the candidates from the query (higher is better)</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/types.jl#L520-L530" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.ChunkEmbeddingsIndex" href="#PromptingTools.Experimental.RAGTools.ChunkEmbeddingsIndex">#</a> <b><u>PromptingTools.Experimental.RAGTools.ChunkEmbeddingsIndex</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ChunkEmbeddingsIndex</span></span></code></pre></div><p>Main struct for storing document chunks and their embeddings. It also stores tags and sources for each chunk.</p><p>Previously, this struct was called <code>ChunkIndex</code>.</p><p><strong>Fields</strong></p><ul><li><p><code>id::Symbol</code>: unique identifier of each index (to ensure we&#39;re using the right index with <code>CandidateChunks</code>)</p></li><li><p><code>chunks::Vector{&lt;:AbstractString}</code>: underlying document chunks / snippets</p></li><li><p><code>embeddings::Union{Nothing, Matrix{&lt;:Real}}</code>: for semantic search</p></li><li><p><code>tags::Union{Nothing, AbstractMatrix{&lt;:Bool}}</code>: for exact search, filtering, etc. This is often a sparse matrix indicating which chunks have the given <code>tag</code> (see <code>tag_vocab</code> for the position lookup)</p></li><li><p><code>tags_vocab::Union{Nothing, Vector{&lt;:AbstractString}}</code>: vocabulary for the <code>tags</code> matrix (each column in <code>tags</code> is one item in <code>tags_vocab</code> and rows are the chunks)</p></li><li><p><code>sources::Vector{&lt;:AbstractString}</code>: sources of the chunks</p></li><li><p><code>extras::Union{Nothing, AbstractVector}</code>: additional data, eg, metadata, source code, etc.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/types.jl#L95-L110" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.ChunkKeywordsIndex" href="#PromptingTools.Experimental.RAGTools.ChunkKeywordsIndex">#</a> <b><u>PromptingTools.Experimental.RAGTools.ChunkKeywordsIndex</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ChunkKeywordsIndex</span></span></code></pre></div><p>Struct for storing chunks of text and associated keywords for BM25 similarity search.</p><p><strong>Fields</strong></p><ul><li><p><code>id::Symbol</code>: unique identifier of each index (to ensure we&#39;re using the right index with <code>CandidateChunks</code>)</p></li><li><p><code>chunks::Vector{&lt;:AbstractString}</code>: underlying document chunks / snippets</p></li><li><p><code>chunkdata::Union{Nothing, AbstractMatrix{&lt;:Real}}</code>: for similarity search, assumed to be <code>DocumentTermMatrix</code></p></li><li><p><code>tags::Union{Nothing, AbstractMatrix{&lt;:Bool}}</code>: for exact search, filtering, etc. This is often a sparse matrix indicating which chunks have the given <code>tag</code> (see <code>tag_vocab</code> for the position lookup)</p></li><li><p><code>tags_vocab::Union{Nothing, Vector{&lt;:AbstractString}}</code>: vocabulary for the <code>tags</code> matrix (each column in <code>tags</code> is one item in <code>tags_vocab</code> and rows are the chunks)</p></li><li><p><code>sources::Vector{&lt;:AbstractString}</code>: sources of the chunks</p></li><li><p><code>extras::Union{Nothing, AbstractVector}</code>: additional data, eg, metadata, source code, etc.</p></li></ul><p><strong>Example</strong></p><p>We can easily create a keywords-based index from a standard embeddings-based index.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Let&#39;s assume we have a standard embeddings-based index</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> build_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SimpleIndexer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), texts; chunker_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Creating an additional index for keyword-based search (BM25), is as simple as</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index_keywords </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ChunkKeywordsIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(index)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># We can immediately create a MultiIndex (a hybrid index holding both indices)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">multi_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> MultiIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([index, index_keywords])</span></span></code></pre></div><p>You can also build the index via build_index</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># given some sentences and sources</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index_keywords </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> build_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">KeywordsIndexer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), sentences; chunker_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; sources))</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Retrive closest chunks with</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">retriever </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SimpleBM25Retriever</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> retrieve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(retriever, index_keywords, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What are the best practices for parallel computing in Julia?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">context</span></span></code></pre></div><p>If you want to use airag, don&#39;t forget to specify the config to make sure keywords are processed (ie, tokenized) and that BM25 is used for searching candidates</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cfg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> RAGConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; retriever </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SimpleBM25Retriever</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">airag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfg, index_keywords;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    question </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;What are the best practices for parallel computing in Julia?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/types.jl#L248-L297" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.ChunkKeywordsIndex-Tuple{PromptingTools.Experimental.RAGTools.AbstractProcessor, ChunkEmbeddingsIndex}" href="#PromptingTools.Experimental.RAGTools.ChunkKeywordsIndex-Tuple{PromptingTools.Experimental.RAGTools.AbstractProcessor, ChunkEmbeddingsIndex}">#</a> <b><u>PromptingTools.Experimental.RAGTools.ChunkKeywordsIndex</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ChunkKeywordsIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [processor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractProcessor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">KeywordsProcessor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),] index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ChunkEmbeddingsIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    index_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> gensym</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ChunkKeywordsIndex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), processor_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Convenience method to quickly create a <code>ChunkKeywordsIndex</code> from an existing <code>ChunkEmbeddingsIndex</code>.</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Let&#39;s assume we have a standard embeddings-based index</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> build_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SimpleIndexer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), texts; chunker_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Creating an additional index for keyword-based search (BM25), is as simple as</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index_keywords </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ChunkKeywordsIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(index)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># We can immediately create a MultiIndex (a hybrid index holding both indices)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">multi_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> MultiIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([index, index_keywords])</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L705-L725" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.CohereReranker" href="#PromptingTools.Experimental.RAGTools.CohereReranker">#</a> <b><u>PromptingTools.Experimental.RAGTools.CohereReranker</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CohereReranker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractReranker</span></span></code></pre></div><p>Rerank strategy using the Cohere Rerank API. Requires an API key. A method for <code>rerank</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L622-L626" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.ContextEnumerator" href="#PromptingTools.Experimental.RAGTools.ContextEnumerator">#</a> <b><u>PromptingTools.Experimental.RAGTools.ContextEnumerator</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ContextEnumerator </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractContextBuilder</span></span></code></pre></div><p>Default method for <code>build_context!</code> method. It simply enumerates the context snippets around each position in <code>candidates</code>. When possibly, it will add surrounding chunks (from the same source).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/generation.jl#L2-L6" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.CosineSimilarity" href="#PromptingTools.Experimental.RAGTools.CosineSimilarity">#</a> <b><u>PromptingTools.Experimental.RAGTools.CosineSimilarity</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CosineSimilarity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractSimilarityFinder</span></span></code></pre></div><p>Finds the closest chunks to a query embedding by measuring the cosine similarity between the query and the chunks&#39; embeddings. A method for <code>find_closest</code> (see the docstring for more details and usage example).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L29-L33" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.DocumentTermMatrix" href="#PromptingTools.Experimental.RAGTools.DocumentTermMatrix">#</a> <b><u>PromptingTools.Experimental.RAGTools.DocumentTermMatrix</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DocumentTermMatrix{T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>A sparse matrix of term frequencies and document lengths to allow calculation of BM25 similarity scores.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/types.jl#L139-L143" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.FileChunker" href="#PromptingTools.Experimental.RAGTools.FileChunker">#</a> <b><u>PromptingTools.Experimental.RAGTools.FileChunker</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">FileChunker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractChunker</span></span></code></pre></div><p>Chunker when you provide file paths to <code>get_chunks</code> functions.</p><p>Ie, the inputs will be validated first (eg, file exists, etc) and then read into memory.</p><p>Set as default chunker in <code>get_chunks</code> functions.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L5-L13" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.FlashRanker" href="#PromptingTools.Experimental.RAGTools.FlashRanker">#</a> <b><u>PromptingTools.Experimental.RAGTools.FlashRanker</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">FlashRanker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractReranker</span></span></code></pre></div><p>Rerank strategy using the package FlashRank.jl and local models. A method for <code>rerank</code>.</p><p>You must first import the FlashRank.jl package. To automatically download any required models, set your <code>ENV[&quot;DATADEPS_ALWAYS_ACCEPT&quot;] = true</code> (see <a href="https://www.oxinabox.net/DataDeps.jl/dev/z10-for-end-users/" target="_blank" rel="noreferrer">DataDeps</a> for more details).</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FlashRank</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Wrap the model to be a valid Ranker recognized by RAGTools</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># It will be provided to the airag/rerank function to avoid instantiating it on every call</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">reranker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FlashRank</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RankerModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:mini</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FlashRanker</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># You can choose :tiny or :mini</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Apply to the pipeline configuration, eg, </span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cfg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> RAGConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; retriever </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AdvancedRetriever</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; reranker))</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Ask a question (assumes you have some `index`)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">question </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;What are the best practices for parallel computing in Julia?&quot;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> airag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfg, index; question, return_all </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L629-L654" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.HTMLStyler" href="#PromptingTools.Experimental.RAGTools.HTMLStyler">#</a> <b><u>PromptingTools.Experimental.RAGTools.HTMLStyler</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HTMLStyler</span></span></code></pre></div><p>Defines styling via classes (attribute <code>class</code>) and styles (attribute <code>style</code>) for HTML formatting of <code>AbstractAnnotatedNode</code></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/annotation.jl#L39-L43" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.HyDERephraser" href="#PromptingTools.Experimental.RAGTools.HyDERephraser">#</a> <b><u>PromptingTools.Experimental.RAGTools.HyDERephraser</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HyDERephraser </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractRephraser</span></span></code></pre></div><p>Rephraser implemented using the provided AI Template (eg, <code>...</code>) and standard chat model. A method for <code>rephrase</code>.</p><p>It uses a prompt-based rephrasing method called HyDE (Hypothetical Document Embedding), where instead of looking for an embedding of the question, we look for the documents most similar to a synthetic passage that <em>would be</em> a good answer to our question.</p><p>Reference: <a href="https://arxiv.org/abs/2212.10496" target="_blank" rel="noreferrer">Arxiv paper</a>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L17-L26" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.JudgeAllScores" href="#PromptingTools.Experimental.RAGTools.JudgeAllScores">#</a> <b><u>PromptingTools.Experimental.RAGTools.JudgeAllScores</u></b> — <i>Type</i>. <p><code>final_rating</code> is the average of all scoring criteria. Explain the <code>final_rating</code> in <code>rationale</code></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/evaluation.jl#L32" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.JudgeRating" href="#PromptingTools.Experimental.RAGTools.JudgeRating">#</a> <b><u>PromptingTools.Experimental.RAGTools.JudgeRating</u></b> — <i>Type</i>. <p>Provide the <code>final_rating</code> between 1-5. Provide the rationale for it.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/evaluation.jl#L26" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.KeywordsIndexer" href="#PromptingTools.Experimental.RAGTools.KeywordsIndexer">#</a> <b><u>PromptingTools.Experimental.RAGTools.KeywordsIndexer</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">KeywordsIndexer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractIndexBuilder</span></span></code></pre></div><p>Keyword-based index (BM25) to be returned by <code>build_index</code>.</p><p>It uses <code>TextChunker</code>, <code>KeywordsProcessor</code>, and <code>NoTagger</code> as default chunker, processor, and tagger.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L124-L130" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.KeywordsProcessor" href="#PromptingTools.Experimental.RAGTools.KeywordsProcessor">#</a> <b><u>PromptingTools.Experimental.RAGTools.KeywordsProcessor</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">KeywordsProcessor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractProcessor</span></span></code></pre></div><p>Default keywords processor for <code>get_keywords</code> functions. It normalizes the documents, tokenizes them and builds a <code>DocumentTermMatrix</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L38-L42" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.MultiCandidateChunks" href="#PromptingTools.Experimental.RAGTools.MultiCandidateChunks">#</a> <b><u>PromptingTools.Experimental.RAGTools.MultiCandidateChunks</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MultiCandidateChunks</span></span></code></pre></div><p>A struct for storing references to multiple sets of chunks across different indices. Each set of chunks is identified by an <code>index_id</code> in <code>index_ids</code>, with corresponding <code>positions</code> in the index and <code>scores</code> indicating the strength of similarity.</p><p>This struct is useful for scenarios where candidates are drawn from multiple indices, and there is a need to keep track of which candidates came from which index.</p><p><strong>Fields</strong></p><ul><li><p><code>index_ids::Vector{Symbol}</code>: the ids of the indices from which the candidates are drawn</p></li><li><p><code>positions::Vector{TP}</code>: the positions of the candidates in their respective indices</p></li><li><p><code>scores::Vector{TD}</code>: the similarity scores of the candidates from the query</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/types.jl#L563-L574" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.MultiFinder" href="#PromptingTools.Experimental.RAGTools.MultiFinder">#</a> <b><u>PromptingTools.Experimental.RAGTools.MultiFinder</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MultiFinder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractSimilarityFinder</span></span></code></pre></div><p>Composite finder for <code>MultiIndex</code> where we want to set multiple finders for each index. A method for <code>find_closest</code>. Positions correspond to <code>indexes(::MultiIndex)</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L71-L76" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.MultiIndex" href="#PromptingTools.Experimental.RAGTools.MultiIndex">#</a> <b><u>PromptingTools.Experimental.RAGTools.MultiIndex</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MultiIndex</span></span></code></pre></div><p>Composite index that stores multiple ChunkIndex objects and their embeddings.</p><p><strong>Fields</strong></p><ul><li><p><code>id::Symbol</code>: unique identifier of each index (to ensure we&#39;re using the right index with <code>CandidateChunks</code>)</p></li><li><p><code>indexes::Vector{&lt;:AbstractChunkIndex}</code>: the indexes to be combined</p></li></ul><p>Use accesor <code>indexes</code> to access the individual indexes.</p><p><strong>Examples</strong></p><p>We can create a <code>MultiIndex</code> from a vector of <code>AbstractChunkIndex</code> objects.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> build_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SimpleIndexer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), texts; chunker_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; sources))</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index_keywords </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ChunkKeywordsIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(index) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># same chunks as above but adds BM25 instead of embeddings</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">multi_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> MultiIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([index, index_keywords])</span></span></code></pre></div><p>To use <code>airag</code> with different types of indices, we need to specify how to find the closest items for each index</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Cosine similarity for embeddings and BM25 for keywords, same order as indexes in MultiIndex</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">finder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MultiFinder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CosineSimilarity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BM25Similarity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()])</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Notice that we add `processor` to make sure keywords are processed (ie, tokenized) as well</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cfg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> RAGConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; retriever </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SimpleRetriever</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; processor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">KeywordsProcessor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), finder))</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Ask questions</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> airag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfg, multi_index; question </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;What are the best practices for parallel computing in Julia?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pprint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># prettify the answer</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/types.jl#L330-L364" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.NoEmbedder" href="#PromptingTools.Experimental.RAGTools.NoEmbedder">#</a> <b><u>PromptingTools.Experimental.RAGTools.NoEmbedder</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NoEmbedder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractEmbedder</span></span></code></pre></div><p>No-op embedder for <code>get_embeddings</code> functions. It returns <code>nothing</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L24-L28" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.NoPostprocessor" href="#PromptingTools.Experimental.RAGTools.NoPostprocessor">#</a> <b><u>PromptingTools.Experimental.RAGTools.NoPostprocessor</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NoPostprocessor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractPostprocessor</span></span></code></pre></div><p>Default method for <code>postprocess!</code> method. A passthrough option that returns the <code>result</code> without any changes.</p><p>Overload this method to add custom postprocessing steps, eg, logging, saving conversations to disk, etc.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/generation.jl#L347-L353" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.NoProcessor" href="#PromptingTools.Experimental.RAGTools.NoProcessor">#</a> <b><u>PromptingTools.Experimental.RAGTools.NoProcessor</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NoProcessor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractProcessor</span></span></code></pre></div><p>No-op processor for <code>get_keywords</code> functions. It returns the inputs as is.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L45-L49" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.NoRefiner" href="#PromptingTools.Experimental.RAGTools.NoRefiner">#</a> <b><u>PromptingTools.Experimental.RAGTools.NoRefiner</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NoRefiner </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractRefiner</span></span></code></pre></div><p>Default method for <code>refine!</code> method. A passthrough option that returns the <code>result.answer</code> without any changes.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/generation.jl#L143-L147" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.NoRephraser" href="#PromptingTools.Experimental.RAGTools.NoRephraser">#</a> <b><u>PromptingTools.Experimental.RAGTools.NoRephraser</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NoRephraser </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractRephraser</span></span></code></pre></div><p>No-op implementation for <code>rephrase</code>, which simply passes the question through.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L3-L7" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.NoReranker" href="#PromptingTools.Experimental.RAGTools.NoReranker">#</a> <b><u>PromptingTools.Experimental.RAGTools.NoReranker</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NoReranker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractReranker</span></span></code></pre></div><p>No-op implementation for <code>rerank</code>, which simply passes the candidate chunks through.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L615-L619" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.NoTagFilter" href="#PromptingTools.Experimental.RAGTools.NoTagFilter">#</a> <b><u>PromptingTools.Experimental.RAGTools.NoTagFilter</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NoTagFilter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractTagFilter</span></span></code></pre></div><p>No-op implementation for <code>find_tags</code>, which simply returns all chunks.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L83-L88" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.NoTagger" href="#PromptingTools.Experimental.RAGTools.NoTagger">#</a> <b><u>PromptingTools.Experimental.RAGTools.NoTagger</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NoTagger </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractTagger</span></span></code></pre></div><p>No-op tagger for <code>get_tags</code> functions. It returns (<code>nothing</code>, <code>nothing</code>).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L79-L83" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.OpenTagger" href="#PromptingTools.Experimental.RAGTools.OpenTagger">#</a> <b><u>PromptingTools.Experimental.RAGTools.OpenTagger</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">OpenTagger </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractTagger</span></span></code></pre></div><p>Tagger for <code>get_tags</code> functions, which generates possible tags for each chunk via <code>aiextract</code>. You can customize it via prompt template (default: <code>:RAGExtractMetadataShort</code>), but it&#39;s quite open-ended (ie, AI decides the possible tags).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L93-L98" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.PassthroughTagger" href="#PromptingTools.Experimental.RAGTools.PassthroughTagger">#</a> <b><u>PromptingTools.Experimental.RAGTools.PassthroughTagger</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PassthroughTagger </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractTagger</span></span></code></pre></div><p>Tagger for <code>get_tags</code> functions, which passes <code>tags</code> directly as Vector of Vectors of strings (ie, <code>tags[i]</code> is the tags for <code>docs[i]</code>).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L86-L90" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.RAGConfig" href="#PromptingTools.Experimental.RAGTools.RAGConfig">#</a> <b><u>PromptingTools.Experimental.RAGTools.RAGConfig</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RAGConfig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractRAGConfig</span></span></code></pre></div><p>Default configuration for RAG. It uses <code>SimpleIndexer</code>, <code>SimpleRetriever</code>, and <code>SimpleGenerator</code> as default components. Provided as the first argument in <code>airag</code>.</p><p>To customize the components, replace corresponding fields for each step of the RAG pipeline (eg, use <code>subtypes(AbstractIndexBuilder)</code> to find the available options).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/generation.jl#L511-L517" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.RAGResult" href="#PromptingTools.Experimental.RAGTools.RAGResult">#</a> <b><u>PromptingTools.Experimental.RAGTools.RAGResult</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RAGResult</span></span></code></pre></div><p>A struct for debugging RAG answers. It contains the question, answer, context, and the candidate chunks at each step of the RAG pipeline.</p><p>Think of the flow as <code>question</code> -&gt; <code>rephrased_questions</code> -&gt; <code>answer</code> -&gt; <code>final_answer</code> with the context and candidate chunks helping along the way.</p><p><strong>Fields</strong></p><ul><li><p><code>question::AbstractString</code>: the original question</p></li><li><p><code>rephrased_questions::Vector{&lt;:AbstractString}</code>: a vector of rephrased questions (eg, HyDe, Multihop, etc.)</p></li><li><p><code>answer::AbstractString</code>: the generated answer</p></li><li><p><code>final_answer::AbstractString</code>: the refined final answer (eg, after CorrectiveRAG), also considered the FINAL answer (it must be always available)</p></li><li><p><code>context::Vector{&lt;:AbstractString}</code>: the context used for retrieval (ie, the vector of chunks and their surrounding window if applicable)</p></li><li><p><code>sources::Vector{&lt;:AbstractString}</code>: the sources of the context (for the original matched chunks)</p></li><li><p><code>emb_candidates::CandidateChunks</code>: the candidate chunks from the embedding index (from <code>find_closest</code>)</p></li><li><p><code>tag_candidates::Union{Nothing, CandidateChunks}</code>: the candidate chunks from the tag index (from <code>find_tags</code>)</p></li><li><p><code>filtered_candidates::CandidateChunks</code>: the filtered candidate chunks (intersection of <code>emb_candidates</code> and <code>tag_candidates</code>)</p></li><li><p><code>reranked_candidates::CandidateChunks</code>: the reranked candidate chunks (from <code>rerank</code>)</p></li><li><p><code>conversations::Dict{Symbol,Vector{&lt;:AbstractMessage}}</code>: the conversation history for AI steps of the RAG pipeline, use keys that correspond to the function names, eg, <code>:answer</code> or <code>:refine</code></p></li></ul><p>See also: <code>pprint</code> (pretty printing), <code>annotate_support</code> (for annotating the answer)</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/types.jl#L945-L966" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.RankGPTReranker" href="#PromptingTools.Experimental.RAGTools.RankGPTReranker">#</a> <b><u>PromptingTools.Experimental.RAGTools.RankGPTReranker</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RankGPTReranker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractReranker</span></span></code></pre></div><p>Rerank strategy using the RankGPT algorithm (calling LLMs). A method for <code>rerank</code>.</p><p><strong>Reference</strong></p><p>[1] <a href="https://arxiv.org/abs/2304.09542" target="_blank" rel="noreferrer">Is ChatGPT Good at Search? Investigating Large Language Models as Re-Ranking Agents by W. Sun et al.</a> [2] <a href="https://github.com/sunnweiwei/RankGPT" target="_blank" rel="noreferrer">RankGPT Github</a></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L659-L667" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.RankGPTResult" href="#PromptingTools.Experimental.RAGTools.RankGPTResult">#</a> <b><u>PromptingTools.Experimental.RAGTools.RankGPTResult</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RankGPTResult</span></span></code></pre></div><p>Results from the RankGPT algorithm.</p><p><strong>Fields</strong></p><ul><li><p><code>question::String</code>: The question that was asked.</p></li><li><p><code>chunks::AbstractVector{T}</code>: The chunks that were ranked (=context).</p></li><li><p><code>positions::Vector{Int}</code>: The ranking of the chunks (referring to the <code>chunks</code>).</p></li><li><p><code>elapsed::Float64</code>: The time it took to rank the chunks.</p></li><li><p><code>cost::Float64</code>: The cumulative cost of the ranking.</p></li><li><p><code>tokens::Int</code>: The cumulative number of tokens used in the ranking.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/rank_gpt.jl#L5-L17" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.SimpleAnswerer" href="#PromptingTools.Experimental.RAGTools.SimpleAnswerer">#</a> <b><u>PromptingTools.Experimental.RAGTools.SimpleAnswerer</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SimpleAnswerer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractAnswerer</span></span></code></pre></div><p>Default method for <code>answer!</code> method. Generates an answer using the <code>aigenerate</code> function with the provided context and question.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/generation.jl#L80-L84" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.SimpleBM25Retriever" href="#PromptingTools.Experimental.RAGTools.SimpleBM25Retriever">#</a> <b><u>PromptingTools.Experimental.RAGTools.SimpleBM25Retriever</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SimpleBM25Retriever </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractRetriever</span></span></code></pre></div><p>Keyword-based implementation for <code>retrieve</code>. It does a simple similarity search via <code>BM25Similarity</code> and returns the results.</p><p>Make sure to use consistent <code>processor</code> and <code>tagger</code> with the Preparation Stage (<code>build_index</code>)!</p><p><strong>Fields</strong></p><ul><li><p><code>rephraser::AbstractRephraser</code>: the rephrasing method, dispatching <code>rephrase</code> - uses <code>NoRephraser</code></p></li><li><p><code>embedder::AbstractEmbedder</code>: the embedding method, dispatching <code>get_embeddings</code> (see Preparation Stage for more details) - uses <code>NoEmbedder</code></p></li><li><p><code>processor::AbstractProcessor</code>: the processor method, dispatching <code>get_keywords</code> (see Preparation Stage for more details) - uses <code>KeywordsProcessor</code></p></li><li><p><code>finder::AbstractSimilarityFinder</code>: the similarity search method, dispatching <code>find_closest</code> - uses <code>CosineSimilarity</code></p></li><li><p><code>tagger::AbstractTagger</code>: the tag generating method, dispatching <code>get_tags</code> (see Preparation Stage for more details) - uses <code>NoTagger</code></p></li><li><p><code>filter::AbstractTagFilter</code>: the tag matching method, dispatching <code>find_tags</code> - uses <code>NoTagFilter</code></p></li><li><p><code>reranker::AbstractReranker</code>: the reranking method, dispatching <code>rerank</code> - uses <code>NoReranker</code></p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L895-L910" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.SimpleGenerator" href="#PromptingTools.Experimental.RAGTools.SimpleGenerator">#</a> <b><u>PromptingTools.Experimental.RAGTools.SimpleGenerator</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SimpleGenerator </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractGenerator</span></span></code></pre></div><p>Default implementation for <code>generate</code>. It simply enumerates context snippets and runs <code>aigenerate</code> (no refinement).</p><p>It uses <code>ContextEnumerator</code>, <code>SimpleAnswerer</code>, <code>NoRefiner</code>, and <code>NoPostprocessor</code> as default <code>contexter</code>, <code>answerer</code>, <code>refiner</code>, and <code>postprocessor</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/generation.jl#L367-L373" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.SimpleIndexer" href="#PromptingTools.Experimental.RAGTools.SimpleIndexer">#</a> <b><u>PromptingTools.Experimental.RAGTools.SimpleIndexer</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SimpleIndexer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractIndexBuilder</span></span></code></pre></div><p>Default implementation for <code>build_index</code>.</p><p>It uses <code>TextChunker</code>, <code>BatchEmbedder</code>, and <code>NoTagger</code> as default chunker, embedder, and tagger.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L111-L117" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.SimpleRefiner" href="#PromptingTools.Experimental.RAGTools.SimpleRefiner">#</a> <b><u>PromptingTools.Experimental.RAGTools.SimpleRefiner</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SimpleRefiner </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractRefiner</span></span></code></pre></div><p>Refines the answer using the same context previously provided via the provided prompt template. A method for <code>refine!</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/generation.jl#L150-L154" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.SimpleRephraser" href="#PromptingTools.Experimental.RAGTools.SimpleRephraser">#</a> <b><u>PromptingTools.Experimental.RAGTools.SimpleRephraser</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SimpleRephraser </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractRephraser</span></span></code></pre></div><p>Rephraser implemented using the provided AI Template (eg, <code>...</code>) and standard chat model. A method for <code>rephrase</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L10-L14" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.SimpleRetriever" href="#PromptingTools.Experimental.RAGTools.SimpleRetriever">#</a> <b><u>PromptingTools.Experimental.RAGTools.SimpleRetriever</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SimpleRetriever </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractRetriever</span></span></code></pre></div><p>Default implementation for <code>retrieve</code> function. It does a simple similarity search via <code>CosineSimilarity</code> and returns the results.</p><p>Make sure to use consistent <code>embedder</code> and <code>tagger</code> with the Preparation Stage (<code>build_index</code>)!</p><p><strong>Fields</strong></p><ul><li><p><code>rephraser::AbstractRephraser</code>: the rephrasing method, dispatching <code>rephrase</code> - uses <code>NoRephraser</code></p></li><li><p><code>embedder::AbstractEmbedder</code>: the embedding method, dispatching <code>get_embeddings</code> (see Preparation Stage for more details) - uses <code>BatchEmbedder</code></p></li><li><p><code>processor::AbstractProcessor</code>: the processor method, dispatching <code>get_keywords</code> (see Preparation Stage for more details) - uses <code>NoProcessor</code></p></li><li><p><code>finder::AbstractSimilarityFinder</code>: the similarity search method, dispatching <code>find_closest</code> - uses <code>CosineSimilarity</code></p></li><li><p><code>tagger::AbstractTagger</code>: the tag generating method, dispatching <code>get_tags</code> (see Preparation Stage for more details) - uses <code>NoTagger</code></p></li><li><p><code>filter::AbstractTagFilter</code>: the tag matching method, dispatching <code>find_tags</code> - uses <code>NoTagFilter</code></p></li><li><p><code>reranker::AbstractReranker</code>: the reranking method, dispatching <code>rerank</code> - uses <code>NoReranker</code></p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L869-L884" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.Styler" href="#PromptingTools.Experimental.RAGTools.Styler">#</a> <b><u>PromptingTools.Experimental.RAGTools.Styler</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Styler</span></span></code></pre></div><p>Defines styling keywords for <code>printstyled</code> for each <code>AbstractAnnotatedNode</code></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/annotation.jl#L27-L31" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.SubChunkIndex" href="#PromptingTools.Experimental.RAGTools.SubChunkIndex">#</a> <b><u>PromptingTools.Experimental.RAGTools.SubChunkIndex</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SubChunkIndex</span></span></code></pre></div><p>A view of the parent index with respect to the <code>chunks</code> (and chunk-aligned fields). All methods and accessors working for <code>AbstractChunkIndex</code> also work for <code>SubChunkIndex</code>. It does not yet work for <code>MultiIndex</code>.</p><p><strong>Fields</strong></p><ul><li><p><code>parent::AbstractChunkIndex</code>: the parent index from which the chunks are drawn (always the original index, never a view)</p></li><li><p><code>positions::Vector{Int}</code>: the positions of the chunks in the parent index (always refers to original PARENT index, even if we create a view of the view)</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CandidateChunks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sub_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> @view</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(index[cc])</span></span></code></pre></div><p>You can use <code>SubChunkIndex</code> to access chunks or sources (and other fields) from a parent index, eg,</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">chunks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sub_index)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sources</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sub_index)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">chunkdata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sub_index) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># slice of embeddings</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">embeddings</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sub_index) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># slice of embeddings</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sub_index) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># slice of tags</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tags_vocab</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sub_index) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># unchanged, identical to parent version</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">extras</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sub_index) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># slice of extras</span></span></code></pre></div><p>Access the parent index that the <code>positions</code> correspond to</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">parent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sub_index)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">positions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sub_index)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/types.jl#L399-L431" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.SubDocumentTermMatrix" href="#PromptingTools.Experimental.RAGTools.SubDocumentTermMatrix">#</a> <b><u>PromptingTools.Experimental.RAGTools.SubDocumentTermMatrix</u></b> — <i>Type</i>. <p>A partial view of a DocumentTermMatrix, <code>tf</code> is MATERIALIZED for performance and fewer allocations.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/types.jl#L200" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.TavilySearchRefiner" href="#PromptingTools.Experimental.RAGTools.TavilySearchRefiner">#</a> <b><u>PromptingTools.Experimental.RAGTools.TavilySearchRefiner</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TavilySearchRefiner </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractRefiner</span></span></code></pre></div><p>Refines the answer by executing a web search using the Tavily API. This method aims to enhance the answer&#39;s accuracy and relevance by incorporating information retrieved from the web. A method for <code>refine!</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/generation.jl#L157-L161" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.TextChunker" href="#PromptingTools.Experimental.RAGTools.TextChunker">#</a> <b><u>PromptingTools.Experimental.RAGTools.TextChunker</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TextChunker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractChunker</span></span></code></pre></div><p>Chunker when you provide text to <code>get_chunks</code> functions. Inputs are directly chunked</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L16-L20" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.TrigramAnnotater" href="#PromptingTools.Experimental.RAGTools.TrigramAnnotater">#</a> <b><u>PromptingTools.Experimental.RAGTools.TrigramAnnotater</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TrigramAnnotater</span></span></code></pre></div><p>Annotation method where we score answer versus each context based on word-level trigrams that match.</p><p>It&#39;s very simple method (and it can loose some semantic meaning in longer sequences like negative), but it works reasonably well for both text and code.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/annotation.jl#L142-L148" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools._normalize" href="#PromptingTools.Experimental.RAGTools._normalize">#</a> <b><u>PromptingTools.Experimental.RAGTools._normalize</u></b> — <i>Function</i>. <p>Shortcut to LinearAlgebra.normalize. Provided in the package extension <code>RAGToolsExperimentalExt</code> (Requires SparseArrays, Unicode, and LinearAlgebra)</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L142" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.add_node_metadata!-Tuple{TrigramAnnotater, PromptingTools.Experimental.RAGTools.AnnotatedNode}" href="#PromptingTools.Experimental.RAGTools.add_node_metadata!-Tuple{TrigramAnnotater, PromptingTools.Experimental.RAGTools.AnnotatedNode}">#</a> <b><u>PromptingTools.Experimental.RAGTools.add_node_metadata!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">add_node_metadata!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(annotater</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TrigramAnnotater</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    root</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AnnotatedNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; add_sources</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, add_scores</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sources</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractVector{&lt;:AbstractString}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Adds metadata to the children of <code>root</code>. Metadata includes sources and scores, if requested.</p><p>Optionally, it can add a list of <code>sources</code> at the end of the printed text.</p><p>The metadata is added by inserting new nodes in the <code>root</code> children list (with no children of its own to be printed out).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/annotation.jl#L318-L328" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.airag-Tuple{PromptingTools.Experimental.RAGTools.AbstractRAGConfig, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex}" href="#PromptingTools.Experimental.RAGTools.airag-Tuple{PromptingTools.Experimental.RAGTools.AbstractRAGConfig, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex}">#</a> <b><u>PromptingTools.Experimental.RAGTools.airag</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">airag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractRAGConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractDocumentIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    question</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    retriever</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractRetriever</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cfg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">retriever,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    retriever_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    generator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractGenerator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cfg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">generator,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    generator_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_tracker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Atomic{Float64}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><p>High-level wrapper for Retrieval-Augmented Generation (RAG), it combines together the <code>retrieve</code> and <code>generate!</code> steps which you can customize if needed.</p><p>The simplest version first finds the relevant chunks in <code>index</code> for the <code>question</code> and then sends these chunks to the AI model to help with generating a response to the <code>question</code>.</p><p>To customize the components, replace the types (<code>retriever</code>, <code>generator</code>) of the corresponding step of the RAG pipeline - or go into sub-routines within the steps. Eg, use <code>subtypes(AbstractRetriever)</code> to find the available options.</p><p><strong>Arguments</strong></p><ul><li><p><code>cfg::AbstractRAGConfig</code>: The configuration for the RAG pipeline. Defaults to <code>RAGConfig()</code>, where you can swap sub-types to customize the pipeline.</p></li><li><p><code>index::AbstractDocumentIndex</code>: The chunk index to search for relevant text.</p></li><li><p><code>question::AbstractString</code>: The question to be answered.</p></li><li><p><code>return_all::Bool</code>: If <code>true</code>, returns the details used for RAG along with the response.</p></li><li><p><code>verbose::Integer</code>: If <code>&gt;0</code>, enables verbose logging. The higher the number, the more nested functions will log.</p></li><li><p><code>api_kwargs</code>: API parameters that will be forwarded to ALL of the API calls (<code>aiembed</code>, <code>aigenerate</code>, and <code>aiextract</code>).</p></li><li><p><code>retriever::AbstractRetriever</code>: The retriever to use for finding relevant chunks. Defaults to <code>cfg.retriever</code>, eg, <code>SimpleRetriever</code> (with no question rephrasing).</p></li><li><p><code>retriever_kwargs::NamedTuple</code>: API parameters that will be forwarded to the <code>retriever</code> call. Examples of important ones:</p><ul><li><p><code>top_k::Int</code>: Number of top candidates to retrieve based on embedding similarity.</p></li><li><p><code>top_n::Int</code>: Number of candidates to return after reranking.</p></li><li><p><code>tagger::AbstractTagger</code>: Tagger to use for tagging the chunks. Defaults to <code>NoTagger()</code>.</p></li><li><p><code>tagger_kwargs::NamedTuple</code>: API parameters that will be forwarded to the <code>tagger</code> call. You could provide the explicit tags directly with <code>PassthroughTagger</code> and <code>tagger_kwargs = (; tags = [&quot;tag1&quot;, &quot;tag2&quot;])</code>.</p></li></ul></li><li><p><code>generator::AbstractGenerator</code>: The generator to use for generating the answer. Defaults to <code>cfg.generator</code>, eg, <code>SimpleGenerator</code>.</p></li><li><p><code>generator_kwargs::NamedTuple</code>: API parameters that will be forwarded to the <code>generator</code> call. Examples of important ones:</p><ul><li><p><code>answerer_kwargs::NamedTuple</code>: API parameters that will be forwarded to the <code>answerer</code> call. Examples:</p><ul><li><p><code>model</code>: The model to use for generating the answer. Defaults to <code>PT.MODEL_CHAT</code>.</p></li><li><p><code>template</code>: The template to use for the <code>aigenerate</code> function. Defaults to <code>:RAGAnswerFromContext</code>.</p></li></ul></li><li><p><code>refiner::AbstractRefiner</code>: The method to use for refining the answer. Defaults to <code>generator.refiner</code>, eg, <code>NoRefiner</code>.</p></li><li><p><code>refiner_kwargs::NamedTuple</code>: API parameters that will be forwarded to the <code>refiner</code> call.</p><ul><li><p><code>model</code>: The model to use for generating the answer. Defaults to <code>PT.MODEL_CHAT</code>.</p></li><li><p><code>template</code>: The template to use for the <code>aigenerate</code> function. Defaults to <code>:RAGAnswerRefiner</code>.</p></li></ul></li></ul></li><li><p><code>cost_tracker</code>: An atomic counter to track the total cost of the operations (if you want to track the cost of multiple pipeline runs - it passed around in the pipeline).</p></li></ul><p><strong>Returns</strong></p><ul><li><p>If <code>return_all</code> is <code>false</code>, returns the generated message (<code>msg</code>).</p></li><li><p>If <code>return_all</code> is <code>true</code>, returns the detail of the full pipeline in <code>RAGResult</code> (see the docs).</p></li></ul><p>See also <code>build_index</code>, <code>retrieve</code>, <code>generate!</code>, <code>RAGResult</code>, <code>getpropertynested</code>, <code>setpropertynested</code>, <code>merge_kwargs_nested</code>, <code>ChunkKeywordsIndex</code>.</p><p><strong>Examples</strong></p><p>Using <code>airag</code> to get a response for a question:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> build_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># create an index</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">question </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;How to make a barplot in Makie.jl?&quot;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> airag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(index; question)</span></span></code></pre></div><p>To understand the details of the RAG process, use <code>return_all=true</code></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg, details </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> airag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(index; question, return_all </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># details is a RAGDetails object with all the internal steps of the `airag` function</span></span></code></pre></div><p>You can also pretty-print <code>details</code> to highlight generated text vs text that is supported by context. It also includes annotations of which context was used for each part of the response (where available).</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pprint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(details)</span></span></code></pre></div><p>Example with advanced retrieval (with question rephrasing and reranking (requires <code>COHERE_API_KEY</code>). We will obtain top 100 chunks from embeddings (<code>top_k</code>) and top 5 chunks from reranking (<code>top_n</code>). In addition, it will be done with a &quot;custom&quot; locally-hosted model.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cfg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> RAGConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; retriever </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AdvancedRetriever</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># kwargs will be big and nested, let&#39;s prepare them upfront</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># we specify &quot;custom&quot; model for each component that calls LLM</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    retriever_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        top_k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        top_n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        rephraser_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;custom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        embedder_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;custom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tagger_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;custom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    generator_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        answerer_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;custom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        refiner_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;custom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        url </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://localhost:8080&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> airag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfg, index, question; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>If you want to use hybrid retrieval (embeddings + BM25), you can easily create an additional index based on keywords and pass them both into a <code>MultiIndex</code>.</p><p>You need to provide an explicit config, so the pipeline knows how to handle each index in the search similarity phase (<code>finder</code>).</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # your existing index</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># create the multi-index with the keywords index</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index_keywords </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ChunkKeywordsIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(index)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">multi_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> MultiIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([index, index_keywords])</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># define the similarity measures for the indices that you have (same order)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">finder </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MultiFinder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CosineSimilarity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BM25Similarity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()])</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cfg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> RAGConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; retriever</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AdvancedRetriever</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; processor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">KeywordsProcessor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), finder))</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Run the pipeline with the new hybrid retrieval (return the `RAGResult` to see the details)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> airag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfg, multi_index; question, return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Pretty-print the result</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pprint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result)</span></span></code></pre></div><p>For easier manipulation of nested kwargs, see utilities <code>getpropertynested</code>, <code>setpropertynested</code>, <code>merge_kwargs_nested</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/generation.jl#L527-L650" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.align_node_styles!-Tuple{TrigramAnnotater, AbstractVector{&lt;:PromptingTools.Experimental.RAGTools.AnnotatedNode}}" href="#PromptingTools.Experimental.RAGTools.align_node_styles!-Tuple{TrigramAnnotater, AbstractVector{&lt;:PromptingTools.Experimental.RAGTools.AnnotatedNode}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.align_node_styles!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">align_node_styles!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(annotater</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TrigramAnnotater</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, nodes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AnnotatedNode}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Aligns the styles of the nodes based on the surrounding nodes (&quot;fill-in-the-middle&quot;).</p><p>If the node has no score, but the surrounding nodes have the same style, the node will inherit the style of the surrounding nodes.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/annotation.jl#L191-L197" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.annotate_support-Tuple{TrigramAnnotater, AbstractString, AbstractVector}" href="#PromptingTools.Experimental.RAGTools.annotate_support-Tuple{TrigramAnnotater, AbstractString, AbstractVector}">#</a> <b><u>PromptingTools.Experimental.RAGTools.annotate_support</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">annotate_support</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(annotater</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TrigramAnnotater</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, answer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; min_score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Float64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    skip_trigrams</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, hashed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sources</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractVector{&lt;:AbstractString}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    min_source_score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Float64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.25</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    add_sources</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    add_scores</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Annotates the <code>answer</code> with the overlap/what&#39;s supported in <code>context</code> and returns the annotated tree of nodes representing the <code>answer</code></p><p>Returns a &quot;root&quot; node with children nodes representing the sentences/code blocks in the <code>answer</code>. Only the &quot;leaf&quot; nodes are to be printed (to avoid duplication), &quot;leaf&quot; nodes are those with NO children.</p><p>Default logic:</p><ul><li><p>Split into sentences/code blocks, then into tokens (~words).</p></li><li><p>Then match each token (~word) exactly.</p></li><li><p>If no exact match found, count trigram-based match (include the surrounding tokens for better contextual awareness).</p></li><li><p>If the match is higher than <code>min_score</code>, it&#39;s recorded in the <code>score</code> of the node.</p></li></ul><p><strong>Arguments</strong></p><ul><li><p><code>annotater::TrigramAnnotater</code>: Annotater to use</p></li><li><p><code>answer::AbstractString</code>: Text to annotate</p></li><li><p><code>context::AbstractVector</code>: Context to annotate against, ie, look for &quot;support&quot; in the texts in <code>context</code></p></li><li><p><code>min_score::Float64</code>: Minimum score to consider a match. Default: 0.5, which means that half of the trigrams of each word should match</p></li><li><p><code>skip_trigrams::Bool</code>: Whether to potentially skip trigram matching if exact full match is found. Default: true</p></li><li><p><code>hashed::Bool</code>: Whether to use hashed trigrams. It&#39;s harder to debug, but it&#39;s much faster for larger texts (hashed text are held in a Set to deduplicate). Default: true</p></li><li><p><code>sources::Union{Nothing, AbstractVector{&lt;:AbstractString}}</code>: Sources to add at the end of the context. Default: nothing</p></li><li><p><code>min_source_score::Float64</code>: Minimum score to consider/to display a source. Default: 0.25, which means that at least a quarter of the trigrams of each word should match to some context. The threshold is lower than <code>min_score</code>, because it&#39;s average across ALL words in a block, so it&#39;s much harder to match fully with generated text.</p></li><li><p><code>add_sources::Bool</code>: Whether to add sources at the end of each code block/sentence. Sources are addded in the square brackets like &quot;[1]&quot;. Default: true</p></li><li><p><code>add_scores::Bool</code>: Whether to add source-matching scores at the end of each code block/sentence. Scores are added in the square brackets like &quot;[0.75]&quot;. Default: true</p></li><li><p>kwargs: Additional keyword arguments to pass to <code>trigram_support!</code> and <code>set_node_style!</code>. See their documentation for more details (eg, customize the colors of the nodes based on the score)</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">annotater </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TrigramAnnotater</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;This is a test context.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Another context sentence.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Final piece of context.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">answer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;This is a test context. Another context sentence.&quot;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">annotated_root </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> annotate_support</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(annotater, answer, context)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pprint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(annotated_root) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># pretty print the annotated tree</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/annotation.jl#L416-L459" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.annotate_support-Tuple{TrigramAnnotater, PromptingTools.Experimental.RAGTools.AbstractRAGResult}" href="#PromptingTools.Experimental.RAGTools.annotate_support-Tuple{TrigramAnnotater, PromptingTools.Experimental.RAGTools.AbstractRAGResult}">#</a> <b><u>PromptingTools.Experimental.RAGTools.annotate_support</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">annotate_support</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    annotater</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TrigramAnnotater</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractRAGResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; min_score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Float64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    skip_trigrams</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, hashed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    min_source_score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Float64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.25</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    add_sources</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    add_scores</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Dispatch for <code>annotate_support</code> for <code>AbstractRAGResult</code> type. It extracts the <code>final_answer</code> and <code>context</code> from the <code>result</code> and calls <code>annotate_support</code> with them.</p><p>See <code>annotate_support</code> for more details.</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">res </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> RAGResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; question </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, final_answer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;This is a test.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Test context.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Completely different&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">annotated_root </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> annotate_support</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(annotater, res)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pprint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(annotated_root)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/annotation.jl#L509-L528" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.answer!-Tuple{PromptingTools.Experimental.RAGTools.SimpleAnswerer, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractRAGResult}" href="#PromptingTools.Experimental.RAGTools.answer!-Tuple{PromptingTools.Experimental.RAGTools.SimpleAnswerer, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractRAGResult}">#</a> <b><u>PromptingTools.Experimental.RAGTools.answer!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">answer!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    answerer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SimpleAnswerer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractDocumentIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractRAGResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MODEL_CHAT, verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    template</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Symbol</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :RAGAnswerFromContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_tracker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Atomic{Float64}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Generates an answer using the <code>aigenerate</code> function with the provided <code>result.context</code> and <code>result.question</code>.</p><p><strong>Returns</strong></p><ul><li>Mutated <code>result</code> with <code>result.answer</code> and the full conversation saved in <code>result.conversations[:answer]</code></li></ul><p><strong>Arguments</strong></p><ul><li><p><code>answerer::SimpleAnswerer</code>: The method to use for generating the answer. Uses <code>aigenerate</code>.</p></li><li><p><code>index::AbstractDocumentIndex</code>: The index containing chunks and sources.</p></li><li><p><code>result::AbstractRAGResult</code>: The result containing the context and question to generate the answer for.</p></li><li><p><code>model::AbstractString</code>: The model to use for generating the answer. Defaults to <code>PT.MODEL_CHAT</code>.</p></li><li><p><code>verbose::Bool</code>: If <code>true</code>, enables verbose logging.</p></li><li><p><code>template::Symbol</code>: The template to use for the <code>aigenerate</code> function. Defaults to <code>:RAGAnswerFromContext</code>.</p></li><li><p><code>cost_tracker</code>: An atomic counter to track the cost of the operation.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/generation.jl#L93-L115" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.build_context-Tuple{PromptingTools.Experimental.RAGTools.ContextEnumerator, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractCandidateChunks}" href="#PromptingTools.Experimental.RAGTools.build_context-Tuple{PromptingTools.Experimental.RAGTools.ContextEnumerator, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractCandidateChunks}">#</a> <b><u>PromptingTools.Experimental.RAGTools.build_context</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">build_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(contexter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ContextEnumerator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractDocumentIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, candidates</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractCandidateChunks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    chunks_window_margin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Tuple{Int, Int}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    build_context!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(contexter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ContextEnumerator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractDocumentIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractRAGResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Build context strings for each position in <code>candidates</code> considering a window margin around each position. If mutating version is used (<code>build_context!</code>), it will use <code>result.reranked_candidates</code> to update the <code>result.context</code> field.</p><p><strong>Arguments</strong></p><ul><li><p><code>contexter::ContextEnumerator</code>: The method to use for building the context. Enumerates the snippets.</p></li><li><p><code>index::AbstractDocumentIndex</code>: The index containing chunks and sources.</p></li><li><p><code>candidates::AbstractCandidateChunks</code>: Candidate chunks which contain positions to extract context from.</p></li><li><p><code>verbose::Bool</code>: If <code>true</code>, enables verbose logging.</p></li><li><p><code>chunks_window_margin::Tuple{Int, Int}</code>: A tuple indicating the margin (before, after) around each position to include in the context. Defaults to <code>(1,1)</code>, which means 1 preceding and 1 suceeding chunk will be included. With <code>(0,0)</code>, only the matching chunks will be included.</p></li></ul><p><strong>Returns</strong></p><ul><li><code>Vector{String}</code>: A vector of context strings, each corresponding to a position in <code>reranked_candidates</code>.</li></ul><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ChunkIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Assuming a proper index is defined</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">candidates </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CandidateChunks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id, [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> build_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ContextEnumerator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), index, candidates; chunks_window_margin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># include only one following chunk for each matching chunk</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/generation.jl#L9-L38" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.build_index-Tuple{KeywordsIndexer, Vector{&lt;:AbstractString}}" href="#PromptingTools.Experimental.RAGTools.build_index-Tuple{KeywordsIndexer, Vector{&lt;:AbstractString}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.build_index</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">build_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    indexer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">KeywordsIndexer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, files_or_docs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    extras</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractVector}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    index_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> gensym</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ChunkKeywordsIndex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    chunker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractChunker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> indexer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chunker,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    chunker_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    processor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractProcessor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> indexer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">processor,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    processor_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tagger</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractTagger</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> indexer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tagger,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tagger_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_tracker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Atomic{Float64}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><p>Builds a <code>ChunkKeywordsIndex</code> from the provided files or documents to support keyword-based search (BM25).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L648-L664" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.build_index-Tuple{PromptingTools.Experimental.RAGTools.AbstractIndexBuilder, Vector{&lt;:AbstractString}}" href="#PromptingTools.Experimental.RAGTools.build_index-Tuple{PromptingTools.Experimental.RAGTools.AbstractIndexBuilder, Vector{&lt;:AbstractString}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.build_index</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">build_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    indexer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractIndexBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, files_or_docs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    extras</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractVector}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    index_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> gensym</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ChunkEmbeddingsIndex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    chunker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractChunker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> indexer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chunker,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    chunker_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    embedder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractEmbedder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> indexer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">embedder,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    embedder_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tagger</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractTagger</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> indexer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tagger,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tagger_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_tracker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Atomic{Float64}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><p>Build an INDEX for RAG (Retriever-Augmented Generation) applications from the provided file paths. INDEX is a object storing the document chunks and their embeddings (and potentially other information).</p><p>The function processes each file or document (depending on <code>chunker</code>), splits its content into chunks, embeds these chunks, optionally extracts metadata, and then combines this information into a retrievable index.</p><p>Define your own methods via <code>indexer</code> and its subcomponents (<code>chunker</code>, <code>embedder</code>, <code>tagger</code>).</p><p><strong>Arguments</strong></p><ul><li><p><code>indexer::AbstractIndexBuilder</code>: The indexing logic to use. Default is <code>SimpleIndexer()</code>.</p></li><li><p><code>files_or_docs</code>: A vector of valid file paths OR string documents to be indexed (chunked and embedded). Specify which mode to use via <code>chunker</code>.</p></li><li><p><code>verbose</code>: An Integer specifying the verbosity of the logs. Default is <code>1</code> (high-level logging). <code>0</code> is disabled.</p></li><li><p><code>extras</code>: An optional vector of extra information to be stored with each chunk. Default is <code>nothing</code>.</p></li><li><p><code>index_id</code>: A unique identifier for the index. Default is a generated symbol.</p></li><li><p><code>chunker</code>: The chunker logic to use for splitting the documents. Default is <code>TextChunker()</code>.</p></li><li><p><code>chunker_kwargs</code>: Parameters to be provided to the <code>get_chunks</code> function. Useful to change the <code>separators</code> or <code>max_length</code>.</p><ul><li><code>sources</code>: A vector of strings indicating the source of each chunk. Default is equal to <code>files_or_docs</code>.</li></ul></li><li><p><code>embedder</code>: The embedder logic to use for embedding the chunks. Default is <code>BatchEmbedder()</code>.</p></li><li><p><code>embedder_kwargs</code>: Parameters to be provided to the <code>get_embeddings</code> function. Useful to change the <code>target_batch_size_length</code> or reduce asyncmap tasks <code>ntasks</code>.</p><ul><li><code>model</code>: The model to use for embedding. Default is <code>PT.MODEL_EMBEDDING</code>.</li></ul></li><li><p><code>tagger</code>: The tagger logic to use for extracting tags from the chunks. Default is <code>NoTagger()</code>, ie, skip tag extraction. There are also <code>PassthroughTagger</code> and <code>OpenTagger</code>.</p></li><li><p><code>tagger_kwargs</code>: Parameters to be provided to the <code>get_tags</code> function.</p><ul><li><p><code>model</code>: The model to use for tags extraction. Default is <code>PT.MODEL_CHAT</code>.</p></li><li><p><code>template</code>: A template to be used for tags extraction. Default is <code>:RAGExtractMetadataShort</code>.</p></li><li><p><code>tags</code>: A vector of vectors of strings directly providing the tags for each chunk. Applicable for <code>tagger::PasstroughTagger</code>.</p></li></ul></li><li><p><code>api_kwargs</code>: Parameters to be provided to the API endpoint. Shared across all API calls if provided.</p></li><li><p><code>cost_tracker</code>: A <code>Threads.Atomic{Float64}</code> object to track the total cost of the API calls. Useful to pass the total cost to the parent call.</p></li></ul><p><strong>Returns</strong></p><ul><li><code>ChunkEmbeddingsIndex</code>: An object containing the compiled index of chunks, embeddings, tags, vocabulary, and sources.</li></ul><p>See also: <code>ChunkEmbeddingsIndex</code>, <code>get_chunks</code>, <code>get_embeddings</code>, <code>get_tags</code>, <code>CandidateChunks</code>, <code>find_closest</code>, <code>find_tags</code>, <code>rerank</code>, <code>retrieve</code>, <code>generate!</code>, <code>airag</code></p><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Default is loading a vector of strings and chunking them (`TextChunker()`)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> build_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SimpleIndexer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), texts; chunker_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Another example with tags extraction, splitting only sentences and verbose output</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Assuming `test_files` is a vector of file paths</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">indexer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SimpleIndexer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">FileChunker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), tagger</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OpenTagger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> build_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(indexer, test_files; </span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        chunker_kwargs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; separators</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;. &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]), verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>Notes</strong></p><ul><li>If you get errors about exceeding embedding input sizes, first check the <code>max_length</code> in your chunks. If that does NOT resolve the issue, try changing the <code>embedding_kwargs</code>. In particular, reducing the <code>target_batch_size_length</code> parameter (eg, 10_000) and number of tasks <code>ntasks=1</code>. Some providers cannot handle large batch sizes (eg, Databricks).</li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L542-L608" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.build_qa_evals-Tuple{Vector{&lt;:AbstractString}, Vector{&lt;:AbstractString}}" href="#PromptingTools.Experimental.RAGTools.build_qa_evals-Tuple{Vector{&lt;:AbstractString}, Vector{&lt;:AbstractString}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.build_qa_evals</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">build_qa_evals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(doc_chunks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, sources</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">               model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MODEL_CHAT, instructions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;None.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, qa_template</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Symbol</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:RAGCreateQAFromContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">               verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Vector{QAEvalItem}</span></span></code></pre></div><p>Create a collection of question and answer evaluations (<code>QAEvalItem</code>) from document chunks and sources. This function generates Q&amp;A pairs based on the provided document chunks, using a specified AI model and template.</p><p><strong>Arguments</strong></p><ul><li><p><code>doc_chunks::Vector{&lt;:AbstractString}</code>: A vector of document chunks, each representing a segment of text.</p></li><li><p><code>sources::Vector{&lt;:AbstractString}</code>: A vector of source identifiers corresponding to each chunk in <code>doc_chunks</code> (eg, filenames or paths).</p></li><li><p><code>model</code>: The AI model used for generating Q&amp;A pairs. Default is <code>PT.MODEL_CHAT</code>.</p></li><li><p><code>instructions::String</code>: Additional instructions or context to provide to the model generating QA sets. Defaults to &quot;None.&quot;.</p></li><li><p><code>qa_template::Symbol</code>: A template symbol that dictates the AITemplate that will be used. It must have placeholder <code>context</code>. Default is <code>:CreateQAFromContext</code>.</p></li><li><p><code>api_kwargs::NamedTuple</code>: Parameters that will be forwarded to the API endpoint.</p></li><li><p><code>verbose::Bool</code>: If <code>true</code>, additional information like costs will be logged. Defaults to <code>true</code>.</p></li></ul><p><strong>Returns</strong></p><p><code>Vector{QAEvalItem}</code>: A vector of <code>QAEvalItem</code> structs, each containing a source, context, question, and answer. Invalid or empty items are filtered out.</p><p><strong>Notes</strong></p><ul><li><p>The function internally uses <code>aiextract</code> to generate Q&amp;A pairs based on the provided <code>qa_template</code>. So you can use any kwargs that you want.</p></li><li><p>Each <code>QAEvalItem</code> includes the context (document chunk), the generated question and answer, and the source.</p></li><li><p>The function tracks and reports the cost of AI calls if <code>verbose</code> is enabled.</p></li><li><p>Items where the question, answer, or context is empty are considered invalid and are filtered out.</p></li></ul><p><strong>Examples</strong></p><p>Creating Q&amp;A evaluations from a set of document chunks:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">doc_chunks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Text from document 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Text from document 2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sources </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;source1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;source2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">qa_evals </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> build_qa_evals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(doc_chunks, sources)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/evaluation.jl#L65-L100" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.build_tags" href="#PromptingTools.Experimental.RAGTools.build_tags">#</a> <b><u>PromptingTools.Experimental.RAGTools.build_tags</u></b> — <i>Function</i>. <p>Builds a matrix of tags and a vocabulary list. REQUIRES SparseArrays, LinearAlgebra, Unicode packages to be loaded!!</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/rag_interface.jl#L259" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.build_tags-Tuple{PromptingTools.Experimental.RAGTools.AbstractTagger, Nothing}" href="#PromptingTools.Experimental.RAGTools.build_tags-Tuple{PromptingTools.Experimental.RAGTools.AbstractTagger, Nothing}">#</a> <b><u>PromptingTools.Experimental.RAGTools.build_tags</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">build_tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tagger</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractTagger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, chunk_tags</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>No-op that skips any tag building, returning <code>nothing, nothing</code></p><p>Otherwise, it would build the sparse matrix and the vocabulary (requires <code>SparseArrays</code> and <code>LinearAlgebra</code> packages to be loaded).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L531-L537" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.chunkdata-Tuple{ChunkKeywordsIndex, AbstractVector{&lt;:Integer}}" href="#PromptingTools.Experimental.RAGTools.chunkdata-Tuple{ChunkKeywordsIndex, AbstractVector{&lt;:Integer}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.chunkdata</u></b> — <i>Method</i>. <p>Access chunkdata for a subset of chunks, <code>chunk_idx</code> is a vector of chunk indices in the index</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/types.jl#L319" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.chunkdata-Tuple{PromptingTools.Experimental.RAGTools.AbstractChunkIndex, AbstractVector{&lt;:Integer}}" href="#PromptingTools.Experimental.RAGTools.chunkdata-Tuple{PromptingTools.Experimental.RAGTools.AbstractChunkIndex, AbstractVector{&lt;:Integer}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.chunkdata</u></b> — <i>Method</i>. <p>Access chunkdata for a subset of chunks, <code>chunk_idx</code> is a vector of chunk indices in the index</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/types.jl#L8" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.chunkdata-Tuple{SubChunkIndex, AbstractVector{&lt;:Integer}}" href="#PromptingTools.Experimental.RAGTools.chunkdata-Tuple{SubChunkIndex, AbstractVector{&lt;:Integer}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.chunkdata</u></b> — <i>Method</i>. <p>Access chunkdata for a subset of chunks, <code>chunk_idx</code> is a vector of chunk indices in the index</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/types.jl#L452" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.cohere_api-Tuple{}" href="#PromptingTools.Experimental.RAGTools.cohere_api-Tuple{}">#</a> <b><u>PromptingTools.Experimental.RAGTools.cohere_api</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cohere_api</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">endpoint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://api.cohere.ai/v1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Lightweight wrapper around the Cohere API. See <a href="https://cohere.com/docs" target="_blank" rel="noreferrer">https://cohere.com/docs</a> for more details.</p><p><strong>Arguments</strong></p><ul><li><p><code>api_key</code>: Your Cohere API key. You can get one from <a href="https://dashboard.cohere.com/welcome/register" target="_blank" rel="noreferrer">https://dashboard.cohere.com/welcome/register</a> (trial access is for free).</p></li><li><p><code>endpoint</code>: The Cohere endpoint to call.</p></li><li><p><code>url</code>: The base URL for the Cohere API. Default is <code>https://api.cohere.ai/v1</code>.</p></li><li><p><code>http_kwargs</code>: Any additional keyword arguments to pass to <code>HTTP.post</code>.</p></li><li><p><code>kwargs</code>: Any additional keyword arguments to pass to the Cohere API.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/api_services.jl#L1-L17" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.create_permutation_instruction-Tuple{AbstractVector{&lt;:AbstractString}}" href="#PromptingTools.Experimental.RAGTools.create_permutation_instruction-Tuple{AbstractVector{&lt;:AbstractString}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.create_permutation_instruction</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">create_permutation_instruction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; rank_start</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rank_end</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 512</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, template</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Symbol</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :RAGRankGPT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Creates rendered template with injected <code>context</code> passages.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/rank_gpt.jl#L28-L34" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.extract_ranking-Tuple{AbstractString}" href="#PromptingTools.Experimental.RAGTools.extract_ranking-Tuple{AbstractString}">#</a> <b><u>PromptingTools.Experimental.RAGTools.extract_ranking</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">extract_ranking</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(str</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Extracts the ranking from the response into a sorted array of integers.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/rank_gpt.jl#L55-L59" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.find_closest" href="#PromptingTools.Experimental.RAGTools.find_closest">#</a> <b><u>PromptingTools.Experimental.RAGTools.find_closest</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">find_closest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    finder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BitPackedCosineSimilarity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, emb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractMatrix{&lt;:Bool}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    query_emb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:Real}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, query_tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String[];</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, rescore_multiplier</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, minimum_similarity</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractFloat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Finds the indices of chunks (represented by embeddings in <code>emb</code>) that are closest to query embedding (<code>query_emb</code>) using bit-packed binary embeddings (in the index).</p><p>This is a two-pass approach:</p><ul><li><p>First pass: Hamming distance in bit-packed binary form to get the <code>top_k * rescore_multiplier</code> (i.e., more than top_k) candidates.</p></li><li><p>Second pass: Rescore the candidates with float embeddings and return the top_k.</p></li></ul><p>Returns only <code>top_k</code> closest indices.</p><p>Reference: <a href="https://huggingface.co/blog/embedding-quantization#binary-quantization-in-vector-databases" target="_blank" rel="noreferrer">HuggingFace: Embedding Quantization</a>.</p><p><strong>Examples</strong></p><p>Convert any Float embeddings to bit-packed binary like this:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bitpacked_emb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> pack_bits</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(emb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L411-L432" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.find_closest-2" href="#PromptingTools.Experimental.RAGTools.find_closest-2">#</a> <b><u>PromptingTools.Experimental.RAGTools.find_closest</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">find_closest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    finder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BinaryCosineSimilarity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, emb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractMatrix{&lt;:Bool}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    query_emb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:Real}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, query_tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String[];</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, rescore_multiplier</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, minimum_similarity</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractFloat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Finds the indices of chunks (represented by embeddings in <code>emb</code>) that are closest to query embedding (<code>query_emb</code>) using binary embeddings (in the index).</p><p>This is a two-pass approach:</p><ul><li><p>First pass: Hamming distance in binary form to get the <code>top_k * rescore_multiplier</code> (ie, more than top_k) candidates.</p></li><li><p>Second pass: Rescore the candidates with float embeddings and return the top_k.</p></li></ul><p>Returns only <code>top_k</code> closest indices.</p><p>Reference: <a href="https://huggingface.co/blog/embedding-quantization#binary-quantization-in-vector-databases" target="_blank" rel="noreferrer">HuggingFace: Embedding Quantization</a>.</p><p><strong>Examples</strong></p><p>Convert any Float embeddings to binary like this:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">binary_emb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), emb)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L367-L389" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.find_closest-3" href="#PromptingTools.Experimental.RAGTools.find_closest-3">#</a> <b><u>PromptingTools.Experimental.RAGTools.find_closest</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">find_closest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    finder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CosineSimilarity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, emb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractMatrix{&lt;:Real}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    query_emb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:Real}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, query_tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String[];</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, minimum_similarity</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractFloat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Finds the indices of chunks (represented by embeddings in <code>emb</code>) that are closest (in cosine similarity for <code>CosineSimilarity()</code>) to query embedding (<code>query_emb</code>).</p><p><code>finder</code> is the logic used for the similarity search. Default is <code>CosineSimilarity</code>.</p><p>If <code>minimum_similarity</code> is provided, only indices with similarity greater than or equal to it are returned. Similarity can be between -1 and 1 (-1 = completely opposite, 1 = exactly the same).</p><p>Returns only <code>top_k</code> closest indices.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L185-L199" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.find_closest-4" href="#PromptingTools.Experimental.RAGTools.find_closest-4">#</a> <b><u>PromptingTools.Experimental.RAGTools.find_closest</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">find_closest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    finder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractSimilarityFinder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractChunkIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    query_emb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:Real}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, query_tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String[];</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Finds the indices of chunks (represented by embeddings in <code>index</code>) that are closest to query embedding (<code>query_emb</code>).</p><p>Returns only <code>top_k</code> closest indices.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L219-L228" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.find_closest-5" href="#PromptingTools.Experimental.RAGTools.find_closest-5">#</a> <b><u>PromptingTools.Experimental.RAGTools.find_closest</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">find_closest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    finder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BM25Similarity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, dtm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractDocumentTermMatrix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    query_emb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:Real}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, query_tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String[];</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, minimum_similarity</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractFloat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Finds the indices of chunks (represented by DocumentTermMatrix in <code>dtm</code>) that are closest to query tokens (<code>query_tokens</code>) using BM25.</p><p>Reference: <a href="https://en.wikipedia.org/wiki/Okapi_BM25" target="_blank" rel="noreferrer">Wikipedia: BM25</a>. Implementation follows: <a href="https://opensourceconnections.com/blog/2015/10/16/bm25-the-next-generation-of-lucene-relevation/" target="_blank" rel="noreferrer">The Next Generation of Lucene Relevance</a>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L455-L465" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.find_tags-Tuple{PromptingTools.Experimental.RAGTools.AnyTagFilter, PromptingTools.Experimental.RAGTools.AbstractChunkIndex, Union{Regex, AbstractString}}" href="#PromptingTools.Experimental.RAGTools.find_tags-Tuple{PromptingTools.Experimental.RAGTools.AnyTagFilter, PromptingTools.Experimental.RAGTools.AbstractChunkIndex, Union{Regex, AbstractString}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.find_tags</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">find_tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(method</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AnyTagFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractChunkIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{AbstractString, Regex}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">find_tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(method</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AnyTagFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractChunkIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tags</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{T}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {T </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Union{AbstractString, Regex}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Finds the indices of chunks (represented by tags in <code>index</code>) that have ANY OF the specified <code>tag</code> or <code>tags</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L495-L503" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.find_tags-Union{Tuple{T}, Tuple{PromptingTools.Experimental.RAGTools.AllTagFilter, PromptingTools.Experimental.RAGTools.AbstractChunkIndex, Vector{T}}} where T&lt;:Union{Regex, AbstractString}" href="#PromptingTools.Experimental.RAGTools.find_tags-Union{Tuple{T}, Tuple{PromptingTools.Experimental.RAGTools.AllTagFilter, PromptingTools.Experimental.RAGTools.AbstractChunkIndex, Vector{T}}} where T&lt;:Union{Regex, AbstractString}">#</a> <b><u>PromptingTools.Experimental.RAGTools.find_tags</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">find_tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(method</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AllTagFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractChunkIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{AbstractString, Regex}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">find_tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(method</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AllTagFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractChunkIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tags</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{T}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {T </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Union{AbstractString, Regex}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Finds the indices of chunks (represented by tags in <code>index</code>) that have ALL OF the specified <code>tag</code> or <code>tags</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L529-L537" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.find_tags-Union{Tuple{T}, Tuple{PromptingTools.Experimental.RAGTools.NoTagFilter, PromptingTools.Experimental.RAGTools.AbstractChunkIndex, Union{AbstractVector{&lt;:T}, T}}} where T&lt;:Union{Nothing, Regex, AbstractString}" href="#PromptingTools.Experimental.RAGTools.find_tags-Union{Tuple{T}, Tuple{PromptingTools.Experimental.RAGTools.NoTagFilter, PromptingTools.Experimental.RAGTools.AbstractChunkIndex, Union{AbstractVector{&lt;:T}, T}}} where T&lt;:Union{Nothing, Regex, AbstractString}">#</a> <b><u>PromptingTools.Experimental.RAGTools.find_tags</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">find_tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(method</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NoTagFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractChunkIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tags</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{T, AbstractVector{&lt;:T}}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {T </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                           Union{</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AbstractString, Regex, Nothing}}</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tags; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Returns all chunks in the index, ie, no filtering, so we simply return <code>nothing</code> (easier for dispatch).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L565-L573" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.generate!-Tuple{PromptingTools.Experimental.RAGTools.AbstractGenerator, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractRAGResult}" href="#PromptingTools.Experimental.RAGTools.generate!-Tuple{PromptingTools.Experimental.RAGTools.AbstractGenerator, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractRAGResult}">#</a> <b><u>PromptingTools.Experimental.RAGTools.generate!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">generate!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    generator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractGenerator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractDocumentIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractRAGResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    contexter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractContextBuilder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> generator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">contexter,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    contexter_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    answerer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractAnswerer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> generator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">answerer,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    answerer_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    refiner</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractRefiner</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> generator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">refiner,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    refiner_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    postprocessor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractPostprocessor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> generator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">postprocessor,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    postprocessor_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_tracker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Atomic{Float64}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Generate the response using the provided <code>generator</code> and the <code>index</code> and <code>result</code>. It is the second step in the RAG pipeline (after <code>retrieve</code>)</p><p>Returns the mutated <code>result</code> with the <code>result.final_answer</code> and the full conversation saved in <code>result.conversations[:final_answer]</code>.</p><p><strong>Notes</strong></p><ul><li><p>The default flow is <code>build_context!</code> -&gt; <code>answer!</code> -&gt; <code>refine!</code> -&gt; <code>postprocess!</code>.</p></li><li><p><code>contexter</code> is the method to use for building the context, eg, simply enumerate the context chunks with <code>ContextEnumerator</code>.</p></li><li><p><code>answerer</code> is the standard answer generation step with LLMs.</p></li><li><p><code>refiner</code> step allows the LLM to critique itself and refine its own answer.</p></li><li><p><code>postprocessor</code> step allows for additional processing of the answer, eg, logging, saving conversations, etc.</p></li><li><p>All of its sub-routines operate by mutating the <code>result</code> object (and adding their part).</p></li><li><p>Discover available sub-types for each step with <code>subtypes(AbstractRefiner)</code> and similar for other abstract types.</p></li></ul><p><strong>Arguments</strong></p><ul><li><p><code>generator::AbstractGenerator</code>: The <code>generator</code> to use for generating the answer. Can be <code>SimpleGenerator</code> or <code>AdvancedGenerator</code>.</p></li><li><p><code>index::AbstractDocumentIndex</code>: The index containing chunks and sources.</p></li><li><p><code>result::AbstractRAGResult</code>: The result containing the context and question to generate the answer for.</p></li><li><p><code>verbose::Integer</code>: If &gt;0, enables verbose logging.</p></li><li><p><code>api_kwargs::NamedTuple</code>: API parameters that will be forwarded to ALL of the API calls (<code>aiembed</code>, <code>aigenerate</code>, and <code>aiextract</code>).</p></li><li><p><code>contexter::AbstractContextBuilder</code>: The method to use for building the context. Defaults to <code>generator.contexter</code>, eg, <code>ContextEnumerator</code>.</p></li><li><p><code>contexter_kwargs::NamedTuple</code>: API parameters that will be forwarded to the <code>contexter</code> call.</p></li><li><p><code>answerer::AbstractAnswerer</code>: The method to use for generating the answer. Defaults to <code>generator.answerer</code>, eg, <code>SimpleAnswerer</code>.</p></li><li><p><code>answerer_kwargs::NamedTuple</code>: API parameters that will be forwarded to the <code>answerer</code> call. Examples:</p><ul><li><p><code>model</code>: The model to use for generating the answer. Defaults to <code>PT.MODEL_CHAT</code>.</p></li><li><p><code>template</code>: The template to use for the <code>aigenerate</code> function. Defaults to <code>:RAGAnswerFromContext</code>.</p></li></ul></li><li><p><code>refiner::AbstractRefiner</code>: The method to use for refining the answer. Defaults to <code>generator.refiner</code>, eg, <code>NoRefiner</code>.</p></li><li><p><code>refiner_kwargs::NamedTuple</code>: API parameters that will be forwarded to the <code>refiner</code> call.</p><ul><li><p><code>model</code>: The model to use for generating the answer. Defaults to <code>PT.MODEL_CHAT</code>.</p></li><li><p><code>template</code>: The template to use for the <code>aigenerate</code> function. Defaults to <code>:RAGAnswerRefiner</code>.</p></li></ul></li><li><p><code>postprocessor::AbstractPostprocessor</code>: The method to use for postprocessing the answer. Defaults to <code>generator.postprocessor</code>, eg, <code>NoPostprocessor</code>.</p></li><li><p><code>postprocessor_kwargs::NamedTuple</code>: API parameters that will be forwarded to the <code>postprocessor</code> call.</p></li><li><p><code>cost_tracker</code>: An atomic counter to track the total cost of the operations.</p></li></ul><p>See also: <code>retrieve</code>, <code>build_context!</code>, <code>ContextEnumerator</code>, <code>answer!</code>, <code>SimpleAnswerer</code>, <code>refine!</code>, <code>NoRefiner</code>, <code>SimpleRefiner</code>, <code>postprocess!</code>, <code>NoPostprocessor</code></p><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Assume we already have </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`index`</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">question </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;What are the best practices for parallel computing in Julia?&quot;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Retrieve the relevant chunks - returns RAGResult</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> retrieve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(index, question)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Generate the answer using the default generator, mutates the same result</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> generate!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(index, result)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/generation.jl#L395-L460" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.get_chunks-Tuple{PromptingTools.Experimental.RAGTools.AbstractChunker, Vector{&lt;:AbstractString}}" href="#PromptingTools.Experimental.RAGTools.get_chunks-Tuple{PromptingTools.Experimental.RAGTools.AbstractChunker, Vector{&lt;:AbstractString}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.get_chunks</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">get_chunks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractChunker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    files_or_docs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sources</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> files_or_docs,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    separators </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;. &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Chunks the provided <code>files_or_docs</code> into chunks of maximum length <code>max_length</code> (if possible with provided <code>separators</code>).</p><p>Supports two modes of operation:</p><ul><li><p><code>chunker = FileChunker()</code>: The function opens each file in <code>files_or_docs</code> and reads its contents.</p></li><li><p><code>chunker = TextChunker()</code>: The function assumes that <code>files_or_docs</code> is a vector of strings to be chunked, you MUST provide corresponding <code>sources</code>.</p></li></ul><p><strong>Arguments</strong></p><ul><li><p><code>files_or_docs</code>: A vector of valid file paths OR string documents to be chunked.</p></li><li><p><code>separators</code>: A list of strings used as separators for splitting the text in each file into chunks. Default is <code>[\\n\\n&quot;, &quot;. &quot;, &quot;\\n&quot;, &quot; &quot;]</code>. See <code>recursive_splitter</code> for more details.</p></li><li><p><code>max_length</code>: The maximum length of each chunk (if possible with provided separators). Default is 256.</p></li><li><p><code>sources</code>: A vector of strings indicating the source of each chunk. Default is equal to <code>files_or_docs</code> (for <code>reader=:files</code>)</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L170-L190" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.get_embeddings-Tuple{PromptingTools.Experimental.RAGTools.BatchEmbedder, AbstractVector{&lt;:AbstractString}}" href="#PromptingTools.Experimental.RAGTools.get_embeddings-Tuple{PromptingTools.Experimental.RAGTools.BatchEmbedder, AbstractVector{&lt;:AbstractString}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.get_embeddings</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">get_embeddings</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(embedder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BatchEmbedder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, docs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MODEL_EMBEDDING,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    truncate_dimension</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Int, Nothing}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_tracker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Atomic{Float64}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    target_batch_size_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80_000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ntasks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nthreads</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Embeds a vector of <code>docs</code> using the provided model (kwarg <code>model</code>) in a batched manner - <code>BatchEmbedder</code>.</p><p><code>BatchEmbedder</code> tries to batch embedding calls for roughly 80K characters per call (to avoid exceeding the API rate limit) to reduce network latency.</p><p><strong>Notes</strong></p><ul><li><p><code>docs</code> are assumed to be already chunked to the reasonable sizes that fit within the embedding context limit.</p></li><li><p>If you get errors about exceeding input sizes, first check the <code>max_length</code> in your chunks. If that does NOT resolve the issue, try reducing the <code>target_batch_size_length</code> parameter (eg, 10_000) and number of tasks <code>ntasks=1</code>. Some providers cannot handle large batch sizes.</p></li></ul><p><strong>Arguments</strong></p><ul><li><p><code>docs</code>: A vector of strings to be embedded.</p></li><li><p><code>verbose</code>: A boolean flag for verbose output. Default is <code>true</code>.</p></li><li><p><code>model</code>: The model to use for embedding. Default is <code>PT.MODEL_EMBEDDING</code>.</p></li><li><p><code>truncate_dimension</code>: The dimensionality of the embeddings to truncate to. Default is <code>nothing</code>, <code>0</code> will also do nothing.</p></li><li><p><code>cost_tracker</code>: A <code>Threads.Atomic{Float64}</code> object to track the total cost of the API calls. Useful to pass the total cost to the parent call.</p></li><li><p><code>target_batch_size_length</code>: The target length (in characters) of each batch of document chunks sent for embedding. Default is 80_000 characters. Speeds up embedding process.</p></li><li><p><code>ntasks</code>: The number of tasks to use for asyncmap. Default is 4 * Threads.nthreads().</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L230-L260" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.get_embeddings-Tuple{PromptingTools.Experimental.RAGTools.BinaryBatchEmbedder, AbstractVector{&lt;:AbstractString}}" href="#PromptingTools.Experimental.RAGTools.get_embeddings-Tuple{PromptingTools.Experimental.RAGTools.BinaryBatchEmbedder, AbstractVector{&lt;:AbstractString}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.get_embeddings</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">get_embeddings</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(embedder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BinaryBatchEmbedder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, docs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MODEL_EMBEDDING,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    truncate_dimension</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Int, Nothing}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Matrix{Bool},</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_tracker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Atomic{Float64}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    target_batch_size_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80_000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ntasks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nthreads</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Embeds a vector of <code>docs</code> using the provided model (kwarg <code>model</code>) in a batched manner and then returns the binary embeddings matrix - <code>BinaryBatchEmbedder</code>.</p><p><code>BinaryBatchEmbedder</code> tries to batch embedding calls for roughly 80K characters per call (to avoid exceeding the API rate limit) to reduce network latency.</p><p><strong>Notes</strong></p><ul><li><p><code>docs</code> are assumed to be already chunked to the reasonable sizes that fit within the embedding context limit.</p></li><li><p>If you get errors about exceeding input sizes, first check the <code>max_length</code> in your chunks. If that does NOT resolve the issue, try reducing the <code>target_batch_size_length</code> parameter (eg, 10_000) and number of tasks <code>ntasks=1</code>. Some providers cannot handle large batch sizes.</p></li></ul><p><strong>Arguments</strong></p><ul><li><p><code>docs</code>: A vector of strings to be embedded.</p></li><li><p><code>verbose</code>: A boolean flag for verbose output. Default is <code>true</code>.</p></li><li><p><code>model</code>: The model to use for embedding. Default is <code>PT.MODEL_EMBEDDING</code>.</p></li><li><p><code>truncate_dimension</code>: The dimensionality of the embeddings to truncate to. Default is <code>nothing</code>.</p></li><li><p><code>return_type</code>: The type of the returned embeddings matrix. Default is <code>Matrix{Bool}</code>. Choose <code>BitMatrix</code> to minimize storage requirements, <code>Matrix{Bool}</code> to maximize performance in elementwise-ops.</p></li><li><p><code>cost_tracker</code>: A <code>Threads.Atomic{Float64}</code> object to track the total cost of the API calls. Useful to pass the total cost to the parent call.</p></li><li><p><code>target_batch_size_length</code>: The target length (in characters) of each batch of document chunks sent for embedding. Default is 80_000 characters. Speeds up embedding process.</p></li><li><p><code>ntasks</code>: The number of tasks to use for asyncmap. Default is 4 * Threads.nthreads().</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L300-L332" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.get_embeddings-Tuple{PromptingTools.Experimental.RAGTools.BitPackedBatchEmbedder, AbstractVector{&lt;:AbstractString}}" href="#PromptingTools.Experimental.RAGTools.get_embeddings-Tuple{PromptingTools.Experimental.RAGTools.BitPackedBatchEmbedder, AbstractVector{&lt;:AbstractString}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.get_embeddings</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">get_embeddings</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(embedder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BitPackedBatchEmbedder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, docs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MODEL_EMBEDDING,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    truncate_dimension</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Int, Nothing}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_tracker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Atomic{Float64}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    target_batch_size_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80_000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ntasks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nthreads</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Embeds a vector of <code>docs</code> using the provided model (kwarg <code>model</code>) in a batched manner and then returns the binary embeddings matrix represented in UInt64 (bit-packed) - <code>BitPackedBatchEmbedder</code>.</p><p><code>BitPackedBatchEmbedder</code> tries to batch embedding calls for roughly 80K characters per call (to avoid exceeding the API rate limit) to reduce network latency.</p><p>The best option for FAST and MEMORY-EFFICIENT storage of embeddings, for retrieval use <code>BitPackedCosineSimilarity</code>.</p><p><strong>Notes</strong></p><ul><li><p><code>docs</code> are assumed to be already chunked to the reasonable sizes that fit within the embedding context limit.</p></li><li><p>If you get errors about exceeding input sizes, first check the <code>max_length</code> in your chunks. If that does NOT resolve the issue, try reducing the <code>target_batch_size_length</code> parameter (eg, 10_000) and number of tasks <code>ntasks=1</code>. Some providers cannot handle large batch sizes.</p></li></ul><p><strong>Arguments</strong></p><ul><li><p><code>docs</code>: A vector of strings to be embedded.</p></li><li><p><code>verbose</code>: A boolean flag for verbose output. Default is <code>true</code>.</p></li><li><p><code>model</code>: The model to use for embedding. Default is <code>PT.MODEL_EMBEDDING</code>.</p></li><li><p><code>truncate_dimension</code>: The dimensionality of the embeddings to truncate to. Default is <code>nothing</code>.</p></li><li><p><code>cost_tracker</code>: A <code>Threads.Atomic{Float64}</code> object to track the total cost of the API calls. Useful to pass the total cost to the parent call.</p></li><li><p><code>target_batch_size_length</code>: The target length (in characters) of each batch of document chunks sent for embedding. Default is 80_000 characters. Speeds up embedding process.</p></li><li><p><code>ntasks</code>: The number of tasks to use for asyncmap. Default is 4 * Threads.nthreads().</p></li></ul><p>See also: <code>unpack_bits</code>, <code>pack_bits</code>, <code>BitPackedCosineSimilarity</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L351-L384" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.get_tags-Tuple{PromptingTools.Experimental.RAGTools.NoTagger, AbstractVector{&lt;:AbstractString}}" href="#PromptingTools.Experimental.RAGTools.get_tags-Tuple{PromptingTools.Experimental.RAGTools.NoTagger, AbstractVector{&lt;:AbstractString}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.get_tags</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">get_tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tagger</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NoTagger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, docs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Simple no-op that skips any tagging of the documents</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L456-L461" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.get_tags-Tuple{PromptingTools.Experimental.RAGTools.OpenTagger, AbstractVector{&lt;:AbstractString}}" href="#PromptingTools.Experimental.RAGTools.get_tags-Tuple{PromptingTools.Experimental.RAGTools.OpenTagger, AbstractVector{&lt;:AbstractString}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.get_tags</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">get_tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tagger</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OpenTagger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, docs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_tracker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Atomic{Float64}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Extracts &quot;tags&quot; (metadata/keywords) from a vector of <code>docs</code> using the provided model (kwarg <code>model</code>).</p><p><strong>Arguments</strong></p><ul><li><p><code>docs</code>: A vector of strings to be embedded.</p></li><li><p><code>verbose</code>: A boolean flag for verbose output. Default is <code>true</code>.</p></li><li><p><code>model</code>: The model to use for tags extraction. Default is <code>PT.MODEL_CHAT</code>.</p></li><li><p><code>template</code>: A template to be used for tags extraction. Default is <code>:RAGExtractMetadataShort</code>.</p></li><li><p><code>cost_tracker</code>: A <code>Threads.Atomic{Float64}</code> object to track the total cost of the API calls. Useful to pass the total cost to the parent call.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L482-L496" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.get_tags-Tuple{PromptingTools.Experimental.RAGTools.PassthroughTagger, AbstractVector{&lt;:AbstractString}}" href="#PromptingTools.Experimental.RAGTools.get_tags-Tuple{PromptingTools.Experimental.RAGTools.PassthroughTagger, AbstractVector{&lt;:AbstractString}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.get_tags</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">get_tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tagger</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PassthroughTagger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, docs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tags</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractVector{&lt;:AbstractString}}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Pass <code>tags</code> directly as Vector of Vectors of strings (ie, <code>tags[i]</code> is the tags for <code>docs[i]</code>). It then builds the vocabulary from the tags and returns both the tags in matrix form and the vocabulary.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L467-L474" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.getpropertynested" href="#PromptingTools.Experimental.RAGTools.getpropertynested">#</a> <b><u>PromptingTools.Experimental.RAGTools.getpropertynested</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">getpropertynested</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    nt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, parent_keys</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{Symbol}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Symbol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, default </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Get a property <code>key</code> from a nested NamedTuple <code>nt</code>, where the property is nested to a key in <code>parent_keys</code>.</p><p>Useful for nested kwargs where we want to get some property in <code>parent_keys</code> subset (eg, <code>model</code> in <code>retriever_kwargs</code>).</p><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; abc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; def </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">getpropertynested</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(kw, [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:abc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:def</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: &quot;x&quot;</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/utils.jl#L515-L529" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.hamming_distance-Union{Tuple{T}, Tuple{AbstractMatrix{T}, AbstractVector{T}}} where T&lt;:Integer" href="#PromptingTools.Experimental.RAGTools.hamming_distance-Union{Tuple{T}, Tuple{AbstractMatrix{T}, AbstractVector{T}}} where T&lt;:Integer">#</a> <b><u>PromptingTools.Experimental.RAGTools.hamming_distance</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">hamming_distance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    mat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractMatrix{T}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, query</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{T}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{Int}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {T </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Calculates the column-wise Hamming distance between a matrix of binary vectors <code>mat</code> and a single binary vector <code>vect</code>.</p><p>This is the first-pass ranking for <code>BinaryCosineSimilarity</code> method.</p><p>Implementation from <a href="https://github.com/domluna/tinyRAG" target="_blank" rel="noreferrer"><strong>domluna&#39;s tinyRAG</strong></a>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L344-L353" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.hcat_truncate-Union{Tuple{AbstractVector{&lt;:AbstractMatrix{T}}}, Tuple{T}, Tuple{AbstractVector{&lt;:AbstractMatrix{T}}, Union{Nothing, Int64}}} where T&lt;:Real" href="#PromptingTools.Experimental.RAGTools.hcat_truncate-Union{Tuple{AbstractVector{&lt;:AbstractMatrix{T}}}, Tuple{T}, Tuple{AbstractVector{&lt;:AbstractMatrix{T}}, Union{Nothing, Int64}}} where T&lt;:Real">#</a> <b><u>PromptingTools.Experimental.RAGTools.hcat_truncate</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">hcat_truncate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(matrices</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMatrix{T}}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    truncate_dimension</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Int}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {T </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                                                                     Real}</span></span></code></pre></div><p>Horizontal concatenation of matrices, with optional truncation of the rows of each matrix to the specified dimension (reducing embedding dimensionality).</p><p>More efficient that a simple splatting, as the resulting matrix is pre-allocated in one go.</p><p>Returns: a <code>Matrix{Float32}</code></p><p><strong>Arguments</strong></p><ul><li><p><code>matrices::AbstractVector{&lt;:AbstractMatrix{T}}</code>: Vector of matrices to concatenate</p></li><li><p><code>truncate_dimension::Union{Nothing,Int}=nothing</code>: Dimension to truncate to, or <code>nothing</code> or <code>0</code> to skip truncation. If truncated, the columns will be normalized.</p></li><li><p><code>verbose::Bool=false</code>: Whether to print verbose output.</p></li></ul><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Float32, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">b </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Float32, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> hcat_truncate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([a, b])</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(c) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (1000, 30)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> hcat_truncate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([a, b], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(d) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (500, 30)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/utils.jl#L48-L75" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.load_text-Tuple{PromptingTools.Experimental.RAGTools.AbstractChunker, Any}" href="#PromptingTools.Experimental.RAGTools.load_text-Tuple{PromptingTools.Experimental.RAGTools.AbstractChunker, Any}">#</a> <b><u>PromptingTools.Experimental.RAGTools.load_text</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">load_text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractChunker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, input;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Load text from <code>input</code> using the provided <code>chunker</code>. Called by <code>get_chunks</code>.</p><p>Available chunkers:</p><ul><li><p><code>FileChunker</code>: The function opens each file in <code>input</code> and reads its contents.</p></li><li><p><code>TextChunker</code>: The function assumes that <code>input</code> is a vector of strings to be chunked, you MUST provide corresponding <code>sources</code>.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L145-L154" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.merge_kwargs_nested-Tuple{NamedTuple, NamedTuple}" href="#PromptingTools.Experimental.RAGTools.merge_kwargs_nested-Tuple{NamedTuple, NamedTuple}">#</a> <b><u>PromptingTools.Experimental.RAGTools.merge_kwargs_nested</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">merge_kwargs_nested</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(nt1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, nt2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Merges two nested NamedTuples <code>nt1</code> and <code>nt2</code> recursively. The <code>nt2</code> values will overwrite the <code>nt1</code> values when overlapping.</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; abc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; def </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kw2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; abc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; def </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, def2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), new </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">merge_kwargs_nested</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(kw, kw2)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/utils.jl#L548-L559" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.pack_bits-Tuple{AbstractMatrix{&lt;:Bool}}" href="#PromptingTools.Experimental.RAGTools.pack_bits-Tuple{AbstractMatrix{&lt;:Bool}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.pack_bits</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pack_bits</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(arr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractMatrix{&lt;:Bool}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Matrix{UInt64}</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pack_bits</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:Bool}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Vector{UInt64}</span></span></code></pre></div><p>Pack a matrix or vector of boolean values into a more compact representation using UInt64.</p><p><strong>Arguments (Input)</strong></p><ul><li><code>arr::AbstractMatrix{&lt;:Bool}</code>: A matrix of boolean values where the number of rows must be divisible by 64.</li></ul><p><strong>Returns</strong></p><ul><li>For <code>arr::AbstractMatrix{&lt;:Bool}</code>: Returns a matrix of UInt64 where each element represents 64 boolean values from the original matrix.</li></ul><p><strong>Examples</strong></p><p>For vectors:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Bool, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">binint </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> pack_bits</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bin)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">binx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> unpack_bits</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(binint)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">@assert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> binx</span></span></code></pre></div><p>For matrices:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Bool, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">binint </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> pack_bits</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bin)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">binx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> unpack_bits</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(binint)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">@assert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> binx</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/utils.jl#L583-L612" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.permutation_step!-Tuple{PromptingTools.Experimental.RAGTools.RankGPTResult}" href="#PromptingTools.Experimental.RAGTools.permutation_step!-Tuple{PromptingTools.Experimental.RAGTools.RankGPTResult}">#</a> <b><u>PromptingTools.Experimental.RAGTools.permutation_step!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">permutation_step!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RankGPTResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; rank_start</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, rank_end</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>One sub-step of the RankGPT algorithm permutation ranking within the window of chunks defined by <code>rank_start</code> and <code>rank_end</code> positions.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/rank_gpt.jl#L90-L95" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.preprocess_tokens" href="#PromptingTools.Experimental.RAGTools.preprocess_tokens">#</a> <b><u>PromptingTools.Experimental.RAGTools.preprocess_tokens</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">preprocess_tokens</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, stemmer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; stopwords</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing,Set{String}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, min_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Preprocess provided <code>text</code> by removing numbers, punctuation, and applying stemming for BM25 search index.</p><p>Returns a list of preprocessed tokens.</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">stemmer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Snowball</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Stemmer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;english&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">stopwords </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;an&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;and&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;are&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;as&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;at&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;be&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;but&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;by&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;for&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;if&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;in&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;into&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;is&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;it&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;no&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;not&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;of&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;on&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;or&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;such&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;some&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;that&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;the&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;their&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;then&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;there&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;these&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;they&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;this&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;to&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;was&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;will&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;with&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;This is a sample paragraph to test the functionality of your text preprocessor. It contains a mix of uppercase and lowercase letters, as well as punctuation marks such as commas, periods, and exclamation points! Let&#39;s see how your preprocessor handles quotes, like &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">this </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">one</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;, and also apostrophes, like in don&#39;t. Will it preserve the formatting of this paragraph, including the indentation and line breaks?&quot;</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">preprocess_tokens</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text, stemmer; stopwords)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/utils.jl#L408-L422" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.print_html-Tuple{IO, PromptingTools.Experimental.RAGTools.AbstractAnnotatedNode}" href="#PromptingTools.Experimental.RAGTools.print_html-Tuple{IO, PromptingTools.Experimental.RAGTools.AbstractAnnotatedNode}">#</a> <b><u>PromptingTools.Experimental.RAGTools.print_html</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print_html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([io</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,] parent_node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractAnnotatedNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print_html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([io</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,] rag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractRAGResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; add_sources</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    add_scores</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, default_styler </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> HTMLStyler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    low_styler </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> HTMLStyler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(styles </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;color:magenta&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, classes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    medium_styler </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> HTMLStyler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(styles </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;color:blue&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, classes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    high_styler </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> HTMLStyler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(styles </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, classes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), styler_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Pretty-prints the annotation <code>parent_node</code> (or <code>RAGResult</code>) to the <code>io</code> stream (or returns the string) in HTML format (assumes node is styled with styler <code>HTMLStyler</code>).</p><p>It wraps each &quot;token&quot; into a span with requested styling (HTMLStyler&#39;s properties <code>classes</code> and <code>styles</code>). It also replaces new lines with <code>&lt;br&gt;</code> for better HTML formatting.</p><p>For any non-HTML styler, it prints the content as plain text.</p><p><strong>Returns</strong></p><ul><li><p><code>nothing</code> if <code>io</code> is provided</p></li><li><p>or the string with HTML-formatted text (if <code>io</code> is not provided, we print the result out)</p></li></ul><p>See also <code>HTMLStyler</code>, <code>annotate_support</code>, and <code>set_node_style!</code> for how the styling is applied and what the arguments mean.</p><p><strong>Examples</strong></p><p>Note: <code>RT</code> is an alias for <code>PromptingTools.Experimental.RAGTools</code></p><p>Simple start directly with the <code>RAGResult</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># set up the text/RAGResult</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;This is a test context.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Another context sentence.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Final piece of context.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">answer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;This is a test answer. It has multiple sentences.&quot;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RAGResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; context, final_answer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">answer, question</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># print the HTML</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print_html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rag)</span></span></code></pre></div><p>Low-level control by creating our <code>AnnotatedNode</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># prepare your HTML styling</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">styler_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    default_styler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">HTMLStyler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    low_styler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">HTMLStyler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(styles</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;color:magenta&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, classes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    medium_styler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">HTMLStyler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(styles</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;color:blue&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, classes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    high_styler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">HTMLStyler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(styles</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, classes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># annotate the text</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;This is a test context.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Another context sentence.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Final piece of context.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">answer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;This is a test answer. It has multiple sentences.&quot;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">parent_node </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">annotate_support</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TrigramAnnotater</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), answer, context; add_sources</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, add_scores</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, styler_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># print the HTML</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print_html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parent_node)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># or to accumulate more nodes</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">io </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> IOBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print_html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(io, parent_node)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/annotation.jl#L541-L602" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.rank_gpt-Tuple{AbstractVector{&lt;:AbstractString}, AbstractString}" href="#PromptingTools.Experimental.RAGTools.rank_gpt-Tuple{AbstractVector{&lt;:AbstractString}, AbstractString}">#</a> <b><u>PromptingTools.Experimental.RAGTools.rank_gpt</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rank_gpt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, question</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, rank_start</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, rank_end</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    window_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, step</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    num_rounds</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gpt4o&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Ranks the <code>chunks</code> based on their relevance for <code>question</code>. Returns the ranking permutation of the chunks in the order they are most relevant to the question (the first is the most relevant).</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rank_gpt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunks, question; rank_start</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, rank_end</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">25</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, window_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, step</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, num_rounds</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt4o&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>Reference</strong></p><p>[1] <a href="https://arxiv.org/abs/2304.09542" target="_blank" rel="noreferrer">Is ChatGPT Good at Search? Investigating Large Language Models as Re-Ranking Agents by W. Sun et al.</a> [2] <a href="https://github.com/sunnweiwei/RankGPT" target="_blank" rel="noreferrer">RankGPT Github</a></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/rank_gpt.jl#L142-L158" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.rank_sliding_window!-Tuple{PromptingTools.Experimental.RAGTools.RankGPTResult}" href="#PromptingTools.Experimental.RAGTools.rank_sliding_window!-Tuple{PromptingTools.Experimental.RAGTools.RankGPTResult}">#</a> <b><u>PromptingTools.Experimental.RAGTools.rank_sliding_window!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rank_sliding_window!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RankGPTResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, rank_start </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, rank_end </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    window_size </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, step </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gpt4o&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>One single pass of the RankGPT algorithm permutation ranking across all positions between <code>rank_start</code> and <code>rank_end</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/rank_gpt.jl#L109-L115" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.receive_permutation!-Tuple{AbstractVector{&lt;:Integer}, AbstractString}" href="#PromptingTools.Experimental.RAGTools.receive_permutation!-Tuple{AbstractVector{&lt;:Integer}, AbstractString}">#</a> <b><u>PromptingTools.Experimental.RAGTools.receive_permutation!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">receive_permutation!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    curr_rank</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:Integer}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rank_start</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, rank_end</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Extracts and heals the permutation to contain all ranking positions.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/rank_gpt.jl#L67-L73" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.reciprocal_rank_fusion-Tuple" href="#PromptingTools.Experimental.RAGTools.reciprocal_rank_fusion-Tuple">#</a> <b><u>PromptingTools.Experimental.RAGTools.reciprocal_rank_fusion</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">reciprocal_rank_fusion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Merges multiple rankings and calculates the reciprocal rank score for each chunk (discounted by the inverse of the rank).</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">positions1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">positions2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">positions3 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">12</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">merged_positions, scores </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> reciprocal_rank_fusion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(positions1, positions2, positions3)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/utils.jl#L686-L699" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.reciprocal_rank_fusion-Union{Tuple{T}, Tuple{AbstractVector{&lt;:Integer}, AbstractVector{&lt;:T}, AbstractVector{&lt;:Integer}, AbstractVector{&lt;:T}}} where T&lt;:Real" href="#PromptingTools.Experimental.RAGTools.reciprocal_rank_fusion-Union{Tuple{T}, Tuple{AbstractVector{&lt;:Integer}, AbstractVector{&lt;:T}, AbstractVector{&lt;:Integer}, AbstractVector{&lt;:T}}} where T&lt;:Real">#</a> <b><u>PromptingTools.Experimental.RAGTools.reciprocal_rank_fusion</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">reciprocal_rank_fusion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    positions1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:Integer}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, scores1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:T}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    positions2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:Integer}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    scores2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:T}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {T </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Real</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Merges two sets of rankings and their joint scores. Calculates the reciprocal rank score for each chunk (discounted by the inverse of the rank).</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">positions1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scores1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">positions2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scores2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">merged, scores </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> reciprocal_rank_fusion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(positions1, scores1, positions2, scores2; k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/utils.jl#L715-L732" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.refine!-Tuple{PromptingTools.Experimental.RAGTools.NoRefiner, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractRAGResult}" href="#PromptingTools.Experimental.RAGTools.refine!-Tuple{PromptingTools.Experimental.RAGTools.NoRefiner, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractRAGResult}">#</a> <b><u>PromptingTools.Experimental.RAGTools.refine!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">refine!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    refiner</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NoRefiner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractChunkIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractRAGResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Simple no-op function for <code>refine!</code>. It simply copies the <code>result.answer</code> and <code>result.conversations[:answer]</code> without any changes.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/generation.jl#L170-L176" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.refine!-Tuple{PromptingTools.Experimental.RAGTools.SimpleRefiner, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractRAGResult}" href="#PromptingTools.Experimental.RAGTools.refine!-Tuple{PromptingTools.Experimental.RAGTools.SimpleRefiner, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractRAGResult}">#</a> <b><u>PromptingTools.Experimental.RAGTools.refine!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">refine!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    refiner</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SimpleRefiner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractDocumentIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractRAGResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MODEL_CHAT,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    template</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Symbol</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :RAGAnswerRefiner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_tracker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Atomic{Float64}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Give model a chance to refine the answer (using the same or different context than previously provided).</p><p>This method uses the same context as the original answer, however, it can be modified to do additional retrieval and use a different context.</p><p><strong>Returns</strong></p><ul><li>Mutated <code>result</code> with <code>result.final_answer</code> and the full conversation saved in <code>result.conversations[:final_answer]</code></li></ul><p><strong>Arguments</strong></p><ul><li><p><code>refiner::SimpleRefiner</code>: The method to use for refining the answer. Uses <code>aigenerate</code>.</p></li><li><p><code>index::AbstractDocumentIndex</code>: The index containing chunks and sources.</p></li><li><p><code>result::AbstractRAGResult</code>: The result containing the context and question to generate the answer for.</p></li><li><p><code>model::AbstractString</code>: The model to use for generating the answer. Defaults to <code>PT.MODEL_CHAT</code>.</p></li><li><p><code>verbose::Bool</code>: If <code>true</code>, enables verbose logging.</p></li><li><p><code>template::Symbol</code>: The template to use for the <code>aigenerate</code> function. Defaults to <code>:RAGAnswerRefiner</code>.</p></li><li><p><code>cost_tracker</code>: An atomic counter to track the cost of the operation.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/generation.jl#L187-L211" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.refine!-Tuple{PromptingTools.Experimental.RAGTools.TavilySearchRefiner, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractRAGResult}" href="#PromptingTools.Experimental.RAGTools.refine!-Tuple{PromptingTools.Experimental.RAGTools.TavilySearchRefiner, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, PromptingTools.Experimental.RAGTools.AbstractRAGResult}">#</a> <b><u>PromptingTools.Experimental.RAGTools.refine!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">refine!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    refiner</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TavilySearchRefiner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractDocumentIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractRAGResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MODEL_CHAT,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    include_answer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    max_results</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    include_domains</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String[],</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    exclude_domains</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String[],</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    template</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Symbol</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :RAGWebSearchRefiner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_tracker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Atomic{Float64}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Refines the answer by executing a web search using the Tavily API. This method aims to enhance the answer&#39;s accuracy and relevance by incorporating information retrieved from the web.</p><p>Note: The web results and web answer (if requested) will be added to the context and sources!</p><p><strong>Returns</strong></p><ul><li><p>Mutated <code>result</code> with <code>result.final_answer</code> and the full conversation saved in <code>result.conversations[:final_answer]</code>.</p></li><li><p>In addition, the web results and web answer (if requested) are appended to the <code>result.context</code> and <code>result.sources</code> for correct highlighting and verification.</p></li></ul><p><strong>Arguments</strong></p><ul><li><p><code>refiner::TavilySearchRefiner</code>: The method to use for refining the answer. Uses <code>aigenerate</code> with a web search template.</p></li><li><p><code>index::AbstractDocumentIndex</code>: The index containing chunks and sources.</p></li><li><p><code>result::AbstractRAGResult</code>: The result containing the context and question to generate the answer for.</p></li><li><p><code>model::AbstractString</code>: The model to use for generating the answer. Defaults to <code>PT.MODEL_CHAT</code>.</p></li><li><p><code>include_answer::Bool</code>: If <code>true</code>, includes the answer from Tavily in the web search.</p></li><li><p><code>max_results::Integer</code>: The maximum number of results to return.</p></li><li><p><code>include_domains::AbstractVector{&lt;:AbstractString}</code>: A list of domains to include in the search results. Default is an empty list.</p></li><li><p><code>exclude_domains::AbstractVector{&lt;:AbstractString}</code>: A list of domains to exclude from the search results. Default is an empty list.</p></li><li><p><code>verbose::Bool</code>: If <code>true</code>, enables verbose logging.</p></li><li><p><code>template::Symbol</code>: The template to use for the <code>aigenerate</code> function. Defaults to <code>:RAGWebSearchRefiner</code>.</p></li><li><p><code>cost_tracker</code>: An atomic counter to track the cost of the operation.</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">refiner!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TavilySearchRefiner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), index, result)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># See result.final_answer or pprint(result)</span></span></code></pre></div><p>To enable this refiner in a full RAG pipeline, simply swap the component in the config:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cfg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RAGConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cfg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">generator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">refiner </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TavilySearchRefiner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> airag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfg, index; question, return_all </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pprint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/generation.jl#L241-L289" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.rephrase-Tuple{PromptingTools.Experimental.RAGTools.HyDERephraser, AbstractString}" href="#PromptingTools.Experimental.RAGTools.rephrase-Tuple{PromptingTools.Experimental.RAGTools.HyDERephraser, AbstractString}">#</a> <b><u>PromptingTools.Experimental.RAGTools.rephrase</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rephrase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rephraser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SimpleRephraser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, question</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MODEL_CHAT, template</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Symbol</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :RAGQueryHyDE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_tracker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Atomic{Float64}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><p>Rephrases the <code>question</code> using the provided rephraser <code>template = RAGQueryHyDE</code>.</p><p>Special flavor of rephrasing using HyDE (Hypothetical Document Embedding) method, which aims to find the documents most similar to a synthetic passage that <em>would be</em> a good answer to our question.</p><p>Returns both the original and the rephrased question.</p><p><strong>Arguments</strong></p><ul><li><p><code>rephraser</code>: Type that dictates the logic of rephrasing step.</p></li><li><p><code>question</code>: The question to be rephrased.</p></li><li><p><code>model</code>: The model to use for rephrasing. Default is <code>PT.MODEL_CHAT</code>.</p></li><li><p><code>template</code>: The rephrasing template to use. Default is <code>:RAGQueryHyDE</code>. Find more with <code>aitemplates(&quot;rephrase&quot;)</code>.</p></li><li><p><code>verbose</code>: A boolean flag indicating whether to print verbose logging. Default is <code>true</code>.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L150-L169" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.rephrase-Tuple{PromptingTools.Experimental.RAGTools.NoRephraser, AbstractString}" href="#PromptingTools.Experimental.RAGTools.rephrase-Tuple{PromptingTools.Experimental.RAGTools.NoRephraser, AbstractString}">#</a> <b><u>PromptingTools.Experimental.RAGTools.rephrase</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rephrase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rephraser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NoRephraser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, question</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>No-op, simple passthrough.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L110-L114" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.rephrase-Tuple{PromptingTools.Experimental.RAGTools.SimpleRephraser, AbstractString}" href="#PromptingTools.Experimental.RAGTools.rephrase-Tuple{PromptingTools.Experimental.RAGTools.SimpleRephraser, AbstractString}">#</a> <b><u>PromptingTools.Experimental.RAGTools.rephrase</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rephrase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rephraser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SimpleRephraser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, question</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MODEL_CHAT, template</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Symbol</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :RAGQueryOptimizer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_tracker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Atomic{Float64}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Rephrases the <code>question</code> using the provided rephraser <code>template</code>.</p><p>Returns both the original and the rephrased question.</p><p><strong>Arguments</strong></p><ul><li><p><code>rephraser</code>: Type that dictates the logic of rephrasing step.</p></li><li><p><code>question</code>: The question to be rephrased.</p></li><li><p><code>model</code>: The model to use for rephrasing. Default is <code>PT.MODEL_CHAT</code>.</p></li><li><p><code>template</code>: The rephrasing template to use. Default is <code>:RAGQueryOptimizer</code>. Find more with <code>aitemplates(&quot;rephrase&quot;)</code>.</p></li><li><p><code>verbose</code>: A boolean flag indicating whether to print verbose logging. Default is <code>true</code>.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L119-L135" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.rerank-Tuple{PromptingTools.Experimental.RAGTools.CohereReranker, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, AbstractString, PromptingTools.Experimental.RAGTools.AbstractCandidateChunks}" href="#PromptingTools.Experimental.RAGTools.rerank-Tuple{PromptingTools.Experimental.RAGTools.CohereReranker, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, AbstractString, PromptingTools.Experimental.RAGTools.AbstractCandidateChunks}">#</a> <b><u>PromptingTools.Experimental.RAGTools.rerank</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rerank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    reranker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CohereReranker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractDocumentIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, question</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    candidates</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractCandidateChunks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">COHERE_API_KEY,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    top_n</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(candidates</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scores),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;rerank-english-v3.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return_documents</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_tracker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Atomic{Float64}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Re-ranks a list of candidate chunks using the Cohere Rerank API. See <a href="https://cohere.com/rerank" target="_blank" rel="noreferrer">https://cohere.com/rerank</a> for more details.</p><p><strong>Arguments</strong></p><ul><li><p><code>reranker</code>: Using Cohere API</p></li><li><p><code>index</code>: The index that holds the underlying chunks to be re-ranked.</p></li><li><p><code>question</code>: The query to be used for the search.</p></li><li><p><code>candidates</code>: The candidate chunks to be re-ranked.</p></li><li><p><code>top_n</code>: The number of most relevant documents to return. Default is <code>length(documents)</code>.</p></li><li><p><code>model</code>: The model to use for reranking. Default is <code>rerank-english-v3.0</code>.</p></li><li><p><code>return_documents</code>: A boolean flag indicating whether to return the reranked documents in the response. Default is <code>false</code>.</p></li><li><p><code>verbose</code>: A boolean flag indicating whether to print verbose logging. Default is <code>false</code>.</p></li><li><p><code>cost_tracker</code>: An atomic counter to track the cost of the retrieval. Not implemented /tracked (cost unclear). Provided for consistency.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L686-L712" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.rerank-Tuple{PromptingTools.Experimental.RAGTools.RankGPTReranker, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, AbstractString, PromptingTools.Experimental.RAGTools.AbstractCandidateChunks}" href="#PromptingTools.Experimental.RAGTools.rerank-Tuple{PromptingTools.Experimental.RAGTools.RankGPTReranker, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, AbstractString, PromptingTools.Experimental.RAGTools.AbstractCandidateChunks}">#</a> <b><u>PromptingTools.Experimental.RAGTools.rerank</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rerank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    reranker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RankGPTReranker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractDocumentIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, question</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    candidates</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractCandidateChunks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">OPENAI_API_KEY,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MODEL_CHAT,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    top_n</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(candidates</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scores),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    unique_chunks</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_tracker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Atomic{Float64}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Re-ranks a list of candidate chunks using the RankGPT algorithm. See <a href="https://github.com/sunnweiwei/RankGPT" target="_blank" rel="noreferrer">https://github.com/sunnweiwei/RankGPT</a> for more details.</p><p>It uses LLM calls to rank the candidate chunks.</p><p><strong>Arguments</strong></p><ul><li><p><code>reranker</code>: Using Cohere API</p></li><li><p><code>index</code>: The index that holds the underlying chunks to be re-ranked.</p></li><li><p><code>question</code>: The query to be used for the search.</p></li><li><p><code>candidates</code>: The candidate chunks to be re-ranked.</p></li><li><p><code>top_n</code>: The number of most relevant documents to return. Default is <code>length(documents)</code>.</p></li><li><p><code>model</code>: The model to use for reranking. Default is <code>rerank-english-v3.0</code>.</p></li><li><p><code>verbose</code>: A boolean flag indicating whether to print verbose logging. Default is <code>1</code>.</p></li><li><p><code>unique_chunks</code>: A boolean flag indicating whether to remove duplicates from the candidate chunks prior to reranking (saves compute time). Default is <code>true</code>.</p></li></ul><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">some index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">question </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;What are the best practices for parallel computing in Julia?&quot;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cfg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> RAGConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; retriever </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SimpleRetriever</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; reranker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RankGPTReranker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()))</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> airag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfg, index; question, return_all </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>To get full verbosity of logs, set <code>verbose = 5</code> (anything higher than 3).</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> airag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cfg, index; question, return_all </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, verbose </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>Reference</strong></p><p>[1] <a href="https://arxiv.org/abs/2304.09542" target="_blank" rel="noreferrer">Is ChatGPT Good at Search? Investigating Large Language Models as Re-Ranking Agents by W. Sun et al.</a> [2] <a href="https://github.com/sunnweiwei/RankGPT" target="_blank" rel="noreferrer">RankGPT Github</a></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L773-L817" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.retrieve-Tuple{PromptingTools.Experimental.RAGTools.AbstractRetriever, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, AbstractString}" href="#PromptingTools.Experimental.RAGTools.retrieve-Tuple{PromptingTools.Experimental.RAGTools.AbstractRetriever, PromptingTools.Experimental.RAGTools.AbstractDocumentIndex, AbstractString}">#</a> <b><u>PromptingTools.Experimental.RAGTools.retrieve</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">retrieve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(retriever</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractRetriever</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractChunkIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    question</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    top_n</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rephraser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractRephraser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> retriever</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rephraser,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rephraser_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    embedder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractEmbedder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> retriever</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">embedder,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    embedder_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    processor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractProcessor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> retriever</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">processor,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    processor_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    finder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractSimilarityFinder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> retriever</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">finder,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    finder_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tagger</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractTagger</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> retriever</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tagger,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tagger_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    filter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractTagFilter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> retriever</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">filter,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    filter_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    reranker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractReranker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> retriever</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">reranker,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    reranker_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_tracker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Threads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Atomic{Float64}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Retrieves the most relevant chunks from the index for the given question and returns them in the <code>RAGResult</code> object.</p><p>This is the main entry point for the retrieval stage of the RAG pipeline. It is often followed by <code>generate!</code> step.</p><p>Notes:</p><ul><li>The default flow is <code>build_context!</code> -&gt; <code>answer!</code> -&gt; <code>refine!</code> -&gt; <code>postprocess!</code>.</li></ul><p>The arguments correspond to the steps of the retrieval process (rephrasing, embedding, finding similar docs, tagging, filtering by tags, reranking). You can customize each step by providing a new custom type that dispatches the corresponding function, eg, create your own type <code>struct MyReranker&lt;:AbstractReranker end</code> and define the custom method for it <code>rerank(::MyReranker,...) = ...</code>.</p><p>Note: Discover available retrieval sub-types for each step with <code>subtypes(AbstractRephraser)</code> and similar for other abstract types.</p><p>If you&#39;re using locally-hosted models, you can pass the <code>api_kwargs</code> with the <code>url</code> field set to the model&#39;s URL and make sure to provide corresponding <code>model</code> kwargs to <code>rephraser</code>, <code>embedder</code>, and <code>tagger</code> to use the custom models (they make AI calls).</p><p><strong>Arguments</strong></p><ul><li><p><code>retriever</code>: The retrieval method to use. Default is <code>SimpleRetriever</code> but could be <code>AdvancedRetriever</code> for more advanced retrieval.</p></li><li><p><code>index</code>: The index that holds the chunks and sources to be retrieved from.</p></li><li><p><code>question</code>: The question to be used for the retrieval.</p></li><li><p><code>verbose</code>: If <code>&gt;0</code>, it prints out verbose logging. Default is <code>1</code>. If you set it to <code>2</code>, it will print out logs for each sub-function.</p></li><li><p><code>top_k</code>: The TOTAL number of closest chunks to return from <code>find_closest</code>. Default is <code>100</code>. If there are multiple rephrased questions, the number of chunks per each item will be <code>top_k ÷ number_of_rephrased_questions</code>.</p></li><li><p><code>top_n</code>: The TOTAL number of most relevant chunks to return for the context (from <code>rerank</code> step). Default is <code>5</code>.</p></li><li><p><code>api_kwargs</code>: Additional keyword arguments to be passed to the API calls (shared by all <code>ai*</code> calls).</p></li><li><p><code>rephraser</code>: Transform the question into one or more questions. Default is <code>retriever.rephraser</code>.</p></li><li><p><code>rephraser_kwargs</code>: Additional keyword arguments to be passed to the rephraser.</p><ul><li><p><code>model</code>: The model to use for rephrasing. Default is <code>PT.MODEL_CHAT</code>.</p></li><li><p><code>template</code>: The rephrasing template to use. Default is <code>:RAGQueryOptimizer</code> or <code>:RAGQueryHyDE</code> (depending on the <code>rephraser</code> selected).</p></li></ul></li><li><p><code>embedder</code>: The embedding method to use. Default is <code>retriever.embedder</code>.</p></li><li><p><code>embedder_kwargs</code>: Additional keyword arguments to be passed to the embedder.</p></li><li><p><code>processor</code>: The processor method to use when using Keyword-based index. Default is <code>retriever.processor</code>.</p></li><li><p><code>processor_kwargs</code>: Additional keyword arguments to be passed to the processor.</p></li><li><p><code>finder</code>: The similarity search method to use. Default is <code>retriever.finder</code>, often <code>CosineSimilarity</code>.</p></li><li><p><code>finder_kwargs</code>: Additional keyword arguments to be passed to the similarity finder.</p></li><li><p><code>tagger</code>: The tag generating method to use. Default is <code>retriever.tagger</code>.</p></li><li><p><code>tagger_kwargs</code>: Additional keyword arguments to be passed to the tagger. Noteworthy arguments:</p><ul><li><code>tags</code>: Directly provide the tags to use for filtering (can be String, Regex, or Vector{String}). Useful for <code>tagger = PassthroughTagger</code>.</li></ul></li><li><p><code>filter</code>: The tag matching method to use. Default is <code>retriever.filter</code>.</p></li><li><p><code>filter_kwargs</code>: Additional keyword arguments to be passed to the tag filter.</p></li><li><p><code>reranker</code>: The reranking method to use. Default is <code>retriever.reranker</code>.</p></li><li><p><code>reranker_kwargs</code>: Additional keyword arguments to be passed to the reranker.</p><ul><li><code>model</code>: The model to use for reranking. Default is <code>rerank-english-v2.0</code> if you use <code>reranker = CohereReranker()</code>.</li></ul></li><li><p><code>cost_tracker</code>: An atomic counter to track the cost of the retrieval. Default is <code>Threads.Atomic{Float64}(0.0)</code>.</p></li></ul><p>See also: <code>SimpleRetriever</code>, <code>AdvancedRetriever</code>, <code>build_index</code>, <code>rephrase</code>, <code>get_embeddings</code>, <code>get_keywords</code>, <code>find_closest</code>, <code>get_tags</code>, <code>find_tags</code>, <code>rerank</code>, <code>RAGResult</code>.</p><p><strong>Examples</strong></p><p>Find the 5 most relevant chunks from the index for the given question.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># assumes you have an existing index `index`</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">retriever </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SimpleRetriever</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> retrieve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(retriever,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    index,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;What is the capital of France?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    top_n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># or use the default retriever (same as above)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> retrieve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(retriever,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    index,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;What is the capital of France?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    top_n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Apply more advanced retrieval with question rephrasing and reranking (requires <code>COHERE_API_KEY</code>). We will obtain top 100 chunks from embeddings (<code>top_k</code>) and top 5 chunks from reranking (<code>top_n</code>).</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">retriever </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AdvancedRetriever</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> retrieve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(retriever, index, question; top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, top_n</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>You can use the <code>retriever</code> to customize your retrieval strategy or directly change the strategy types in the <code>retrieve</code> kwargs!</p><p>Example of using locally-hosted model hosted on <code>localhost:8080</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">retriever </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SimpleRetriever</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> retrieve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(retriever, index, question;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rephraser_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;custom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    embedder_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;custom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tagger_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;custom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), api_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        url </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://localhost:8080&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/retrieval.jl#L946-L1057" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.run_qa_evals-Tuple{PromptingTools.Experimental.RAGTools.AbstractChunkIndex, AbstractVector{&lt;:PromptingTools.Experimental.RAGTools.QAEvalItem}}" href="#PromptingTools.Experimental.RAGTools.run_qa_evals-Tuple{PromptingTools.Experimental.RAGTools.AbstractChunkIndex, AbstractVector{&lt;:PromptingTools.Experimental.RAGTools.QAEvalItem}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.run_qa_evals</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">run_qa_evals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractChunkIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, qa_items</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:QAEvalItem}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    airag_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    qa_evals_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, parameters_dict</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dict{Symbol, &lt;:Any}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Dict{Symbol, Any}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span></code></pre></div><p>Evaluates a vector of <code>QAEvalItem</code>s and returns a vector <code>QAEvalResult</code>. This function assesses the relevance and accuracy of the answers generated in a QA evaluation context.</p><p>See <code>?run_qa_evals</code> for more details.</p><p><strong>Arguments</strong></p><ul><li><p><code>qa_items::AbstractVector{&lt;:QAEvalItem}</code>: The vector of QA evaluation items containing the questions and their answers.</p></li><li><p><code>verbose::Bool</code>: If <code>true</code>, enables verbose logging. Defaults to <code>true</code>.</p></li><li><p><code>api_kwargs::NamedTuple</code>: Parameters that will be forwarded to the API calls. See <code>?aiextract</code> for details.</p></li><li><p><code>airag_kwargs::NamedTuple</code>: Parameters that will be forwarded to <code>airag</code> calls. See <code>?airag</code> for details.</p></li><li><p><code>qa_evals_kwargs::NamedTuple</code>: Parameters that will be forwarded to <code>run_qa_evals</code> calls. See <code>?run_qa_evals</code> for details.</p></li><li><p><code>parameters_dict::Dict{Symbol, Any}</code>: Track any parameters used for later evaluations. Keys must be Symbols.</p></li></ul><p><strong>Returns</strong></p><p><code>Vector{QAEvalResult}</code>: Vector of evaluation results that includes various scores and metadata related to the QA evaluation.</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;...&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # Assuming a proper index is defined</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">qa_items </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">QAEvalItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(question</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is the capital of France?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, answer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Paris&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;France is a country in Europe.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            QAEvalItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(question</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is the capital of Germany?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, answer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Berlin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Germany is a country in Europe.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Let&#39;s run a test with `top_k=5`</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> run_qa_evals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(index, qa_items; airag_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), parameters_dict</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Filter out the &quot;failed&quot; calls</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;!</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isnothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">answer_score), results);</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># See average judge score</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">mean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">answer_score, results)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/evaluation.jl#L221-L260" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.run_qa_evals-Tuple{PromptingTools.Experimental.RAGTools.QAEvalItem, RAGResult}" href="#PromptingTools.Experimental.RAGTools.run_qa_evals-Tuple{PromptingTools.Experimental.RAGTools.QAEvalItem, RAGResult}">#</a> <b><u>PromptingTools.Experimental.RAGTools.run_qa_evals</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">run_qa_evals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(qa_item</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">QAEvalItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RAGResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             parameters_dict</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dict{Symbol, &lt;:Any}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, judge_template</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Symbol</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :RAGJudgeAnswerFromContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">             model_judge</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QAEvalResult</span></span></code></pre></div><p>Evaluates a single <code>QAEvalItem</code> using RAG details (<code>RAGResult</code>) and returns a <code>QAEvalResult</code> structure. This function assesses the relevance and accuracy of the answers generated in a QA evaluation context.</p><p><strong>Arguments</strong></p><ul><li><p><code>qa_item::QAEvalItem</code>: The QA evaluation item containing the question and its answer.</p></li><li><p><code>ctx::RAGResult</code>: The RAG result used for generating the QA pair, including the original context and the answers. Comes from <code>airag(...; return_context=true)</code></p></li><li><p><code>verbose::Bool</code>: If <code>true</code>, enables verbose logging. Defaults to <code>true</code>.</p></li><li><p><code>parameters_dict::Dict{Symbol, Any}</code>: Track any parameters used for later evaluations. Keys must be Symbols.</p></li><li><p><code>judge_template::Symbol</code>: The template symbol for the AI model used to judge the answer. Defaults to <code>:RAGJudgeAnswerFromContext</code>.</p></li><li><p><code>model_judge::AbstractString</code>: The AI model used for judging the answer&#39;s quality. Defaults to standard chat model, but it is advisable to use more powerful model GPT-4.</p></li><li><p><code>api_kwargs::NamedTuple</code>: Parameters that will be forwarded to the API endpoint.</p></li></ul><p><strong>Returns</strong></p><p><code>QAEvalResult</code>: An evaluation result that includes various scores and metadata related to the QA evaluation.</p><p><strong>Notes</strong></p><ul><li><p>The function computes a retrieval score and rank based on how well the context matches the QA context.</p></li><li><p>It then uses the <code>judge_template</code> and <code>model_judge</code> to score the answer&#39;s accuracy and relevance.</p></li><li><p>In case of errors during evaluation, the function logs a warning (if <code>verbose</code> is <code>true</code>) and the <code>answer_score</code> will be set to <code>nothing</code>.</p></li></ul><p><strong>Examples</strong></p><p>Evaluating a QA pair using a specific context and model:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">qa_item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> QAEvalItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(question</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is the capital of France?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, answer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Paris&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;France is a country in Europe.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ctx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> RAGResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Wikipedia&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;France is a country in Europe.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, answer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Paris&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">parameters_dict </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;param1&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;value1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;param2&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;value2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">eval_result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> run_qa_evals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(qa_item, ctx, parameters_dict</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">parameters_dict, model_judge</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MyAIJudgeModel&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/evaluation.jl#L145-L181" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.score_retrieval_hit-Tuple{AbstractString, Vector{&lt;:AbstractString}}" href="#PromptingTools.Experimental.RAGTools.score_retrieval_hit-Tuple{AbstractString, Vector{&lt;:AbstractString}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.score_retrieval_hit</u></b> — <i>Method</i>. <p>Returns 1.0 if <code>context</code> overlaps or is contained within any of the <code>candidate_context</code></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/evaluation.jl#L131" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.score_retrieval_rank-Tuple{AbstractString, Vector{&lt;:AbstractString}}" href="#PromptingTools.Experimental.RAGTools.score_retrieval_rank-Tuple{AbstractString, Vector{&lt;:AbstractString}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.score_retrieval_rank</u></b> — <i>Method</i>. <p>Returns Integer rank of the position where <code>context</code> overlaps or is contained within a <code>candidate_context</code></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/evaluation.jl#L138" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.score_to_unit_scale-Union{Tuple{AbstractVector{T}}, Tuple{T}} where T&lt;:Real" href="#PromptingTools.Experimental.RAGTools.score_to_unit_scale-Union{Tuple{AbstractVector{T}}, Tuple{T}} where T&lt;:Real">#</a> <b><u>PromptingTools.Experimental.RAGTools.score_to_unit_scale</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">score_to_unit_scale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{T}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Real</span></span></code></pre></div><p>Shift and scale a vector of scores to the unit scale [0, 1].</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scaled_x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> score_to_unit_scale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/utils.jl#L752-L762" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.set_node_style!-Tuple{TrigramAnnotater, PromptingTools.Experimental.RAGTools.AnnotatedNode}" href="#PromptingTools.Experimental.RAGTools.set_node_style!-Tuple{TrigramAnnotater, PromptingTools.Experimental.RAGTools.AnnotatedNode}">#</a> <b><u>PromptingTools.Experimental.RAGTools.set_node_style!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set_node_style!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TrigramAnnotater</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AnnotatedNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    low_threshold</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Float64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, medium_threshold</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Float64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, high_threshold</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Float64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    default_styler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractAnnotationStyler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Styler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    low_styler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractAnnotationStyler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Styler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :magenta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, bold </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    medium_styler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractAnnotationStyler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Styler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :blue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, bold </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    high_styler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractAnnotationStyler</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Styler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, bold </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    bold_multihits</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Sets style of <code>node</code> based on the provided rules</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/annotation.jl#L151-L161" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.setpropertynested-Tuple{NamedTuple, Vector{Symbol}, Symbol, Any}" href="#PromptingTools.Experimental.RAGTools.setpropertynested-Tuple{NamedTuple, Vector{Symbol}, Symbol, Any}">#</a> <b><u>PromptingTools.Experimental.RAGTools.setpropertynested</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setpropertynested</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(nt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, parent_keys</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{Symbol}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Symbol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    value</span></span></code></pre></div><p>)</p><p>Setter for a property <code>key</code> in a nested NamedTuple <code>nt</code>, where the property is nested to a key in <code>parent_keys</code>.</p><p>Useful for nested kwargs where we want to change some property in <code>parent_keys</code> subset (eg, <code>model</code> in <code>retriever_kwargs</code>).</p><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; abc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; def </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setpropertynested</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(kw, [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:abc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:def</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;y&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: (abc = (def = &quot;y&quot;,),)</span></span></code></pre></div><p>Practical example of changing all <code>model</code> keys in CHAT-based steps in the pipeline:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># changes :model to &quot;gpt4t&quot; whenever the parent key is in the below list (chat-based steps)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setpropertynested</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(kwargs,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:rephraser_kwargs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:tagger_kwargs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:answerer_kwargs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:refiner_kwargs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    :model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt4t&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Or changing an embedding model (across both indexer and retriever steps, because it&#39;s same step name):</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> setpropertynested</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        kwargs, [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:embedder_kwargs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        :model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text-embedding-3-large&quot;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/utils.jl#L461-L493" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.split_into_code_and_sentences-Tuple{Union{SubString{String}, String}}" href="#PromptingTools.Experimental.RAGTools.split_into_code_and_sentences-Tuple{Union{SubString{String}, String}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.split_into_code_and_sentences</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">split_into_code_and_sentences</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(input</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{String, SubString{String}}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Splits text block into code or text and sub-splits into units.</p><p>If code block, it splits by newline but keep the <code>group_id</code> the same (to have the same source) If text block, splits into sentences, bullets, etc., provides different <code>group_id</code> (to have different source)</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/utils.jl#L338-L345" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.tags_extract-Tuple{PromptingTools.Experimental.RAGTools.Tag}" href="#PromptingTools.Experimental.RAGTools.tags_extract-Tuple{PromptingTools.Experimental.RAGTools.Tag}">#</a> <b><u>PromptingTools.Experimental.RAGTools.tags_extract</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tags_extract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(item</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Tag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tags_extract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tags</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{Tag}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Extracts the <code>Tag</code> item into a string of the form <code>category:::value</code> (lowercased and spaces replaced with underscores).</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiextract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:RAGExtractMetadataShort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; return_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MaybeTags, text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I like package DataFrames&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, instructions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;None.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tags_extract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">items)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/preparation.jl#L437-L448" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.token_with_boundaries-Tuple{Union{Nothing, AbstractString}, AbstractString, Union{Nothing, AbstractString}}" href="#PromptingTools.Experimental.RAGTools.token_with_boundaries-Tuple{Union{Nothing, AbstractString}, AbstractString, Union{Nothing, AbstractString}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.token_with_boundaries</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">token_with_boundaries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prev_token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, curr_token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    next_token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Joins the three tokens together. Useful to add boundary tokens (like spaces vs brackets) to the <code>curr_token</code> to improve the matched context (ie, separate partial matches from exact match)</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/utils.jl#L258-L264" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.tokenize-Tuple{Union{SubString{String}, String}}" href="#PromptingTools.Experimental.RAGTools.tokenize-Tuple{Union{SubString{String}, String}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.tokenize</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tokenize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(input</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{String, SubString{String}}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Tokenizes provided <code>input</code> by spaces, special characters or Julia symbols (eg, <code>=&gt;</code>).</p><p>Unlike other tokenizers, it aims to lossless - ie, keep both the separated text and the separators.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/utils.jl#L183-L189" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.translate_positions_to_parent-Tuple{PromptingTools.Experimental.RAGTools.AbstractChunkIndex, AbstractVector{&lt;:Integer}}" href="#PromptingTools.Experimental.RAGTools.translate_positions_to_parent-Tuple{PromptingTools.Experimental.RAGTools.AbstractChunkIndex, AbstractVector{&lt;:Integer}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.translate_positions_to_parent</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">translate_positions_to_parent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractChunkIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, positions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:Integer}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Translate positions to the parent index. Useful to convert between positions in a view and the original index.</p><p>Used whenever a <code>chunkdata()</code> is used to re-align positions in case index is a view.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/types.jl#L46-L52" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.translate_positions_to_parent-Tuple{SubChunkIndex, AbstractVector{&lt;:Integer}}" href="#PromptingTools.Experimental.RAGTools.translate_positions_to_parent-Tuple{SubChunkIndex, AbstractVector{&lt;:Integer}}">#</a> <b><u>PromptingTools.Experimental.RAGTools.translate_positions_to_parent</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">translate_positions_to_parent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SubChunkIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, pos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:Integer}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Translate positions to the parent index. Useful to convert between positions in a view and the original index.</p><p>Used whenever a <code>chunkdata()</code> or <code>tags()</code> are used to re-align positions to the &quot;parent&quot; index.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/types.jl#L504-L511" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.trigram_support!-Union{Tuple{F2}, Tuple{F1}, Tuple{PromptingTools.Experimental.RAGTools.AnnotatedNode, AbstractVector}, Tuple{PromptingTools.Experimental.RAGTools.AnnotatedNode, AbstractVector, F1}, Tuple{PromptingTools.Experimental.RAGTools.AnnotatedNode, AbstractVector, F1, F2}} where {F1&lt;:Function, F2&lt;:Function}" href="#PromptingTools.Experimental.RAGTools.trigram_support!-Union{Tuple{F2}, Tuple{F1}, Tuple{PromptingTools.Experimental.RAGTools.AnnotatedNode, AbstractVector}, Tuple{PromptingTools.Experimental.RAGTools.AnnotatedNode, AbstractVector, F1}, Tuple{PromptingTools.Experimental.RAGTools.AnnotatedNode, AbstractVector, F1, F2}} where {F1&lt;:Function, F2&lt;:Function}">#</a> <b><u>PromptingTools.Experimental.RAGTools.trigram_support!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">trigram_support!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parent_node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AnnotatedNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    context_trigrams</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, trigram_func</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">F1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> trigrams, token_transform</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">F2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> identity;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    skip_trigrams</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, min_score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Float64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    min_source_score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Float64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.25</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    stop_words</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:String}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> STOPWORDS,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    styler_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {F1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, F2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Find if the <code>parent_node.content</code> is supported by the provided <code>context_trigrams</code>.</p><p>Logic:</p><ul><li><p>Split the <code>parent_node.content</code> into tokens</p></li><li><p>Create an <code>AnnotatedNode</code> for each token</p></li><li><p>If <code>skip_trigrams</code> is enabled, it looks for an exact match in the <code>context_trigrams</code></p></li><li><p>If no exact match found, it counts trigram-based match (include the surrounding tokens for better contextual awareness) as a score</p></li><li><p>Then it sets the style of the node based on the score</p></li><li><p>Lastly, it aligns the styles of neighboring nodes with <code>score==nothing</code> (eg, single character tokens)</p></li><li><p>Then, it rolls up the scores and sources to the parent node</p></li></ul><p>For diagnostics, you can use <code>AbstractTrees.print_tree(parent_node)</code> to see the tree structure of each token and its score.</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">node </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AnnotatedNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;xyz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">trigram_support!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(node, context_trigrams) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># updates node.children! ```</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[source](https</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">://</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">github</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">com</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">svilupp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PromptingTools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">jl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">blob</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">f20f3b9fcebd83183f0ae2acb396eb1a9272b14f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">src</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Experimental</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">RAGTools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">annotation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">jl</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#L215-L244)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">br</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">div style</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;border-width:1px; border-style:solid; border-color:black; padding: 1em; border-radius: 25px;&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;PromptingTools.Experimental.RAGTools.trigrams-Tuple{AbstractString}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> href</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;#PromptingTools.Experimental.RAGTools.trigrams-Tuple{AbstractString}&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#&lt;/a&gt;&amp;nbsp;&lt;b&gt;&lt;u&gt;PromptingTools.Experimental.RAGTools.trigrams&lt;/u&gt;&lt;/b&gt; &amp;mdash; &lt;i&gt;Method&lt;/i&gt;.</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">```julia</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">trigrams(input_string::AbstractString; add_word::AbstractString = &quot;&quot;)</span></span></code></pre></div><p>Splits provided <code>input_string</code> into a vector of trigrams (combination of three consecutive characters found in the <code>input_string</code>).</p><p>If <code>add_word</code> is provided, it is added to the resulting array. Useful to add the full word itself to the resulting array for exact match.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/utils.jl#L196-L202" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Experimental.RAGTools.trigrams_hashed-Tuple{AbstractString}" href="#PromptingTools.Experimental.RAGTools.trigrams_hashed-Tuple{AbstractString}">#</a> <b><u>PromptingTools.Experimental.RAGTools.trigrams_hashed</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">trigrams_hashed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(input_string</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; add_word</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Splits provided <code>input_string</code> into a Set of hashed trigrams (combination of three consecutive characters found in the <code>input_string</code>).</p><p>It is more efficient for lookups in large strings (eg, &gt;100K characters).</p><p>If <code>add_word</code> is provided, it is added to the resulting array to hash. Useful to add the full word itself to the resulting array for exact match.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/utils.jl#L226-L234" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.last_message-Tuple{RAGResult}" href="#PromptingTools.last_message-Tuple{RAGResult}">#</a> <b><u>PromptingTools.last_message</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RAGResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Extract the last message from the RAGResult. It looks for <code>final_answer</code> first, then <code>answer</code> fields in the <code>conversations</code> dictionary. Returns <code>nothing</code> if not found.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/types.jl#L1003-L1007" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.last_output-Tuple{RAGResult}" href="#PromptingTools.last_output-Tuple{RAGResult}">#</a> <b><u>PromptingTools.last_output</u></b> — <i>Method</i>. <p>Extracts the last output (generated text answer) from the RAGResult.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/types.jl#L1020" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.pprint-Tuple{IO, PromptingTools.Experimental.RAGTools.AbstractAnnotatedNode}" href="#PromptingTools.pprint-Tuple{IO, PromptingTools.Experimental.RAGTools.AbstractAnnotatedNode}">#</a> <b><u>PromptingTools.pprint</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PromptingTools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pprint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    io</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, node</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractAnnotatedNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    text_width</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> displaysize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(io)[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], add_newline</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Pretty print the <code>node</code> to the <code>io</code> stream, including all its children</p><p>Supports only <code>node.style::Styler</code> for now.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/annotation.jl#L101-L109" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.pprint-Tuple{IO, PromptingTools.Experimental.RAGTools.AbstractRAGResult}" href="#PromptingTools.pprint-Tuple{IO, PromptingTools.Experimental.RAGTools.AbstractRAGResult}">#</a> <b><u>PromptingTools.pprint</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pprint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    io</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractRAGResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; add_context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    text_width</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> displaysize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(io)[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], annotater_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Pretty print the RAG result <code>r</code> to the given <code>io</code> stream.</p><p>If <code>add_context</code> is <code>true</code>, the context will be printed as well. The <code>text_width</code> parameter can be used to control the width of the output.</p><p>You can provide additional keyword arguments to the annotater, eg, <code>add_sources</code>, <code>add_scores</code>, <code>min_score</code>, etc. See <code>annotate_support</code> for more details.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/f20f3b9fcebd83183f0ae2acb396eb1a9272b14f/src/Experimental/RAGTools/types.jl#L1028-L1038" target="_blank" rel="noreferrer">source</a></p></div><br>', 284)
  ]));
}
const reference_ragtools = /* @__PURE__ */ _export_sfc(_sfc_main, [["render", _sfc_render]]);
export {
  __pageData,
  reference_ragtools as default
};
