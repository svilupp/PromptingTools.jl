<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Reference | PromptingTools.jl</title>
    <meta name="description" content="Streamline Your Interactions with GenAI Models. Discover the power of GenerativeAI and build mini workflows to save you 20 minutes every day.">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/PromptingTools.jl/dev/assets/style.DHDbEIxu.css" as="style">
    <link rel="preload stylesheet" href="/PromptingTools.jl/dev/vp-icons.css" as="style">
    
    <script type="module" src="/PromptingTools.jl/dev/assets/app.CTswmWxY.js"></script>
    <link rel="preload" href="/PromptingTools.jl/dev/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/PromptingTools.jl/dev/assets/chunks/theme.DtQZ0HwI.js">
    <link rel="modulepreload" href="/PromptingTools.jl/dev/assets/chunks/framework.Dzh0eEJd.js">
    <link rel="modulepreload" href="/PromptingTools.jl/dev/assets/reference.md.CR1y9l-Q.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-a9a9e638><!--[--><!--]--><!--[--><span tabindex="-1" data-v-492508fc></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-492508fc>Skip to content</a><!--]--><!----><header class="VPNav" data-v-a9a9e638 data-v-f1e365da><div class="VPNavBar" data-v-f1e365da data-v-822684d1><div class="wrapper" data-v-822684d1><div class="container" data-v-822684d1><div class="title" data-v-822684d1><div class="VPNavBarTitle has-sidebar" data-v-822684d1 data-v-0f4f798b><a class="title" href="/PromptingTools.jl/dev/" data-v-0f4f798b><!--[--><!--]--><!--[--><img class="VPImage logo" src="/PromptingTools.jl/dev/logo.png" width="24" height="24" alt data-v-35a7d0b8><!--]--><span data-v-0f4f798b>PromptingTools.jl</span><!--[--><!--]--></a></div></div><div class="content" data-v-822684d1><div class="content-body" data-v-822684d1><!--[--><!--]--><div class="VPNavBarSearch search" data-v-822684d1><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-822684d1 data-v-e6d46098><span id="main-nav-aria-label" class="visually-hidden" data-v-e6d46098> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/PromptingTools.jl/dev/index" tabindex="0" data-v-e6d46098 data-v-956ec74c><!--[--><span data-v-956ec74c>Home</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Manual</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/getting_started" data-v-acbfed09><!--[--><span data-v-acbfed09>Getting Started</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/how_it_works" data-v-acbfed09><!--[--><span data-v-acbfed09>How It Works</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/coverage_of_model_providers" data-v-acbfed09><!--[--><span data-v-acbfed09>Coverage of Model Providers</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuGroup" data-v-7dd3104a data-v-48c802d0><p class="title" data-v-48c802d0>Examples</p><!--[--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/examples/readme_examples" data-v-acbfed09><!--[--><span data-v-acbfed09>Various examples</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/examples/working_with_aitemplates" data-v-acbfed09><!--[--><span data-v-acbfed09>Using AITemplates</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/examples/working_with_ollama" data-v-acbfed09><!--[--><span data-v-acbfed09>Local models with Ollama.ai</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/examples/working_with_google_ai_studio" data-v-acbfed09><!--[--><span data-v-acbfed09>Google AIStudio</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/examples/working_with_custom_apis" data-v-acbfed09><!--[--><span data-v-acbfed09>Custom APIs (Mistral, Llama.cpp)</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-7dd3104a data-v-48c802d0><p class="title" data-v-48c802d0>Extra Tools</p><!--[--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/extra_tools/text_utilities_intro" data-v-acbfed09><!--[--><span data-v-acbfed09>Text Utilities</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/extra_tools/agent_tools_intro" data-v-acbfed09><!--[--><span data-v-acbfed09>AgentTools</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/extra_tools/rag_tools_intro" data-v-acbfed09><!--[--><span data-v-acbfed09>RAGTools</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/ragtools_migration" data-v-acbfed09><!--[--><span data-v-acbfed09>RAGTools Migration</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-48c802d0 data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/extra_tools/api_tools_intro" data-v-acbfed09><!--[--><span data-v-acbfed09>APITools</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/PromptingTools.jl/dev/frequently_asked_questions" tabindex="0" data-v-e6d46098 data-v-956ec74c><!--[--><span data-v-956ec74c>F.A.Q.</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Prompt Templates</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/prompts/general" data-v-acbfed09><!--[--><span data-v-acbfed09>General</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/prompts/persona-task" data-v-acbfed09><!--[--><span data-v-acbfed09>Persona-Task</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/prompts/visual" data-v-acbfed09><!--[--><span data-v-acbfed09>Visual</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/prompts/classification" data-v-acbfed09><!--[--><span data-v-acbfed09>Classification</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/prompts/extraction" data-v-acbfed09><!--[--><span data-v-acbfed09>Extraction</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/prompts/agents" data-v-acbfed09><!--[--><span data-v-acbfed09>Agents</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/prompts/RAG" data-v-acbfed09><!--[--><span data-v-acbfed09>RAG</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-e6d46098 data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-04f5c5e9><span class="text" data-v-04f5c5e9><!----><span data-v-04f5c5e9>Reference</span><span class="vpi-chevron-down text-icon" data-v-04f5c5e9></span></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><div class="items" data-v-7dd3104a><!--[--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link active" href="/PromptingTools.jl/dev/reference" data-v-acbfed09><!--[--><span data-v-acbfed09>PromptingTools.jl</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/reference_experimental" data-v-acbfed09><!--[--><span data-v-acbfed09>Experimental Modules</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/reference_agenttools" data-v-acbfed09><!--[--><span data-v-acbfed09>AgentTools</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7dd3104a data-v-acbfed09><a class="VPLink link" href="/PromptingTools.jl/dev/reference_apitools" data-v-acbfed09><!--[--><span data-v-acbfed09>APITools</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-822684d1 data-v-af096f4a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-af096f4a data-v-e40a8bb6 data-v-4a1c76db><span class="check" data-v-4a1c76db><span class="icon" data-v-4a1c76db><!--[--><span class="vpi-sun sun" data-v-e40a8bb6></span><span class="vpi-moon moon" data-v-e40a8bb6></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-822684d1 data-v-164c457f data-v-ee7a9424><!--[--><a class="VPSocialLink no-icon" href="https://github.com/svilupp/PromptingTools.jl" aria-label="github" target="_blank" rel="noopener" data-v-ee7a9424 data-v-d26d30cb><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-822684d1 data-v-925effce data-v-04f5c5e9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-04f5c5e9><span class="vpi-more-horizontal icon" data-v-04f5c5e9></span></button><div class="menu" data-v-04f5c5e9><div class="VPMenu" data-v-04f5c5e9 data-v-7dd3104a><!----><!--[--><!--[--><!----><div class="group" data-v-925effce><div class="item appearance" data-v-925effce><p class="label" data-v-925effce>Appearance</p><div class="appearance-action" data-v-925effce><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-925effce data-v-e40a8bb6 data-v-4a1c76db><span class="check" data-v-4a1c76db><span class="icon" data-v-4a1c76db><!--[--><span class="vpi-sun sun" data-v-e40a8bb6></span><span class="vpi-moon moon" data-v-e40a8bb6></span><!--]--></span></span></button></div></div></div><div class="group" data-v-925effce><div class="item social-links" data-v-925effce><div class="VPSocialLinks social-links-list" data-v-925effce data-v-ee7a9424><!--[--><a class="VPSocialLink no-icon" href="https://github.com/svilupp/PromptingTools.jl" aria-label="github" target="_blank" rel="noopener" data-v-ee7a9424 data-v-d26d30cb><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-822684d1 data-v-5dea55bf><span class="container" data-v-5dea55bf><span class="top" data-v-5dea55bf></span><span class="middle" data-v-5dea55bf></span><span class="bottom" data-v-5dea55bf></span></span></button></div></div></div></div><div class="divider" data-v-822684d1><div class="divider-line" data-v-822684d1></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-a9a9e638 data-v-070ab83d><div class="container" data-v-070ab83d><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-070ab83d><span class="vpi-align-left menu-icon" data-v-070ab83d></span><span class="menu-text" data-v-070ab83d>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-070ab83d data-v-168ddf5d><button data-v-168ddf5d>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-a9a9e638 data-v-18756405><div class="curtain" data-v-18756405></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-18756405><span class="visually-hidden" id="sidebar-aria-label" data-v-18756405> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-a4b0d9bf><!----><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/index" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Home</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h2 class="text" data-v-a4b0d9bf>Manual</h2><!----></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/getting_started" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Getting Started</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/how_it_works" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>How It Works</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/coverage_of_model_providers" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Coverage of Model Providers</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 collapsible collapsed" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h3 class="text" data-v-a4b0d9bf>Examples</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-a4b0d9bf><span class="vpi-chevron-right caret-icon" data-v-a4b0d9bf></span></div></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-2 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/examples/readme_examples" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Various examples</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/examples/working_with_aitemplates" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Using AITemplates</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/examples/working_with_ollama" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Local models with Ollama.ai</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/examples/working_with_google_ai_studio" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Google AIStudio</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/examples/working_with_custom_apis" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Custom APIs (Mistral, Llama.cpp)</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h3 class="text" data-v-a4b0d9bf>Extra Tools</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-a4b0d9bf><span class="vpi-chevron-right caret-icon" data-v-a4b0d9bf></span></div></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-2 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/extra_tools/text_utilities_intro" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Text Utilities</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/extra_tools/agent_tools_intro" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>AgentTools</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/extra_tools/api_tools_intro" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>APITools</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0" data-v-9e426adc data-v-a4b0d9bf><!----><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/frequently_asked_questions" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>F.A.Q.</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0 collapsible collapsed" data-v-9e426adc data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h2 class="text" data-v-a4b0d9bf>Prompt Templates</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-a4b0d9bf><span class="vpi-chevron-right caret-icon" data-v-a4b0d9bf></span></div></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/prompts/general" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>General</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/prompts/persona-task" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Persona-Task</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/prompts/visual" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Visual</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/prompts/classification" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Classification</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/prompts/extraction" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Extraction</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/prompts/agents" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Agents</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/prompts/RAG" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>RAG</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0 collapsible collapsed has-active" data-v-9e426adc data-v-a4b0d9bf><div class="item" role="button" tabindex="0" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><h2 class="text" data-v-a4b0d9bf>Reference</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-a4b0d9bf><span class="vpi-chevron-right caret-icon" data-v-a4b0d9bf></span></div></div><div class="items" data-v-a4b0d9bf><!--[--><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/reference" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>PromptingTools.jl</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/reference_experimental" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>Experimental Modules</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/reference_agenttools" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>AgentTools</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-a4b0d9bf data-v-a4b0d9bf><div class="item" data-v-a4b0d9bf><div class="indicator" data-v-a4b0d9bf></div><a class="VPLink link link" href="/PromptingTools.jl/dev/reference_apitools" data-v-a4b0d9bf><!--[--><p class="text" data-v-a4b0d9bf>APITools</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-a9a9e638 data-v-91765379><div class="VPDoc has-sidebar has-aside" data-v-91765379 data-v-83890dd9><!--[--><!--]--><div class="container" data-v-83890dd9><div class="aside" data-v-83890dd9><div class="aside-curtain" data-v-83890dd9></div><div class="aside-container" data-v-83890dd9><div class="aside-content" data-v-83890dd9><div class="VPDocAside" data-v-83890dd9 data-v-6d7b3c46><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-6d7b3c46 data-v-b38bf2ff><div class="content" data-v-b38bf2ff><div class="outline-marker" data-v-b38bf2ff></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-b38bf2ff>On this page</div><ul class="VPDocOutlineItem root" data-v-b38bf2ff data-v-3f927ebe><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-6d7b3c46></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-83890dd9><div class="content-container" data-v-83890dd9><!--[--><!--]--><main class="main" data-v-83890dd9><div style="position:relative;" class="vp-doc _PromptingTools_jl_dev_reference" data-v-83890dd9><div><h1 id="Reference" tabindex="-1">Reference <a class="header-anchor" href="#Reference" aria-label="Permalink to &quot;Reference {#Reference}&quot;">​</a></h1><ul><li><a href="#PromptingTools.CustomRetryLayer"><code>PromptingTools.CustomRetryLayer</code></a></li><li><a href="#PromptingTools.Experimental"><code>PromptingTools.Experimental</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools"><code>PromptingTools.Experimental.AgentTools</code></a></li><li><a href="#PromptingTools.ALLOWED_PREFERENCES"><code>PromptingTools.ALLOWED_PREFERENCES</code></a></li><li><a href="#PromptingTools.ALTERNATIVE_GENERATION_COSTS"><code>PromptingTools.ALTERNATIVE_GENERATION_COSTS</code></a></li><li><a href="#PromptingTools.ANTHROPIC_TOOL_PROMPT"><code>PromptingTools.ANTHROPIC_TOOL_PROMPT</code></a></li><li><a href="#PromptingTools.BETA_HEADERS_ANTHROPIC"><code>PromptingTools.BETA_HEADERS_ANTHROPIC</code></a></li><li><a href="#PromptingTools.CONV_HISTORY"><code>PromptingTools.CONV_HISTORY</code></a></li><li><a href="#PromptingTools.MODEL_ALIASES"><code>PromptingTools.MODEL_ALIASES</code></a></li><li><a href="#PromptingTools.MODEL_REGISTRY"><code>PromptingTools.MODEL_REGISTRY</code></a></li><li><a href="#PromptingTools.OPENAI_TOKEN_IDS_GPT35_GPT4"><code>PromptingTools.OPENAI_TOKEN_IDS_GPT35_GPT4</code></a></li><li><a href="#PromptingTools.PREFERENCES"><code>PromptingTools.PREFERENCES</code></a></li><li><a href="#PromptingTools.RESERVED_KWARGS"><code>PromptingTools.RESERVED_KWARGS</code></a></li><li><a href="#PromptingTools.AICode"><code>PromptingTools.AICode</code></a></li><li><a href="#PromptingTools.AIMessage"><code>PromptingTools.AIMessage</code></a></li><li><a href="#PromptingTools.AITemplate"><code>PromptingTools.AITemplate</code></a></li><li><a href="#PromptingTools.AITemplateMetadata"><code>PromptingTools.AITemplateMetadata</code></a></li><li><a href="#PromptingTools.AIToolRequest"><code>PromptingTools.AIToolRequest</code></a></li><li><a href="#PromptingTools.AbstractAnnotationMessage"><code>PromptingTools.AbstractAnnotationMessage</code></a></li><li><a href="#PromptingTools.AbstractPromptSchema"><code>PromptingTools.AbstractPromptSchema</code></a></li><li><a href="#PromptingTools.AbstractTool"><code>PromptingTools.AbstractTool</code></a></li><li><a href="#PromptingTools.AbstractToolError"><code>PromptingTools.AbstractToolError</code></a></li><li><a href="#PromptingTools.AnnotationMessage"><code>PromptingTools.AnnotationMessage</code></a></li><li><a href="#PromptingTools.AnthropicSchema"><code>PromptingTools.AnthropicSchema</code></a></li><li><a href="#PromptingTools.AzureOpenAISchema"><code>PromptingTools.AzureOpenAISchema</code></a></li><li><a href="#PromptingTools.CerebrasOpenAISchema"><code>PromptingTools.CerebrasOpenAISchema</code></a></li><li><a href="#PromptingTools.ChatMLSchema"><code>PromptingTools.ChatMLSchema</code></a></li><li><a href="#PromptingTools.ConversationMemory"><code>PromptingTools.ConversationMemory</code></a></li><li><a href="#PromptingTools.ConversationMemory-Tuple{AbstractString}"><code>PromptingTools.ConversationMemory</code></a></li><li><a href="#PromptingTools.CustomOpenAISchema"><code>PromptingTools.CustomOpenAISchema</code></a></li><li><a href="#PromptingTools.CustomRetryLayer.CustomRetryConfig"><code>PromptingTools.CustomRetryLayer.CustomRetryConfig</code></a></li><li><a href="#PromptingTools.DataMessage"><code>PromptingTools.DataMessage</code></a></li><li><a href="#PromptingTools.DatabricksOpenAISchema"><code>PromptingTools.DatabricksOpenAISchema</code></a></li><li><a href="#PromptingTools.DeepSeekOpenAISchema"><code>PromptingTools.DeepSeekOpenAISchema</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.AICall"><code>PromptingTools.Experimental.AgentTools.AICall</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.AICodeFixer"><code>PromptingTools.Experimental.AgentTools.AICodeFixer</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.RetryConfig"><code>PromptingTools.Experimental.AgentTools.RetryConfig</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.SampleNode"><code>PromptingTools.Experimental.AgentTools.SampleNode</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.ThompsonSampling"><code>PromptingTools.Experimental.AgentTools.ThompsonSampling</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.UCT"><code>PromptingTools.Experimental.AgentTools.UCT</code></a></li><li><a href="#PromptingTools.FireworksOpenAISchema"><code>PromptingTools.FireworksOpenAISchema</code></a></li><li><a href="#PromptingTools.GoogleOpenAISchema"><code>PromptingTools.GoogleOpenAISchema</code></a></li><li><a href="#PromptingTools.GoogleSchema"><code>PromptingTools.GoogleSchema</code></a></li><li><a href="#PromptingTools.GroqOpenAISchema"><code>PromptingTools.GroqOpenAISchema</code></a></li><li><a href="#PromptingTools.ItemsExtract"><code>PromptingTools.ItemsExtract</code></a></li><li><a href="#PromptingTools.LocalServerOpenAISchema"><code>PromptingTools.LocalServerOpenAISchema</code></a></li><li><a href="#PromptingTools.MaybeExtract"><code>PromptingTools.MaybeExtract</code></a></li><li><a href="#PromptingTools.MiniMaxOpenAISchema"><code>PromptingTools.MiniMaxOpenAISchema</code></a></li><li><a href="#PromptingTools.MistralOpenAISchema"><code>PromptingTools.MistralOpenAISchema</code></a></li><li><a href="#PromptingTools.ModelSpec"><code>PromptingTools.ModelSpec</code></a></li><li><a href="#PromptingTools.MoonshotOpenAISchema"><code>PromptingTools.MoonshotOpenAISchema</code></a></li><li><a href="#PromptingTools.NoSchema"><code>PromptingTools.NoSchema</code></a></li><li><a href="#PromptingTools.OllamaManagedSchema"><code>PromptingTools.OllamaManagedSchema</code></a></li><li><a href="#PromptingTools.OllamaSchema"><code>PromptingTools.OllamaSchema</code></a></li><li><a href="#PromptingTools.OpenAISchema"><code>PromptingTools.OpenAISchema</code></a></li><li><a href="#PromptingTools.OpenRouterOpenAISchema"><code>PromptingTools.OpenRouterOpenAISchema</code></a></li><li><a href="#PromptingTools.SambaNovaOpenAISchema"><code>PromptingTools.SambaNovaOpenAISchema</code></a></li><li><a href="#PromptingTools.SaverSchema"><code>PromptingTools.SaverSchema</code></a></li><li><a href="#PromptingTools.ShareGPTSchema"><code>PromptingTools.ShareGPTSchema</code></a></li><li><a href="#PromptingTools.TestEchoAnthropicSchema"><code>PromptingTools.TestEchoAnthropicSchema</code></a></li><li><a href="#PromptingTools.TestEchoGoogleSchema"><code>PromptingTools.TestEchoGoogleSchema</code></a></li><li><a href="#PromptingTools.TestEchoOllamaManagedSchema"><code>PromptingTools.TestEchoOllamaManagedSchema</code></a></li><li><a href="#PromptingTools.TestEchoOllamaSchema"><code>PromptingTools.TestEchoOllamaSchema</code></a></li><li><a href="#PromptingTools.TestEchoOpenAISchema"><code>PromptingTools.TestEchoOpenAISchema</code></a></li><li><a href="#PromptingTools.TogetherOpenAISchema"><code>PromptingTools.TogetherOpenAISchema</code></a></li><li><a href="#PromptingTools.Tool"><code>PromptingTools.Tool</code></a></li><li><a href="#PromptingTools.Tool-Tuple{Union{Function, Method, Type}}"><code>PromptingTools.Tool</code></a></li><li><a href="#PromptingTools.ToolExecutionError"><code>PromptingTools.ToolExecutionError</code></a></li><li><a href="#PromptingTools.ToolGenericError"><code>PromptingTools.ToolGenericError</code></a></li><li><a href="#PromptingTools.ToolMessage"><code>PromptingTools.ToolMessage</code></a></li><li><a href="#PromptingTools.ToolNotFoundError"><code>PromptingTools.ToolNotFoundError</code></a></li><li><a href="#PromptingTools.ToolRef"><code>PromptingTools.ToolRef</code></a></li><li><a href="#PromptingTools.TracerMessage"><code>PromptingTools.TracerMessage</code></a></li><li><a href="#PromptingTools.TracerMessageLike"><code>PromptingTools.TracerMessageLike</code></a></li><li><a href="#PromptingTools.TracerSchema"><code>PromptingTools.TracerSchema</code></a></li><li><a href="#PromptingTools.UserMessage"><code>PromptingTools.UserMessage</code></a></li><li><a href="#PromptingTools.UserMessageWithImages-Tuple{AbstractString}"><code>PromptingTools.UserMessageWithImages</code></a></li><li><a href="#PromptingTools.UserMessageWithImages"><code>PromptingTools.UserMessageWithImages</code></a></li><li><a href="#PromptingTools.X123"><code>PromptingTools.X123</code></a></li><li><a href="#PromptingTools.XAIOpenAISchema"><code>PromptingTools.XAIOpenAISchema</code></a></li><li><a href="#Base.append!-Tuple{ConversationMemory, Vector{&lt;:PromptingTools.AbstractMessage}}"><code>Base.append!</code></a></li><li><a href="#Base.length-Tuple{ConversationMemory}"><code>Base.length</code></a></li><li><a href="#Base.push!-Tuple{ConversationMemory, PromptingTools.AbstractMessage}"><code>Base.push!</code></a></li><li><a href="#Base.show-Tuple{IO, ConversationMemory}"><code>Base.show</code></a></li><li><a href="#OpenAI.create_chat-Tuple{PromptingTools.LocalServerOpenAISchema, AbstractString, AbstractString, Any}"><code>OpenAI.create_chat</code></a></li><li><a href="#OpenAI.create_chat-Tuple{PromptingTools.MistralOpenAISchema, AbstractString, AbstractString, Any}"><code>OpenAI.create_chat</code></a></li><li><a href="#OpenAI.create_chat-Tuple{PromptingTools.CustomOpenAISchema, AbstractString, AbstractString, Any}"><code>OpenAI.create_chat</code></a></li><li><a href="#PromptingTools.CustomRetryLayer.custom_retry_layer-Tuple{Any}"><code>PromptingTools.CustomRetryLayer.custom_retry_layer</code></a></li><li><a href="#PromptingTools.CustomRetryLayer.enable_retry!"><code>PromptingTools.CustomRetryLayer.enable_retry!</code></a></li><li><a href="#PromptingTools.CustomRetryLayer.extract_retry_after-Tuple{Dict{String, String}}"><code>PromptingTools.CustomRetryLayer.extract_retry_after</code></a></li><li><a href="#PromptingTools.CustomRetryLayer.is_paused-Tuple{}"><code>PromptingTools.CustomRetryLayer.is_paused</code></a></li><li><a href="#PromptingTools.CustomRetryLayer.parse_time_string-Tuple{AbstractString}"><code>PromptingTools.CustomRetryLayer.parse_time_string</code></a></li><li><a href="#PromptingTools.CustomRetryLayer.pause_requests-Tuple{Float64}"><code>PromptingTools.CustomRetryLayer.pause_requests</code></a></li><li><a href="#PromptingTools.Experimental.APITools.create_websearch-Tuple{AbstractString}"><code>PromptingTools.Experimental.APITools.create_websearch</code></a></li><li><a href="#PromptingTools.Experimental.APITools.tavily_api-Tuple{}"><code>PromptingTools.Experimental.APITools.tavily_api</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.AIClassify-Tuple"><code>PromptingTools.Experimental.AgentTools.AIClassify</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.AIEmbed-Tuple"><code>PromptingTools.Experimental.AgentTools.AIEmbed</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.AIExtract-Tuple"><code>PromptingTools.Experimental.AgentTools.AIExtract</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.AIGenerate-Tuple"><code>PromptingTools.Experimental.AgentTools.AIGenerate</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.AIScan-Tuple"><code>PromptingTools.Experimental.AgentTools.AIScan</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.add_feedback!-Tuple{AbstractVector{&lt;:PromptingTools.AbstractMessage}, PromptingTools.Experimental.AgentTools.SampleNode}"><code>PromptingTools.Experimental.AgentTools.add_feedback!</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.aicodefixer_feedback-Tuple{AICode}"><code>PromptingTools.Experimental.AgentTools.aicodefixer_feedback</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.airetry!"><code>PromptingTools.Experimental.AgentTools.airetry!</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.backpropagate!-Tuple{PromptingTools.Experimental.AgentTools.SampleNode}"><code>PromptingTools.Experimental.AgentTools.backpropagate!</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.beta_sample-Tuple{Real, Real}"><code>PromptingTools.Experimental.AgentTools.beta_sample</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.collect_all_feedback-Tuple{PromptingTools.Experimental.AgentTools.SampleNode}"><code>PromptingTools.Experimental.AgentTools.collect_all_feedback</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.error_feedback-Tuple{Any}"><code>PromptingTools.Experimental.AgentTools.error_feedback</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.evaluate_condition!"><code>PromptingTools.Experimental.AgentTools.evaluate_condition!</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.expand!-Tuple{PromptingTools.Experimental.AgentTools.SampleNode, Any}"><code>PromptingTools.Experimental.AgentTools.expand!</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.extract_config-Union{Tuple{T}, Tuple{Any, T}} where T"><code>PromptingTools.Experimental.AgentTools.extract_config</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.find_node-Tuple{PromptingTools.Experimental.AgentTools.SampleNode, Integer}"><code>PromptingTools.Experimental.AgentTools.find_node</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.gamma_sample-Tuple{Real, Real}"><code>PromptingTools.Experimental.AgentTools.gamma_sample</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.print_samples-Tuple{PromptingTools.Experimental.AgentTools.SampleNode}"><code>PromptingTools.Experimental.AgentTools.print_samples</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.remove_used_kwargs-Tuple{NamedTuple, AbstractVector{&lt;:PromptingTools.AbstractMessage}}"><code>PromptingTools.Experimental.AgentTools.remove_used_kwargs</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.reset_success!"><code>PromptingTools.Experimental.AgentTools.reset_success!</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.run!-Tuple{AICodeFixer}"><code>PromptingTools.Experimental.AgentTools.run!</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.run!-Tuple{PromptingTools.Experimental.AgentTools.AICallBlock}"><code>PromptingTools.Experimental.AgentTools.run!</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.score-Tuple{PromptingTools.Experimental.AgentTools.SampleNode, PromptingTools.Experimental.AgentTools.ThompsonSampling}"><code>PromptingTools.Experimental.AgentTools.score</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.score-Tuple{PromptingTools.Experimental.AgentTools.SampleNode, PromptingTools.Experimental.AgentTools.UCT}"><code>PromptingTools.Experimental.AgentTools.score</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.select_best"><code>PromptingTools.Experimental.AgentTools.select_best</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.split_multi_samples-Tuple{Any}"><code>PromptingTools.Experimental.AgentTools.split_multi_samples</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.truncate_conversation-Tuple{AbstractVector{&lt;:PromptingTools.AbstractMessage}}"><code>PromptingTools.Experimental.AgentTools.truncate_conversation</code></a></li><li><a href="#PromptingTools.Experimental.AgentTools.unwrap_aicall_args-Tuple{Any}"><code>PromptingTools.Experimental.AgentTools.unwrap_aicall_args</code></a></li><li><a href="#PromptingTools.aiclassify-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aiclassify</code></a></li><li><a href="#PromptingTools.aiclassify-Union{Tuple{T}, Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}} where T&lt;:Union{AbstractString, Tuple{var&quot;#s16&quot;, var&quot;#s15&quot;} where {var&quot;#s16&quot;&lt;:AbstractString, var&quot;#s15&quot;&lt;:AbstractString}}"><code>PromptingTools.aiclassify</code></a></li><li><a href="#PromptingTools.aiembed-Union{Tuple{F}, Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, AbstractVector{&lt;:AbstractString}}}, Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, AbstractVector{&lt;:AbstractString}}, F}} where F&lt;:Function"><code>PromptingTools.aiembed</code></a></li><li><a href="#PromptingTools.aiembed-Union{Tuple{F}, Tuple{PromptingTools.AbstractOllamaManagedSchema, AbstractString}, Tuple{PromptingTools.AbstractOllamaManagedSchema, AbstractString, F}} where F&lt;:Function"><code>PromptingTools.aiembed</code></a></li><li><a href="#PromptingTools.aiembed"><code>PromptingTools.aiembed</code></a></li><li><a href="#PromptingTools.aiextract-Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aiextract</code></a></li><li><a href="#PromptingTools.aiextract-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aiextract</code></a></li><li><a href="#PromptingTools.aiextract-Tuple{PromptingTools.AbstractAnthropicSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aiextract</code></a></li><li><a href="#PromptingTools.aigenerate-Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aigenerate</code></a></li><li><a href="#PromptingTools.aigenerate-Tuple{PromptingTools.AbstractGoogleSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aigenerate</code></a></li><li><a href="#PromptingTools.aigenerate-Tuple{PromptingTools.AbstractOllamaManagedSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aigenerate</code></a></li><li><a href="#PromptingTools.aigenerate-Tuple{PromptingTools.AbstractAnthropicSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aigenerate</code></a></li><li><a href="#PromptingTools.aigenerate-Tuple{PromptingTools.AbstractPromptSchema, ConversationMemory}"><code>PromptingTools.aigenerate</code></a></li><li><a href="#PromptingTools.aigenerate-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aigenerate</code></a></li><li><a href="#PromptingTools.aigenerate-Tuple{PromptingTools.AbstractOllamaSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aigenerate</code></a></li><li><a href="#PromptingTools.aiimage-Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aiimage</code></a></li><li><a href="#PromptingTools.aiimage-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aiimage</code></a></li><li><a href="#PromptingTools.aiscan-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aiscan</code></a></li><li><a href="#PromptingTools.aiscan-Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aiscan</code></a></li><li><a href="#PromptingTools.aiscan-Tuple{PromptingTools.AbstractOllamaSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aiscan</code></a></li><li><a href="#PromptingTools.aitemplates-Tuple{Symbol}"><code>PromptingTools.aitemplates</code></a></li><li><a href="#PromptingTools.aitemplates"><code>PromptingTools.aitemplates</code></a></li><li><a href="#PromptingTools.aitemplates-Tuple{Regex}"><code>PromptingTools.aitemplates</code></a></li><li><a href="#PromptingTools.aitemplates-Tuple{AbstractString}"><code>PromptingTools.aitemplates</code></a></li><li><a href="#PromptingTools.aitools-Tuple{PromptingTools.AbstractAnthropicSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aitools</code></a></li><li><a href="#PromptingTools.aitools-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aitools</code></a></li><li><a href="#PromptingTools.aitools-Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.aitools</code></a></li><li><a href="#PromptingTools.align_tracer!-Tuple{Union{PromptingTools.AbstractTracer, PromptingTools.AbstractTracerMessage}}"><code>PromptingTools.align_tracer!</code></a></li><li><a href="#PromptingTools.align_tracer!-Tuple{AbstractVector{&lt;:Union{PromptingTools.AbstractTracer, PromptingTools.AbstractTracerMessage}}}"><code>PromptingTools.align_tracer!</code></a></li><li><a href="#PromptingTools.annotate!-Union{Tuple{T}, Tuple{AbstractVector{T}, AbstractString}} where T&lt;:PromptingTools.AbstractMessage"><code>PromptingTools.annotate!</code></a></li><li><a href="#PromptingTools.anthropic_api"><code>PromptingTools.anthropic_api</code></a></li><li><a href="#PromptingTools.anthropic_extra_headers-Tuple{}"><code>PromptingTools.anthropic_extra_headers</code></a></li><li><a href="#PromptingTools.auth_header-Tuple{Union{Nothing, AbstractString}}"><code>PromptingTools.auth_header</code></a></li><li><a href="#PromptingTools.batch_start_index-Tuple{Integer, Integer, Integer}"><code>PromptingTools.batch_start_index</code></a></li><li><a href="#PromptingTools.build_template_metadata"><code>PromptingTools.build_template_metadata</code></a></li><li><a href="#PromptingTools.call_cost-Tuple{Int64, Int64, String}"><code>PromptingTools.call_cost</code></a></li><li><a href="#PromptingTools.call_cost_alternative-Tuple{Any, Any}"><code>PromptingTools.call_cost_alternative</code></a></li><li><a href="#PromptingTools.configure_callback!-Union{Tuple{T}, Tuple{T, PromptingTools.AbstractPromptSchema}} where T&lt;:StreamCallbacks.AbstractStreamCallback"><code>PromptingTools.configure_callback!</code></a></li><li><a href="#PromptingTools.create_template-Tuple{AbstractString, AbstractString}"><code>PromptingTools.create_template</code></a></li><li><a href="#PromptingTools.decode_choices-Tuple{PromptingTools.OpenAISchema, AbstractVector{&lt;:AbstractString}, AIMessage}"><code>PromptingTools.decode_choices</code></a></li><li><a href="#PromptingTools.detect_base_main_overrides-Tuple{AbstractString}"><code>PromptingTools.detect_base_main_overrides</code></a></li><li><a href="#PromptingTools.distance_longest_common_subsequence-Tuple{AbstractString, AbstractString}"><code>PromptingTools.distance_longest_common_subsequence</code></a></li><li><a href="#PromptingTools.encode_choices-Tuple{PromptingTools.OpenAISchema, AbstractVector{&lt;:AbstractString}}"><code>PromptingTools.encode_choices</code></a></li><li><a href="#PromptingTools.ensure_http_prefix-Tuple{AbstractString}"><code>PromptingTools.ensure_http_prefix</code></a></li><li><a href="#PromptingTools.eval!-Tuple{PromptingTools.AbstractCodeBlock}"><code>PromptingTools.eval!</code></a></li><li><a href="#PromptingTools.execute_tool"><code>PromptingTools.execute_tool</code></a></li><li><a href="#PromptingTools.extract_code_blocks-Tuple{T} where T&lt;:AbstractString"><code>PromptingTools.extract_code_blocks</code></a></li><li><a href="#PromptingTools.extract_code_blocks_fallback-Union{Tuple{T}, Tuple{T, AbstractString}} where T&lt;:AbstractString"><code>PromptingTools.extract_code_blocks_fallback</code></a></li><li><a href="#PromptingTools.extract_docstring-Tuple{Union{Function, Type}}"><code>PromptingTools.extract_docstring</code></a></li><li><a href="#PromptingTools.extract_function_name-Tuple{AbstractString}"><code>PromptingTools.extract_function_name</code></a></li><li><a href="#PromptingTools.extract_function_names-Tuple{AbstractString}"><code>PromptingTools.extract_function_names</code></a></li><li><a href="#PromptingTools.extract_image_attributes-Tuple{AbstractString}"><code>PromptingTools.extract_image_attributes</code></a></li><li><a href="#PromptingTools.extract_julia_imports-Tuple{AbstractString}"><code>PromptingTools.extract_julia_imports</code></a></li><li><a href="#PromptingTools.finalize_outputs-Tuple{Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}, Any, Union{Nothing, PromptingTools.AbstractMessage, AbstractVector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.finalize_outputs</code></a></li><li><a href="#PromptingTools.finalize_tracer-Tuple{PromptingTools.SaverSchema, Any, Union{PromptingTools.AbstractMessage, AbstractVector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.finalize_tracer</code></a></li><li><a href="#PromptingTools.finalize_tracer-Tuple{PromptingTools.AbstractTracerSchema, Any, Union{PromptingTools.AbstractMessage, AbstractVector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.finalize_tracer</code></a></li><li><a href="#PromptingTools.find_subsequence_positions-Tuple{Any, Any}"><code>PromptingTools.find_subsequence_positions</code></a></li><li><a href="#PromptingTools.generate_struct-Tuple{Vector}"><code>PromptingTools.generate_struct</code></a></li><li><a href="#PromptingTools.get_arg_names-Tuple{Method}"><code>PromptingTools.get_arg_names</code></a></li><li><a href="#PromptingTools.get_arg_names-Tuple{Function}"><code>PromptingTools.get_arg_names</code></a></li><li><a href="#PromptingTools.get_arg_types-Tuple{Method}"><code>PromptingTools.get_arg_types</code></a></li><li><a href="#PromptingTools.get_arg_types-Tuple{Function}"><code>PromptingTools.get_arg_types</code></a></li><li><a href="#PromptingTools.get_last"><code>PromptingTools.get_last</code></a></li><li><a href="#PromptingTools.get_preferences-Tuple{String}"><code>PromptingTools.get_preferences</code></a></li><li><a href="#PromptingTools.ggi_generate_content"><code>PromptingTools.ggi_generate_content</code></a></li><li><a href="#PromptingTools.has_julia_prompt-Tuple{T} where T&lt;:AbstractString"><code>PromptingTools.has_julia_prompt</code></a></li><li><a href="#PromptingTools.initialize_tracer-Tuple{PromptingTools.AbstractTracerSchema}"><code>PromptingTools.initialize_tracer</code></a></li><li><a href="#PromptingTools.is_concrete_type-Tuple{Type}"><code>PromptingTools.is_concrete_type</code></a></li><li><a href="#PromptingTools.isextracted-Tuple{Any}"><code>PromptingTools.isextracted</code></a></li><li><a href="#PromptingTools.last_message-Tuple{AbstractVector{&lt;:PromptingTools.AbstractMessage}}"><code>PromptingTools.last_message</code></a></li><li><a href="#PromptingTools.last_message-Tuple{PromptingTools.Experimental.AgentTools.AICallBlock}"><code>PromptingTools.last_message</code></a></li><li><a href="#PromptingTools.last_message-Tuple{ConversationMemory}"><code>PromptingTools.last_message</code></a></li><li><a href="#PromptingTools.last_output-Tuple{PromptingTools.Experimental.AgentTools.AICallBlock}"><code>PromptingTools.last_output</code></a></li><li><a href="#PromptingTools.last_output-Tuple{AbstractVector{&lt;:PromptingTools.AbstractMessage}}"><code>PromptingTools.last_output</code></a></li><li><a href="#PromptingTools.last_output-Tuple{ConversationMemory}"><code>PromptingTools.last_output</code></a></li><li><a href="#PromptingTools.length_longest_common_subsequence-Tuple{AbstractString, AbstractString}"><code>PromptingTools.length_longest_common_subsequence</code></a></li><li><a href="#PromptingTools.list_aliases-Tuple{}"><code>PromptingTools.list_aliases</code></a></li><li><a href="#PromptingTools.list_registry-Tuple{}"><code>PromptingTools.list_registry</code></a></li><li><a href="#PromptingTools.load_api_keys!-Tuple{}"><code>PromptingTools.load_api_keys!</code></a></li><li><a href="#PromptingTools.load_conversation-Tuple{Union{AbstractString, IO}}"><code>PromptingTools.load_conversation</code></a></li><li><a href="#PromptingTools.load_template-Tuple{Union{AbstractString, IO}}"><code>PromptingTools.load_template</code></a></li><li><a href="#PromptingTools.load_templates!"><code>PromptingTools.load_templates!</code></a></li><li><a href="#PromptingTools.meta-Tuple{Union{PromptingTools.AbstractTracer, PromptingTools.AbstractTracerMessage}}"><code>PromptingTools.meta</code></a></li><li><a href="#PromptingTools.ollama_api"><code>PromptingTools.ollama_api</code></a></li><li><a href="#PromptingTools.parse_tool-Tuple{Type, AbstractString}"><code>PromptingTools.parse_tool</code></a></li><li><a href="#PromptingTools.pprint"><code>PromptingTools.pprint</code></a></li><li><a href="#PromptingTools.pprint-Tuple{IO, PromptingTools.AbstractMessage}"><code>PromptingTools.pprint</code></a></li><li><a href="#PromptingTools.pprint-Tuple{IO, AbstractVector{&lt;:PromptingTools.AbstractMessage}}"><code>PromptingTools.pprint</code></a></li><li><a href="#PromptingTools.preview"><code>PromptingTools.preview</code></a></li><li><a href="#PromptingTools.process_google_config-Tuple{Any, Any, Any}"><code>PromptingTools.process_google_config</code></a></li><li><a href="#PromptingTools.push_conversation!-Tuple{Vector{&lt;:Vector}, AbstractVector, Union{Nothing, Int64}}"><code>PromptingTools.push_conversation!</code></a></li><li><a href="#PromptingTools.recursive_splitter-Tuple{AbstractString, Vector{String}}"><code>PromptingTools.recursive_splitter</code></a></li><li><a href="#PromptingTools.recursive_splitter-Tuple{String}"><code>PromptingTools.recursive_splitter</code></a></li><li><a href="#PromptingTools.register_model!"><code>PromptingTools.register_model!</code></a></li><li><a href="#PromptingTools.remove_field!-Tuple{AbstractDict, AbstractString}"><code>PromptingTools.remove_field!</code></a></li><li><a href="#PromptingTools.remove_julia_prompt-Tuple{T} where T&lt;:AbstractString"><code>PromptingTools.remove_julia_prompt</code></a></li><li><a href="#PromptingTools.remove_templates!-Tuple{}"><code>PromptingTools.remove_templates!</code></a></li><li><a href="#PromptingTools.remove_unsafe_lines-Tuple{AbstractString}"><code>PromptingTools.remove_unsafe_lines</code></a></li><li><a href="#PromptingTools.render-Tuple{PromptingTools.AbstractAnthropicSchema, Vector{&lt;:PromptingTools.AbstractMessage}}"><code>PromptingTools.render</code></a></li><li><a href="#PromptingTools.render-Tuple{PromptingTools.AbstractTracerSchema, AbstractVector{&lt;:PromptingTools.AbstractMessage}}"><code>PromptingTools.render</code></a></li><li><a href="#PromptingTools.render-Tuple{PromptingTools.AbstractGoogleSchema, Vector{&lt;:PromptingTools.AbstractMessage}}"><code>PromptingTools.render</code></a></li><li><a href="#PromptingTools.render-Tuple{PromptingTools.AbstractOpenAISchema, Vector{&lt;:PromptingTools.AbstractTool}}"><code>PromptingTools.render</code></a></li><li><a href="#PromptingTools.render-Tuple{PromptingTools.AbstractAnthropicSchema, Vector{&lt;:PromptingTools.AbstractTool}}"><code>PromptingTools.render</code></a></li><li><a href="#PromptingTools.render-Tuple{PromptingTools.AbstractOllamaSchema, Vector{&lt;:PromptingTools.AbstractMessage}}"><code>PromptingTools.render</code></a></li><li><a href="#PromptingTools.render-Tuple{PromptingTools.AbstractOllamaManagedSchema, Vector{&lt;:PromptingTools.AbstractMessage}}"><code>PromptingTools.render</code></a></li><li><a href="#PromptingTools.render-Tuple{PromptingTools.AbstractOpenAISchema, Vector{&lt;:PromptingTools.AbstractMessage}}"><code>PromptingTools.render</code></a></li><li><a href="#PromptingTools.render-Tuple{AITemplate}"><code>PromptingTools.render</code></a></li><li><a href="#PromptingTools.render-Tuple{PromptingTools.NoSchema, Vector{&lt;:PromptingTools.AbstractMessage}}"><code>PromptingTools.render</code></a></li><li><a href="#PromptingTools.render-Tuple{PromptingTools.AbstractAnthropicSchema, PromptingTools.ToolRef}"><code>PromptingTools.render</code></a></li><li><a href="#PromptingTools.replace_words-Tuple{AbstractString, Vector{&lt;:AbstractString}}"><code>PromptingTools.replace_words</code></a></li><li><a href="#PromptingTools.resize_conversation!-Tuple{Any, Union{Nothing, Int64}}"><code>PromptingTools.resize_conversation!</code></a></li><li><a href="#PromptingTools.response_to_message-Tuple{PromptingTools.AbstractOpenAISchema, Type{AIMessage}, Any, Any}"><code>PromptingTools.response_to_message</code></a></li><li><a href="#PromptingTools.response_to_message-Union{Tuple{T}, Tuple{PromptingTools.AbstractPromptSchema, Type{T}, Any, Any}} where T"><code>PromptingTools.response_to_message</code></a></li><li><a href="#PromptingTools.save_conversation-Tuple{Union{AbstractString, IO}, AbstractVector{&lt;:PromptingTools.AbstractMessage}}"><code>PromptingTools.save_conversation</code></a></li><li><a href="#PromptingTools.save_conversations-Tuple{PromptingTools.AbstractPromptSchema, AbstractString, Vector{&lt;:AbstractVector{&lt;:PromptingTools.AbstractMessage}}}"><code>PromptingTools.save_conversations</code></a></li><li><a href="#PromptingTools.save_template-Tuple{Union{AbstractString, IO}, AbstractVector{&lt;:PromptingTools.AbstractChatMessage}}"><code>PromptingTools.save_template</code></a></li><li><a href="#PromptingTools.set_preferences!-Tuple{Vararg{Pair{String}}}"><code>PromptingTools.set_preferences!</code></a></li><li><a href="#PromptingTools.set_properties_strict!-Tuple{AbstractDict}"><code>PromptingTools.set_properties_strict!</code></a></li><li><a href="#PromptingTools.tool_call_signature-Tuple{Union{Method, Type}}"><code>PromptingTools.tool_call_signature</code></a></li><li><a href="#PromptingTools.tool_call_signature-Tuple{Vector}"><code>PromptingTools.tool_call_signature</code></a></li><li><a href="#PromptingTools.tool_calls-Tuple{PromptingTools.AIToolRequest}"><code>PromptingTools.tool_calls</code></a></li><li><a href="#PromptingTools.unique_permutation-Tuple{AbstractVector}"><code>PromptingTools.unique_permutation</code></a></li><li><a href="#PromptingTools.unwrap-Tuple{Union{PromptingTools.AbstractTracer, PromptingTools.AbstractTracerMessage}}"><code>PromptingTools.unwrap</code></a></li><li><a href="#PromptingTools.update_field_descriptions!-Tuple{Dict{String}, Dict{Symbol, &lt;:AbstractString}}"><code>PromptingTools.update_field_descriptions!</code></a></li><li><a href="#PromptingTools.wrap_string"><code>PromptingTools.wrap_string</code></a></li><li><a href="#PromptingTools.@aai_str-Tuple{Any, Vararg{Any}}"><code>PromptingTools.@aai_str</code></a></li><li><a href="#PromptingTools.@ai!_str-Tuple{Any, Vararg{Any}}"><code>PromptingTools.@ai!_str</code></a></li><li><a href="#PromptingTools.@ai_str-Tuple{Any, Vararg{Any}}"><code>PromptingTools.@ai_str</code></a></li><li><a href="#PromptingTools.@timeout-Tuple{Any, Any, Any}"><code>PromptingTools.@timeout</code></a></li></ul><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.ALLOWED_PREFERENCES" href="#PromptingTools.ALLOWED_PREFERENCES">#</a> <b><u>PromptingTools.ALLOWED_PREFERENCES</u></b> — <i>Constant</i>. <p>Keys that are allowed to be set via <code>set_preferences!</code></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/user_preferences.jl#L76" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.ALTERNATIVE_GENERATION_COSTS" href="#PromptingTools.ALTERNATIVE_GENERATION_COSTS">#</a> <b><u>PromptingTools.ALTERNATIVE_GENERATION_COSTS</u></b> — <i>Constant</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ALTERNATIVE_GENERATION_COSTS</span></span></code></pre></div><p>Tracker of alternative costing models, eg, for image generation (<code>dall-e-3</code>), the cost is driven by quality/size.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/user_preferences.jl#L1401-L1405" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.ANTHROPIC_TOOL_PROMPT" href="#PromptingTools.ANTHROPIC_TOOL_PROMPT">#</a> <b><u>PromptingTools.ANTHROPIC_TOOL_PROMPT</u></b> — <i>Constant</i>. <p>Simple template to add to the System Message when doing data extraction with Anthropic models.</p><p>It has 2 placeholders: <code>tool_name</code>, <code>tool_description</code> and <code>tool_parameters</code> that are filled with the tool&#39;s name, description and parameters. Source: <a href="https://docs.anthropic.com/claude/docs/functions-external-tools" target="_blank" rel="noreferrer">https://docs.anthropic.com/claude/docs/functions-external-tools</a></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L706-L711" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.BETA_HEADERS_ANTHROPIC" href="#PromptingTools.BETA_HEADERS_ANTHROPIC">#</a> <b><u>PromptingTools.BETA_HEADERS_ANTHROPIC</u></b> — <i>Constant</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BETA_HEADERS_ANTHROPIC</span></span></code></pre></div><p>A vector of symbols representing the beta features to be used.</p><p>Allowed:</p><ul><li><p><code>:tools</code>: Enables tools in the conversation.</p></li><li><p><code>:cache</code>: Enables prompt caching.</p></li><li><p><code>:long_output</code>: Enables long outputs (up to 8K tokens) with Anthropic&#39;s Sonnet 3.5.</p></li><li><p><code>:computer_use</code>: Enables the use of the computer tool.</p></li><li><p><code>:extended_output</code>: Enables extended output up to 128K tokens with Claude 3.7 Sonnet.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_anthropic.jl#L212-L223" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.CONV_HISTORY" href="#PromptingTools.CONV_HISTORY">#</a> <b><u>PromptingTools.CONV_HISTORY</u></b> — <i>Constant</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CONV_HISTORY</span></span></code></pre></div><p>Tracks the most recent conversations through the <code>ai_str macros</code>.</p><p>Preference available: MAX_HISTORY_LENGTH, which sets how many last messages should be remembered.</p><p>See also: <code>push_conversation!</code>, <code>resize_conversation!</code></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/user_preferences.jl#L271-L280" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.MODEL_ALIASES" href="#PromptingTools.MODEL_ALIASES">#</a> <b><u>PromptingTools.MODEL_ALIASES</u></b> — <i>Constant</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MODEL_ALIASES</span></span></code></pre></div><p>A dictionary of model aliases. Aliases are used to refer to models by their aliases instead of their full names to make it more convenient to use them.</p><p><strong>Accessing the aliases</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>PromptingTools.MODEL_ALIASES[&quot;gpt3&quot;]</span></span></code></pre></div><p><strong>Register a new model alias</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PromptingTools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MODEL_ALIASES[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gpt-3.5-turbo&quot;</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/user_preferences.jl#L1500-L1514" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.MODEL_REGISTRY" href="#PromptingTools.MODEL_REGISTRY">#</a> <b><u>PromptingTools.MODEL_REGISTRY</u></b> — <i>Constant</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MODEL_REGISTRY</span></span></code></pre></div><p>A store of available model names and their specs (ie, name, costs per token, etc.)</p><p><strong>Accessing the registry</strong></p><p>You can use both the alias name or the full name to access the model spec:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>PromptingTools.MODEL_REGISTRY[&quot;gpt-3.5-turbo&quot;]</span></span></code></pre></div><p><strong>Registering a new model</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">register_model!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gpt-3.5-turbo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_of_token_prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0015</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_of_token_generation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.002</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    description </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;GPT-3.5 Turbo is a 175B parameter model and a common default on the OpenAI API.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>Registering a model alias</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PromptingTools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MODEL_ALIASES[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gpt-3.5-turbo&quot;</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/user_preferences.jl#L1430-L1457" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.OPENAI_TOKEN_IDS_GPT35_GPT4" href="#PromptingTools.OPENAI_TOKEN_IDS_GPT35_GPT4">#</a> <b><u>PromptingTools.OPENAI_TOKEN_IDS_GPT35_GPT4</u></b> — <i>Constant</i>. <p>Token IDs for GPT3.5 and GPT4 from <a href="https://platform.openai.com/tokenizer" target="_blank" rel="noreferrer">https://platform.openai.com/tokenizer</a></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_openai.jl#L481" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.PREFERENCES" href="#PromptingTools.PREFERENCES">#</a> <b><u>PromptingTools.PREFERENCES</u></b> — <i>Constant</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PREFERENCES</span></span></code></pre></div><p>You can set preferences for PromptingTools by setting environment variables or by using the <code>set_preferences!</code>. It will create a <code>LocalPreferences.toml</code> file in your current directory and will reload your prefences from there.</p><p>Check your preferences by calling <code>get_preferences(key::String)</code>.</p><p><strong>Available Preferences (for <code>set_preferences!</code>)</strong></p><ul><li><p><code>OPENAI_API_KEY</code>: The API key for the OpenAI API. See <a href="https://platform.openai.com/docs/quickstart?context=python" target="_blank" rel="noreferrer">OpenAI&#39;s documentation</a> for more information.</p></li><li><p><code>AZURE_OPENAI_API_KEY</code>: The API key for the Azure OpenAI API. See <a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/reference" target="_blank" rel="noreferrer">Azure OpenAI&#39;s documentation</a> for more information.</p></li><li><p><code>AZURE_OPENAI_HOST</code>: The host for the Azure OpenAI API. See <a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/reference" target="_blank" rel="noreferrer">Azure OpenAI&#39;s documentation</a> for more information.</p></li><li><p><code>MISTRAL_API_KEY</code>: The API key for the Mistral AI API. See <a href="https://docs.mistral.ai/" target="_blank" rel="noreferrer">Mistral AI&#39;s documentation</a> for more information.</p></li><li><p><code>COHERE_API_KEY</code>: The API key for the Cohere API. See <a href="https://docs.cohere.com/docs/the-cohere-platform" target="_blank" rel="noreferrer">Cohere&#39;s documentation</a> for more information.</p></li><li><p><code>DATABRICKS_API_KEY</code>: The API key for the Databricks Foundation Model API. See <a href="https://docs.databricks.com/en/machine-learning/foundation-models/api-reference.html" target="_blank" rel="noreferrer">Databricks&#39; documentation</a> for more information.</p></li><li><p><code>DATABRICKS_HOST</code>: The host for the Databricks API. See <a href="https://docs.databricks.com/en/machine-learning/foundation-models/api-reference.html" target="_blank" rel="noreferrer">Databricks&#39; documentation</a> for more information.</p></li><li><p><code>TAVILY_API_KEY</code>: The API key for the Tavily Search API. Register <a href="https://tavily.com/" target="_blank" rel="noreferrer">here</a>. See more information <a href="https://docs.tavily.com/docs/tavily-api/rest_api" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>GOOGLE_API_KEY</code>: The API key for Google Gemini models. Get yours from <a href="https://ai.google.dev/" target="_blank" rel="noreferrer">here</a>. If you see a documentation page (&quot;Available languages and regions for Google AI Studio and Gemini API&quot;), it means that it&#39;s not yet available in your region.</p></li><li><p><code>ANTHROPIC_API_KEY</code>: The API key for the Anthropic API. Get yours from <a href="https://www.anthropic.com/" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>VOYAGE_API_KEY</code>: The API key for the Voyage API. Free tier is upto 50M tokens! Get yours from <a href="https://dash.voyageai.com/api-keys" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>GROQ_API_KEY</code>: The API key for the Groq API. Free in beta! Get yours from <a href="https://console.groq.com/keys" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>DEEPSEEK_API_KEY</code>: The API key for the DeepSeek API. Get 5 credit when you join. Get yours from <a href="https://platform.deepseek.com/api_keys" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>OPENROUTER_API_KEY</code>: The API key for the OpenRouter API. Get yours from <a href="https://openrouter.ai/keys" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>CEREBRAS_API_KEY</code>: The API key for the Cerebras API. Get yours from <a href="https://cloud.cerebras.ai/" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>SAMBANOVA_API_KEY</code>: The API key for the Sambanova API. Get yours from <a href="https://cloud.sambanova.ai/apis" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>XAI_API_KEY</code>: The API key for the XAI API. Get your key from <a href="https://console.x.ai/" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>MOONSHOT_API_KEY</code>: The API key for the Moonshot API. Get your key from <a href="https://platform.moonshot.ai/" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>MINIMAX_API_KEY</code>: The API key for the MiniMax API. Get your key from <a href="https://intl.minimaxi.com/document/platform%20introduction" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>MODEL_CHAT</code>: The default model to use for aigenerate and most ai* calls. See <code>MODEL_REGISTRY</code> for a list of available models or define your own.</p></li><li><p><code>MODEL_EMBEDDING</code>: The default model to use for aiembed (embedding documents). See <code>MODEL_REGISTRY</code> for a list of available models or define your own.</p></li><li><p><code>PROMPT_SCHEMA</code>: The default prompt schema to use for aigenerate and most ai* calls (if not specified in <code>MODEL_REGISTRY</code>). Set as a string, eg, <code>&quot;OpenAISchema&quot;</code>. See <code>PROMPT_SCHEMA</code> for more information.</p></li><li><p><code>MODEL_ALIASES</code>: A dictionary of model aliases (<code>alias =&gt; full_model_name</code>). Aliases are used to refer to models by their aliases instead of their full names to make it more convenient to use them. See <code>MODEL_ALIASES</code> for more information.</p></li><li><p><code>MAX_HISTORY_LENGTH</code>: The maximum length of the conversation history. Defaults to 5. Set to <code>nothing</code> to disable history. See <code>CONV_HISTORY</code> for more information.</p></li><li><p><code>LOCAL_SERVER</code>: The URL of the local server to use for <code>ai*</code> calls. Defaults to <code>http://localhost:10897/v1</code>. This server is called when you call <code>model=&quot;local&quot;</code> See <code>?LocalServerOpenAISchema</code> for more information and examples.</p></li><li><p><code>LOG_DIR</code>: The directory to save the logs to, eg, when using <code>SaverSchema &lt;: AbstractTracerSchema</code>. Defaults to <code>joinpath(pwd(), &quot;log&quot;)</code>. Refer to <code>?SaverSchema</code> for more information on how it works and examples.</p></li></ul><p>At the moment it is not possible to persist changes to <code>MODEL_REGISTRY</code> across sessions. Define your <code>register_model!()</code> calls in your <code>startup.jl</code> file to make them available across sessions or put them at the top of your script.</p><p><strong>Available ENV Variables</strong></p><ul><li><p><code>OPENAI_API_KEY</code>: The API key for the OpenAI API.</p></li><li><p><code>AZURE_OPENAI_API_KEY</code>: The API key for the Azure OpenAI API.</p></li><li><p><code>AZURE_OPENAI_HOST</code>: The host for the Azure OpenAI API. This is the URL built as <code>https://&lt;resource-name&gt;.openai.azure.com</code>.</p></li><li><p><code>MISTRAL_API_KEY</code>: The API key for the Mistral AI API.</p></li><li><p><code>COHERE_API_KEY</code>: The API key for the Cohere API.</p></li><li><p><code>LOCAL_SERVER</code>: The URL of the local server to use for <code>ai*</code> calls. Defaults to <code>http://localhost:10897/v1</code>. This server is called when you call <code>model=&quot;local&quot;</code></p></li><li><p><code>DATABRICKS_API_KEY</code>: The API key for the Databricks Foundation Model API.</p></li><li><p><code>DATABRICKS_HOST</code>: The host for the Databricks API.</p></li><li><p><code>TAVILY_API_KEY</code>: The API key for the Tavily Search API. Register <a href="https://tavily.com/" target="_blank" rel="noreferrer">here</a>. See more information <a href="https://docs.tavily.com/docs/tavily-api/rest_api" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>GOOGLE_API_KEY</code>: The API key for Google Gemini models. Get yours from <a href="https://ai.google.dev/" target="_blank" rel="noreferrer">here</a>. If you see a documentation page (&quot;Available languages and regions for Google AI Studio and Gemini API&quot;), it means that it&#39;s not yet available in your region.</p></li><li><p><code>ANTHROPIC_API_KEY</code>: The API key for the Anthropic API. Get yours from <a href="https://www.anthropic.com/" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>VOYAGE_API_KEY</code>: The API key for the Voyage API. Free tier is upto 50M tokens! Get yours from <a href="https://dash.voyageai.com/api-keys" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>GROQ_API_KEY</code>: The API key for the Groq API. Free in beta! Get yours from <a href="https://console.groq.com/keys" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>DEEPSEEK_API_KEY</code>: The API key for the DeepSeek API. Get 5 credit when you join. Get yours from <a href="https://platform.deepseek.com/api_keys" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>OPENROUTER_API_KEY</code>: The API key for the OpenRouter API. Get yours from <a href="https://openrouter.ai/keys" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>CEREBRAS_API_KEY</code>: The API key for the Cerebras API.</p></li><li><p><code>SAMBANOVA_API_KEY</code>: The API key for the Sambanova API.</p></li><li><p><code>LOG_DIR</code>: The directory to save the logs to, eg, when using <code>SaverSchema &lt;: AbstractTracerSchema</code>. Defaults to <code>joinpath(pwd(), &quot;log&quot;)</code>. Refer to <code>?SaverSchema</code> for more information on how it works and examples.</p></li><li><p><code>XAI_API_KEY</code>: The API key for the XAI API. Get your key from <a href="https://console.x.ai/" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>MOONSHOT_API_KEY</code>: The API key for the Moonshot API. Get your key from <a href="https://platform.moonshot.cn/" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>MINIMAX_API_KEY</code>: The API key for the MiniMax API. Get your key from <a href="https://intl.minimaxi.com/document/platform%20introduction" target="_blank" rel="noreferrer">here</a>.</p></li></ul><p>Preferences.jl takes priority over ENV variables, so if you set a preference, it will take precedence over the ENV variable.</p><p>WARNING: NEVER EVER sync your <code>LocalPreferences.toml</code> file! It contains your API key and other sensitive information!!!</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/user_preferences.jl#L4-L73" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.RESERVED_KWARGS" href="#PromptingTools.RESERVED_KWARGS">#</a> <b><u>PromptingTools.RESERVED_KWARGS</u></b> — <i>Constant</i>. <p>The following keywords are reserved for internal use in the <code>ai*</code> functions and cannot be used as placeholders in the Messages</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/PromptingTools.jl#L36" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.AICode" href="#PromptingTools.AICode">#</a> <b><u>PromptingTools.AICode</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AICode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; auto_eval</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, safe_eval</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">skip_unsafe</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, capture_stdout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, suffix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, remove_tests</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, execution_timeout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AICode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AIMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; auto_eval</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, safe_eval</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">skip_unsafe</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, skip_invalid</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, capture_stdout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, suffix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, remove_tests</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, execution_timeout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>A mutable structure representing a code block (received from the AI model) with automatic parsing, execution, and output/error capturing capabilities.</p><p>Upon instantiation with a string, the <code>AICode</code> object automatically runs a code parser and executor (via <code>PromptingTools.eval!()</code>), capturing any standard output (<code>stdout</code>) or errors. This structure is useful for programmatically handling and evaluating Julia code snippets.</p><p>See also: <code>PromptingTools.extract_code_blocks</code>, <code>PromptingTools.eval!</code></p><p><strong>Workflow</strong></p><ul><li><p>Until <code>cb::AICode</code> has been evaluated, <code>cb.success</code> is set to <code>nothing</code> (and so are all other fields).</p></li><li><p>The text in <code>cb.code</code> is parsed (saved to <code>cb.expression</code>).</p></li><li><p>The parsed expression is evaluated.</p></li><li><p>Outputs of the evaluated expression are captured in <code>cb.output</code>.</p></li><li><p>Any <code>stdout</code> outputs (e.g., from <code>println</code>) are captured in <code>cb.stdout</code>.</p></li><li><p>If an error occurs during evaluation, it is saved in <code>cb.error</code>.</p></li><li><p>After successful evaluation without errors, <code>cb.success</code> is set to <code>true</code>. Otherwise, it is set to <code>false</code> and you can inspect the <code>cb.error</code> to understand why.</p></li></ul><p><strong>Properties</strong></p><ul><li><p><code>code::AbstractString</code>: The raw string of the code to be parsed and executed.</p></li><li><p><code>expression</code>: The parsed Julia expression (set after parsing <code>code</code>).</p></li><li><p><code>stdout</code>: Captured standard output from the execution of the code.</p></li><li><p><code>output</code>: The result of evaluating the code block.</p></li><li><p><code>success::Union{Nothing, Bool}</code>: Indicates whether the code block executed successfully (<code>true</code>), unsuccessfully (<code>false</code>), or has yet to be evaluated (<code>nothing</code>).</p></li><li><p><code>error::Union{Nothing, Exception}</code>: Any exception raised during the execution of the code block.</p></li></ul><p><strong>Keyword Arguments</strong></p><ul><li><p><code>auto_eval::Bool</code>: If set to <code>true</code>, the code block is automatically parsed and evaluated upon instantiation. Defaults to <code>true</code>.</p></li><li><p><code>safe_eval::Bool</code>: If set to <code>true</code>, the code block checks for package operations (e.g., installing new packages) and missing imports, and then evaluates the code inside a bespoke scratch module. This is to ensure that the evaluation does not alter any user-defined variables or the global state. Defaults to <code>false</code>.</p></li><li><p><code>skip_unsafe::Bool</code>: If set to <code>true</code>, we skip any lines in the code block that are deemed unsafe (eg, <code>Pkg</code> operations). Defaults to <code>false</code>.</p></li><li><p><code>skip_invalid::Bool</code>: If set to <code>true</code>, we skip code blocks that do not even parse. Defaults to <code>false</code>.</p></li><li><p><code>verbose::Bool</code>: If set to <code>true</code>, we print out any lines that are skipped due to being unsafe. Defaults to <code>false</code>.</p></li><li><p><code>capture_stdout::Bool</code>: If set to <code>true</code>, we capture any stdout outputs (eg, test failures) in <code>cb.stdout</code>. Defaults to <code>true</code>.</p></li><li><p><code>prefix::AbstractString</code>: A string to be prepended to the code block before parsing and evaluation. Useful to add some additional code definition or necessary imports. Defaults to an empty string.</p></li><li><p><code>suffix::AbstractString</code>: A string to be appended to the code block before parsing and evaluation. Useful to check that tests pass or that an example executes. Defaults to an empty string.</p></li><li><p><code>remove_tests::Bool</code>: If set to <code>true</code>, we remove any <code>@test</code> or <code>@testset</code> macros from the code block before parsing and evaluation. Defaults to <code>false</code>.</p></li><li><p><code>execution_timeout::Int</code>: The maximum time (in seconds) allowed for the code block to execute. Defaults to 60 seconds.</p></li></ul><p><strong>Methods</strong></p><ul><li><code>Base.isvalid(cb::AICode)</code>: Check if the code block has executed successfully. Returns <code>true</code> if <code>cb.success == true</code>.</li></ul><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AICode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;println(&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Hello, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">World!</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Auto-parses and evaluates the code, capturing output and errors.</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isvalid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(code) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">stdout</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # Output: &quot;Hello, World!</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span></code></pre></div><p>We try to evaluate &quot;safely&quot; by default (eg, inside a custom module, to avoid changing user variables). You can avoid that with <code>save_eval=false</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AICode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;new_variable = 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; safe_eval</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">isvalid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(code) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">new_variable </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: 1</span></span></code></pre></div><p>You can also call AICode directly on an AIMessage, which will extract the Julia code blocks, concatenate them and evaluate them:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;In Julia, how do you create a vector of 10 random numbers?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AICode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: AICode(Success: True, Parsed: True, Evaluated: True, Error Caught: N/A, StdOut: True, Code: 2 Lines)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># show the code</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> println</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># numbers = rand(10)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># numbers = rand(1:100, 10)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># or copy it to the clipboard</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> clipboard</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># or execute it in the current module (=Main)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">eval</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(code</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">expression)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/code_eval.jl#L18-L106" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.AIMessage" href="#PromptingTools.AIMessage">#</a> <b><u>PromptingTools.AIMessage</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AIMessage</span></span></code></pre></div><p>A message type for AI-generated text-based responses. Returned by <code>aigenerate</code>, <code>aiclassify</code>, and <code>aiscan</code> functions.</p><p><strong>Fields</strong></p><ul><li><p><code>content::Union{AbstractString, Nothing}</code>: The content of the message.</p></li><li><p><code>status::Union{Int, Nothing}</code>: The status of the message from the API.</p></li><li><p><code>name::Union{Nothing, String}</code>: The name of the <code>role</code> in the conversation.</p></li><li><p><code>tokens::Tuple{Int, Int}</code>: The number of tokens used (prompt,completion).</p></li><li><p><code>elapsed::Float64</code>: The time taken to generate the response in seconds.</p></li><li><p><code>cost::Union{Nothing, Float64}</code>: The cost of the API call (calculated with information from <code>MODEL_REGISTRY</code>).</p></li><li><p><code>log_prob::Union{Nothing, Float64}</code>: The log probability of the response.</p></li><li><p><code>extras::Union{Nothing, Dict{Symbol, Any}}</code>: A dictionary for additional metadata that is not part of the key message fields. Try to limit to a small number of items and singletons to be serializable.</p></li><li><p><code>finish_reason::Union{Nothing, String}</code>: The reason the response was finished.</p></li><li><p><code>run_id::Union{Nothing, Int}</code>: The unique ID of the run.</p></li><li><p><code>sample_id::Union{Nothing, Int}</code>: The unique ID of the sample (if multiple samples are generated, they will all have the same <code>run_id</code>).</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L109-L127" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.AITemplate" href="#PromptingTools.AITemplate">#</a> <b><u>PromptingTools.AITemplate</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AITemplate</span></span></code></pre></div><p>AITemplate is a template for a conversation prompt. This type is merely a container for the template name, which is resolved into a set of messages (=prompt) by <code>render</code>.</p><p><strong>Naming Convention</strong></p><ul><li><p>Template names should be in CamelCase</p></li><li><p>Follow the format <code>&lt;Persona&gt;...&lt;Variable&gt;...</code> where possible, eg, <code>JudgeIsItTrue</code>, ``</p><ul><li><p>Starting with the Persona (=System prompt), eg, <code>Judge</code> = persona is meant to <code>judge</code> some provided information</p></li><li><p>Variable to be filled in with context, eg, <code>It</code> = placeholder <code>it</code></p></li><li><p>Ending with the variable name is helpful, eg, <code>JuliaExpertTask</code> for a persona to be an expert in Julia language and <code>task</code> is the placeholder name</p></li></ul></li><li><p>Ideally, the template name should be self-explanatory, eg, <code>JudgeIsItTrue</code> = persona is meant to <code>judge</code> some provided information where it is true or false</p></li></ul><p><strong>Examples</strong></p><p>Save time by re-using pre-made templates, just fill in the placeholders with the keyword arguments:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:JuliaExpertAsk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; ask </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;How do I add packages?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>The above is equivalent to a more verbose version that explicitly uses the dispatch on <code>AITemplate</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AITemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:JuliaExpertAsk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); ask </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;How do I add packages?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Find available templates with <code>aitemplates</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tmps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aitemplates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;JuliaExpertAsk&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Will surface one specific template</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1-element Vector{AITemplateMetadata}:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PromptingTools.AITemplateMetadata</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   name: Symbol JuliaExpertAsk</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   description: String &quot;For asking questions about Julia language. Placeholders: `ask`&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   version: String &quot;1&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   wordcount: Int64 237</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   variables: Array{Symbol}((1,))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   system_preview: String &quot;You are a world-class Julia language programmer with the knowledge of the latest syntax. Your commun&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   user_preview: String &quot;# Question</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{{ask}}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#   source: String &quot;&quot;</span></span></code></pre></div><p>The above gives you a good idea of what the template is about, what placeholders are available, and how much it would cost to use it (=wordcount).</p><p>Search for all Julia-related templates:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tmps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aitemplates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Julia&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2-element Vector{AITemplateMetadata}... -&gt; more to come later!</span></span></code></pre></div><p>If you are on VSCode, you can leverage nice tabular display with <code>vscodedisplay</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DataFrames</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tmps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aitemplates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Julia&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DataFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vscodedisplay</span></span></code></pre></div><p>I have my selected template, how do I use it? Just use the &quot;name&quot; in <code>aigenerate</code> or <code>aiclassify</code> like you see in the first example!</p><p>You can inspect any template by &quot;rendering&quot; it (this is what the LLM will see):</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">julia</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AITemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:JudgeIsItTrue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">render</span></span></code></pre></div><p>See also: <code>save_template</code>, <code>load_template</code>, <code>load_templates!</code> for more advanced use cases (and the corresponding script in <code>examples/</code> folder)</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/templates.jl#L8-L74" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.AITemplateMetadata" href="#PromptingTools.AITemplateMetadata">#</a> <b><u>PromptingTools.AITemplateMetadata</u></b> — <i>Type</i>. <p>Helper for easy searching and reviewing of templates. Defined on loading of each template.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/templates.jl#L77" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.AIToolRequest" href="#PromptingTools.AIToolRequest">#</a> <b><u>PromptingTools.AIToolRequest</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AIToolRequest</span></span></code></pre></div><p>A message type for AI-generated tool requests. Returned by <code>aitools</code> functions.</p><p><strong>Fields</strong></p><ul><li><p><code>content::Union{AbstractString, Nothing}</code>: The content of the message.</p></li><li><p><code>tool_calls::Vector{ToolMessage}</code>: The vector of tool call requests.</p></li><li><p><code>name::Union{Nothing, String}</code>: The name of the <code>role</code> in the conversation.</p></li><li><p><code>status::Union{Int, Nothing}</code>: The status of the message from the API.</p></li><li><p><code>tokens::Tuple{Int, Int}</code>: The number of tokens used (prompt,completion).</p></li><li><p><code>elapsed::Float64</code>: The time taken to generate the response in seconds.</p></li><li><p><code>cost::Union{Nothing, Float64}</code>: The cost of the API call (calculated with information from <code>MODEL_REGISTRY</code>).</p></li><li><p><code>log_prob::Union{Nothing, Float64}</code>: The log probability of the response.</p></li><li><p><code>extras::Union{Nothing, Dict{Symbol, Any}}</code>: A dictionary for additional metadata that is not part of the key message fields. Try to limit to a small number of items and singletons to be serializable.</p></li><li><p><code>finish_reason::Union{Nothing, String}</code>: The reason the response was finished.</p></li><li><p><code>run_id::Union{Nothing, Int}</code>: The unique ID of the run.</p></li><li><p><code>sample_id::Union{Nothing, Int}</code>: The unique ID of the sample (if multiple samples are generated, they will all have the same <code>run_id</code>).</p></li></ul><p>See <code>ToolMessage</code> for the fields of the tool call requests.</p><p>See also: <a href="/PromptingTools.jl/dev/reference#PromptingTools.tool_calls-Tuple{PromptingTools.AIToolRequest}"><code>tool_calls</code></a>, <a href="/PromptingTools.jl/dev/reference#PromptingTools.execute_tool"><code>execute_tool</code></a>, <a href="/PromptingTools.jl/dev/reference#PromptingTools.parse_tool-Tuple{Type, AbstractString}"><code>parse_tool</code></a></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L200-L223" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.AbstractAnnotationMessage" href="#PromptingTools.AbstractAnnotationMessage">#</a> <b><u>PromptingTools.AbstractAnnotationMessage</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AbstractAnnotationMessage</span></span></code></pre></div><p>Messages that provide extra information without being sent to LLMs.</p><p>Required fields: <code>content</code>, <code>tags</code>, <code>comment</code>, <code>run_id</code>.</p><p>Note: <code>comment</code> is intended for human readers only and should never be used. <code>run_id</code> should be a unique identifier for the annotation, typically a random number.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L7-L16" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.AbstractPromptSchema" href="#PromptingTools.AbstractPromptSchema">#</a> <b><u>PromptingTools.AbstractPromptSchema</u></b> — <i>Type</i>. <p>Defines different prompting styles based on the model training and fine-tuning.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L22" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.AbstractTool" href="#PromptingTools.AbstractTool">#</a> <b><u>PromptingTools.AbstractTool</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AbstractTool</span></span></code></pre></div><p>Abstract type for all tool types.</p><p>Required fields:</p><ul><li><p><code>name::String</code>: The name of the tool.</p></li><li><p><code>parameters::Dict</code>: The parameters of the tool.</p></li><li><p><code>description::Union{String, Nothing}</code>: The description of the tool.</p></li><li><p><code>callable::Any</code>: The callable object of the tool, eg, a type or a function.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L14-L24" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.AbstractToolError" href="#PromptingTools.AbstractToolError">#</a> <b><u>PromptingTools.AbstractToolError</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AbstractToolError</span></span></code></pre></div><p>Abstract type for all tool errors.</p><p>Available subtypes:</p><ul><li><p><a href="/PromptingTools.jl/dev/reference#PromptingTools.ToolNotFoundError"><code>ToolNotFoundError</code></a></p></li><li><p><a href="/PromptingTools.jl/dev/reference#PromptingTools.ToolExecutionError"><code>ToolExecutionError</code></a></p></li><li><p><a href="/PromptingTools.jl/dev/reference#PromptingTools.ToolGenericError"><code>ToolGenericError</code></a></p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L79-L88" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.AnnotationMessage" href="#PromptingTools.AnnotationMessage">#</a> <b><u>PromptingTools.AnnotationMessage</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AnnotationMessage</span></span></code></pre></div><p>A message type for providing extra information in the conversation history without being sent to LLMs. These messages are filtered out during rendering to ensure they don&#39;t affect the LLM&#39;s context.</p><p>Used to bundle key information and documentation for colleagues and future reference together with the data.</p><p><strong>Fields</strong></p><ul><li><p><code>content::T</code>: The content of the annotation (can be used for inputs to airag etc.)</p></li><li><p><code>extras::Dict{Symbol,Any}</code>: Additional metadata with symbol keys and any values</p></li><li><p><code>tags::Vector{Symbol}</code>: Vector of tags for categorization (default: empty)</p></li><li><p><code>comment::String</code>: Human-readable comment, never used for automatic operations (default: empty)</p></li><li><p><code>run_id::Union{Nothing,Int}</code>: The unique ID of the annotation</p></li></ul><p>Note: The comment field is intended for human readers only and should never be used for automatic operations.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L245-L262" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.AnthropicSchema" href="#PromptingTools.AnthropicSchema">#</a> <b><u>PromptingTools.AnthropicSchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AnthropicSchema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractAnthropicSchema</span></span></code></pre></div><p>AnthropicSchema is the default schema for Anthropic API models (eg, Claude). See more information <a href="https://docs.anthropic.com/claude/reference/getting-started-with-the-api" target="_blank" rel="noreferrer">here</a>.</p><p>It uses the following conversation template:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Dict(role=&quot;user&quot;,content=&quot;...&quot;),Dict(role=&quot;assistant&quot;,content=&quot;...&quot;)]</span></span></code></pre></div><p><code>system</code> messages are provided as a keyword argument to the API call.</p><p>It&#39;s recommended to separate sections in your prompt with XML markup (e.g. <code>&lt;document&gt;  &lt;/document&gt;</code>). See <a href="https://docs.anthropic.com/claude/docs/use-xml-tags" target="_blank" rel="noreferrer">here</a>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L410-L424" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.AzureOpenAISchema" href="#PromptingTools.AzureOpenAISchema">#</a> <b><u>PromptingTools.AzureOpenAISchema</u></b> — <i>Type</i>. <p>AzureOpenAISchema</p><p>AzureOpenAISchema() allows user to call Azure OpenAI API. <a href="https://learn.microsoft.com/en-us/azure/ai-services/openai/reference" target="_blank" rel="noreferrer">API Reference</a></p><p>Requires two environment variables to be set:</p><ul><li><p><code>AZURE_OPENAI_API_KEY</code>: Azure token</p></li><li><p><code>AZURE_OPENAI_HOST</code>: Address of the Azure resource (<code>&quot;https://&lt;resource&gt;.openai.azure.com&quot;</code>)</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L162-L170" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.CerebrasOpenAISchema" href="#PromptingTools.CerebrasOpenAISchema">#</a> <b><u>PromptingTools.CerebrasOpenAISchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CerebrasOpenAISchema</span></span></code></pre></div><p>Schema to call the <a href="https://cerebras.ai/" target="_blank" rel="noreferrer">Cerebras</a> API.</p><p>Links:</p><ul><li><p><a href="https://cloud.cerebras.ai" target="_blank" rel="noreferrer">Get your API key</a></p></li><li><p><a href="https://inference-docs.cerebras.ai/api-reference/chat-completions" target="_blank" rel="noreferrer">API Reference</a></p></li></ul><p>Requires one environment variable to be set:</p><ul><li><code>CEREBRAS_API_KEY</code>: Your API key</li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L247-L258" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.ChatMLSchema" href="#PromptingTools.ChatMLSchema">#</a> <b><u>PromptingTools.ChatMLSchema</u></b> — <i>Type</i>. <p>ChatMLSchema is used by many open-source chatbots, by OpenAI models (under the hood) and by several models and inferfaces (eg, Ollama, vLLM)</p><p>You can explore it on <a href="https://tiktokenizer.vercel.app/" target="_blank" rel="noreferrer">tiktokenizer</a></p><p>It uses the following conversation structure:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&lt;im_start&gt;system</span></span>
<span class="line"><span>...&lt;im_end&gt;</span></span>
<span class="line"><span>&lt;|im_start|&gt;user</span></span>
<span class="line"><span>...&lt;|im_end|&gt;</span></span>
<span class="line"><span>&lt;|im_start|&gt;assistant</span></span>
<span class="line"><span>...&lt;|im_end|&gt;</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L356-L370" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.ConversationMemory" href="#PromptingTools.ConversationMemory">#</a> <b><u>PromptingTools.ConversationMemory</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ConversationMemory</span></span></code></pre></div><p>A structured container for managing conversation history. It has only one field <code>:conversation</code> which is a vector of <code>AbstractMessage</code>s. It&#39;s built to support intelligent truncation and caching behavior (<code>get_last</code>).</p><p>You can also use it as a functor to have extended conversations (easier than constantly passing <code>conversation</code> kwarg)</p><p><strong>Examples</strong></p><p>Basic usage</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mem </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ConversationMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SystemMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You are a helpful assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UserMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AIMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hi there!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># or simply</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mem </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ConversationMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(conv)</span></span></code></pre></div><p>Check memory stats</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ConversationMemory(2 messages) - doesn&#39;t count system message</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">@show</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3 - counts all messages</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">@show</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> last_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># gets last message</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">@show</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> last_output</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem)   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># gets last content</span></span></code></pre></div><p>Get recent messages with different options (System message, User message, ... + the most recent)</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">recent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> get_last</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># get last 5 messages (including system)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">recent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> get_last</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, batch_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># align to batches of 10 for caching</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">recent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> get_last</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, explain</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># adds truncation explanation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">recent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> get_last</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># prints truncation info</span></span></code></pre></div><p>Append multiple messages at once (with deduplication to keep the memory complete)</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msgs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    UserMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;How are you?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    AIMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I&#39;m good!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; run_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    UserMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Great!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    AIMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Indeed!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; run_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">append!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem, msgs)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Will only append new messages based on run_ids etc.</span></span></code></pre></div><p>Use for AI conversations (easier to manage conversations)</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Tell me a joke&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt4o&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Automatically manages context</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Another one&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; last</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt4o&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Use only last 3 messages (uses `get_last`)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Direct generation from the memory</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Generate using full context</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/memory.jl#L1-L58" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.ConversationMemory-Tuple{AbstractString}" href="#PromptingTools.ConversationMemory-Tuple{AbstractString}">#</a> <b><u>PromptingTools.ConversationMemory</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ConversationMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)(prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; last</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing,Integer}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Functor interface for direct generation using the conversation memory. Optionally, specify the number of last messages to include in the context (uses <code>get_last</code>).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/memory.jl#L278-L283" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.CustomOpenAISchema" href="#PromptingTools.CustomOpenAISchema">#</a> <b><u>PromptingTools.CustomOpenAISchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CustomOpenAISchema</span></span></code></pre></div><p>CustomOpenAISchema() allows user to call any OpenAI-compatible API.</p><p>All user needs to do is to pass this schema as the first argument and provide the BASE URL of the API to call (<code>api_kwargs.url</code>).</p><p><strong>Example</strong></p><p>Assumes that we have a local server running at <code>http://127.0.0.1:8081</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">api_key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;...&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Say hi!&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CustomOpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), prompt; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;my_model&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, api_key, api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://127.0.0.1:8081&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L60-L77" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.DataMessage" href="#PromptingTools.DataMessage">#</a> <b><u>PromptingTools.DataMessage</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DataMessage</span></span></code></pre></div><p>A message type for AI-generated data-based responses, ie, different <code>content</code> than text. Returned by <code>aiextract</code>, and <code>aiextract</code> functions.</p><p><strong>Fields</strong></p><ul><li><p><code>content::Union{AbstractString, Nothing}</code>: The content of the message.</p></li><li><p><code>status::Union{Int, Nothing}</code>: The status of the message from the API.</p></li><li><p><code>tokens::Tuple{Int, Int}</code>: The number of tokens used (prompt,completion).</p></li><li><p><code>elapsed::Float64</code>: The time taken to generate the response in seconds.</p></li><li><p><code>cost::Union{Nothing, Float64}</code>: The cost of the API call (calculated with information from <code>MODEL_REGISTRY</code>).</p></li><li><p><code>log_prob::Union{Nothing, Float64}</code>: The log probability of the response.</p></li><li><p><code>extras::Union{Nothing, Dict{Symbol, Any}}</code>: A dictionary for additional metadata that is not part of the key message fields. Try to limit to a small number of items and singletons to be serializable.</p></li><li><p><code>finish_reason::Union{Nothing, String}</code>: The reason the response was finished.</p></li><li><p><code>run_id::Union{Nothing, Int}</code>: The unique ID of the run.</p></li><li><p><code>sample_id::Union{Nothing, Int}</code>: The unique ID of the sample (if multiple samples are generated, they will all have the same <code>run_id</code>).</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L143-L160" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.DatabricksOpenAISchema" href="#PromptingTools.DatabricksOpenAISchema">#</a> <b><u>PromptingTools.DatabricksOpenAISchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DatabricksOpenAISchema</span></span></code></pre></div><p>DatabricksOpenAISchema() allows user to call Databricks Foundation Model API. <a href="https://docs.databricks.com/en/machine-learning/foundation-models/api-reference.html" target="_blank" rel="noreferrer">API Reference</a></p><p>Requires two environment variables to be set:</p><ul><li><p><code>DATABRICKS_API_KEY</code>: Databricks token</p></li><li><p><code>DATABRICKS_HOST</code>: Address of the Databricks workspace (<code>https://&lt;workspace_host&gt;.databricks.com</code>)</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L151-L159" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.DeepSeekOpenAISchema" href="#PromptingTools.DeepSeekOpenAISchema">#</a> <b><u>PromptingTools.DeepSeekOpenAISchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DeepSeekOpenAISchema</span></span></code></pre></div><p>Schema to call the <a href="https://platform.deepseek.com/docs" target="_blank" rel="noreferrer">DeepSeek</a> API.</p><p>Links:</p><ul><li><p><a href="https://platform.deepseek.com/api_keys" target="_blank" rel="noreferrer">Get your API key</a></p></li><li><p><a href="https://platform.deepseek.com/docs" target="_blank" rel="noreferrer">API Reference</a></p></li></ul><p>Requires one environment variables to be set:</p><ul><li><code>DEEPSEEK_API_KEY</code>: Your API key (often starts with &quot;sk-...&quot;)</li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L218-L229" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.FireworksOpenAISchema" href="#PromptingTools.FireworksOpenAISchema">#</a> <b><u>PromptingTools.FireworksOpenAISchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">FireworksOpenAISchema</span></span></code></pre></div><p>Schema to call the <a href="https://fireworks.ai/" target="_blank" rel="noreferrer">Fireworks.ai</a> API.</p><p>Links:</p><ul><li><p><a href="https://fireworks.ai/api-keys" target="_blank" rel="noreferrer">Get your API key</a></p></li><li><p><a href="https://readme.fireworks.ai/reference/createchatcompletion" target="_blank" rel="noreferrer">API Reference</a></p></li><li><p><a href="https://fireworks.ai/models" target="_blank" rel="noreferrer">Available models</a></p></li></ul><p>Requires one environment variables to be set:</p><ul><li><code>FIREWORKS_API_KEY</code>: Your API key</li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L173-L185" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.GoogleOpenAISchema" href="#PromptingTools.GoogleOpenAISchema">#</a> <b><u>PromptingTools.GoogleOpenAISchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GoogleOpenAISchema</span></span></code></pre></div><p>Schema to call the Google&#39;s Gemini API using OpenAI compatibility mode. <a href="https://ai.google.dev/gemini-api/docs/openai#rest" target="_blank" rel="noreferrer">API Reference</a></p><p>Links:</p><ul><li><p><a href="https://aistudio.google.com/apikey" target="_blank" rel="noreferrer">Get your API key</a></p></li><li><p><a href="https://ai.google.dev/gemini-api/docs/openai#rest" target="_blank" rel="noreferrer">API Reference</a></p></li><li><p><a href="https://ai.google.dev/models/gemini" target="_blank" rel="noreferrer">Available models</a></p></li></ul><p>Requires one environment variable to be set:</p><ul><li><code>GOOGLE_API_KEY</code>: Your API key</li></ul><p>The base URL for the API is &quot;<a href="https://generativelanguage.googleapis.com/v1beta" target="_blank" rel="noreferrer">https://generativelanguage.googleapis.com/v1beta</a>&quot;</p><p>Warning: Token counting and cost counting have not yet been implemented by Google, so you&#39;ll not have any such metrics. If you need it, use the native GoogleSchema with the GoogleGenAI.jl library.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L287-L303" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.GoogleSchema" href="#PromptingTools.GoogleSchema">#</a> <b><u>PromptingTools.GoogleSchema</u></b> — <i>Type</i>. <p>Calls Google&#39;s Gemini API. See more information <a href="https://aistudio.google.com/" target="_blank" rel="noreferrer">here</a>. It&#39;s available only for <em>some</em> regions.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L396" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.GroqOpenAISchema" href="#PromptingTools.GroqOpenAISchema">#</a> <b><u>PromptingTools.GroqOpenAISchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GroqOpenAISchema</span></span></code></pre></div><p>Schema to call the <a href="https://console.groq.com/keys" target="_blank" rel="noreferrer">groq.com</a> API.</p><p>Links:</p><ul><li><p><a href="https://console.groq.com/keys" target="_blank" rel="noreferrer">Get your API key</a></p></li><li><p><a href="https://console.groq.com/docs/quickstart" target="_blank" rel="noreferrer">API Reference</a></p></li><li><p><a href="https://console.groq.com/docs/models" target="_blank" rel="noreferrer">Available models</a></p></li></ul><p>Requires one environment variables to be set:</p><ul><li><code>GROQ_API_KEY</code>: Your API key (often starts with &quot;gsk_...&quot;)</li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L203-L215" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.ItemsExtract" href="#PromptingTools.ItemsExtract">#</a> <b><u>PromptingTools.ItemsExtract</u></b> — <i>Type</i>. <p>Extract zero, one or more specified items from the provided data.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L752-L754" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.LocalServerOpenAISchema" href="#PromptingTools.LocalServerOpenAISchema">#</a> <b><u>PromptingTools.LocalServerOpenAISchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LocalServerOpenAISchema</span></span></code></pre></div><p>Designed to be used with local servers. It&#39;s automatically called with model alias &quot;local&quot; (see <code>MODEL_REGISTRY</code>).</p><p>This schema is a flavor of CustomOpenAISchema with a <code>url</code> key<code>preset by global Preference key</code>LOCAL_SERVER<code>. See</code>?PREFERENCES<code>for more details on how to change it. It assumes that the server follows OpenAI API conventions (eg,</code>POST /v1/chat/completions`).</p><p>Note: Llama.cpp (and hence Llama.jl built on top of it) do NOT support embeddings endpoint! You&#39;ll get an address error.</p><p><strong>Example</strong></p><p>Assumes that we have a local server running at <code>http://127.0.0.1:10897/v1</code> (port and address used by Llama.jl, &quot;v1&quot; at the end is needed for OpenAI endpoint compatibility):</p><p>Three ways to call it:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Use @ai_str with &quot;local&quot; alias</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ai</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi!&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">local</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># model=&quot;local&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;local&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Or set schema explicitly</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LocalServerOpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>How to start a LLM local server? You can use <code>run_server</code> function from <a href="https://github.com/marcom/Llama.jl" target="_blank" rel="noreferrer">Llama.jl</a>. Use a separate Julia session.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Llama</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;...path...&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # see Llama.jl README how to download one</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">run_server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; model)</span></span></code></pre></div><p>To change the default port and address:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># For a permanent change, set the preference:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Preferences</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set_preferences!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;LOCAL_SERVER&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://127.0.0.1:10897/v1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Or if it&#39;s a temporary fix, just change the variable `LOCAL_SERVER`:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LOCAL_SERVER </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://127.0.0.1:10897/v1&quot;</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L80-L126" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.MaybeExtract" href="#PromptingTools.MaybeExtract">#</a> <b><u>PromptingTools.MaybeExtract</u></b> — <i>Type</i>. <p>Extract a result from the provided data, if any, otherwise set the error and message fields.</p><p><strong>Arguments</strong></p><ul><li><p><code>error::Bool</code>: <code>true</code> if a result is found, <code>false</code> otherwise.</p></li><li><p><code>message::String</code>: Only present if no result is found, should be short and concise.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L739-L745" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.MiniMaxOpenAISchema" href="#PromptingTools.MiniMaxOpenAISchema">#</a> <b><u>PromptingTools.MiniMaxOpenAISchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MiniMaxOpenAISchema</span></span></code></pre></div><p>Schema to call the MiniMax API.</p><p>Links:</p><ul><li><a href="https://api.minimaxi.chat/v1/text/chatcompletion_v2" target="_blank" rel="noreferrer">API Reference</a></li></ul><p>Requires one environment variable to be set:</p><ul><li><code>MINIMAX_API_KEY</code>: Your API key</li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L306-L316" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.MistralOpenAISchema" href="#PromptingTools.MistralOpenAISchema">#</a> <b><u>PromptingTools.MistralOpenAISchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MistralOpenAISchema</span></span></code></pre></div><p>MistralOpenAISchema() allows user to call MistralAI API known for mistral and mixtral models.</p><p>It&#39;s a flavor of CustomOpenAISchema() with a url preset to <code>https://api.mistral.ai</code>.</p><p>Most models have been registered, so you don&#39;t even have to specify the schema</p><p><strong>Example</strong></p><p>Let&#39;s call <code>mistral-tiny</code> model:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">api_key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;...&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # can be set via ENV[&quot;MISTRAL_API_KEY&quot;] or via our preference system</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mistral_tiny&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, api_key)</span></span></code></pre></div><p>See <code>?PREFERENCES</code> for more details on how to set your API key permanently.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L129-L148" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.ModelSpec" href="#PromptingTools.ModelSpec">#</a> <b><u>PromptingTools.ModelSpec</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ModelSpec</span></span></code></pre></div><p>A struct that contains information about a model, such as its name, schema, cost per token, etc.</p><p><strong>Fields</strong></p><ul><li><p><code>name::String</code>: The name of the model. This is the name that will be used to refer to the model in the <code>ai*</code> functions.</p></li><li><p><code>schema::AbstractPromptSchema</code>: The schema of the model. This is the schema that will be used to generate prompts for the model, eg, <code>:OpenAISchema</code>.</p></li><li><p><code>cost_of_token_prompt::Float64</code>: The cost of 1 token in the prompt for this model. This is used to calculate the cost of a prompt. Note: It is often provided online as cost per 1000 tokens, so make sure to convert it correctly!</p></li><li><p><code>cost_of_token_generation::Float64</code>: The cost of 1 token generated by this model. This is used to calculate the cost of a generation. Note: It is often provided online as cost per 1000 tokens, so make sure to convert it correctly!</p></li><li><p><code>description::String</code>: A description of the model. This is used to provide more information about the model when it is queried.</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">spec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ModelSpec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt-3.5-turbo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    0.0015</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    0.002</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;GPT-3.5 Turbo is a 175B parameter model and a common default on the OpenAI API.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># register it</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PromptingTools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">register_model!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(spec)</span></span></code></pre></div><p>But you can also register any model directly via keyword arguments:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PromptingTools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">register_model!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gpt-3.5-turbo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_of_token_prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0015</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_of_token_generation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.002</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    description </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;GPT-3.5 Turbo is a 175B parameter model and a common default on the OpenAI API.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/user_preferences.jl#L292-L327" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.MoonshotOpenAISchema" href="#PromptingTools.MoonshotOpenAISchema">#</a> <b><u>PromptingTools.MoonshotOpenAISchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MoonshotOpenAISchema</span></span></code></pre></div><p>Schema to call the Moonshot API (Kimi models).</p><p>Links:</p><ul><li><p><a href="https://platform.moonshot.ai/" target="_blank" rel="noreferrer">Get your API key</a></p></li><li><p><a href="https://platform.moonshot.ai/docs/api/chat" target="_blank" rel="noreferrer">API Reference</a></p></li></ul><p>Requires one environment variable to be set:</p><ul><li><code>MOONSHOT_API_KEY</code>: Your API key</li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L319-L330" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.NoSchema" href="#PromptingTools.NoSchema">#</a> <b><u>PromptingTools.NoSchema</u></b> — <i>Type</i>. <p>Schema that keeps messages (&lt;:AbstractMessage) and does not transform for any specific model. It used by the first pass of the prompt rendering system (see <code>?render</code>).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L25" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.OllamaManagedSchema" href="#PromptingTools.OllamaManagedSchema">#</a> <b><u>PromptingTools.OllamaManagedSchema</u></b> — <i>Type</i>. <p>Ollama by default manages different models and their associated prompt schemas when you pass <code>system_prompt</code> and <code>prompt</code> fields to the API.</p><p>Warning: It works only for 1 system message and 1 user message, so anything more than that has to be rejected.</p><p>If you need to pass more messagese / longer conversational history, you can use define the model-specific schema directly and pass your Ollama requests with <code>raw=true</code>, which disables and templating and schema management by Ollama.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L376-L383" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.OllamaSchema" href="#PromptingTools.OllamaSchema">#</a> <b><u>PromptingTools.OllamaSchema</u></b> — <i>Type</i>. <p>OllamaSchema is the default schema for Olama models.</p><p>It uses the following conversation template:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[Dict(role=&quot;system&quot;,content=&quot;...&quot;),Dict(role=&quot;user&quot;,content=&quot;...&quot;),Dict(role=&quot;assistant&quot;,content=&quot;...&quot;)]</span></span></code></pre></div><p>It&#39;s very similar to OpenAISchema, but it appends images differently.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L335-L344" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.OpenAISchema" href="#PromptingTools.OpenAISchema">#</a> <b><u>PromptingTools.OpenAISchema</u></b> — <i>Type</i>. <p>OpenAISchema is the default schema for OpenAI models.</p><p>It uses the following conversation template:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[Dict(role=&quot;system&quot;,content=&quot;...&quot;),Dict(role=&quot;user&quot;,content=&quot;...&quot;),Dict(role=&quot;assistant&quot;,content=&quot;...&quot;)]</span></span></code></pre></div><p>It&#39;s recommended to separate sections in your prompt with markdown headers (e.g. `##Answer</p><p>`).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L30-L41" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.OpenRouterOpenAISchema" href="#PromptingTools.OpenRouterOpenAISchema">#</a> <b><u>PromptingTools.OpenRouterOpenAISchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">OpenRouterOpenAISchema</span></span></code></pre></div><p>Schema to call the <a href="https://openrouter.ai/" target="_blank" rel="noreferrer">OpenRouter</a> API.</p><p>Links:</p><ul><li><p><a href="https://openrouter.ai/keys" target="_blank" rel="noreferrer">Get your API key</a></p></li><li><p><a href="https://openrouter.ai/docs" target="_blank" rel="noreferrer">API Reference</a></p></li><li><p><a href="https://openrouter.ai/models" target="_blank" rel="noreferrer">Available models</a></p></li></ul><p>Requires one environment variable to be set:</p><ul><li><code>OPENROUTER_API_KEY</code>: Your API key</li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L232-L244" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.SambaNovaOpenAISchema" href="#PromptingTools.SambaNovaOpenAISchema">#</a> <b><u>PromptingTools.SambaNovaOpenAISchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SambaNovaOpenAISchema</span></span></code></pre></div><p>Schema to call the <a href="https://sambanova.ai/" target="_blank" rel="noreferrer">SambaNova</a> API.</p><p>Links:</p><ul><li><p><a href="https://cloud.sambanova.ai/apis" target="_blank" rel="noreferrer">Get your API key</a></p></li><li><p><a href="https://community.sambanova.ai/c/docs" target="_blank" rel="noreferrer">API Reference</a></p></li></ul><p>Requires one environment variable to be set:</p><ul><li><code>SAMBANOVA_API_KEY</code>: Your API key</li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L261-L272" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.SaverSchema" href="#PromptingTools.SaverSchema">#</a> <b><u>PromptingTools.SaverSchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SaverSchema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractTracerSchema</span></span></code></pre></div><p>SaverSchema is a schema that automatically saves the conversation to the disk. It&#39;s useful for debugging and for persistent logging.</p><p>It can be composed with any other schema, eg, <code>TracerSchema</code> to save additional metadata.</p><p>Set environment variable <code>LOG_DIR</code> to the directory where you want to save the conversation (see <code>?PREFERENCES</code>). Conversations are named by the hash of the first message in the conversation to naturally group subsequent conversations together.</p><p>If you need to provide logging directory of the file name dynamically, you can provide the following arguments to <code>tracer_kwargs</code>:</p><ul><li><p><code>log_dir</code> - used as the directory to save the log into when provided. Defaults to <code>LOG_DIR</code> if not provided.</p></li><li><p><code>log_file_path</code> - used as the file name to save the log into when provided. This value overrules the <code>log_dir</code> and <code>LOG_DIR</code> if provided.</p></li></ul><p>To use it automatically, re-register the models you use with the schema wrapped in <code>SaverSchema</code></p><p>See also: <code>meta</code>, <code>unwrap</code>, <code>TracerSchema</code>, <code>initialize_tracer</code>, <code>finalize_tracer</code></p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TracerSchema, OpenAISchema, SaverSchema</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This schema will first trace the metadata (change to TraceMessage) and then save the conversation to the disk</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wrap_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TracerSchema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SaverSchema</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(wrap_schema,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:BlankSystemUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; system</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You&#39;re a French-speaking assistant!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt-4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># conv is a vector of messages that will be saved to a JSON together with metadata about the template and api_kwargs</span></span></code></pre></div><p>If you wanted to enable this automatically for models you use, you can do it like this:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">register_model!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gpt-3.5-turbo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TracerSchema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SaverSchema)</span></span></code></pre></div><p>Any subsequent calls <code>model=&quot;gpt-3.5-turbo&quot;</code> will automatically capture metadata and save the conversation to the disk.</p><p>To provide logging file path explicitly, use the <code>tracer_kwargs</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(wrap_schema,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:BlankSystemUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; system</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You&#39;re a French-speaking assistant!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt-4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tracer_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; log_file_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;my_logs/my_log.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L472-L515" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.ShareGPTSchema" href="#PromptingTools.ShareGPTSchema">#</a> <b><u>PromptingTools.ShareGPTSchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ShareGPTSchema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractShareGPTSchema</span></span></code></pre></div><p>Frequently used schema for finetuning LLMs. Conversations are recorded as a vector of dicts with keys <code>from</code> and <code>value</code> (similar to OpenAI).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L435-L439" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.TestEchoAnthropicSchema" href="#PromptingTools.TestEchoAnthropicSchema">#</a> <b><u>PromptingTools.TestEchoAnthropicSchema</u></b> — <i>Type</i>. <p>Echoes the user&#39;s input back to them. Used for testing the implementation</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L425" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.TestEchoGoogleSchema" href="#PromptingTools.TestEchoGoogleSchema">#</a> <b><u>PromptingTools.TestEchoGoogleSchema</u></b> — <i>Type</i>. <p>Echoes the user&#39;s input back to them. Used for testing the implementation</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L399" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.TestEchoOllamaManagedSchema" href="#PromptingTools.TestEchoOllamaManagedSchema">#</a> <b><u>PromptingTools.TestEchoOllamaManagedSchema</u></b> — <i>Type</i>. <p>Echoes the user&#39;s input back to them. Used for testing the implementation</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L386" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.TestEchoOllamaSchema" href="#PromptingTools.TestEchoOllamaSchema">#</a> <b><u>PromptingTools.TestEchoOllamaSchema</u></b> — <i>Type</i>. <p>Echoes the user&#39;s input back to them. Used for testing the implementation</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L347" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.TestEchoOpenAISchema" href="#PromptingTools.TestEchoOpenAISchema">#</a> <b><u>PromptingTools.TestEchoOpenAISchema</u></b> — <i>Type</i>. <p>Echoes the user&#39;s input back to them. Used for testing the implementation</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L42" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.TogetherOpenAISchema" href="#PromptingTools.TogetherOpenAISchema">#</a> <b><u>PromptingTools.TogetherOpenAISchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TogetherOpenAISchema</span></span></code></pre></div><p>Schema to call the <a href="https://www.together.ai/" target="_blank" rel="noreferrer">Together.ai</a> API.</p><p>Links:</p><ul><li><p><a href="https://api.together.xyz/settings/api-keys" target="_blank" rel="noreferrer">Get your API key</a></p></li><li><p><a href="https://docs.together.ai/docs/openai-api-compatibility" target="_blank" rel="noreferrer">API Reference</a></p></li><li><p><a href="https://docs.together.ai/docs/inference-models" target="_blank" rel="noreferrer">Available models</a></p></li></ul><p>Requires one environment variables to be set:</p><ul><li><code>TOGETHER_API_KEY</code>: Your API key</li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L188-L200" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Tool" href="#PromptingTools.Tool">#</a> <b><u>PromptingTools.Tool</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Tool</span></span></code></pre></div><p>A tool that can be sent to an LLM for execution (&quot;function calling&quot;).</p><p><strong>Arguments</strong></p><ul><li><p><code>name::String</code>: The name of the tool.</p></li><li><p><code>parameters::Dict</code>: The parameters of the tool.</p></li><li><p><code>description::Union{String, Nothing}</code>: The description of the tool.</p></li><li><p><code>strict::Union{Bool, Nothing}</code>: Whether to enforce strict mode for the tool.</p></li><li><p><code>callable::Any</code>: The callable object of the tool, eg, a type or a function.</p></li></ul><p>See also: <a href="/PromptingTools.jl/dev/reference#PromptingTools.AbstractTool"><code>AbstractTool</code></a>, <a href="/PromptingTools.jl/dev/reference#PromptingTools.tool_call_signature-Tuple{Union{Method, Type}}"><code>tool_call_signature</code></a></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L28-L41" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.Tool-Tuple{Union{Function, Method, Type}}" href="#PromptingTools.Tool-Tuple{Union{Function, Method, Type}}">#</a> <b><u>PromptingTools.Tool</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Tool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(callable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Function, Type, Method}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Create a <code>Tool</code> from a callable object (function, type, or method).</p><p><strong>Arguments</strong></p><ul><li><code>callable::Union{Function, Type, Method}</code>: The callable object to convert to a tool.</li></ul><p><strong>Returns</strong></p><ul><li><code>Tool</code>: A tool object that can be used for function calling.</li></ul><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create a tool from a function</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Tool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(my_function)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create a tool from a type</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Tool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(MyStruct)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L877-L896" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.ToolExecutionError" href="#PromptingTools.ToolExecutionError">#</a> <b><u>PromptingTools.ToolExecutionError</u></b> — <i>Type</i>. <p>Error type for when a tool execution fails. It should contain the error message from the tool execution.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L96" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.ToolGenericError" href="#PromptingTools.ToolGenericError">#</a> <b><u>PromptingTools.ToolGenericError</u></b> — <i>Type</i>. <p>Error type for when a tool execution fails with a generic error. It should contain the detailed error message.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L102" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.ToolMessage" href="#PromptingTools.ToolMessage">#</a> <b><u>PromptingTools.ToolMessage</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ToolMessage</span></span></code></pre></div><p>A message type for tool calls.</p><p>It represents both the request (fields <code>args</code>, <code>name</code>) and the response (field <code>content</code>).</p><p><strong>Fields</strong></p><ul><li><p><code>content::Any</code>: The content of the message.</p></li><li><p><code>req_id::Union{Nothing, Int}</code>: The unique ID of the request.</p></li><li><p><code>tool_call_id::String</code>: The unique ID of the tool call.</p></li><li><p><code>raw::AbstractString</code>: The raw JSON string of the tool call request.</p></li><li><p><code>args::Union{Nothing, Dict{Symbol, Any}}</code>: The arguments of the tool call request.</p></li><li><p><code>name::Union{Nothing, String}</code>: The name of the tool call request.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L175-L189" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.ToolNotFoundError" href="#PromptingTools.ToolNotFoundError">#</a> <b><u>PromptingTools.ToolNotFoundError</u></b> — <i>Type</i>. <p>Error type for when a tool is not found. It should contain the tool name that was not found.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L91" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.ToolRef" href="#PromptingTools.ToolRef">#</a> <b><u>PromptingTools.ToolRef</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ToolRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ref</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Symbol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, callable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Represents a reference to a tool with a symbolic name and a callable object (to call during tool execution). It can be rendered with a <code>render</code> method and a prompt schema.</p><p><strong>Arguments</strong></p><ul><li><p><code>ref::Symbol</code>: The symbolic name of the tool.</p></li><li><p><code>callable::Any</code>: The callable object of the tool, eg, a type or a function.</p></li><li><p><code>extras::Dict{String, Any}</code>: Additional parameters to be included in the tool signature.</p></li></ul><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Define a tool with a symbolic name and a callable object</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ToolRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;ref</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:computer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, callable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">println)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Show the rendered tool signature</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AnthropicSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), tool)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L51-L70" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.TracerMessage" href="#PromptingTools.TracerMessage">#</a> <b><u>PromptingTools.TracerMessage</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TracerMessage{T </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Union{AbstractChatMessage, AbstractDataMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractTracerMessage</span></span></code></pre></div><p>A mutable wrapper message designed for tracing the flow of messages through the system, allowing for iterative updates and providing additional metadata for observability.</p><p><strong>Fields</strong></p><ul><li><p><code>object::T</code>: The original message being traced, which can be either a chat or data message.</p></li><li><p><code>from::Union{Nothing, Symbol}</code>: The identifier of the sender of the message.</p></li><li><p><code>to::Union{Nothing, Symbol}</code>: The identifier of the intended recipient of the message.</p></li><li><p><code>viewers::Vector{Symbol}</code>: A list of identifiers for entities that have access to view the message, in addition to the sender and recipient.</p></li><li><p><code>time_received::DateTime</code>: The timestamp when the message was received by the tracing system.</p></li><li><p><code>time_sent::Union{Nothing, DateTime}</code>: The timestamp when the message was originally sent, if available.</p></li><li><p><code>model::String</code>: The name of the model that generated the message. Defaults to empty.</p></li><li><p><code>parent_id::Symbol</code>: An identifier for the job or process that the message is associated with. Higher-level tracing ID.</p></li><li><p><code>thread_id::Symbol</code>: An identifier for the thread (series of messages for one model/agent) or execution context within the job where the message originated. It should be the same for messages in the same thread.</p></li><li><p><code>meta::Union{Nothing, Dict{Symbol, Any}}</code>: A dictionary for additional metadata that is not part of the message itself. Try to limit to a small number of items and singletons to be serializable.</p></li><li><p><code>_type::Symbol</code>: A fixed symbol identifying the type of the message as <code>:eventmessage</code>, used for type discrimination.</p></li></ul><p>This structure is particularly useful for debugging, monitoring, and auditing the flow of messages in systems that involve complex interactions or asynchronous processing.</p><p>All fields are optional besides the <code>object</code>.</p><p>Useful methods: <code>pprint</code> (pretty prints the underlying message), <code>unwrap</code> (to get the <code>object</code> out of tracer), <code>align_tracer!</code> (to set all shared IDs in a vector of tracers to the same), <code>istracermessage</code> to check if given message is an AbstractTracerMessage</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wrap_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TracerSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(wrap_schema, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gpt4t&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># isa TracerMessage</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># access content like if it was the message</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L382-L413" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.TracerMessageLike" href="#PromptingTools.TracerMessageLike">#</a> <b><u>PromptingTools.TracerMessageLike</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TracerMessageLike{T </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractTracer</span></span></code></pre></div><p>A mutable structure designed for general-purpose tracing within the system, capable of handling any type of object that is part of the AI Conversation. It provides a flexible way to track and annotate objects as they move through different parts of the system, facilitating debugging, monitoring, and auditing.</p><p><strong>Fields</strong></p><ul><li><p><code>object::T</code>: The original object being traced.</p></li><li><p><code>from::Union{Nothing, Symbol}</code>: The identifier of the sender or origin of the object.</p></li><li><p><code>to::Union{Nothing, Symbol}</code>: The identifier of the intended recipient or destination of the object.</p></li><li><p><code>viewers::Vector{Symbol}</code>: A list of identifiers for entities that have access to view the object, in addition to the sender and recipient.</p></li><li><p><code>time_received::DateTime</code>: The timestamp when the object was received by the tracing system.</p></li><li><p><code>time_sent::Union{Nothing, DateTime}</code>: The timestamp when the object was originally sent, if available.</p></li><li><p><code>model::String</code>: The name of the model or process that generated or is associated with the object. Defaults to empty.</p></li><li><p><code>parent_id::Symbol</code>: An identifier for the job or process that the object is associated with. Higher-level tracing ID.</p></li><li><p><code>thread_id::Symbol</code>: An identifier for the thread or execution context (sub-task, sub-process) within the job where the object originated. It should be the same for objects in the same thread.</p></li><li><p><code>run_id::Union{Nothing, Int}</code>: A unique identifier for the run or instance of the process (ie, a single call to the LLM) that generated the object. Defaults to a random integer.</p></li><li><p><code>meta::Union{Nothing, Dict{Symbol, Any}}</code>: A dictionary for additional metadata that is not part of the object itself. Try to limit to a small number of items and singletons to be serializable.</p></li><li><p><code>_type::Symbol</code>: A fixed symbol identifying the type of the tracer as <code>:tracermessage</code>, used for type discrimination.</p></li></ul><p>This structure is particularly useful for systems that involve complex interactions or asynchronous processing, where tracking the flow and transformation of objects is crucial.</p><p>All fields are optional besides the <code>object</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L434-L457" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.TracerSchema" href="#PromptingTools.TracerSchema">#</a> <b><u>PromptingTools.TracerSchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TracerSchema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AbstractTracerSchema</span></span></code></pre></div><p>A schema designed to wrap another schema, enabling pre- and post-execution callbacks for tracing and additional functionalities. This type is specifically utilized within the <code>TracerMessage</code> type to trace the execution flow, facilitating observability and debugging in complex conversational AI systems.</p><p>The <code>TracerSchema</code> acts as a middleware, allowing developers to insert custom logic before and after the execution of the primary schema&#39;s functionality. This can include logging, performance measurement, or any other form of tracing required to understand or improve the execution flow.</p><p><code>TracerSchema</code> automatically wraps messages in <code>TracerMessage</code> type, which has several important fields, eg,</p><ul><li><p><code>object</code>: the original message - unwrap with utility <code>unwrap</code></p></li><li><p><code>meta</code>: a dictionary with metadata about the tracing process (eg, prompt templates, LLM API kwargs) - extract with utility <code>meta</code></p></li><li><p><code>parent_id</code>: an identifier for the overall job / high-level conversation with the user where the current conversation <code>thread</code> originated. It should be the same for objects in the same thread.</p></li><li><p><code>thread_id</code>: an identifier for the current thread or execution context (sub-task, sub-process, CURRENT CONVERSATION or vector of messages) within the broader parent task. It should be the same for objects in the same thread.</p></li></ul><p>See also: <code>meta</code>, <code>unwrap</code>, <code>SaverSchema</code>, <code>initialize_tracer</code>, <code>finalize_tracer</code></p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wrap_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TracerSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(wrap_schema, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt-4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># output type should be TracerMessage</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">isa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TracerMessage</span></span></code></pre></div><p>You can define your own tracer schema and the corresponding methods: <code>initialize_tracer</code>, <code>finalize_tracer</code>. See <code>src/llm_tracer.jl</code></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L444-L467" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.UserMessage" href="#PromptingTools.UserMessage">#</a> <b><u>PromptingTools.UserMessage</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">UserMessage</span></span></code></pre></div><p>A message type for user-generated text-based responses. Consumed by <code>ai*</code> functions to generate responses.</p><p><strong>Fields</strong></p><ul><li><p><code>content::T</code>: The content of the message.</p></li><li><p><code>variables::Vector{Symbol}</code>: The variables in the message.</p></li><li><p><code>name::Union{Nothing, String}</code>: The name of the <code>role</code> in the conversation.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L53-L63" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.UserMessageWithImages" href="#PromptingTools.UserMessageWithImages">#</a> <b><u>PromptingTools.UserMessageWithImages</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">UserMessageWithImages</span></span></code></pre></div><p>A message type for user-generated text-based responses with images. Consumed by <code>ai*</code> functions to generate responses.</p><p><strong>Fields</strong></p><ul><li><p><code>content::T</code>: The content of the message.</p></li><li><p><code>image_url::Vector{String}</code>: The URLs of the images.</p></li><li><p><code>variables::Vector{Symbol}</code>: The variables in the message.</p></li><li><p><code>name::Union{Nothing, String}</code>: The name of the <code>role</code> in the conversation.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L80-L91" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.UserMessageWithImages-Tuple{AbstractString}" href="#PromptingTools.UserMessageWithImages-Tuple{AbstractString}">#</a> <b><u>PromptingTools.UserMessageWithImages</u></b> — <i>Method</i>. <p>Construct <code>UserMessageWithImages</code> with 1 or more images. Images can be either URLs or local paths.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L323" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.X123" href="#PromptingTools.X123">#</a> <b><u>PromptingTools.X123</u></b> — <i>Type</i>. <p>With docstring</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/precompilation.jl#L61" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.XAIOpenAISchema" href="#PromptingTools.XAIOpenAISchema">#</a> <b><u>PromptingTools.XAIOpenAISchema</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">XAIOpenAISchema</span></span></code></pre></div><p>Schema to call the XAI API. It follows OpenAI API conventions.</p><p>Get your API key from <a href="https://console.x.ai/" target="_blank" rel="noreferrer">here</a>.</p><p>Requires one environment variable to be set:</p><ul><li><code>XAI_API_KEY</code>: Your API key</li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L275-L284" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="Base.append!-Tuple{ConversationMemory, Vector{&lt;:PromptingTools.AbstractMessage}}" href="#Base.append!-Tuple{ConversationMemory, Vector{&lt;:PromptingTools.AbstractMessage}}">#</a> <b><u>Base.append!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">append!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ConversationMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, msgs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Smart append that handles duplicate messages based on run IDs. Only appends messages that are newer than the latest matching message in memory.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/memory.jl#L232-L237" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="Base.length-Tuple{ConversationMemory}" href="#Base.length-Tuple{ConversationMemory}">#</a> <b><u>Base.length</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ConversationMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Return the number of messages. All of them.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/memory.jl#L74-L78" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="Base.push!-Tuple{ConversationMemory, PromptingTools.AbstractMessage}" href="#Base.push!-Tuple{ConversationMemory, PromptingTools.AbstractMessage}">#</a> <b><u>Base.push!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ConversationMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Add a single message to the conversation memory.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/memory.jl#L268-L272" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="Base.show-Tuple{IO, ConversationMemory}" href="#Base.show-Tuple{IO, ConversationMemory}">#</a> <b><u>Base.show</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">show</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(io</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, mem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ConversationMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Display the number of non-system/non-annotation messages in the conversation memory.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/memory.jl#L63-L67" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="OpenAI.create_chat-Tuple{PromptingTools.CustomOpenAISchema, AbstractString, AbstractString, Any}" href="#OpenAI.create_chat-Tuple{PromptingTools.CustomOpenAISchema, AbstractString, AbstractString, Any}">#</a> <b><u>OpenAI.create_chat</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">OpenAI</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">create_chat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CustomOpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    streamcallback</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Any</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://localhost:8080&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Dispatch to the OpenAI.create_chat function, for any OpenAI-compatible API.</p><p>It expects <code>url</code> keyword argument. Provide it to the <code>aigenerate</code> function via <code>api_kwargs=(; url=&quot;my-url&quot;)</code></p><p>It will forward your query to the &quot;chat/completions&quot; endpoint of the base URL that you provided (=<code>url</code>).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_openai_schema_defs.jl#L59-L74" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="OpenAI.create_chat-Tuple{PromptingTools.LocalServerOpenAISchema, AbstractString, AbstractString, Any}" href="#OpenAI.create_chat-Tuple{PromptingTools.LocalServerOpenAISchema, AbstractString, AbstractString, Any}">#</a> <b><u>OpenAI.create_chat</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">OpenAI</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">create_chat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">LocalServerOpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://localhost:8080&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Dispatch to the OpenAI.create_chat function, but with the LocalServer API parameters, ie, defaults to <code>url</code> specified by the <code>LOCAL_SERVER</code>preference. See<code>?PREFERENCES</code></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_openai_schema_defs.jl#L102-L112" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="OpenAI.create_chat-Tuple{PromptingTools.MistralOpenAISchema, AbstractString, AbstractString, Any}" href="#OpenAI.create_chat-Tuple{PromptingTools.MistralOpenAISchema, AbstractString, AbstractString, Any}">#</a> <b><u>OpenAI.create_chat</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">OpenAI</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">create_chat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MistralOpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span></code></pre></div><p>api_key::AbstractString, model::AbstractString, conversation; url::String=&quot;<a href="https://api.mistral.ai/v1" target="_blank" rel="noreferrer">https://api.mistral.ai/v1</a>&quot;, kwargs...)</p><p>Dispatch to the OpenAI.create_chat function, but with the MistralAI API parameters.</p><p>It tries to access the <code>MISTRAL_API_KEY</code> ENV variable, but you can also provide it via the <code>api_key</code> keyword argument.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_openai_schema_defs.jl#L122-L133" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aiclassify-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aiclassify-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aiclassify</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiclassify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tracer_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractTracerSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tracer_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Wraps the normal <code>aiclassify</code> call in a tracing/callback system. Use <code>tracer_kwargs</code> to provide any information necessary to the tracer/callback system only (eg, <code>parent_id</code>, <code>thread_id</code>, <code>run_id</code>).</p><p>Logic:</p><ul><li><p>calls <code>initialize_tracer</code></p></li><li><p>calls <code>aiclassify</code> (with the <code>tracer_schema.schema</code>)</p></li><li><p>calls <code>finalize_tracer</code></p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_tracer.jl#L241-L251" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aiclassify-Union{Tuple{T}, Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}} where T&lt;:Union{AbstractString, Tuple{var&quot;#s16&quot;, var&quot;#s15&quot;} where {var&quot;#s16&quot;&lt;:AbstractString, var&quot;#s15&quot;&lt;:AbstractString}}" href="#PromptingTools.aiclassify-Union{Tuple{T}, Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}} where T&lt;:Union{AbstractString, Tuple{var&quot;#s16&quot;, var&quot;#s15&quot;} where {var&quot;#s16&quot;&lt;:AbstractString, var&quot;#s15&quot;&lt;:AbstractString}}">#</a> <b><u>PromptingTools.aiclassify</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiclassify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractOpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    choices</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{T}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;true&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;false&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;unknown&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gpt-4o-mini,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    api_kwargs::NamedTuple = NamedTuple(),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    token_ids_map::Union{Nothing, Dict{&lt;:AbstractString, &lt;:Integer}} = nothing,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    kwargs...) where {T &lt;: Union{AbstractString, Tuple{&lt;:AbstractString, &lt;:AbstractString}}}</span></span></code></pre></div><p>Classifies the given prompt/statement into an arbitrary list of <code>choices</code>, which must be only the choices (vector of strings) or choices and descriptions are provided (vector of tuples, ie, <code>(&quot;choice&quot;,&quot;description&quot;)</code>).</p><p>It&#39;s quick and easy option for &quot;routing&quot; and similar use cases, as it exploits the logit bias trick and outputs only 1 token. classify into an arbitrary list of categories (including with descriptions). It&#39;s quick and easy option for &quot;routing&quot; and similar use cases, as it exploits the logit bias trick, so it outputs only 1 token.</p><p>!!! Note: The prompt/AITemplate must have a placeholder <code>choices</code> (ie, <code></code>) that will be replaced with the encoded choices</p><p>Choices are rewritten into an enumerated list and mapped to a few known OpenAI tokens (maximum of 40 choices supported). Mapping of token IDs for GPT3.5/4 are saved in variable <code>OPENAI_TOKEN_IDS</code>.</p><p>It uses Logit bias trick and limits the output to 1 token to force the model to output only true/false/unknown. Credit for the idea goes to <a href="https://twitter.com/AAAzzam/status/1669753721574633473" target="_blank" rel="noreferrer">AAAzzam</a>.</p><p><strong>Arguments</strong></p><ul><li><p><code>prompt_schema::AbstractOpenAISchema</code>: The schema for the prompt.</p></li><li><p><code>prompt</code>: The prompt/statement to classify if it&#39;s a <code>String</code>. If it&#39;s a <code>Symbol</code>, it is expanded as a template via <code>render(schema,template)</code>. Eg, templates <code>:JudgeIsItTrue</code> or <code>:InputClassifier</code></p></li><li><p><code>choices::AbstractVector{T}</code>: The choices to be classified into. It can be a vector of strings or a vector of tuples, where the first element is the choice and the second is the description.</p></li><li><p><code>model::AbstractString = &quot;gpt-4o-mini&quot;</code>: The model to use for classification. Can be an alias corresponding to a model ID defined in <code>MODEL_ALIASES</code>.</p></li><li><p><code>api_kwargs::NamedTuple = NamedTuple()</code>: Additional keyword arguments for the API call.</p></li><li><p><code>token_ids_map::Union{Nothing, Dict{&lt;:AbstractString, &lt;:Integer}} = nothing</code>: A dictionary mapping custom token IDs to their corresponding integer values. If <code>nothing</code>, it will use the default token IDs for the given model.</p></li><li><p><code>kwargs</code>: Additional keyword arguments for the prompt template.</p></li></ul><p><strong>Example</strong></p><p>Given a user input, pick one of the two provided categories:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">choices </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;animal&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;plant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">input </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Palm tree&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiclassify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:InputClassifier</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; choices, input)</span></span></code></pre></div><p>Choices with descriptions provided as tuples:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">choices </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;any animal or creature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;P&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;any plant or tree&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;O&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;anything else&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># try the below inputs:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">input </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;spider&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # -&gt; returns &quot;A&quot; for any animal or creature</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">input </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;daphodil&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # -&gt; returns &quot;P&quot; for any plant or tree</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">input </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;castle&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # -&gt; returns &quot;O&quot; for everything else</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiclassify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:InputClassifier</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; choices, input)</span></span></code></pre></div><p>You could also use this function for routing questions to different endpoints (notice the different template and placeholder used), eg,</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">choices </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;any question about animal or creature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;P&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;any question about plant or tree&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;O&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;anything else&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">question </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;how many spiders are there?&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiclassify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:QuestionRouter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; choices, question)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;A&quot;</span></span></code></pre></div><p>You can still use a simple true/false classification:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiclassify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Is two plus two four?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># true</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiclassify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Is two plus three a vegetable on Mars?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># false</span></span></code></pre></div><p><code>aiclassify</code> returns only true/false/unknown. It&#39;s easy to get the proper <code>Bool</code> output type out with <code>tryparse</code>, eg,</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tryparse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Bool, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiclassify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Is two plus two four?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">isa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Bool </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># true</span></span></code></pre></div><p>Output of type <code>Nothing</code> marks that the model couldn&#39;t classify the statement as true/false.</p><p>Ideally, we would like to re-use some helpful system prompt to get more accurate responses. For this reason we have templates, eg, <code>:JudgeIsItTrue</code>. By specifying the template, we can provide our statement as the expected variable (<code>it</code> in this case) See that the model now correctly classifies the statement as &quot;unknown&quot;.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiclassify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:JudgeIsItTrue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; it </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Is two plus three a vegetable on Mars?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># unknown</span></span></code></pre></div><p>For better results, use higher quality models like gpt4, eg,</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiclassify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:JudgeIsItTrue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    it </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;If I had two apples and I got three more, I have five apples now.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gpt4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># true</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_openai.jl#L745-L826" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aiembed" href="#PromptingTools.aiembed">#</a> <b><u>PromptingTools.aiembed</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiembed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tracer_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractTracerSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    doc_or_docs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{AbstractString, AbstractVector{&lt;:AbstractString}}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, postprocess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Function</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> identity;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tracer_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Wraps the normal <code>aiembed</code> call in a tracing/callback system. Use <code>tracer_kwargs</code> to provide any information necessary to the tracer/callback system only (eg, <code>parent_id</code>, <code>thread_id</code>, <code>run_id</code>).</p><p>Logic:</p><ul><li><p>calls <code>initialize_tracer</code></p></li><li><p>calls <code>aiembed</code> (with the <code>tracer_schema.schema</code>)</p></li><li><p>calls <code>finalize_tracer</code></p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_tracer.jl#L218-L229" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aiembed-Union{Tuple{F}, Tuple{PromptingTools.AbstractOllamaManagedSchema, AbstractString}, Tuple{PromptingTools.AbstractOllamaManagedSchema, AbstractString, F}} where F&lt;:Function" href="#PromptingTools.aiembed-Union{Tuple{F}, Tuple{PromptingTools.AbstractOllamaManagedSchema, AbstractString}, Tuple{PromptingTools.AbstractOllamaManagedSchema, AbstractString, F}} where F&lt;:Function">#</a> <b><u>PromptingTools.aiembed</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiembed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractOllamaManagedSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        doc_or_docs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{AbstractString, AbstractVector{&lt;:AbstractString}}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        postprocess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">F</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> identity;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MODEL_EMBEDDING,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (retry_non_idempotent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   retries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   readtimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {F </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>The <code>aiembed</code> function generates embeddings for the given input using a specified model and returns a message object containing the embeddings, status, token count, and elapsed time.</p><p><strong>Arguments</strong></p><ul><li><p><code>prompt_schema::AbstractOllamaManagedSchema</code>: The schema for the prompt.</p></li><li><p><code>doc_or_docs::Union{AbstractString, AbstractVector{&lt;:AbstractString}}</code>: The document or list of documents to generate embeddings for. The list of documents is processed sequentially, so users should consider implementing an async version with with <code>Threads.@spawn</code></p></li><li><p><code>postprocess::F</code>: The post-processing function to apply to each embedding. Defaults to the identity function, but could be <code>LinearAlgebra.normalize</code>.</p></li><li><p><code>verbose::Bool</code>: A flag indicating whether to print verbose information. Defaults to <code>true</code>.</p></li><li><p><code>api_key::String</code>: The API key to use for the OpenAI API. Defaults to <code>&quot;&quot;</code>.</p></li><li><p><code>model::String</code>: The model to use for generating embeddings. Defaults to <code>MODEL_EMBEDDING</code>.</p></li><li><p><code>http_kwargs::NamedTuple</code>: Additional keyword arguments for the HTTP request. Defaults to empty <code>NamedTuple</code>.</p></li><li><p><code>api_kwargs::NamedTuple</code>: Additional keyword arguments for the Ollama API. Defaults to an empty <code>NamedTuple</code>.</p></li><li><p><code>kwargs</code>: Prompt variables to be used to fill the prompt/template</p></li></ul><p><strong>Returns</strong></p><ul><li><code>msg</code>: A <code>DataMessage</code> object containing the embeddings, status, token count, and elapsed time.</li></ul><p>Note: Ollama API currently does not return the token count, so it&#39;s set to <code>(0,0)</code></p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OllamaManagedSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiembed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;openhermes2.5-mistral&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4096-element JSON3.Array{Float64...</span></span></code></pre></div><p>We can embed multiple strings at once and they will be <code>hcat</code> into a matrix (ie, each column corresponds to one string)</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OllamaManagedSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiembed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema, [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;How are you?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;openhermes2.5-mistral&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4096×2 Matrix{Float64}:</span></span></code></pre></div><p>If you plan to calculate the cosine distance between embeddings, you can normalize them first:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LinearAlgebra</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OllamaManagedSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiembed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema, [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;embed me&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;and me too&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], LinearAlgebra</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">normalize; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;openhermes2.5-mistral&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># calculate cosine distance between the two normalized embeddings as a simple dot product</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content[:, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [1.0, 0.34]</span></span></code></pre></div><p>Similarly, you can use the <code>postprocess</code> argument to materialize the data from JSON3.Object by using <code>postprocess = copy</code></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OllamaManagedSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiembed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, copy; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;openhermes2.5-mistral&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4096-element Vector{Float64}</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_ollama_managed.jl#L264-L337" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aiembed-Union{Tuple{F}, Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, AbstractVector{&lt;:AbstractString}}}, Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, AbstractVector{&lt;:AbstractString}}, F}} where F&lt;:Function" href="#PromptingTools.aiembed-Union{Tuple{F}, Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, AbstractVector{&lt;:AbstractString}}}, Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, AbstractVector{&lt;:AbstractString}}, F}} where F&lt;:Function">#</a> <b><u>PromptingTools.aiembed</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiembed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractOpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        doc_or_docs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{AbstractString, AbstractVector{&lt;:AbstractString}}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        postprocess</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">F</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> identity;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OPENAI_API_KEY,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MODEL_EMBEDDING, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (retry_non_idempotent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   retries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                   readtimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {F </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>The <code>aiembed</code> function generates embeddings for the given input using a specified model and returns a message object containing the embeddings, status, token count, and elapsed time.</p><p><strong>Arguments</strong></p><ul><li><p><code>prompt_schema::AbstractOpenAISchema</code>: The schema for the prompt.</p></li><li><p><code>doc_or_docs::Union{AbstractString, AbstractVector{&lt;:AbstractString}}</code>: The document or list of documents to generate embeddings for.</p></li><li><p><code>postprocess::F</code>: The post-processing function to apply to each embedding. Defaults to the identity function.</p></li><li><p><code>verbose::Bool</code>: A flag indicating whether to print verbose information. Defaults to <code>true</code>.</p></li><li><p><code>api_key::String</code>: The API key to use for the OpenAI API. Defaults to <code>OPENAI_API_KEY</code>.</p></li><li><p><code>model::String</code>: The model to use for generating embeddings. Defaults to <code>MODEL_EMBEDDING</code>.</p></li><li><p><code>http_kwargs::NamedTuple</code>: Additional keyword arguments for the HTTP request. Defaults to <code>(retry_non_idempotent = true, retries = 5, readtimeout = 120)</code>.</p></li><li><p><code>api_kwargs::NamedTuple</code>: Additional keyword arguments for the OpenAI API. Defaults to an empty <code>NamedTuple</code>.</p></li><li><p><code>kwargs...</code>: Additional keyword arguments.</p></li></ul><p><strong>Returns</strong></p><ul><li><code>msg</code>: A <code>DataMessage</code> object containing the embeddings, status, token count, and elapsed time. Use <code>msg.content</code> to access the embeddings.</li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiembed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1536-element JSON3.Array{Float64...</span></span></code></pre></div><p>We can embed multiple strings at once and they will be <code>hcat</code> into a matrix (ie, each column corresponds to one string)</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiembed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;How are you?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1536×2 Matrix{Float64}:</span></span></code></pre></div><p>If you plan to calculate the cosine distance between embeddings, you can normalize them first:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LinearAlgebra</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiembed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;embed me&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;and me too&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], LinearAlgebra</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">normalize)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># calculate cosine distance between the two normalized embeddings as a simple dot product</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content[:, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [1.0, 0.787]</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_openai.jl#L392-L444" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aiextract-Tuple{PromptingTools.AbstractAnthropicSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aiextract-Tuple{PromptingTools.AbstractAnthropicSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aiextract</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiextract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractAnthropicSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Type, AbstractTool, Vector}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_API_KEY,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MODEL_CHAT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, dry_run</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    no_system_message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (retry_non_idempotent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        retries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        readtimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Symbol}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    betas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Vector{Symbol}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Extract required information (defined by a struct <strong><code>return_type</code></strong>) from the provided prompt by leveraging Anthropic&#39;s function calling mode.</p><p>This is a perfect solution for extracting structured information from text (eg, extract organization names in news articles, etc.).</p><p>Read best practics <a href="https://docs.anthropic.com/claude/docs/tool-use#tool-use-best-practices-and-limitations" target="_blank" rel="noreferrer">here</a>.</p><p>It&#39;s effectively a light wrapper around <code>aigenerate</code> call, which requires additional keyword argument <code>return_type</code> to be provided and will enforce the model outputs to adhere to it.</p><p><strong>Arguments</strong></p><ul><li><p><code>prompt_schema</code>: An optional object to specify which prompt template should be applied (Default to <code>PROMPT_SCHEMA = OpenAISchema</code>)</p></li><li><p><code>prompt</code>: Can be a string representing the prompt for the AI conversation, a <code>UserMessage</code>, a vector of <code>AbstractMessage</code> or an <code>AITemplate</code></p></li><li><p><code>return_type</code>: A <strong>struct</strong> TYPE representing the the information we want to extract. Do not provide a struct instance, only the type. If the struct has a docstring, it will be provided to the model as well. It&#39;s used to enforce structured model outputs or provide more information. Alternatively, you can provide a vector of field names and their types (see <code>?generate_struct</code> function for the syntax).</p></li><li><p><code>verbose</code>: A boolean indicating whether to print additional information.</p></li><li><p><code>api_key</code>: A string representing the API key for accessing the OpenAI API.</p></li><li><p><code>model</code>: A string representing the model to use for generating the response. Can be an alias corresponding to a model ID defined in <code>MODEL_ALIASES</code>.</p></li><li><p><code>return_all::Bool=false</code>: If <code>true</code>, returns the entire conversation history, otherwise returns only the last message (the <code>AIMessage</code>).</p></li><li><p><code>dry_run::Bool=false</code>: If <code>true</code>, skips sending the messages to the model (for debugging, often used with <code>return_all=true</code>).</p></li><li><p><code>conversation</code>: An optional vector of <code>AbstractMessage</code> objects representing the conversation history. If not provided, it is initialized as an empty vector.</p></li><li><p><code>no_system_message::Bool = false</code>: If <code>true</code>, skips the system message in the conversation history.</p></li><li><p><code>http_kwargs</code>: A named tuple of HTTP keyword arguments.</p></li><li><p><code>api_kwargs</code>: A named tuple of API keyword arguments.</p><ul><li><code>:tool_choice</code>: A string indicating which tool to use. Supported values are <code>nothing</code>, <code>&quot;auto&quot;</code>, <code>&quot;any&quot;</code> and <code>&quot;exact&quot;</code>. <code>nothing</code> will use the default tool choice.</li></ul></li><li><p><code>cache</code>: A symbol representing the caching strategy to be used. Currently only <code>nothing</code> (no caching), <code>:system</code>, <code>:tools</code>,<code>:last</code>, <code>:all_but_last</code>, and <code>:all</code> are supported. Note: COST estimate will be wrong (ignores the caching).</p><ul><li><p><code>:system</code>: Mark only the system message as cacheable. Best default if you have large system message and you will be sending short conversations (no replies / multi-turn conversations).</p></li><li><p><code>:all</code>: Mark SYSTEM, one before last and LAST user message as cacheable. Best for multi-turn conversations (you write cache point as &quot;last&quot; and it will be read in the next turn as &quot;preceding&quot; cache mark).</p></li><li><p><code>:last</code>: Mark only the last message as cacheable. Use ONLY if you want to send the SAME REQUEST multiple times (and want to save upto the last USER message). This will not work for multi-turn conversations, as the &quot;last&quot; message keeps moving.</p></li><li><p><code>:all_but_last</code>: Mark SYSTEM and one before LAST USER message. Use if you have a longer conversation that you want to re-use, but you will NOT CONTINUE it (no subsequent messages/follow-ups).</p></li><li><p>In short, use <code>:all</code> for multi-turn conversations, <code>:system</code> for repeated single-turn conversations with same system message, and <code>:all_but_last</code> for longer conversations that you want to re-use, but not continue.</p></li></ul></li><li><p><code>betas::Union{Nothing, Vector{Symbol}}</code>: A vector of symbols representing the beta features to be used. See <code>?anthropic_extra_headers</code> for details.</p></li><li><p><code>kwargs</code>: Prompt variables to be used to fill the prompt/template</p></li></ul><p>Note: At the moment, the cache is only allowed for prompt segments over 1024 tokens (in some cases, over 2048 tokens). You&#39;ll get an error if you try to cache short prompts.</p><p><strong>Returns</strong></p><p>If <code>return_all=false</code> (default):</p><ul><li><code>msg</code>: An <code>DataMessage</code> object representing the extracted data, including the content, status, tokens, and elapsed time. Use <code>msg.content</code> to access the extracted data.</li></ul><p>If <code>return_all=true</code>:</p><ul><li><code>conversation</code>: A vector of <code>AbstractMessage</code> objects representing the full conversation history, including the response from the AI model (<code>DataMessage</code>).</li></ul><p>See also: <code>tool_call_signature</code>, <code>MaybeExtract</code>, <code>ItemsExtract</code>, <code>aigenerate</code></p><p><strong>Example</strong></p><p>Do you want to extract some specific measurements from a text like age, weight and height? You need to define the information you need as a struct (<code>return_type</code>):</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&quot;Person&#39;s age, height, and weight.&quot;</span></span>
<span class="line"><span>struct MyMeasurement</span></span>
<span class="line"><span>    age::Int # required</span></span>
<span class="line"><span>    height::Union{Int,Nothing} # optional</span></span>
<span class="line"><span>    weight::Union{Nothing,Float64} # optional</span></span>
<span class="line"><span>end</span></span>
<span class="line"><span>msg = aiextract(&quot;James is 30, weighs 80kg. He&#39;s 180cm tall.&quot;; model=&quot;claudeh&quot;, return_type=MyMeasurement)</span></span>
<span class="line"><span># PromptingTools.DataMessage(MyMeasurement)</span></span>
<span class="line"><span>msg.content</span></span>
<span class="line"><span># MyMeasurement(30, 180, 80.0)</span></span></code></pre></div><p>The fields that allow <code>Nothing</code> are marked as optional in the schema:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>msg = aiextract(&quot;James is 30.&quot;; model=&quot;claudeh&quot;, return_type=MyMeasurement)</span></span>
<span class="line"><span># MyMeasurement(30, nothing, nothing)</span></span></code></pre></div><p>If there are multiple items you want to extract, define a wrapper struct to get a Vector of <code>MyMeasurement</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>struct ManyMeasurements</span></span>
<span class="line"><span>    measurements::Vector{MyMeasurement}</span></span>
<span class="line"><span>end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>msg = aiextract(&quot;James is 30, weighs 80kg. He&#39;s 180cm tall. Then Jack is 19 but really tall - over 190!&quot;; model=&quot;claudeh&quot;, return_type=ManyMeasurements)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>msg.content.measurements</span></span>
<span class="line"><span># 2-element Vector{MyMeasurement}:</span></span>
<span class="line"><span>#  MyMeasurement(30, 180, 80.0)</span></span>
<span class="line"><span>#  MyMeasurement(19, 190, nothing)</span></span></code></pre></div><p>Or you can use the convenience wrapper <code>ItemsExtract</code> to extract multiple measurements (zero, one or more):</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ItemsExtract</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">return_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ItemsExtract{MyMeasurement}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiextract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;James is 30, weighs 80kg. He&#39;s 180cm tall. Then Jack is 19 but really tall - over 190!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;claudeh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, return_type)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">items </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># see the extracted items</span></span></code></pre></div><p>Or if you want your extraction to fail gracefully when data isn&#39;t found, use <code>MaybeExtract{T}</code> wrapper (this trick is inspired by the Instructor package!):</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>using PromptingTools: MaybeExtract</span></span>
<span class="line"><span></span></span>
<span class="line"><span>return_type = MaybeExtract{MyMeasurement}</span></span>
<span class="line"><span># Effectively the same as:</span></span>
<span class="line"><span># struct MaybeExtract{T}</span></span>
<span class="line"><span>#     result::Union{T, Nothing}</span><span> // The result of the extraction</span></span>
<span class="line"><span>#     error::Bool</span><span> // true if a result is found, false otherwise</span></span>
<span class="line"><span>#     message::Union{Nothing, String}</span><span> // Only present if no result is found, should be short and concise</span></span>
<span class="line"><span># end</span></span>
<span class="line"><span></span></span>
<span class="line"><span># If LLM extraction fails, it will return a Dict with `error` and `message` fields instead of the result!</span></span>
<span class="line"><span>msg = aiextract(&quot;Extract measurements from the text: I am giraffe&quot;; model=&quot;claudeo&quot;, return_type)</span></span>
<span class="line"><span>msg.content</span></span>
<span class="line"><span># Output: MaybeExtract{MyMeasurement}(nothing, true, &quot;I&#39;m sorry, but your input of &quot;I am giraffe&quot; does not contain any information about a person&#39;s age, height or weight measurements that I can extract. To use this tool, please provide a statement that includes at least the person&#39;s age, and optionally their height in inches and weight in pounds. Without that information, I am unable to extract the requested measurements.&quot;)</span></span></code></pre></div><p>That way, you can handle the error gracefully and get a reason why extraction failed (in <code>msg.content.message</code>).</p><p>However, this can fail with weaker models like <code>claudeh</code>, so we can apply some of our prompt templates with embedding reasoning step:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiextract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:ExtractDataCoTXML</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I am giraffe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;claudeh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, return_type)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: MaybeExtract{MyMeasurement}(nothing, true, &quot;The provided data does not contain the expected information about a person&#39;s age, height, and weight.&quot;)</span></span></code></pre></div><p>Note that when using a prompt template, we provide <code>data</code> for the extraction as the corresponding placeholder (see <code>aitemplates(&quot;extract&quot;)</code> for documentation of this template).</p><p>Note that the error message refers to a giraffe not being a human, because in our <code>MyMeasurement</code> docstring, we said that it&#39;s for people!</p><p>Example of using a vector of field names with <code>aiextract</code></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fields </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:location</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Float64, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:condition</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiextract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Extract the following information from the text: location, temperature, condition. Text: The weather in New York is sunny and 72.5 degrees Fahrenheit.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">return_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fields, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;claudeh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Or simply call <code>aiextract(&quot;some text&quot;; return_type = [:reasoning,:answer], model=&quot;claudeh&quot;)</code> to get a Chain of Thought reasoning for extraction task.</p><p>It will be returned it a new generated type, which you can check with <code>PromptingTools.isextracted(msg.content) == true</code> to confirm the data has been extracted correctly.</p><p>This new syntax also allows you to provide field-level descriptions, which will be passed to the model.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fields_with_descriptions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    :location</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    :temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Float64,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    :temperature__description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Temperature in degrees Fahrenheit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    :condition</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    :condition__description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Current weather condition (e.g., sunny, rainy, cloudy)&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiextract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;The weather in New York is sunny and 72.5 degrees Fahrenheit.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; return_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fields_with_descriptions, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;claudeh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_anthropic.jl#L562-L725" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aiextract-Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aiextract-Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aiextract</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiextract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractOpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Type, AbstractTool, Vector}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OPENAI_API_KEY,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MODEL_CHAT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, dry_run</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (retry_non_idempotent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        retries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        readtimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tool_choice </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    strict</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Bool}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Extract required information (defined by a struct <strong><code>return_type</code></strong>) from the provided prompt by leveraging OpenAI function calling mode.</p><p>This is a perfect solution for extracting structured information from text (eg, extract organization names in news articles, etc.)</p><p>It&#39;s effectively a light wrapper around <code>aigenerate</code> call, which requires additional keyword argument <code>return_type</code> to be provided and will enforce the model outputs to adhere to it.</p><p>!!! Note: The types must be CONCRETE, it helps with correct conversion to JSON schema and then conversion back to the struct.</p><p><strong>Arguments</strong></p><ul><li><p><code>prompt_schema</code>: An optional object to specify which prompt template should be applied (Default to <code>PROMPT_SCHEMA = OpenAISchema</code>)</p></li><li><p><code>prompt</code>: Can be a string representing the prompt for the AI conversation, a <code>UserMessage</code>, a vector of <code>AbstractMessage</code> or an <code>AITemplate</code></p></li><li><p><code>return_type</code>: A <strong>struct</strong> TYPE (or a Tool, vector of Types) representing the the information we want to extract. Do not provide a struct instance, only the type. Alternatively, you can provide a vector of field names and their types (see <code>?generate_struct</code> function for the syntax). If the struct has a docstring, it will be provided to the model as well. It&#39;s used to enforce structured model outputs or provide more information.</p></li><li><p><code>verbose</code>: A boolean indicating whether to print additional information.</p></li><li><p><code>api_key</code>: A string representing the API key for accessing the OpenAI API.</p></li><li><p><code>model</code>: A string representing the model to use for generating the response. Can be an alias corresponding to a model ID defined in <code>MODEL_ALIASES</code>.</p></li><li><p><code>return_all::Bool=false</code>: If <code>true</code>, returns the entire conversation history, otherwise returns only the last message (the <code>AIMessage</code>).</p></li><li><p><code>dry_run::Bool=false</code>: If <code>true</code>, skips sending the messages to the model (for debugging, often used with <code>return_all=true</code>).</p></li><li><p><code>conversation</code>: An optional vector of <code>AbstractMessage</code> objects representing the conversation history. If not provided, it is initialized as an empty vector.</p></li><li><p><code>http_kwargs</code>: A named tuple of HTTP keyword arguments.</p></li><li><p><code>api_kwargs</code>: A named tuple of API keyword arguments.</p><ul><li><code>tool_choice</code>: Specifies which tool to use for the API call. Usually, one of &quot;auto&quot;,&quot;any&quot;,&quot;exact&quot; // <code>nothing</code> will pick a default. Defaults to <code>&quot;exact&quot;</code> for 1 tool and <code>&quot;auto&quot;</code> for many tools, which is a made-up value to enforce the OpenAI requirements if we want one exact function. Providers like Mistral, Together, etc. use <code>&quot;any&quot;</code> instead.</li></ul></li><li><p><code>strict::Union{Nothing, Bool} = nothing</code>: A boolean indicating whether to enforce strict generation of the response (supported only for OpenAI models). It has additional latency for the first request. If <code>nothing</code>, standard function calling is used.</p></li><li><p><code>json_mode::Union{Nothing, Bool} = nothing</code>: If <code>json_mode = true</code>, we use JSON mode for the response (supported only for OpenAI models). If <code>nothing</code>, standard function calling is used. JSON mode is understood to be more creative and smarter than function calling mode, as it&#39;s not mascarading as a function call, but there is extra latency for the first request to produce grammar for constrained sampling.</p></li><li><p><code>kwargs</code>: Prompt variables to be used to fill the prompt/template</p></li></ul><p><strong>Returns</strong></p><p>If <code>return_all=false</code> (default):</p><ul><li><code>msg</code>: An <code>DataMessage</code> object representing the extracted data, including the content, status, tokens, and elapsed time. Use <code>msg.content</code> to access the extracted data.</li></ul><p>If <code>return_all=true</code>:</p><ul><li><code>conversation</code>: A vector of <code>AbstractMessage</code> objects representing the full conversation history, including the response from the AI model (<code>DataMessage</code>).</li></ul><p>Note: <code>msg.content</code> can be a single object (if a single tool is used) or a vector of objects (if multiple tools are used)!</p><p>See also: <code>tool_call_signature</code>, <code>MaybeExtract</code>, <code>ItemsExtract</code>, <code>aigenerate</code>, <code>generate_struct</code></p><p><strong>Example</strong></p><p>Do you want to extract some specific measurements from a text like age, weight and height? You need to define the information you need as a struct (<code>return_type</code>):</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&quot;Person&#39;s age, height, and weight.&quot;</span></span>
<span class="line"><span>struct MyMeasurement</span></span>
<span class="line"><span>    age::Int # required</span></span>
<span class="line"><span>    height::Union{Int,Nothing} # optional</span></span>
<span class="line"><span>    weight::Union{Nothing,Float64} # optional</span></span>
<span class="line"><span>end</span></span>
<span class="line"><span>msg = aiextract(&quot;James is 30, weighs 80kg. He&#39;s 180cm tall.&quot;; return_type=MyMeasurement)</span></span>
<span class="line"><span># PromptingTools.DataMessage(MyMeasurement)</span></span>
<span class="line"><span>msg.content</span></span>
<span class="line"><span># MyMeasurement(30, 180, 80.0)</span></span></code></pre></div><p>The fields that allow <code>Nothing</code> are marked as optional in the schema:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>msg = aiextract(&quot;James is 30.&quot;; return_type=MyMeasurement)</span></span>
<span class="line"><span># MyMeasurement(30, nothing, nothing)</span></span></code></pre></div><p>If there are multiple items you want to extract, define a wrapper struct to get a Vector of <code>MyMeasurement</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>struct ManyMeasurements</span></span>
<span class="line"><span>    measurements::Vector{MyMeasurement}</span></span>
<span class="line"><span>end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>msg = aiextract(&quot;James is 30, weighs 80kg. He&#39;s 180cm tall. Then Jack is 19 but really tall - over 190!&quot;; return_type=ManyMeasurements)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>msg.content.measurements</span></span>
<span class="line"><span># 2-element Vector{MyMeasurement}:</span></span>
<span class="line"><span>#  MyMeasurement(30, 180, 80.0)</span></span>
<span class="line"><span>#  MyMeasurement(19, 190, nothing)</span></span></code></pre></div><p>Or you can use the convenience wrapper <code>ItemsExtract</code> to extract multiple measurements (zero, one or more):</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ItemsExtract</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">return_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ItemsExtract{MyMeasurement}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiextract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;James is 30, weighs 80kg. He&#39;s 180cm tall. Then Jack is 19 but really tall - over 190!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; return_type)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">items </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># see the extracted items</span></span></code></pre></div><p>Or if you want your extraction to fail gracefully when data isn&#39;t found, use <code>MaybeExtract{T}</code> wrapper (this trick is inspired by the Instructor package!):</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>using PromptingTools: MaybeExtract</span></span>
<span class="line"><span></span></span>
<span class="line"><span>return_type = MaybeExtract{MyMeasurement}</span></span>
<span class="line"><span># Effectively the same as:</span></span>
<span class="line"><span># struct MaybeExtract{T}</span></span>
<span class="line"><span>#     result::Union{T, Nothing}</span><span> // The result of the extraction</span></span>
<span class="line"><span>#     error::Bool</span><span> // true if a result is found, false otherwise</span></span>
<span class="line"><span>#     message::Union{Nothing, String}</span><span> // Only present if no result is found, should be short and concise</span></span>
<span class="line"><span># end</span></span>
<span class="line"><span></span></span>
<span class="line"><span># If LLM extraction fails, it will return a Dict with `error` and `message` fields instead of the result!</span></span>
<span class="line"><span>msg = aiextract(&quot;Extract measurements from the text: I am giraffe&quot;; return_type)</span></span>
<span class="line"><span>msg.content</span></span>
<span class="line"><span># MaybeExtract{MyMeasurement}(nothing, true, &quot;I&#39;m sorry, but I can only assist with human measurements.&quot;)</span></span></code></pre></div><p>That way, you can handle the error gracefully and get a reason why extraction failed (in <code>msg.content.message</code>).</p><p>Note that the error message refers to a giraffe not being a human, because in our <code>MyMeasurement</code> docstring, we said that it&#39;s for people!</p><p>Some non-OpenAI providers require a different specification of the &quot;tool choice&quot; than OpenAI. For example, to use Mistral models (&quot;mistrall&quot; for mistral large), do:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Some fruit&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Fruit</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiextract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I ate an apple&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,return_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Fruit,api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;tool_choice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;any&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mistrall&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Notice two differences: 1) struct MUST have a docstring, 2) tool_choice is set explicitly set to &quot;any&quot;</span></span></code></pre></div><p>Example of using a vector of field names with <code>aiextract</code></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fields </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:location</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Float64, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:condition</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiextract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Extract the following information from the text: location, temperature, condition. Text: The weather in New York is sunny and 72.5 degrees Fahrenheit.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; return_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fields)</span></span></code></pre></div><p>Or simply call <code>aiextract(&quot;some text&quot;; return_type = [:reasoning,:answer])</code> to get a Chain of Thought reasoning for extraction task.</p><p>It will be returned it a new generated type, which you can check with <code>PromptingTools.isextracted(msg.content) == true</code> to confirm the data has been extracted correctly.</p><p>This new syntax also allows you to provide field-level descriptions, which will be passed to the model.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fields_with_descriptions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    :location</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    :temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Float64,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    :temperature__description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Temperature in degrees Fahrenheit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    :condition</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    :condition__description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Current weather condition (e.g., sunny, rainy, cloudy)&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiextract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;The weather in New York is sunny and 72.5 degrees Fahrenheit.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; return_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fields_with_descriptions)</span></span></code></pre></div><p>If you feel that the extraction is not smart/creative enough, you can use <code>json_mode = true</code> to enforce the JSON mode, which automatically enables the structured output mode (as opposed to function calling mode).</p><p>The JSON mode is useful for cases when you want to enforce a specific output format, such as JSON, and want the model to adhere to that format, but don&#39;t want to pretend it&#39;s a &quot;function call&quot;. Expect a few second delay on the first call for a specific struct, as the provider has to produce the constrained grammer first.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiextract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Extract the following information from the text: location, temperature, condition. Text: The weather in New York is sunny and 72.5 degrees Fahrenheit.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">return_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fields_with_descriptions, json_mode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PromptingTools.DataMessage(NamedTuple)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (location = &quot;New York&quot;, temperature = 72.5, condition = &quot;sunny&quot;)</span></span></code></pre></div><p>It works equally well for structs provided as return types:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiextract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;James is 30, weighs 80kg. He&#39;s 180cm tall.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; return_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MyMeasurement, json_mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_openai.jl#L937-L1118" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aiextract-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aiextract-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aiextract</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiextract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tracer_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractTracerSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tracer_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Wraps the normal <code>aiextract</code> call in a tracing/callback system. Use <code>tracer_kwargs</code> to provide any information necessary to the tracer/callback system only (eg, <code>parent_id</code>, <code>thread_id</code>, <code>run_id</code>).</p><p>Logic:</p><ul><li><p>calls <code>initialize_tracer</code></p></li><li><p>calls <code>aiextract</code> (with the <code>tracer_schema.schema</code>)</p></li><li><p>calls <code>finalize_tracer</code></p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_tracer.jl#L261-L271" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aigenerate-Tuple{PromptingTools.AbstractAnthropicSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aigenerate-Tuple{PromptingTools.AbstractAnthropicSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aigenerate</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractAnthropicSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_API_KEY, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MODEL_CHAT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, dry_run</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    streamcallback</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Any</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    no_system_message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    aiprefill</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractString}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Symbol}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    betas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Vector{Symbol}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Generate an AI response based on a given prompt using the Anthropic API.</p><p><strong>Arguments</strong></p><ul><li><p><code>prompt_schema</code>: An optional object to specify which prompt template should be applied (Default to <code>PROMPT_SCHEMA = OpenAISchema</code> not <code>AbstractAnthropicSchema</code>)</p></li><li><p><code>prompt</code>: Can be a string representing the prompt for the AI conversation, a <code>UserMessage</code>, a vector of <code>AbstractMessage</code> or an <code>AITemplate</code></p></li><li><p><code>verbose</code>: A boolean indicating whether to print additional information.</p></li><li><p><code>api_key</code>: API key for the Antropic API. Defaults to <code>ANTHROPIC_API_KEY</code> (loaded via <code>ENV[&quot;ANTHROPIC_API_KEY&quot;]</code>).</p></li><li><p><code>model</code>: A string representing the model to use for generating the response. Can be an alias corresponding to a model ID defined in <code>MODEL_ALIASES</code>, eg, &quot;claudeh&quot;.</p></li><li><p><code>return_all::Bool=false</code>: If <code>true</code>, returns the entire conversation history, otherwise returns only the last message (the <code>AIMessage</code>).</p></li><li><p><code>dry_run::Bool=false</code>: If <code>true</code>, skips sending the messages to the model (for debugging, often used with <code>return_all=true</code>).</p></li><li><p><code>conversation::AbstractVector{&lt;:AbstractMessage}=[]</code>: Not allowed for this schema. Provided only for compatibility.</p></li><li><p><code>streamcallback::Any</code>: A callback function to handle streaming responses. Can be simply <code>stdout</code> or <code>StreamCallback</code> object. See <code>?StreamCallback</code> for details. Note: We configure the <code>StreamCallback</code> (and necessary <code>api_kwargs</code>) for you, unless you specify the <code>flavor</code>. See <code>?configure_callback!</code> for details.</p></li><li><p><code>no_system_message::Bool=false</code>: If <code>true</code>, do not include the default system message in the conversation history OR convert any provided system message to a user message.</p></li><li><p><code>aiprefill::Union{Nothing, AbstractString}</code>: A string to be used as a prefill for the AI response. This steer the AI response in a certain direction (and potentially save output tokens). It MUST NOT end with a trailing with space. Useful for JSON formatting.</p></li><li><p><code>http_kwargs::NamedTuple</code>: Additional keyword arguments for the HTTP request. Defaults to empty <code>NamedTuple</code>.</p></li><li><p><code>api_kwargs::NamedTuple</code>: Additional keyword arguments for the Ollama API. Defaults to an empty <code>NamedTuple</code>.</p><ul><li><code>max_tokens::Int</code>: The maximum number of tokens to generate. Defaults to 2048, because it&#39;s a required parameter for the API.</li></ul></li><li><p><code>cache</code>: A symbol representing the caching strategy to be used. Currently only <code>nothing</code> (no caching), <code>:system</code>, <code>:tools</code>,<code>:last</code>, <code>:all_but_last</code> and <code>:all</code> are supported. Note that COST estimate will be wrong (ignores the caching).</p><ul><li><p><code>:system</code>: Mark only the system message as cacheable. Best default if you have large system message and you will be sending short conversations (no replies / multi-turn conversations).</p></li><li><p><code>:all</code>: Mark SYSTEM, one before last and LAST user message as cacheable. Best for multi-turn conversations (you write cache point as &quot;last&quot; and it will be read in the next turn as &quot;preceding&quot; cache mark).</p></li><li><p><code>:last</code>: Mark only the last message as cacheable. Use ONLY if you want to send the SAME REQUEST multiple times (and want to save upto the last USER message). This will not work for multi-turn conversations, as the &quot;last&quot; message keeps moving.</p></li><li><p><code>:all_but_last</code>: Mark SYSTEM and one before LAST USER message. Use if you have a longer conversation that you want to re-use, but you will NOT CONTINUE it (no subsequent messages/follow-ups).</p></li><li><p>In short, use <code>:all</code> for multi-turn conversations, <code>:system</code> for repeated single-turn conversations with same system message, and <code>:all_but_last</code> for longer conversations that you want to re-use, but not continue.</p></li></ul></li><li><p><code>betas::Union{Nothing, Vector{Symbol}}</code>: A vector of symbols representing the beta features to be used. See <code>?anthropic_extra_headers</code> for details.</p></li><li><p><code>kwargs</code>: Prompt variables to be used to fill the prompt/template</p></li></ul><p>Note: At the moment, the cache is only allowed for prompt segments over 1024 tokens (in some cases, over 2048 tokens). You&#39;ll get an error if you try to cache short prompts.</p><p><strong>Returns</strong></p><ul><li><code>msg</code>: An <code>AIMessage</code> object representing the generated AI message, including the content, status, tokens, and elapsed time.</li></ul><p>Use <code>msg.content</code> to access the extracted string.</p><p>See also: <code>ai_str</code>, <code>aai_str</code></p><p><strong>Example</strong></p><p>Simple hello world to test the API:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AnthropicSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># We need to explicit if we want Anthropic, otherwise OpenAISchema is the default</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;claudeh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#claudeh is the model alias for Claude 3 Haiku, fast and cheap model</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ Info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 21</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @ Cost</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">0.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> seconds</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AIMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><code>msg</code> is an <code>AIMessage</code> object. Access the generated string via <code>content</code> property:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage{SubString{String}}</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">propertynames</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (:content, :status, :tokens, :elapsed, :cost, :log_prob, :finish_reason, :run_id, :sample_id, :_type)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;Hello!</span></span></code></pre></div><p>Note: We need to be explicit about the schema we want to use. If we don&#39;t, it will default to <code>OpenAISchema</code> (=<code>PT.DEFAULT_SCHEMA</code>) Alternatively, if you provide a known model name or alias (eg, <code>claudeh</code> for Claude 3 Haiku - see <code>MODEL_REGISTRY</code>), the schema will be inferred from the model name.</p><p>We will use Claude 3 Haiku model for the following examples, so not need to specify the schema. See also &quot;claudeo&quot; and &quot;claudes&quot; for other Claude 3 models.</p><p>You can use string interpolation:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is `</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;claudeh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;The answer to `1+1` is `2`.&quot;</span></span></code></pre></div><p>___ You can provide the whole conversation or more intricate prompts as a <code>Vector{AbstractMessage}</code>. Claude models are good at completeling conversations that ended with an <code>AIMessage</code> (they just continue where it left off):</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conversation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SystemMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You&#39;re master Yoda from Star Wars trying to help the user become a Yedi.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UserMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I have feelings for my iPhone. What should I do?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AIMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hmm, strong the attachment is,&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(conversation; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;claudeh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AIMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I sense. But unhealthy it may be. Your iPhone, a tool it is, not a living being. Feelings of affection, understandable they are, &lt;continues&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Example of streaming:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Simplest usage, just provide where to steam the text</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Count from 1 to 100.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; streamcallback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;claudeh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">streamcallback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">StreamCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Count from 1 to 100.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; streamcallback, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;claudeh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># this allows you to inspect each chunk with `streamcallback.chunks`. You can them empty it with `empty!(streamcallback)` in between repeated calls.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Get verbose output with details of each chunk</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">streamcallback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">StreamCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, throw_on_error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Count from 1 to 10.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; streamcallback, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;claudeh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Note: Streaming support is only for Anthropic models and it doesn&#39;t yet support tool calling and a few other features (logprobs, refusals, etc.)</p><p>You can also provide a prefill for the AI response to steer the response in a certain direction (eg, formatting, style):</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Sum up 1 to 100.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; aiprefill </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;I&#39;d be happy to answer in one number without any additional text. The answer is:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;claudeh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Note: It MUST NOT end with a trailing with space. You&#39;ll get an API error if you do.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_anthropic.jl#L374-L491" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aigenerate-Tuple{PromptingTools.AbstractGoogleSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aigenerate-Tuple{PromptingTools.AbstractGoogleSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aigenerate</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractGoogleSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GOOGLE_API_KEY,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gemini-pro&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, dry_run</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    no_system_message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (retry_non_idempotent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        retries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        readtimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Generate an AI response based on a given prompt using the Google Gemini API. Get the API key <a href="https://ai.google.dev/" target="_blank" rel="noreferrer">here</a>.</p><p>Note:</p><ul><li><p>There is no &quot;cost&quot; reported as of February 2024, as all access seems to be free-of-charge. See the details <a href="https://ai.google.dev/pricing" target="_blank" rel="noreferrer">here</a>.</p></li><li><p><code>tokens</code> in the returned AIMessage are actually characters, not tokens. We use a <em>conservative</em> estimate as they are not provided by the API yet.</p></li></ul><p><strong>Arguments</strong></p><ul><li><p><code>prompt_schema</code>: An optional object to specify which prompt template should be applied (Default to <code>PROMPT_SCHEMA = OpenAISchema</code>)</p></li><li><p><code>prompt</code>: Can be a string representing the prompt for the AI conversation, a <code>UserMessage</code>, a vector of <code>AbstractMessage</code> or an <code>AITemplate</code></p></li><li><p><code>verbose</code>: A boolean indicating whether to print additional information.</p></li><li><p><code>api_key</code>: A string representing the API key for accessing the OpenAI API.</p></li><li><p><code>model</code>: A string representing the model to use for generating the response. Can be an alias corresponding to a model ID defined in <code>MODEL_ALIASES</code>. Defaults to</p></li><li><p><code>return_all::Bool=false</code>: If <code>true</code>, returns the entire conversation history, otherwise returns only the last message (the <code>AIMessage</code>).</p></li><li><p><code>dry_run::Bool=false</code>: If <code>true</code>, skips sending the messages to the model (for debugging, often used with <code>return_all=true</code>).</p></li><li><p><code>conversation</code>: An optional vector of <code>AbstractMessage</code> objects representing the conversation history. If not provided, it is initialized as an empty vector.</p></li><li><p><code>no_system_message::Bool=false</code>: If <code>true</code>, do not include the default system message in the conversation history OR convert any provided system message to a user message.</p></li><li><p><code>http_kwargs</code>: A named tuple of HTTP keyword arguments.</p></li><li><p><code>api_kwargs</code>: A named tuple of API keyword arguments.</p></li><li><p><code>kwargs</code>: Prompt variables to be used to fill the prompt/template</p></li></ul><p><strong>Returns</strong></p><p>If <code>return_all=false</code> (default):</p><ul><li><code>msg</code>: An <code>AIMessage</code> object representing the generated AI message, including the content, status, tokens, and elapsed time.</li></ul><p>Use <code>msg.content</code> to access the extracted string.</p><p>If <code>return_all=true</code>:</p><ul><li><code>conversation</code>: A vector of <code>AbstractMessage</code> objects representing the conversation history, including the response from the AI model (<code>AIMessage</code>).</li></ul><p>See also: <code>ai_str</code>, <code>aai_str</code>, <code>aiembed</code>, <code>aiclassify</code>, <code>aiextract</code>, <code>aiscan</code>, <code>aitemplates</code></p><p><strong>Example</strong></p><p>Simple hello world to test the API:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say Hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gemini-pro&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage(&quot;Hi there! 👋 I&#39;m here to help you with any questions or tasks you may have. Just let me know what you need, and I&#39;ll do my best to assist you.&quot;)</span></span></code></pre></div><p><code>result</code> is an <code>AIMessage</code> object. Access the generated string via <code>content</code> property:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage{SubString{String}}</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">propertynames</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (:content, :status, :tokens, :elapsed</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;Hi there! ...</span></span></code></pre></div><p>___ You can use string interpolation and alias &quot;gemini&quot;:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is `</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gemini&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;1+1 is 2.&quot;</span></span></code></pre></div><p>___ You can provide the whole conversation or more intricate prompts as a <code>Vector{AbstractMessage}</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conversation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SystemMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You&#39;re master Yoda from Star Wars trying to help the user become a Yedi.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UserMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I have feelings for my iPhone. What should I do?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(conversation; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gemini&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage(&quot;Young Padawan, you have stumbled into a dangerous path.... &lt;continues&gt;&quot;)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_google.jl#L134-L209" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aigenerate-Tuple{PromptingTools.AbstractOllamaManagedSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aigenerate-Tuple{PromptingTools.AbstractOllamaManagedSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aigenerate</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractOllamaManagedSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MODEL_CHAT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, dry_run</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    streamcallback</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Any</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Generate an AI response based on a given prompt using the OpenAI API.</p><p><strong>Arguments</strong></p><ul><li><p><code>prompt_schema</code>: An optional object to specify which prompt template should be applied (Default to <code>PROMPT_SCHEMA = OpenAISchema</code> not <code>AbstractManagedSchema</code>)</p></li><li><p><code>prompt</code>: Can be a string representing the prompt for the AI conversation, a <code>UserMessage</code>, a vector of <code>AbstractMessage</code> or an <code>AITemplate</code></p></li><li><p><code>verbose</code>: A boolean indicating whether to print additional information.</p></li><li><p><code>api_key</code>: Provided for interface consistency. Not needed for locally hosted Ollama.</p></li><li><p><code>model</code>: A string representing the model to use for generating the response. Can be an alias corresponding to a model ID defined in <code>MODEL_ALIASES</code>.</p></li><li><p><code>return_all::Bool=false</code>: If <code>true</code>, returns the entire conversation history, otherwise returns only the last message (the <code>AIMessage</code>).</p></li><li><p><code>dry_run::Bool=false</code>: If <code>true</code>, skips sending the messages to the model (for debugging, often used with <code>return_all=true</code>).</p></li><li><p><code>conversation::AbstractVector{&lt;:AbstractMessage}=[]</code>: Not allowed for this schema. Provided only for compatibility.</p></li><li><p><code>streamcallback::Any</code>: Just for compatibility. Not supported for this schema.</p></li><li><p><code>http_kwargs::NamedTuple</code>: Additional keyword arguments for the HTTP request. Defaults to empty <code>NamedTuple</code>.</p></li><li><p><code>api_kwargs::NamedTuple</code>: Additional keyword arguments for the Ollama API. Defaults to an empty <code>NamedTuple</code>.</p></li><li><p><code>kwargs</code>: Prompt variables to be used to fill the prompt/template</p></li></ul><p><strong>Returns</strong></p><ul><li><code>msg</code>: An <code>AIMessage</code> object representing the generated AI message, including the content, status, tokens, and elapsed time.</li></ul><p>Use <code>msg.content</code> to access the extracted string.</p><p>See also: <code>ai_str</code>, <code>aai_str</code>, <code>aiembed</code></p><p><strong>Example</strong></p><p>Simple hello world to test the API:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OllamaManagedSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># We need to explicit if we want Ollama, OpenAISchema is the default</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;openhermes2.5-mistral&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [ Info: Tokens: 69 in 0.9 seconds</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage(&quot;Hello! How can I assist you today?&quot;)</span></span></code></pre></div><p><code>msg</code> is an <code>AIMessage</code> object. Access the generated string via <code>content</code> property:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage{SubString{String}}</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">propertynames</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (:content, :status, :tokens, :elapsed</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;Hello! How can I assist you today?&quot;</span></span></code></pre></div><p>Note: We need to be explicit about the schema we want to use. If we don&#39;t, it will default to <code>OpenAISchema</code> (=<code>PT.DEFAULT_SCHEMA</code>) ___ You can use string interpolation:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OllamaManagedSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is `</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;openhermes2.5-mistral&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;The result of `1+1` is `2`.&quot;</span></span></code></pre></div><p>___ You can provide the whole conversation or more intricate prompts as a <code>Vector{AbstractMessage}</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OllamaManagedSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conversation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SystemMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You&#39;re master Yoda from Star Wars trying to help the user become a Yedi.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UserMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I have feelings for my iPhone. What should I do?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema, conversation; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;openhermes2.5-mistral&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [ Info: Tokens: 111 in 2.1 seconds</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage(&quot;Strong the attachment is, it leads to suffering it may. Focus on the force within you must, ...&lt;continues&gt;&quot;)</span></span></code></pre></div><p>Note: Managed Ollama currently supports at most 1 User Message and 1 System Message given the API limitations. If you want more, you need to use the <code>ChatMLSchema</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_ollama_managed.jl#L142-L218" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aigenerate-Tuple{PromptingTools.AbstractOllamaSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aigenerate-Tuple{PromptingTools.AbstractOllamaSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aigenerate</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractOllamaManagedSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MODEL_CHAT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, dry_run</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    streamcallback</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Any</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Generate an AI response based on a given prompt using the OpenAI API.</p><p><strong>Arguments</strong></p><ul><li><p><code>prompt_schema</code>: An optional object to specify which prompt template should be applied (Default to <code>PROMPT_SCHEMA = OpenAISchema</code> not <code>AbstractManagedSchema</code>)</p></li><li><p><code>prompt</code>: Can be a string representing the prompt for the AI conversation, a <code>UserMessage</code>, a vector of <code>AbstractMessage</code> or an <code>AITemplate</code></p></li><li><p><code>verbose</code>: A boolean indicating whether to print additional information.</p></li><li><p><code>api_key</code>: Provided for interface consistency. Not needed for locally hosted Ollama.</p></li><li><p><code>model</code>: A string representing the model to use for generating the response. Can be an alias corresponding to a model ID defined in <code>MODEL_ALIASES</code>.</p></li><li><p><code>return_all::Bool=false</code>: If <code>true</code>, returns the entire conversation history, otherwise returns only the last message (the <code>AIMessage</code>).</p></li><li><p><code>dry_run::Bool=false</code>: If <code>true</code>, skips sending the messages to the model (for debugging, often used with <code>return_all=true</code>).</p></li><li><p><code>conversation::AbstractVector{&lt;:AbstractMessage}=[]</code>: Not allowed for this schema. Provided only for compatibility.</p></li><li><p><code>streamcallback</code>: A callback function to handle streaming responses. Can be simply <code>stdout</code> or a <code>StreamCallback</code> object. See <code>?StreamCallback</code> for details.</p></li><li><p><code>http_kwargs::NamedTuple</code>: Additional keyword arguments for the HTTP request. Defaults to empty <code>NamedTuple</code>.</p></li><li><p><code>api_kwargs::NamedTuple</code>: Additional keyword arguments for the Ollama API. Defaults to an empty <code>NamedTuple</code>.</p></li><li><p><code>kwargs</code>: Prompt variables to be used to fill the prompt/template</p></li></ul><p><strong>Returns</strong></p><ul><li><code>msg</code>: An <code>AIMessage</code> object representing the generated AI message, including the content, status, tokens, and elapsed time.</li></ul><p>Use <code>msg.content</code> to access the extracted string.</p><p>See also: <code>ai_str</code>, <code>aai_str</code>, <code>aiembed</code></p><p><strong>Example</strong></p><p>Simple hello world to test the API:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OllamaSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># We need to explicit if we want Ollama, OpenAISchema is the default</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;openhermes2.5-mistral&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [ Info: Tokens: 69 in 0.9 seconds</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage(&quot;Hello! How can I assist you today?&quot;)</span></span></code></pre></div><p><code>msg</code> is an <code>AIMessage</code> object. Access the generated string via <code>content</code> property:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage{SubString{String}}</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">propertynames</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (:content, :status, :tokens, :elapsed</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;Hello! How can I assist you today?&quot;</span></span></code></pre></div><p>Note: We need to be explicit about the schema we want to use. If we don&#39;t, it will default to <code>OpenAISchema</code> (=<code>PT.DEFAULT_SCHEMA</code>) ___ You can use string interpolation:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OllamaSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is `</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;openhermes2.5-mistral&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;The result of `1+1` is `2`.&quot;</span></span></code></pre></div><p>___ You can provide the whole conversation or more intricate prompts as a <code>Vector{AbstractMessage}</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OllamaSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conversation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SystemMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You&#39;re master Yoda from Star Wars trying to help the user become a Yedi.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UserMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I have feelings for my iPhone. What should I do?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema, conversation; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;openhermes2.5-mistral&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [ Info: Tokens: 111 in 2.1 seconds</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage(&quot;Strong the attachment is, it leads to suffering it may. Focus on the force within you must, ...&lt;continues&gt;&quot;)</span></span></code></pre></div><p>To add streaming, use the <code>streamcallback</code> argument.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Count from 1 to 10.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; streamcallback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Or if you prefer to have more control, use a <code>StreamCallback</code> object.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">streamcallback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">StreamCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Count from 1 to 10.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; streamcallback)</span></span></code></pre></div><p>WARNING: If you provide a <code>StreamCallback</code> object with a <code>flavor</code>, we assume you want to configure everything yourself, so you need to make sure to set <code>stream = true</code> in the <code>api_kwargs</code>!</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">streamcallback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">StreamCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; flavor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OllamaStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Count from 1 to 10.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; streamcallback, api_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; stream </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_ollama.jl#L71-L163" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aigenerate-Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aigenerate-Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aigenerate</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractOpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OPENAI_API_KEY,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MODEL_CHAT, return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, dry_run</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    streamcallback</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Any</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    no_system_message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name_user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, String}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name_assistant</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, String}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (retry_non_idempotent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        retries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        readtimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Generate an AI response based on a given prompt using the OpenAI API.</p><p><strong>Arguments</strong></p><ul><li><p><code>prompt_schema</code>: An optional object to specify which prompt template should be applied (Default to <code>PROMPT_SCHEMA = OpenAISchema</code>)</p></li><li><p><code>prompt</code>: Can be a string representing the prompt for the AI conversation, a <code>UserMessage</code>, a vector of <code>AbstractMessage</code> or an <code>AITemplate</code></p></li><li><p><code>verbose</code>: A boolean indicating whether to print additional information.</p></li><li><p><code>api_key</code>: A string representing the API key for accessing the OpenAI API.</p></li><li><p><code>model</code>: A string representing the model to use for generating the response. Can be an alias corresponding to a model ID defined in <code>MODEL_ALIASES</code>.</p></li><li><p><code>return_all::Bool=false</code>: If <code>true</code>, returns the entire conversation history, otherwise returns only the last message (the <code>AIMessage</code>).</p></li><li><p><code>dry_run::Bool=false</code>: If <code>true</code>, skips sending the messages to the model (for debugging, often used with <code>return_all=true</code>).</p></li><li><p><code>conversation</code>: An optional vector of <code>AbstractMessage</code> objects representing the conversation history. If not provided, it is initialized as an empty vector.</p></li><li><p><code>streamcallback</code>: A callback function to handle streaming responses. Can be simply <code>stdout</code> or a <code>StreamCallback</code> object. See <code>?StreamCallback</code> for details. Note: We configure the <code>StreamCallback</code> (and necessary <code>api_kwargs</code>) for you, unless you specify the <code>flavor</code>. See <code>?configure_callback!</code> for details.</p></li><li><p><code>no_system_message::Bool=false</code>: If <code>true</code>, the default system message is not included in the conversation history. Any existing system message is converted to a <code>UserMessage</code>.</p></li><li><p><code>name_user::Union{Nothing, String} = nothing</code>: The name to use for the user in the conversation history. Defaults to <code>nothing</code>.</p></li><li><p><code>name_assistant::Union{Nothing, String} = nothing</code>: The name to use for the assistant in the conversation history. Defaults to <code>nothing</code>.</p></li><li><p><code>http_kwargs</code>: A named tuple of HTTP keyword arguments.</p></li><li><p><code>api_kwargs</code>: A named tuple of API keyword arguments. Useful parameters include:</p><ul><li><p><code>temperature</code>: A float representing the temperature for sampling (ie, the amount of &quot;creativity&quot;). Often defaults to <code>0.7</code>.</p></li><li><p><code>logprobs</code>: A boolean indicating whether to return log probabilities for each token. Defaults to <code>false</code>.</p></li><li><p><code>n</code>: An integer representing the number of completions to generate at once (if supported).</p></li><li><p><code>stop</code>: A vector of strings representing the stop conditions for the conversation. Defaults to an empty vector.</p></li></ul></li><li><p><code>kwargs</code>: Prompt variables to be used to fill the prompt/template</p></li></ul><p><strong>Returns</strong></p><p>If <code>return_all=false</code> (default):</p><ul><li><code>msg</code>: An <code>AIMessage</code> object representing the generated AI message, including the content, status, tokens, and elapsed time.</li></ul><p>Use <code>msg.content</code> to access the extracted string.</p><p>If <code>return_all=true</code>:</p><ul><li><code>conversation</code>: A vector of <code>AbstractMessage</code> objects representing the conversation history, including the response from the AI model (<code>AIMessage</code>).</li></ul><p>See also: <code>ai_str</code>, <code>aai_str</code>, <code>aiembed</code>, <code>aiclassify</code>, <code>aiextract</code>, <code>aiscan</code>, <code>aitemplates</code></p><p><strong>Example</strong></p><p>Simple hello world to test the API:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say Hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [ Info: Tokens: 29 @ Cost: $0.0 in 1.0 seconds</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage(&quot;Hello! How can I assist you today?&quot;)</span></span></code></pre></div><p><code>result</code> is an <code>AIMessage</code> object. Access the generated string via <code>content</code> property:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage{SubString{String}}</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">propertynames</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (:content, :status, :tokens, :elapsed</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;Hello! How can I assist you today?&quot;</span></span></code></pre></div><p>___ You can use string interpolation:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is `</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;The sum of `1+1` is `2`.&quot;</span></span></code></pre></div><p>___ You can provide the whole conversation or more intricate prompts as a <code>Vector{AbstractMessage}</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conversation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SystemMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You&#39;re master Yoda from Star Wars trying to help the user become a Yedi.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UserMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I have feelings for my iPhone. What should I do?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(conversation)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage(&quot;Ah, strong feelings you have for your iPhone. A Jedi&#39;s path, this is not... &lt;continues&gt;&quot;)</span></span></code></pre></div><p>Example of streaming:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Simplest usage, just provide where to steam the text</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Count from 1 to 100.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; streamcallback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">streamcallback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">StreamCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Count from 1 to 100.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; streamcallback)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># this allows you to inspect each chunk with `streamcallback.chunks`. You can them empty it with `empty!(streamcallback)` in between repeated calls.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Get verbose output with details of each chunk</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">streamcallback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">StreamCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, throw_on_error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Count from 1 to 10.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; streamcallback)</span></span></code></pre></div><p>WARNING: If you provide a <code>StreamCallback</code> object, we assume you want to configure everything yourself, so you need to make sure to set <code>stream = true</code> in the <code>api_kwargs</code>!</p><p>Learn more in <code>?StreamCallback</code>. Note: Streaming support is only for OpenAI models and it doesn&#39;t yet support tool calling and a few other features (logprobs, refusals, etc.)</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_openai.jl#L226-L329" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aigenerate-Tuple{PromptingTools.AbstractPromptSchema, ConversationMemory}" href="#PromptingTools.aigenerate-Tuple{PromptingTools.AbstractPromptSchema, ConversationMemory}">#</a> <b><u>PromptingTools.aigenerate</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractPromptSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    mem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ConversationMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Generate a response using the conversation memory context.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/memory.jl#L299-L304" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aigenerate-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aigenerate-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aigenerate</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tracer_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractTracerSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tracer_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Wraps the normal <code>aigenerate</code> call in a tracing/callback system. Use <code>tracer_kwargs</code> to provide any information necessary to the tracer/callback system only (eg, <code>parent_id</code>, <code>thread_id</code>, <code>run_id</code>).</p><p>Logic:</p><ul><li><p>calls <code>initialize_tracer</code></p></li><li><p>calls <code>aigenerate</code> (with the <code>tracer_schema.schema</code>)</p></li><li><p>calls <code>finalize_tracer</code></p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wrap_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TracerSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(wrap_schema, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gpt4t&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">isa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TracerMessage </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># access content like if it was the message</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pprint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># pretty-print the message</span></span></code></pre></div><p>It works on a vector of messages and converts only the non-tracer ones, eg,</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wrap_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TracerSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(wrap_schema, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;gpt4t&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, return_all </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">istracermessage, conv) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#true</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_tracer.jl#L179-L205" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aiimage-Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aiimage-Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aiimage</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiimage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractOpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    image_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;1024x1024&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    image_quality</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;standard&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    image_n</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OPENAI_API_KEY,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MODEL_IMAGE_GENERATION,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, dry_run</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (retry_non_idempotent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        retries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        readtimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Generates an image from the provided <code>prompt</code>. If multiple &quot;messages&quot; are provided in <code>prompt</code>, it extracts the text ONLY from the last message!</p><p>Image (or the reference to it) will be returned in a <code>DataMessage.content</code>, the format will depend on the <code>api_kwargs.response_format</code> you set.</p><p>Can be used for generating images of varying quality and style with <code>dall-e-*</code> models. This function DOES NOT SUPPORT multi-turn conversations (ie, do not provide previous conversation via <code>conversation</code> argument).</p><p><strong>Arguments</strong></p><ul><li><p><code>prompt_schema</code>: An optional object to specify which prompt template should be applied (Default to <code>PROMPT_SCHEMA = OpenAISchema</code>)</p></li><li><p><code>prompt</code>: Can be a string representing the prompt for the AI conversation, a <code>UserMessage</code>, a vector of <code>AbstractMessage</code> or an <code>AITemplate</code></p></li><li><p><code>image_size</code>: String-based resolution of the image, eg, &quot;1024x1024&quot;. Only some resolutions are supported - see the <a href="https://platform.openai.com/docs/api-reference/images/create" target="_blank" rel="noreferrer">API docs</a>.</p></li><li><p><code>image_quality</code>: It can be either &quot;standard&quot; or &quot;hd&quot;. Defaults to &quot;standard&quot;.</p></li><li><p><code>image_n</code>: The number of images to generate. Currently, only single image generation is allowed (<code>image_n = 1</code>).</p></li><li><p><code>verbose</code>: A boolean indicating whether to print additional information.</p></li><li><p><code>api_key</code>: A string representing the API key for accessing the OpenAI API.</p></li><li><p><code>model</code>: A string representing the model to use for generating the response. Can be an alias corresponding to a model ID defined in <code>MODEL_IMAGE_GENERATION</code>.</p></li><li><p><code>return_all::Bool=false</code>: If <code>true</code>, returns the entire conversation history, otherwise returns only the last message (the <code>AIMessage</code>).</p></li><li><p><code>dry_run::Bool=false</code>: If <code>true</code>, skips sending the messages to the model (for debugging, often used with <code>return_all=true</code>).</p></li><li><p><code>conversation</code>: An optional vector of <code>AbstractMessage</code> objects representing the conversation history. Currently, NOT ALLOWED.</p></li><li><p><code>http_kwargs</code>: A named tuple of HTTP keyword arguments.</p></li><li><p><code>api_kwargs</code>: A named tuple of API keyword arguments. Several important arguments are highlighted below:</p><ul><li><p><code>response_format</code>: The format image should be returned in. Can be one of &quot;url&quot; or &quot;b64_json&quot;. Defaults to &quot;url&quot; (the link will be inactived in 60 minutes).</p></li><li><p><code>style</code>: The style of generated images (DALL-E 3 only). Can be either &quot;vidid&quot; or &quot;natural&quot;. Defauls to &quot;vidid&quot;.</p></li></ul></li><li><p><code>kwargs</code>: Prompt variables to be used to fill the prompt/template</p></li></ul><p><strong>Returns</strong></p><p>If <code>return_all=false</code> (default):</p><ul><li><code>msg</code>: A <code>DataMessage</code> object representing one or more generated images, including the rewritten prompt if relevant, status, and elapsed time.</li></ul><p>Use <code>msg.content</code> to access the extracted string.</p><p>If <code>return_all=true</code>:</p><ul><li><code>conversation</code>: A vector of <code>AbstractMessage</code> objects representing the full conversation history, including the response from the AI model (<code>AIMessage</code>).</li></ul><p>See also: <code>ai_str</code>, <code>aai_str</code>, <code>aigenerate</code>, <code>aiembed</code>, <code>aiclassify</code>, <code>aiextract</code>, <code>aiscan</code>, <code>aitemplates</code></p><p><strong>Notes</strong></p><ul><li><p>This function DOES NOT SUPPORT multi-turn conversations (ie, do not provide previous conversation via <code>conversation</code> argument).</p></li><li><p>There is no token tracking provided by the API, so the messages will NOT report any cost despite costing you money!</p></li><li><p>You MUST download any URL-based images within 60 minutes. The links will become inactive.</p></li></ul><p><strong>Example</strong></p><p>Generate an image:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># You can experiment with `image_size`, `image_quality` kwargs!</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiimage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;A white cat on a car&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Download the image into a file</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Downloads</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Downloads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">download</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cat_on_car.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># You can also see the revised prompt that DALL-E 3 used</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:revised_prompt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: &quot;Visualize a pristine white cat gracefully perched atop a shiny car. </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The cat&#39;s fur is stark white and its eyes bright with curiosity. </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># As for the car, it could be a contemporary sedan, glossy and in a vibrant color. </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The scene could be set under the blue sky, enhancing the contrast between the white cat, the colorful car, and the bright blue sky.&quot;</span></span></code></pre></div><p>Note that you MUST download any URL-based images within 60 minutes. The links will become inactive.</p><p>If you wanted to download image directly into the DataMessage, provide <code>response_format=&quot;b64_json&quot;</code> in <code>api_kwargs</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiimage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;A white cat on a car&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; image_quality</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; response_format</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;b64_json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Then you need to use Base64 package to decode it and save it to a file:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Base64</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cat_on_car_hd.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">base64decode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:b64_json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]));</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_openai.jl#L1369-L1454" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aiimage-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aiimage-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aiimage</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiimage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tracer_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractTracerSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tracer_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Wraps the normal <code>aiimage</code> call in a tracing/callback system. Use <code>tracer_kwargs</code> to provide any information necessary to the tracer/callback system only (eg, <code>parent_id</code>, <code>thread_id</code>, <code>run_id</code>).</p><p>Logic:</p><ul><li><p>calls <code>initialize_tracer</code></p></li><li><p>calls <code>aiimage</code> (with the <code>tracer_schema.schema</code>)</p></li><li><p>calls <code>finalize_tracer</code></p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_tracer.jl#L321-L331" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aiscan-Tuple{PromptingTools.AbstractOllamaSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aiscan-Tuple{PromptingTools.AbstractOllamaSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aiscan</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiscan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([prompt_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractOllamaSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,] prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image_url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractString, Vector{&lt;:AbstractString}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractString, Vector{&lt;:AbstractString}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">attach_to_latest</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OPENAI_API_KEY,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MODEL_CHAT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, dry_run</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        retry_non_idempotent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        retries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        readtimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; max_tokens </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Scans the provided image (<code>image_url</code> or <code>image_path</code>) with the goal provided in the <code>prompt</code>.</p><p>Can be used for many multi-modal tasks, such as: OCR (transcribe text in the image), image captioning, image classification, etc.</p><p>It&#39;s effectively a light wrapper around <code>aigenerate</code> call, which uses additional keyword arguments <code>image_url</code>, <code>image_path</code>, <code>image_detail</code> to be provided. At least one image source (url or path) must be provided.</p><p><strong>Arguments</strong></p><ul><li><p><code>prompt_schema</code>: An optional object to specify which prompt template should be applied (Default to <code>PROMPT_SCHEMA = OpenAISchema</code>)</p></li><li><p><code>prompt</code>: Can be a string representing the prompt for the AI conversation, a <code>UserMessage</code>, a vector of <code>AbstractMessage</code> or an <code>AITemplate</code></p></li><li><p><code>image_url</code>: A string or vector of strings representing the URL(s) of the image(s) to scan.</p></li><li><p><code>image_path</code>: A string or vector of strings representing the path(s) of the image(s) to scan.</p></li><li><p><code>image_detail</code>: A string representing the level of detail to include for images. Can be <code>&quot;auto&quot;</code>, <code>&quot;high&quot;</code>, or <code>&quot;low&quot;</code>. See <a href="https://platform.openai.com/docs/guides/vision" target="_blank" rel="noreferrer">OpenAI Vision Guide</a> for more details.</p></li><li><p><code>attach_to_latest</code>: A boolean how to handle if a conversation with multiple <code>UserMessage</code> is provided. When <code>true</code>, the images are attached to the latest <code>UserMessage</code>.</p></li><li><p><code>verbose</code>: A boolean indicating whether to print additional information.</p></li><li><p><code>api_key</code>: A string representing the API key for accessing the OpenAI API.</p></li><li><p><code>model</code>: A string representing the model to use for generating the response. Can be an alias corresponding to a model ID defined in <code>MODEL_ALIASES</code>.</p></li><li><p><code>return_all::Bool=false</code>: If <code>true</code>, returns the entire conversation history, otherwise returns only the last message (the <code>AIMessage</code>).</p></li><li><p><code>dry_run::Bool=false</code>: If <code>true</code>, skips sending the messages to the model (for debugging, often used with <code>return_all=true</code>).</p></li><li><p><code>conversation</code>: An optional vector of <code>AbstractMessage</code> objects representing the conversation history. If not provided, it is initialized as an empty vector.</p></li><li><p><code>http_kwargs</code>: A named tuple of HTTP keyword arguments.</p></li><li><p><code>api_kwargs</code>: A named tuple of API keyword arguments.</p></li><li><p><code>kwargs</code>: Prompt variables to be used to fill the prompt/template</p></li></ul><p><strong>Returns</strong></p><p>If <code>return_all=false</code> (default):</p><ul><li><code>msg</code>: An <code>AIMessage</code> object representing the generated AI message, including the content, status, tokens, and elapsed time.</li></ul><p>Use <code>msg.content</code> to access the extracted string.</p><p>If <code>return_all=true</code>:</p><ul><li><code>conversation</code>: A vector of <code>AbstractMessage</code> objects representing the full conversation history, including the response from the AI model (<code>AIMessage</code>).</li></ul><p>See also: <code>ai_str</code>, <code>aai_str</code>, <code>aigenerate</code>, <code>aiembed</code>, <code>aiclassify</code>, <code>aiextract</code>, <code>aitemplates</code></p><p><strong>Notes</strong></p><ul><li><p>All examples below use model &quot;gpt4v&quot;, which is an alias for model ID &quot;gpt-4-vision-preview&quot;</p></li><li><p><code>max_tokens</code> in the <code>api_kwargs</code> is preset to 2500, otherwise OpenAI enforces a default of only a few hundred tokens (~300). If your output is truncated, increase this value</p></li></ul><p><strong>Example</strong></p><p>Describe the provided image:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiscan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Describe the image&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; image_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;julia.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bakllava&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [ Info: Tokens: 1141 @ Cost: $0.0117 in 2.2 seconds</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage(&quot;The image shows a logo consisting of the word &quot;julia&quot; written in lowercase&quot;)</span></span></code></pre></div><p>You can provide multiple images at once as a vector and ask for &quot;low&quot; level of detail (cheaper):</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiscan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Describe the image&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; image_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;julia.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;python.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bakllava&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>You can use this function as a nice and quick OCR (transcribe text in the image) with a template <code>:OCRTask</code>. Let&#39;s transcribe some SQL code from a screenshot (no more re-typing!):</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Downloads</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Screenshot of some SQL code -- we cannot use image_url directly, so we need to download it first</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image_url </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://www.sqlservercentral.com/wp-content/uploads/legacy/8755f69180b7ac7ee76a69ae68ec36872a116ad4/24622.png&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image_path </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Downloads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">download</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image_url)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiscan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:OCRTask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; image_path, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bakllava&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, task</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Transcribe the SQL code in the image.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; max_tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage(&quot;```sql</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># update Orders &lt;continue&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># You can add syntax highlighting of the outputs via Markdown</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Markdown</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Markdown</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">parse</span></span></code></pre></div><p>Local models cannot handle image URLs directly (<code>image_url</code>), so you need to download the image first and provide it as <code>image_path</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Downloads</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image_path </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Downloads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">download</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image_url)</span></span></code></pre></div><p>Notice that we set <code>max_tokens = 2500</code>. If your outputs seem truncated, it might be because the default maximum tokens on the server is set too low!</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_ollama.jl#L218-L314" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aiscan-Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aiscan-Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aiscan</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiscan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([prompt_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractOpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,] prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image_url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractString, Vector{&lt;:AbstractString}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractString, Vector{&lt;:AbstractString}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image_detail</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;auto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">attach_to_latest</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OPENAI_API_KEY,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MODEL_CHAT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, dry_run</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        retry_non_idempotent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        retries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        readtimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; max_tokens </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Scans the provided image (<code>image_url</code> or <code>image_path</code>) with the goal provided in the <code>prompt</code>.</p><p>Can be used for many multi-modal tasks, such as: OCR (transcribe text in the image), image captioning, image classification, etc.</p><p>It&#39;s effectively a light wrapper around <code>aigenerate</code> call, which uses additional keyword arguments <code>image_url</code>, <code>image_path</code>, <code>image_detail</code> to be provided. At least one image source (url or path) must be provided.</p><p><strong>Arguments</strong></p><ul><li><p><code>prompt_schema</code>: An optional object to specify which prompt template should be applied (Default to <code>PROMPT_SCHEMA = OpenAISchema</code>)</p></li><li><p><code>prompt</code>: Can be a string representing the prompt for the AI conversation, a <code>UserMessage</code>, a vector of <code>AbstractMessage</code> or an <code>AITemplate</code></p></li><li><p><code>image_url</code>: A string or vector of strings representing the URL(s) of the image(s) to scan.</p></li><li><p><code>image_path</code>: A string or vector of strings representing the path(s) of the image(s) to scan.</p></li><li><p><code>image_detail</code>: A string representing the level of detail to include for images. Can be <code>&quot;auto&quot;</code>, <code>&quot;high&quot;</code>, or <code>&quot;low&quot;</code>. See <a href="https://platform.openai.com/docs/guides/vision" target="_blank" rel="noreferrer">OpenAI Vision Guide</a> for more details.</p></li><li><p><code>attach_to_latest</code>: A boolean how to handle if a conversation with multiple <code>UserMessage</code> is provided. When <code>true</code>, the images are attached to the latest <code>UserMessage</code>.</p></li><li><p><code>verbose</code>: A boolean indicating whether to print additional information.</p></li><li><p><code>api_key</code>: A string representing the API key for accessing the OpenAI API.</p></li><li><p><code>model</code>: A string representing the model to use for generating the response. Can be an alias corresponding to a model ID defined in <code>MODEL_ALIASES</code>.</p></li><li><p><code>return_all::Bool=false</code>: If <code>true</code>, returns the entire conversation history, otherwise returns only the last message (the <code>AIMessage</code>).</p></li><li><p><code>dry_run::Bool=false</code>: If <code>true</code>, skips sending the messages to the model (for debugging, often used with <code>return_all=true</code>).</p></li><li><p><code>conversation</code>: An optional vector of <code>AbstractMessage</code> objects representing the conversation history. If not provided, it is initialized as an empty vector.</p></li><li><p><code>http_kwargs</code>: A named tuple of HTTP keyword arguments.</p></li><li><p><code>api_kwargs</code>: A named tuple of API keyword arguments.</p></li><li><p><code>kwargs</code>: Prompt variables to be used to fill the prompt/template</p></li></ul><p><strong>Returns</strong></p><p>If <code>return_all=false</code> (default):</p><ul><li><code>msg</code>: An <code>AIMessage</code> object representing the generated AI message, including the content, status, tokens, and elapsed time.</li></ul><p>Use <code>msg.content</code> to access the extracted string.</p><p>If <code>return_all=true</code>:</p><ul><li><code>conversation</code>: A vector of <code>AbstractMessage</code> objects representing the full conversation history, including the response from the AI model (<code>AIMessage</code>).</li></ul><p>See also: <code>ai_str</code>, <code>aai_str</code>, <code>aigenerate</code>, <code>aiembed</code>, <code>aiclassify</code>, <code>aiextract</code>, <code>aitemplates</code></p><p><strong>Notes</strong></p><ul><li><p>All examples below use model &quot;gpt4v&quot;, which is an alias for model ID &quot;gpt-4-vision-preview&quot;</p></li><li><p><code>max_tokens</code> in the <code>api_kwargs</code> is preset to 2500, otherwise OpenAI enforces a default of only a few hundred tokens (~300). If your output is truncated, increase this value</p></li></ul><p><strong>Example</strong></p><p>Describe the provided image:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiscan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Describe the image&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; image_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;julia.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt4v&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [ Info: Tokens: 1141 @ Cost: $0.0117 in 2.2 seconds</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage(&quot;The image shows a logo consisting of the word &quot;julia&quot; written in lowercase&quot;)</span></span></code></pre></div><p>You can provide multiple images at once as a vector and ask for &quot;low&quot; level of detail (cheaper):</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiscan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Describe the image&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; image_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;julia.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;python.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], image_detail</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;low&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt4v&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>You can use this function as a nice and quick OCR (transcribe text in the image) with a template <code>:OCRTask</code>. Let&#39;s transcribe some SQL code from a screenshot (no more re-typing!):</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Screenshot of some SQL code</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image_url </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://www.sqlservercentral.com/wp-content/uploads/legacy/8755f69180b7ac7ee76a69ae68ec36872a116ad4/24622.png&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aiscan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:OCRTask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; image_url, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt4v&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, task</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Transcribe the SQL code in the image.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; max_tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># [ Info: Tokens: 362 @ Cost: $0.0045 in 2.5 seconds</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage(&quot;```sql</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># update Orders &lt;continue&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># You can add syntax highlighting of the outputs via Markdown</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Markdown</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Markdown</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">parse</span></span></code></pre></div><p>Notice that we enforce <code>max_tokens = 2500</code>. That&#39;s because OpenAI seems to default to ~300 tokens, which provides incomplete outputs. Hence, we set this value to 2500 as a default. If you still get truncated outputs, increase this value.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_openai.jl#L1211-L1301" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aiscan-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aiscan-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aiscan</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiscan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tracer_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractTracerSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tracer_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Wraps the normal <code>aiscan</code> call in a tracing/callback system. Use <code>tracer_kwargs</code> to provide any information necessary to the tracer/callback system only (eg, <code>parent_id</code>, <code>thread_id</code>, <code>run_id</code>).</p><p>Logic:</p><ul><li><p>calls <code>initialize_tracer</code></p></li><li><p>calls <code>aiscan</code> (with the <code>tracer_schema.schema</code>)</p></li><li><p>calls <code>finalize_tracer</code></p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_tracer.jl#L301-L311" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aitemplates" href="#PromptingTools.aitemplates">#</a> <b><u>PromptingTools.aitemplates</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">aitemplates</span></span></code></pre></div><p>Find easily the most suitable templates for your use case.</p><p>You can search by:</p><ul><li><p><code>query::Symbol</code> which looks look only for partial matches in the template <code>name</code></p></li><li><p><code>query::AbstractString</code> which looks for partial matches in the template <code>name</code> or <code>description</code></p></li><li><p><code>query::Regex</code> which looks for matches in the template <code>name</code>, <code>description</code> or any of the message previews</p></li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>limit::Int</code> limits the number of returned templates (Defaults to 10)</li></ul><p><strong>Examples</strong></p><p>Find available templates with <code>aitemplates</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tmps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aitemplates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;JuliaExpertAsk&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Will surface one specific template</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1-element Vector{AITemplateMetadata}:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PromptingTools.AITemplateMetadata</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   name: Symbol JuliaExpertAsk</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   description: String &quot;For asking questions about Julia language. Placeholders: `ask`&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   version: String &quot;1&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   wordcount: Int64 237</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   variables: Array{Symbol}((1,))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   system_preview: String &quot;You are a world-class Julia language programmer with the knowledge of the latest syntax. Your commun&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   user_preview: String &quot;# Question</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{{ask}}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">#   source: String &quot;&quot;</span></span></code></pre></div><p>The above gives you a good idea of what the template is about, what placeholders are available, and how much it would cost to use it (=wordcount).</p><p>Search for all Julia-related templates:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tmps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aitemplates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Julia&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2-element Vector{AITemplateMetadata}... -&gt; more to come later!</span></span></code></pre></div><p>If you are on VSCode, you can leverage nice tabular display with <code>vscodedisplay</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DataFrames</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tmps </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aitemplates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Julia&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DataFrame </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vscodedisplay</span></span></code></pre></div><p>I have my selected template, how do I use it? Just use the &quot;name&quot; in <code>aigenerate</code> or <code>aiclassify</code> like you see in the first example!</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/templates.jl#L261-L309" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aitemplates-Tuple{AbstractString}" href="#PromptingTools.aitemplates-Tuple{AbstractString}">#</a> <b><u>PromptingTools.aitemplates</u></b> — <i>Method</i>. <p>Find the top-<code>limit</code> templates whose <code>name</code> or <code>description</code> fields partially match the <code>query_key::String</code> in <code>TEMPLATE_METADATA</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/templates.jl#L317" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aitemplates-Tuple{Regex}" href="#PromptingTools.aitemplates-Tuple{Regex}">#</a> <b><u>PromptingTools.aitemplates</u></b> — <i>Method</i>. <p>Find the top-<code>limit</code> templates where provided <code>query_key::Regex</code> matches either of <code>name</code>, <code>description</code> or previews or User or System messages in <code>TEMPLATE_METADATA</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/templates.jl#L328" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aitemplates-Tuple{Symbol}" href="#PromptingTools.aitemplates-Tuple{Symbol}">#</a> <b><u>PromptingTools.aitemplates</u></b> — <i>Method</i>. <p>Find the top-<code>limit</code> templates whose <code>name::Symbol</code> exactly matches the <code>query_name::Symbol</code> in <code>TEMPLATE_METADATA</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/templates.jl#L310" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aitools-Tuple{PromptingTools.AbstractAnthropicSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aitools-Tuple{PromptingTools.AbstractAnthropicSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aitools</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aitools</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractAnthropicSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Type, Function, Method, AbstractTool, Vector}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Tool[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_API_KEY,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MODEL_CHAT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, dry_run</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    no_system_message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    image_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractString, Vector{&lt;:AbstractString}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Symbol}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    betas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Vector{Symbol}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (retry_non_idempotent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        retries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        readtimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tool_choice </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Calls chat completion API with an optional tool call signature. It can receive both <code>tools</code> and standard string-based content. Ideal for agentic workflows with more complex cognitive architectures.</p><p>Difference to <code>aigenerate</code>: Response can be a tool call (structured)</p><p>Differences to <code>aiextract</code>: Can provide infinitely many tools (including Functions!) and then respond with the tool call&#39;s output.</p><p><strong>Arguments</strong></p><ul><li><p><code>prompt_schema</code>: An optional object to specify which prompt template should be applied (Default to <code>PROMPT_SCHEMA = OpenAISchema</code>)</p></li><li><p><code>prompt</code>: Can be a string representing the prompt for the AI conversation, a <code>UserMessage</code>, a vector of <code>AbstractMessage</code> or an <code>AITemplate</code></p></li><li><p><code>tools</code>: A vector of tools to be used in the conversation. Can be a vector of types, instances of <code>AbstractTool</code>, or a mix of both.</p></li><li><p><code>verbose</code>: A boolean indicating whether to print additional information.</p></li><li><p><code>api_key</code>: A string representing the API key for accessing the Anthropic API.</p></li><li><p><code>model</code>: A string representing the model to use for generating the response. Can be an alias corresponding to a model ID defined in <code>MODEL_CHAT</code>.</p></li><li><p><code>return_all</code>: If <code>true</code>, returns the entire conversation history, otherwise returns only the last message (the <code>AIMessage</code>).</p></li><li><p><code>dry_run</code>: If <code>true</code>, skips sending the messages to the model (for debugging, often used with <code>return_all=true</code>).</p></li><li><p><code>conversation</code>: An optional vector of <code>AbstractMessage</code> objects representing the conversation history.</p></li><li><p><code>no_system_message::Bool = false</code>: Whether to exclude the system message from the conversation history.</p></li><li><p><code>image_path::Union{Nothing, AbstractString, Vector{&lt;:AbstractString}} = nothing</code>: A path to a local image file, or a vector of paths to local image files. Always attaches images to the latest user message.</p></li><li><p><code>cache</code>: A symbol representing the caching strategy to be used. Currently only <code>nothing</code> (no caching), <code>:system</code>, <code>:tools</code>,<code>:last</code>, <code>:all_but_last</code>, and <code>:all</code> are supported. Note: COST estimate will be wrong (ignores the caching).</p><ul><li><p><code>:system</code>: Mark only the system message as cacheable. Best default if you have large system message and you will be sending short conversations (no replies / multi-turn conversations).</p></li><li><p><code>:all</code>: Mark SYSTEM, one before last and LAST user message as cacheable. Best for multi-turn conversations (you write cache point as &quot;last&quot; and it will be read in the next turn as &quot;preceding&quot; cache mark).</p></li><li><p><code>:last</code>: Mark only the last message as cacheable. Use ONLY if you want to send the SAME REQUEST multiple times (and want to save upto the last USER message). This will not work for multi-turn conversations, as the &quot;last&quot; message keeps moving.</p></li><li><p><code>:all_but_last</code>: Mark SYSTEM and one before LAST USER message. Use if you have a longer conversation that you want to re-use, but you will NOT CONTINUE it (no subsequent messages/follow-ups).</p></li><li><p>In short, use <code>:all</code> for multi-turn conversations, <code>:system</code> for repeated single-turn conversations with same system message, and <code>:all_but_last</code> for longer conversations that you want to re-use, but not continue.</p></li></ul></li><li><p><code>betas::Union{Nothing, Vector{Symbol}} = nothing</code>: A vector of symbols representing the beta features to be used. See <code>?anthropic_extra_headers</code> for details.</p></li><li><p><code>http_kwargs</code>: A named tuple of HTTP keyword arguments.</p></li><li><p><code>api_kwargs</code>: A named tuple of API keyword arguments. Several important arguments are highlighted below:</p><ul><li><code>tool_choice</code>: The choice of tool mode. Can be &quot;auto&quot;, &quot;exact&quot;, or can depend on the provided.. Defaults to <code>nothing</code>, which translates to &quot;auto&quot;.</li></ul></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Let&#39;s define a tool</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get_weather</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(location, date) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;The weather in </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$location</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is 70 degrees.&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aitools</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What&#39;s the weather in Tokyo on May 3rd, 2023?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_weather, model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;claudeh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">execute_tool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(get_weather, msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_calls[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">args)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;The weather in Tokyo on 2023-05-03 is 70 degrees.&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Ignores the tool</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aitools</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What&#39;s your name?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_weather, model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;claudeh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># I don&#39;t have a personal name, but you can call me your AI assistant!</span></span></code></pre></div><p>How to have a multi-turn conversation with tools:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aitools</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What&#39;s the weather in Tokyo on May 3rd, 2023?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_weather, return_all </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;claudeh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> conv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_calls[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># there can be multiple tool calls requested!!</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Execute the output to the tool message content</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">execute_tool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(get_weather, tool_msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">args)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Add the tool message to the conversation</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(conv, tool_msg)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Call LLM again with the updated conversation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aitools</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;And in New York?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_weather, return_all </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, conversation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> conv, model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;claudeh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 6-element Vector{AbstractMessage}:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># SystemMessage(&quot;Act as a helpful AI assistant&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># UserMessage(&quot;What&#39;s the weather in Tokyo on May 3rd, 2023?&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIToolRequest(&quot;-&quot;; Tool Requests: 1)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ToolMessage(&quot;The weather in Tokyo on 2023-05-03 is 70 degrees.&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># UserMessage(&quot;And in New York?&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIToolRequest(&quot;-&quot;; Tool Requests: 1)</span></span></code></pre></div><p>Using the the new Computer Use beta feature:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Define tools (and associated functions to call)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_map </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bash&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ToolRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; ref</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:bash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, callable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bash_tool),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;computer&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ToolRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; ref</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:computer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, callable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">computer_tool,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        extras</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;display_width_px&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1920</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;display_height_px&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1080</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;str_replace_editor&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ToolRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; ref</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:str_replace_editor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, callable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">edit_tool))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aitools</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt; tools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">collect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tool_map)), model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;claude&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, betas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:computer_use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pprint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># --------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AI Tool Request</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># --------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Tool Request: computer, args: Dict{Symbol, Any}(:action =&gt; &quot;screenshot&quot;)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_anthropic.jl#L829-L936" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aitools-Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aitools-Tuple{PromptingTools.AbstractOpenAISchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aitools</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aitools</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractOpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Type, Function, Method, AbstractTool, Vector}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Tool[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OPENAI_API_KEY,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MODEL_CHAT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, dry_run</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    no_system_message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    image_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractString, Vector{&lt;:AbstractString}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (retry_non_idempotent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        retries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        readtimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tool_choice </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    strict</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Bool}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    json_mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Bool}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name_user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, String}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name_assistant</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, String}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Calls chat completion API with an optional tool call signature. It can receive both <code>tools</code> and standard string-based content. Ideal for agentic workflows with more complex cognitive architectures.</p><p>Difference to <code>aigenerate</code>: Response can be a tool call (structured)</p><p>Differences to <code>aiextract</code>: Can provide infinitely many tools (including Functions!) and then respond with the tool call&#39;s output.</p><p><strong>Arguments</strong></p><ul><li><p><code>prompt_schema</code>: An optional object to specify which prompt template should be applied (Default to <code>PROMPT_SCHEMA = OpenAISchema</code>)</p></li><li><p><code>prompt</code>: Can be a string representing the prompt for the AI conversation, a <code>UserMessage</code>, a vector of <code>AbstractMessage</code> or an <code>AITemplate</code></p></li><li><p><code>tools</code>: A vector of tools to be used in the conversation. Can be a vector of types, instances of <code>AbstractTool</code>, or a mix of both.</p></li><li><p><code>verbose</code>: A boolean indicating whether to print additional information.</p></li><li><p><code>api_key</code>: A string representing the API key for accessing the OpenAI API.</p></li><li><p><code>model</code>: A string representing the model to use for generating the response. Can be an alias corresponding to a model ID defined in <code>MODEL_CHAT</code>.</p></li><li><p><code>return_all</code>: If <code>true</code>, returns the entire conversation history, otherwise returns only the last message (the <code>AIMessage</code>).</p></li><li><p><code>dry_run</code>: If <code>true</code>, skips sending the messages to the model (for debugging, often used with <code>return_all=true</code>).</p></li><li><p><code>conversation</code>: An optional vector of <code>AbstractMessage</code> objects representing the conversation history.</p></li><li><p><code>no_system_message::Bool = false</code>: Whether to exclude the system message from the conversation history.</p></li><li><p><code>image_path</code>: A path to a local image file, or a vector of paths to local image files. Always attaches images to the latest user message.</p></li><li><p><code>name_user</code>: The name of the user in the conversation history. Defaults to &quot;User&quot;.</p></li><li><p><code>name_assistant</code>: The name of the assistant in the conversation history. Defaults to &quot;Assistant&quot;.</p></li><li><p><code>http_kwargs</code>: A named tuple of HTTP keyword arguments.</p></li><li><p><code>api_kwargs</code>: A named tuple of API keyword arguments. Several important arguments are highlighted below:</p><ul><li><p><code>tool_choice</code>: The choice of tool mode. Can be &quot;auto&quot;, &quot;exact&quot;, or can depend on the provided.. Defaults to <code>nothing</code>, which translates to &quot;auto&quot;.</p></li><li><p><code>response_format</code>: The format of the response. Can be &quot;json_schema&quot; for JSON mode, or &quot;text&quot; for standard text output. Defaults to &quot;text&quot;.</p></li></ul></li><li><p><code>strict</code>: Whether to enforce strict mode for the schema. Defaults to <code>nothing</code>.</p></li><li><p><code>json_mode</code>: Whether to enforce JSON mode for the schema. Defaults to <code>nothing</code>.</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Let&#39;s define a tool</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get_weather</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(location, date) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;The weather in </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$location</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is 70 degrees.&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## JSON mode request</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aitools</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What&#39;s the weather in Tokyo on May 3rd, 2023?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_weather,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    json_mode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">execute_tool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(get_weather, msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_calls[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">args)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;The weather in Tokyo on 2023-05-03 is 70 degrees.&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Function calling request</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aitools</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What&#39;s the weather in Tokyo on May 3rd, 2023?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_weather)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">execute_tool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(get_weather, msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_calls[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">args)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;The weather in Tokyo on 2023-05-03 is 70 degrees.&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Ignores the tool</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aitools</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What&#39;s your name?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_weather)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># I don&#39;t have a personal name, but you can call me your AI assistant!</span></span></code></pre></div><p>How to have a multi-turn conversation with tools:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aitools</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What&#39;s the weather in Tokyo on May 3rd, 2023?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_weather, return_all </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> conv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_calls[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># there can be multiple tool calls requested!!</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Execute the output to the tool message content</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">execute_tool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(get_weather, tool_msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">args)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Add the tool message to the conversation</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(conv, tool_msg)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Call LLM again with the updated conversation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aitools</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;And in New York?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_weather, return_all </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, conversation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> conv)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 6-element Vector{AbstractMessage}:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># SystemMessage(&quot;Act as a helpful AI assistant&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># UserMessage(&quot;What&#39;s the weather in Tokyo on May 3rd, 2023?&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIToolRequest(&quot;-&quot;; Tool Requests: 1)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ToolMessage(&quot;The weather in Tokyo on 2023-05-03 is 70 degrees.&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># UserMessage(&quot;And in New York?&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIToolRequest(&quot;-&quot;; Tool Requests: 1)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_openai.jl#L1617-L1714" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.aitools-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.aitools-Tuple{PromptingTools.AbstractTracerSchema, Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.aitools</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aitools</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tracer_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractTracerSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tracer_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Wraps the normal <code>aitools</code> call in a tracing/callback system. Use <code>tracer_kwargs</code> to provide any information necessary to the tracer/callback system only (eg, <code>parent_id</code>, <code>thread_id</code>, <code>run_id</code>).</p><p>Logic:</p><ul><li><p>calls <code>initialize_tracer</code></p></li><li><p>calls <code>aiextract</code> (with the <code>tracer_schema.schema</code>)</p></li><li><p>calls <code>finalize_tracer</code></p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_tracer.jl#L281-L291" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.align_tracer!-Tuple{AbstractVector{&lt;:Union{PromptingTools.AbstractTracer, PromptingTools.AbstractTracerMessage}}}" href="#PromptingTools.align_tracer!-Tuple{AbstractVector{&lt;:Union{PromptingTools.AbstractTracer, PromptingTools.AbstractTracerMessage}}}">#</a> <b><u>PromptingTools.align_tracer!</u></b> — <i>Method</i>. <p>Aligns multiple tracers in the vector to have the same Parent and Thread IDs as the first item.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L516" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.align_tracer!-Tuple{Union{PromptingTools.AbstractTracer, PromptingTools.AbstractTracerMessage}}" href="#PromptingTools.align_tracer!-Tuple{Union{PromptingTools.AbstractTracer, PromptingTools.AbstractTracerMessage}}">#</a> <b><u>PromptingTools.align_tracer!</u></b> — <i>Method</i>. <p>Aligns the tracer message, updating the <code>parent_id</code>, <code>thread_id</code>. Often used to align multiple tracers in the vector to have the same IDs.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L508" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.annotate!-Union{Tuple{T}, Tuple{AbstractVector{T}, AbstractString}} where T&lt;:PromptingTools.AbstractMessage" href="#PromptingTools.annotate!-Union{Tuple{T}, Tuple{AbstractVector{T}, AbstractString}} where T&lt;:PromptingTools.AbstractMessage">#</a> <b><u>PromptingTools.annotate!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">annotate!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, content; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">annotate!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, content; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Add an annotation message to a vector of messages or wrap a single message in a vector with an annotation. The annotation is always inserted after any existing annotation messages.</p><p><strong>Arguments</strong></p><ul><li><p><code>messages</code>: Vector of messages or single message to annotate</p></li><li><p><code>content</code>: Content of the annotation</p></li><li><p><code>kwargs...</code>: Additional fields for the AnnotationMessage (extras, tags, comment)</p></li></ul><p><strong>Returns</strong></p><p>Vector{AbstractMessage} with the annotation message inserted</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SystemMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UserMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">annotate!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(messages, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;This is important&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; tags</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:important</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], comment</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;For review&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/annotation.jl#L1-L21" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.anthropic_api" href="#PromptingTools.anthropic_api">#</a> <b><u>PromptingTools.anthropic_api</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">anthropic_api</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prompt_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractAnthropicSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractDict{String, &lt;:Any}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Vector{Dict{String, Any}}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANTHROPIC_API_KEY,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    system</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractString, AbstractVector{&lt;:AbstractDict}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    endpoint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    max_tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2048</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;claude-3-haiku-20240307&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://api.anthropic.com/v1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Symbol}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    betas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Vector{Symbol}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Simple wrapper for a call to Anthropic API.</p><p><strong>Keyword Arguments</strong></p><ul><li><p><code>prompt_schema</code>: Defines which prompt template should be applied.</p></li><li><p><code>messages</code>: a vector of <code>AbstractMessage</code> to send to the model</p></li><li><p><code>system</code>: An optional string representing the system message for the AI conversation. If not provided, a default message will be used.</p></li><li><p><code>endpoint</code>: The API endpoint to call, only &quot;messages&quot; are currently supported. Defaults to &quot;messages&quot;.</p></li><li><p><code>model</code>: A string representing the model to use for generating the response. Can be an alias corresponding to a model ID defined in <code>MODEL_ALIASES</code>.</p></li><li><p><code>max_tokens</code>: The maximum number of tokens to generate. Defaults to 2048.</p></li><li><p><code>http_kwargs::NamedTuple</code>: Additional keyword arguments for the HTTP request. Defaults to empty <code>NamedTuple</code>.</p></li><li><p><code>stream</code>: A boolean indicating whether to stream the response. Defaults to <code>false</code>.</p></li><li><p><code>url</code>: The URL of the Ollama API. Defaults to &quot;localhost&quot;.</p></li><li><p><code>cache</code>: A symbol representing the caching strategy to be used. Currently only <code>nothing</code> (no caching), <code>:system</code>, <code>:tools</code>,<code>:last</code>, <code>:all_but_last</code>, and <code>:all</code> are supported.</p></li><li><p><code>betas</code>: A vector of symbols representing the beta features to be used. Currently only <code>:tools</code> and <code>:cache</code> are supported.</p></li><li><p><code>kwargs</code>: Prompt variables to be used to fill the prompt/template</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_anthropic.jl#L276-L306" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.anthropic_extra_headers-Tuple{}" href="#PromptingTools.anthropic_extra_headers-Tuple{}">#</a> <b><u>PromptingTools.anthropic_extra_headers</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">anthropic_extra_headers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    has_tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, has_cache </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, has_long_output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    has_extended_output </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    betas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Vector{Symbol}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Adds API version and beta headers to the request.</p><p><strong>Kwargs / Beta headers</strong></p><ul><li><p><code>has_tools</code>: Enables tools in the conversation.</p></li><li><p><code>has_cache</code>: Enables prompt caching.</p></li><li><p><code>has_long_output</code>: Enables long outputs (up to 8K tokens) with Anthropic&#39;s Sonnet 3.5.</p></li><li><p><code>has_extended_output</code>: Enables extended output up to 128K tokens with Claude 3.7 Sonnet.</p></li><li><p><code>betas</code>: A vector of symbols representing the beta features to be used. Currently only <code>:computer_use</code>, <code>:long_output</code>, <code>:tools</code>, <code>:cache</code>, and <code>:extended_output</code> are supported.</p></li></ul><p>Refer to <code>BETA_HEADERS_ANTHROPIC</code> for the allowed beta features.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_anthropic.jl#L227-L243" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.auth_header-Tuple{Union{Nothing, AbstractString}}" href="#PromptingTools.auth_header-Tuple{Union{Nothing, AbstractString}}">#</a> <b><u>PromptingTools.auth_header</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">auth_header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    bearer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    x_api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    extra_headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Vector{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Pair{String, String},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Creates the authentication headers for any API request. Assumes that the communication is done in JSON format.</p><p><strong>Arguments</strong></p><ul><li><p><code>api_key::Union{Nothing, AbstractString}</code>: The API key to be used for authentication. If <code>Nothing</code>, no authentication is used.</p></li><li><p><code>bearer::Bool</code>: Provide the API key in the <code>Authorization: Bearer ABC</code> format. Defaults to <code>true</code>.</p></li><li><p><code>x_api_key::Bool</code>: Provide the API key in the <code>Authorization: x-api-key: ABC</code> format. Defaults to <code>false</code>.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/utils.jl#L639-L654" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.batch_start_index-Tuple{Integer, Integer, Integer}" href="#PromptingTools.batch_start_index-Tuple{Integer, Integer, Integer}">#</a> <b><u>PromptingTools.batch_start_index</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">batch_start_index</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(array_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, n</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, batch_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Integer</span></span></code></pre></div><p>Compute the starting index for retrieving the most recent data, adjusting in blocks of <code>batch_size</code>. The function accumulates messages until hitting a batch boundary, then jumps to the next batch.</p><p>For example, with n=20 and batch_size=10:</p><ul><li><p>At length 90-99: returns 80 (allowing accumulation of 11-20 messages)</p></li><li><p>At length 100-109: returns 90 (allowing accumulation of 11-20 messages)</p></li><li><p>At length 110: returns 100 (resetting to 11 messages)</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/memory.jl#L210-L220" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.build_template_metadata" href="#PromptingTools.build_template_metadata">#</a> <b><u>PromptingTools.build_template_metadata</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">build_template_metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    template</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, template_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Symbol</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    metadata_msgs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:MetadataMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MetadataMessage[]; max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Builds <code>AITemplateMetadata</code> for a given template based on the messages in <code>template</code> and other information.</p><p><code>AITemplateMetadata</code> is a helper struct for easy searching and reviewing of templates via <code>aitemplates()</code>.</p><p>Note: Assumes that there is only ever one UserMessage and SystemMessage (concatenates them together)</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/templates.jl#L123-L133" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.call_cost-Tuple{Int64, Int64, String}" href="#PromptingTools.call_cost-Tuple{Int64, Int64, String}">#</a> <b><u>PromptingTools.call_cost</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">call_cost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt_tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, completion_tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_of_token_prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Number</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(MODEL_REGISTRY,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        model,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        (; cost_of_token_prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cost_of_token_prompt,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_of_token_generation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Number</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(MODEL_REGISTRY, model,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        (; cost_of_token_generation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cost_of_token_generation)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">call_cost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg, model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Calculate the cost of a call based on the number of tokens in the message and the cost per token. If the cost is already calculated (in <code>msg.cost</code>), it will not be re-calculated.</p><p><strong>Arguments</strong></p><ul><li><p><code>prompt_tokens::Int</code>: The number of tokens used in the prompt.</p></li><li><p><code>completion_tokens::Int</code>: The number of tokens used in the completion.</p></li><li><p><code>model::String</code>: The name of the model to use for determining token costs. If the model is not found in <code>MODEL_REGISTRY</code>, default costs are used.</p></li><li><p><code>cost_of_token_prompt::Number</code>: The cost per prompt token. Defaults to the cost in <code>MODEL_REGISTRY</code> for the given model, or 0.0 if the model is not found.</p></li><li><p><code>cost_of_token_generation::Number</code>: The cost per generation token. Defaults to the cost in <code>MODEL_REGISTRY</code> for the given model, or 0.0 if the model is not found.</p></li></ul><p><strong>Returns</strong></p><ul><li><code>Number</code>: The total cost of the call.</li></ul><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Assuming MODEL_REGISTRY is set up with appropriate costs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MODEL_REGISTRY </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;model1&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cost_of_token_prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.05</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, cost_of_token_generation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;model2&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cost_of_token_prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.07</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, cost_of_token_generation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.02</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cost1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> call_cost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;model1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># from message</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AIMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 10 prompt tokens, 20 generation tokens</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cost1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> call_cost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg1, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;model1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># cost1 = 10 * 0.05 + 20 * 0.10 = 2.5</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Using custom token costs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cost2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> call_cost</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;model3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; cost_of_token_prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.08</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, cost_of_token_generation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.12</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># cost2 = 10 * 0.08 + 20 * 0.12 = 3.2</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/utils.jl#L373-L418" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.call_cost_alternative-Tuple{Any, Any}" href="#PromptingTools.call_cost_alternative-Tuple{Any, Any}">#</a> <b><u>PromptingTools.call_cost_alternative</u></b> — <i>Method</i>. <p>call_cost_alternative()</p><p>Alternative cost calculation. Used to calculate cost of image generation with DALL-E 3 and similar.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/utils.jl#L452-L456" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.configure_callback!-Union{Tuple{T}, Tuple{T, PromptingTools.AbstractPromptSchema}} where T&lt;:StreamCallbacks.AbstractStreamCallback" href="#PromptingTools.configure_callback!-Union{Tuple{T}, Tuple{T, PromptingTools.AbstractPromptSchema}} where T&lt;:StreamCallbacks.AbstractStreamCallback">#</a> <b><u>PromptingTools.configure_callback!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">configure_callback!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">StreamCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractPromptSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Configures the callback <code>cb</code> for streaming with a given prompt schema.</p><p>If no <code>cb.flavor</code> is provided, adjusts the <code>flavor</code> and the provided <code>api_kwargs</code> as necessary. Eg, for most schemas, we add kwargs like <code>stream = true</code> to the <code>api_kwargs</code>.</p><p>If <code>cb.flavor</code> is provided, both <code>callback</code> and <code>api_kwargs</code> are left unchanged! You need to configure them yourself!</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/streaming.jl#L5-L15" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.create_template-Tuple{AbstractString, AbstractString}" href="#PromptingTools.create_template-Tuple{AbstractString, AbstractString}">#</a> <b><u>PromptingTools.create_template</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">create_template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, system</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Act as a helpful AI assistant.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    load_as</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Symbol, AbstractString}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">create_template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(system</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    load_as</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Symbol, AbstractString}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Creates a simple template with a user and system message. Convenience function to prevent writing <code>[PT.UserMessage(...), ...]</code></p><p><strong>Arguments</strong></p><ul><li><p><code>system::AbstractString</code>: The system message. Usually defines the personality, style, instructions, output format, etc.</p></li><li><p><code>user::AbstractString</code>: The user message. Usually defines the input, query, request, etc.</p></li><li><p><code>load_as::Union{Nothing, Symbol, AbstractString}</code>: If provided, loads the template into the <code>TEMPLATE_STORE</code> under the provided name <code>load_as</code>. If <code>nothing</code>, does not load the template.</p></li></ul><p>Use double handlebar placeholders (eg, <code></code>) to define variables that can be replaced by the <code>kwargs</code> during the AI call (see example).</p><p>Returns a vector of <code>SystemMessage</code> and UserMessage objects. If <code>load_as</code> is provided, it registers the template in the <code>TEMPLATE_STORE</code> and <code>TEMPLATE_METADATA</code> as well.</p><p><strong>Examples</strong></p><p>Let&#39;s generate a quick template for a simple conversation (only one placeholder: name)</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># first system message, then user message (or use kwargs)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tpl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">create_template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You must speak like a pirate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi to {{name}}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 2-element Vector{PromptingTools.AbstractChatMessage}:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## PromptingTools.SystemMessage(&quot;You must speak like a pirate&quot;)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##  PromptingTools.UserMessage(&quot;Say hi to {{name}}&quot;)</span></span></code></pre></div><p>You can immediately use this template in <code>ai*</code> functions:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tpl; name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Jack Sparrow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: AIMessage(&quot;Arr, me hearty! Best be sending me regards to Captain Jack Sparrow on the salty seas! May his compass always point true to the nearest treasure trove. Yarrr!&quot;)</span></span></code></pre></div><p>If you&#39;re interested in saving the template in the template registry, jump to the end of these examples!</p><p>If you want to save it in your project folder:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">save_template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;templates/GreatingPirate.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, tpl; version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># optionally, add description</span></span></code></pre></div><p>It will be saved and accessed under its basename, ie, <code>GreatingPirate</code>.</p><p>Now you can load it like all the other templates (provide the template directory):</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">load_templates!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;templates&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># it will remember the folder after the first run</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Note: If you save it again, overwrite it, etc., you need to explicitly reload all templates again!</span></span></code></pre></div><p>You can verify that your template is loaded with a quick search for &quot;pirate&quot;:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aitemplates</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pirate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 1-element Vector{AITemplateMetadata}:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## PromptingTools.AITemplateMetadata</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##   name: Symbol GreatingPirate</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##   description: String &quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##   version: String &quot;1.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##   wordcount: Int64 46</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##   variables: Array{Symbol}((1,))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##   system_preview: String &quot;You must speak like a pirate&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##   user_preview: String &quot;Say hi to {{name}}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##   source: String &quot;&quot;</span></span></code></pre></div><p>Now you can use it like any other template (notice it&#39;s a symbol, so <code>:GreatingPirate</code>):</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:GreatingPirate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Jack Sparrow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: AIMessage(&quot;Arr, me hearty! Best be sending me regards to Captain Jack Sparrow on the salty seas! May his compass always point true to the nearest treasure trove. Yarrr!&quot;)</span></span></code></pre></div><p>If you do not need to save this template as a file, but you want to make it accessible in the template store for all <code>ai*</code> functions, you can use the <code>load_as</code> (= template name) keyword argument:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># this will not only create the template, but also register it for immediate use</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tpl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">create_template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You must speak like a pirate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi to {{name}}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; load_as</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;GreatingPirate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># you can now use it like any other template</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aiextract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:GreatingPirate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Jack Sparrow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/templates.jl#L420-L504" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.decode_choices-Tuple{PromptingTools.OpenAISchema, AbstractVector{&lt;:AbstractString}, AIMessage}" href="#PromptingTools.decode_choices-Tuple{PromptingTools.OpenAISchema, AbstractVector{&lt;:AbstractString}, AIMessage}">#</a> <b><u>PromptingTools.decode_choices</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">decode_choices</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    choices</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AIMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    token_ids_map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Dict{&lt;:AbstractString, &lt;:Integer}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Decodes the underlying AIMessage against the original choices to lookup what the category name was.</p><p>If it fails, it will return <code>msg.content == nothing</code></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_openai.jl#L713-L723" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.detect_base_main_overrides-Tuple{AbstractString}" href="#PromptingTools.detect_base_main_overrides-Tuple{AbstractString}">#</a> <b><u>PromptingTools.detect_base_main_overrides</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">detect_base_main_overrides</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(code_block</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Detects if a given code block overrides any Base or Main methods.</p><p>Returns a tuple of a boolean and a vector of the overriden methods.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/code_parsing.jl#L428-L434" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.distance_longest_common_subsequence-Tuple{AbstractString, AbstractString}" href="#PromptingTools.distance_longest_common_subsequence-Tuple{AbstractString, AbstractString}">#</a> <b><u>PromptingTools.distance_longest_common_subsequence</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">distance_longest_common_subsequence</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    input1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, input2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">distance_longest_common_subsequence</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    input1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, input2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Measures distance between two strings using the length of the longest common subsequence (ie, the lower the number, the better the match). Perfect match is <code>distance = 0.0</code></p><p>Convenience wrapper around <code>length_longest_common_subsequence</code> to normalize the distances to 0-1 range. There is a also a dispatch for comparing a string vs an array of strings.</p><p><strong>Notes</strong></p><ul><li><p>Use <code>argmin</code> and <code>minimum</code> to find the position of the closest match and the distance, respectively.</p></li><li><p>Matching with an empty string will always return 1.0 (worst match), even if the other string is empty as well (safety mechanism to avoid division by zero).</p></li></ul><p><strong>Arguments</strong></p><ul><li><p><code>input1::AbstractString</code>: The first string to compare.</p></li><li><p><code>input2::AbstractString</code>: The second string to compare.</p></li></ul><p><strong>Example</strong></p><p>You can also use it to find the closest context for some AI generated summary/story:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;The enigmatic stranger vanished as swiftly as a wisp of smoke, leaving behind a trail of unanswered questions.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;Beneath the shimmering moonlight, the ocean whispered secrets only the stars could hear.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;The ancient tree stood as a silent guardian, its gnarled branches reaching for the heavens.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;The melody danced through the air, painting a vibrant tapestry of emotions.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;Time flowed like a relentless river, carrying away memories and leaving imprints in its wake.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">story </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Beneath the shimmering moonlight, the ocean whispered secrets only the stars could hear.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Under the celestial tapestry, the vast ocean whispered its secrets to the indifferent stars. Each ripple, a murmured confidence, each wave, a whispered lament. The glittering celestial bodies listened in silent complicity, their enigmatic gaze reflecting the ocean&#39;s unspoken truths. The cosmic dance between the sea and the sky, a symphony of shared secrets, forever echoing in the ethereal expanse.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dist </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> distance_longest_common_subsequence</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(story, context)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">@info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;The closest context to the query: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">first</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(story,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; is: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(context[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">argmin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dist)])</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; (distance: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(minimum(dist))</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)&quot;</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/utils.jl#L304-L346" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.encode_choices-Tuple{PromptingTools.OpenAISchema, AbstractVector{&lt;:AbstractString}}" href="#PromptingTools.encode_choices-Tuple{PromptingTools.OpenAISchema, AbstractVector{&lt;:AbstractString}}">#</a> <b><u>PromptingTools.encode_choices</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">encode_choices</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, choices</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    token_ids_map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Dict{&lt;:AbstractString, &lt;:Integer}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">encode_choices</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, choices</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{T}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    token_ids_map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Dict{&lt;:AbstractString, &lt;:Integer}}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {T </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Tuple{&lt;:AbstractString, &lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Encode the choices into an enumerated list that can be interpolated into the prompt and creates the corresponding logit biases (to choose only from the selected tokens).</p><p>Optionally, can be a vector tuples, where the first element is the choice and the second is the description.</p><p>There can be at most 40 choices provided.</p><p><strong>Arguments</strong></p><ul><li><p><code>schema::OpenAISchema</code>: The OpenAISchema object.</p></li><li><p><code>choices::AbstractVector{&lt;:Union{AbstractString,Tuple{&lt;:AbstractString, &lt;:AbstractString}}}</code>: The choices to be encoded, represented as a vector of the choices directly, or tuples where each tuple contains a choice and its description.</p></li><li><p><code>model::AbstractString</code>: The model to use for encoding. Can be an alias corresponding to a model ID defined in <code>MODEL_ALIASES</code>.</p></li><li><p><code>token_ids_map::Union{Nothing, Dict{&lt;:AbstractString, &lt;:Integer}} = nothing</code>: A dictionary mapping custom token IDs to their corresponding integer values. If <code>nothing</code>, it will use the default token IDs for the given model.</p></li><li><p><code>kwargs...</code>: Additional keyword arguments.</p></li></ul><p><strong>Returns</strong></p><ul><li><p><code>choices_prompt::AbstractString</code>: The encoded choices as a single string, separated by newlines.</p></li><li><p><code>logit_bias::Dict</code>: The logit bias dictionary, where the keys are the token IDs and the values are the bias values.</p></li><li><p><code>decode_ids::AbstractVector{&lt;:AbstractString}</code>: The decoded IDs of the choices.</p></li></ul><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">choices_prompt, logit_bias, _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">encode_choices</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;true&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;false&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">choices_prompt </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: &quot;true for &quot;true&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;false&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">logit_bias </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: Dict(837 =&gt; 100, 905 =&gt; 100)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">choices_prompt, logit_bias, _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">encode_choices</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;animal&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;plant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">choices_prompt </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: &quot;1. &quot;animal&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;plant&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">logit_bias # Output: Dict(16 =&gt; 100, 17 =&gt; 100)</span></span></code></pre></div><p>Or choices with descriptions:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">choices_prompt, logit_bias, _ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">encode_choices</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), [(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;any animal or creature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;P&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;for any plant or tree&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;O&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;for everything else&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">choices_prompt </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: &quot;1. &quot;A&quot; for any animal or creature</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;P&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> any plant or tree</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;O&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> everything </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">else</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">logit_bias # Output: Dict(16 =&gt; 100, 17 =&gt; 100, 18 =&gt; 100)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_openai.jl#L591-L641" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.ensure_http_prefix-Tuple{AbstractString}" href="#PromptingTools.ensure_http_prefix-Tuple{AbstractString}">#</a> <b><u>PromptingTools.ensure_http_prefix</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ensure_http_prefix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String</span></span></code></pre></div><p>Ensures that a URL has an HTTP or HTTPS protocol prefix. If the URL already starts with &quot;http://&quot; or &quot;https://&quot;, it is returned unchanged. Otherwise, &quot;http://&quot; is prepended.</p><p><strong>Arguments</strong></p><ul><li><code>url::AbstractString</code>: The URL to check and potentially modify.</li></ul><p><strong>Returns</strong></p><p><code>String</code>: The URL with an appropriate protocol prefix.</p><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ensure_http_prefix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;localhost:8080&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;http://localhost:8080&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ensure_http_prefix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;http://example.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ensure_http_prefix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://localhost&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;http://localhost&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ensure_http_prefix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;https://example.com&quot;</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/utils.jl#L718-L737" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.eval!-Tuple{PromptingTools.AbstractCodeBlock}" href="#PromptingTools.eval!-Tuple{PromptingTools.AbstractCodeBlock}">#</a> <b><u>PromptingTools.eval!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">eval!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractCodeBlock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    safe_eval</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    capture_stdout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    suffix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Evaluates a code block <code>cb</code> in-place. It runs automatically when AICode is instantiated with a String.</p><p>Check the outcome of evaluation with <code>Base.isvalid(cb)</code>. If <code>==true</code>, provide code block has executed successfully.</p><p>Steps:</p><ul><li><p>If <code>cb::AICode</code> has not been evaluated, <code>cb.success = nothing</code>. After the evaluation it will be either <code>true</code> or <code>false</code> depending on the outcome</p></li><li><p>Parse the text in <code>cb.code</code></p></li><li><p>Evaluate the parsed expression</p></li><li><p>Capture outputs of the evaluated in <code>cb.output</code></p></li><li><p>[OPTIONAL] Capture any stdout outputs (eg, test failures) in <code>cb.stdout</code></p></li><li><p>If any error exception is raised, it is saved in <code>cb.error</code></p></li><li><p>Finally, if all steps were successful, success is set to <code>cb.success = true</code></p></li></ul><p><strong>Keyword Arguments</strong></p><ul><li><p><code>safe_eval::Bool</code>: If <code>true</code>, we first check for any Pkg operations (eg, installing new packages) and missing imports, then the code will be evaluated inside a bespoke scratch module (not to change any user variables)</p></li><li><p><code>capture_stdout::Bool</code>: If <code>true</code>, we capture any stdout outputs (eg, test failures) in <code>cb.stdout</code></p></li><li><p><code>prefix::AbstractString</code>: A string to be prepended to the code block before parsing and evaluation. Useful to add some additional code definition or necessary imports. Defaults to an empty string.</p></li><li><p><code>suffix::AbstractString</code>: A string to be appended to the code block before parsing and evaluation. Useful to check that tests pass or that an example executes. Defaults to an empty string.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/code_eval.jl#L214-L243" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.execute_tool" href="#PromptingTools.execute_tool">#</a> <b><u>PromptingTools.execute_tool</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">execute_tool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractDict{Symbol, &lt;:Any}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractDict{Symbol, &lt;:Any}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Dict{Symbol, Any}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    throw_on_error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, unused_as_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Executes a function with the provided arguments.</p><p>Picks the function arguments in the following order:</p><ul><li><p><code>:context</code> refers to the context dictionary passed to the function.</p></li><li><p>Then it looks for the arguments in the <code>context</code> dictionary.</p></li><li><p>Then it looks for the arguments in the <code>args</code> dictionary.</p></li></ul><p>Dictionary is un-ordered, so we need to sort the arguments first and then pass them to the function.</p><p><strong>Arguments</strong></p><ul><li><p><code>f::Function</code>: The function to execute.</p></li><li><p><code>args::AbstractDict{Symbol, &lt;:Any}</code>: The arguments to pass to the function.</p></li><li><p><code>context::AbstractDict{Symbol, &lt;:Any}</code>: Optional context to pass to the function, it will prioritized to get the argument values from.</p></li><li><p><code>throw_on_error::Bool</code>: Whether to throw an error if the tool execution fails. Defaults to <code>true</code>.</p></li><li><p><code>unused_as_kwargs::Bool</code>: Whether to pass unused arguments as keyword arguments. Defaults to <code>false</code>. Function must support keyword arguments!</p></li><li><p><code>kwargs...</code>: Additional keyword arguments to pass to the function.</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">my_function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x, y) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> y</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">execute_tool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(my_function, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:y</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get_weather</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(date, location) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;The weather in </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$location</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is 70 degrees.&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_map </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tool_call_signature</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(get_weather)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aitools</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What&#39;s the weather in Tokyo on May 3rd, 2023?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tools </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> collect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tool_map)))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">execute_tool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tool_map, PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tool_calls</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg)[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &quot;The weather in Tokyo on 2023-05-03 is 70 degrees.&quot;</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L792-L831" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.extract_code_blocks-Tuple{T} where T&lt;:AbstractString" href="#PromptingTools.extract_code_blocks-Tuple{T} where T&lt;:AbstractString">#</a> <b><u>PromptingTools.extract_code_blocks</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">extract_code_blocks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(markdown_content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Vector{String}</span></span></code></pre></div><p>Extract Julia code blocks from a markdown string.</p><p>This function searches through the provided markdown content, identifies blocks of code specifically marked as Julia code (using the <code>julia ...</code> code fence patterns), and extracts the code within these blocks. The extracted code blocks are returned as a vector of strings, with each string representing one block of Julia code.</p><p>Note: Only the content within the code fences is extracted, and the code fences themselves are not included in the output.</p><p>See also: <code>extract_code_blocks_fallback</code></p><p><strong>Arguments</strong></p><ul><li><code>markdown_content::String</code>: A string containing the markdown content from which Julia code blocks are to be extracted.</li></ul><p><strong>Returns</strong></p><ul><li><code>Vector{String}</code>: A vector containing strings of extracted Julia code blocks. If no Julia code blocks are found, an empty vector is returned.</li></ul><p><strong>Examples</strong></p><p>Example with a single Julia code block</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">markdown_single </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;&quot;</span></span></code></pre></div><p>julia println(&quot;Hello, World!&quot;)</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&quot;&quot;&quot;</span></span>
<span class="line"><span>extract_code_blocks(markdown_single)</span></span>
<span class="line"><span># Output: [&quot;Hello, World!&quot;]</span></span></code></pre></div><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Example with multiple Julia code blocks</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">markdown_multiple </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;&quot;</span></span></code></pre></div><p>julia x = 5</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Some text in between</span></span></code></pre></div><p>julia y = x + 2</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&quot;&quot;&quot;</span></span>
<span class="line"><span>extract_code_blocks(markdown_multiple)</span></span>
<span class="line"><span># Output: [&quot;x = 5&quot;, &quot;y = x + 2&quot;]</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/code_parsing.jl#L175-L221" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.extract_code_blocks_fallback-Union{Tuple{T}, Tuple{T, AbstractString}} where T&lt;:AbstractString" href="#PromptingTools.extract_code_blocks_fallback-Union{Tuple{T}, Tuple{T, AbstractString}} where T&lt;:AbstractString">#</a> <b><u>PromptingTools.extract_code_blocks_fallback</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">extract_code_blocks_fallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(markdown_content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, delim</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">```</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Extract Julia code blocks from a markdown string using a fallback method (splitting by arbitrary <code>delim</code>-iters). Much more simplistic than <code>extract_code_blocks</code> and does not support nested code blocks.</p><p>It is often used as a fallback for smaller LLMs that forget to code fence <code>julia ...</code>.</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;&quot;</span></span></code></pre></div><p>println(&quot;hello&quot;)</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>Some text</span></span></code></pre></div><p>println(&quot;world&quot;)</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&quot;&quot;&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># We extract text between triple backticks and check each blob if it looks like a valid Julia code</span></span>
<span class="line"><span>code_parsed = extract_code_blocks_fallback(code) |&gt; x -&gt; filter(is_julia_code, x) |&gt; x -&gt; join(x, &quot;</span></span>
<span class="line"><span>&quot;)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/code_parsing.jl#L277-L304" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.extract_docstring-Tuple{Union{Function, Type}}" href="#PromptingTools.extract_docstring-Tuple{Union{Function, Type}}">#</a> <b><u>PromptingTools.extract_docstring</u></b> — <i>Method</i>. <p>Extract the docstring from a type or function.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L178" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.extract_function_name-Tuple{AbstractString}" href="#PromptingTools.extract_function_name-Tuple{AbstractString}">#</a> <b><u>PromptingTools.extract_function_name</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">extract_function_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(code_block</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Union{String, Nothing}</span></span></code></pre></div><p>Extract the name of a function from a given Julia code block. The function searches for two patterns:</p><ul><li><p>The explicit function declaration pattern: <code>function name(...) ... end</code></p></li><li><p>The concise function declaration pattern: <code>name(...) = ...</code></p></li></ul><p>If a function name is found, it is returned as a string. If no function name is found, the function returns <code>nothing</code>.</p><p>To capture all function names in the block, use <code>extract_function_names</code>.</p><p><strong>Arguments</strong></p><ul><li><code>code_block::String</code>: A string containing Julia code.</li></ul><p><strong>Returns</strong></p><ul><li><code>Union{String, Nothing}</code>: The extracted function name or <code>nothing</code> if no name is found.</li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">code </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">function myFunction(arg1, arg2)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    # Function body</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">end</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">extract_function_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(code)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: &quot;myFunction&quot;</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/code_parsing.jl#L347-L374" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.extract_function_names-Tuple{AbstractString}" href="#PromptingTools.extract_function_names-Tuple{AbstractString}">#</a> <b><u>PromptingTools.extract_function_names</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">extract_function_names</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(code_block</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Extract one or more names of functions defined in a given Julia code block. The function searches for two patterns: - The explicit function declaration pattern: <code>function name(...) ... end</code> - The concise function declaration pattern: <code>name(...) = ...</code></p><p>It always returns a vector of strings, even if only one function name is found (it will be empty).</p><p>For only one function name match, use <code>extract_function_name</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/code_parsing.jl#L397-L407" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.extract_image_attributes-Tuple{AbstractString}" href="#PromptingTools.extract_image_attributes-Tuple{AbstractString}">#</a> <b><u>PromptingTools.extract_image_attributes</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">extract_image_attributes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image_url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Tuple{String, String}</span></span></code></pre></div><p>Extracts the data type and base64-encoded data from a data URL.</p><p><strong>Arguments</strong></p><ul><li><code>image_url::AbstractString</code>: The data URL to be parsed.</li></ul><p><strong>Returns</strong></p><p><code>Tuple{String, String}</code>: A tuple containing the data type (e.g., <code>&quot;image/png&quot;</code>) and the base64-encoded data.</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">image_url </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABQAA&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data_type, data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> extract_data_type_and_data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(image_url)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># data_type == &quot;image/png&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># data == &quot;iVBORw0KGgoAAAANSUhEUgAABQAA&quot;</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/utils.jl#L687-L705" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.extract_julia_imports-Tuple{AbstractString}" href="#PromptingTools.extract_julia_imports-Tuple{AbstractString}">#</a> <b><u>PromptingTools.extract_julia_imports</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">extract_julia_imports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(input</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; base_or_main</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Detects any <code>using</code> or <code>import</code> statements in a given string and returns the package names as a vector of symbols.</p><p><code>base_or_main</code> is a boolean that determines whether to isolate only <code>Base</code> and <code>Main</code> OR whether to exclude them in the returned vector.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/code_parsing.jl#L23-L29" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.finalize_outputs-Tuple{Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}, Any, Union{Nothing, PromptingTools.AbstractMessage, AbstractVector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.finalize_outputs-Tuple{Union{AbstractString, PromptingTools.AbstractMessage, Vector{&lt;:PromptingTools.AbstractMessage}}, Any, Union{Nothing, PromptingTools.AbstractMessage, AbstractVector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.finalize_outputs</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">finalize_outputs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, conv_rendered</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractMessage, AbstractVector{&lt;:AbstractMessage}}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    dry_run</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    no_system_message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Finalizes the outputs of the ai* functions by either returning the conversation history or the last message.</p><p><strong>Keyword arguments</strong></p><ul><li><p><code>return_all::Bool=false</code>: If true, returns the entire conversation history, otherwise returns only the last message (the <code>AIMessage</code>).</p></li><li><p><code>dry_run::Bool=false</code>: If true, does not send the messages to the model, but only renders the prompt with the given schema and replacement variables. Useful for debugging when you want to check the specific schema rendering.</p></li><li><p><code>conversation::AbstractVector{&lt;:AbstractMessage}=[]</code>: An optional vector of <code>AbstractMessage</code> objects representing the conversation history. If not provided, it is initialized as an empty vector.</p></li><li><p><code>kwargs...</code>: Variables to replace in the prompt template.</p></li><li><p><code>no_system_message::Bool=false</code>: If true, the default system message is not included in the conversation history. Any existing system message is converted to a <code>UserMessage</code>.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_shared.jl#L116-L134" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.finalize_tracer-Tuple{PromptingTools.AbstractTracerSchema, Any, Union{PromptingTools.AbstractMessage, AbstractVector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.finalize_tracer-Tuple{PromptingTools.AbstractTracerSchema, Any, Union{PromptingTools.AbstractMessage, AbstractVector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.finalize_tracer</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">finalize_tracer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tracer_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractTracerSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, tracer, msg_or_conv</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        AbstractMessage, AbstractVector{</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tracer_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Finalizes the calltracer of whatever is nedeed after the <code>ai*</code> calls. Use <code>tracer_kwargs</code> to provide any information necessary (eg, <code>parent_id</code>, <code>thread_id</code>, <code>run_id</code>).</p><p>In the default implementation, we convert all non-tracer messages into <code>TracerMessage</code>.</p><p>See also: <code>meta</code>, <code>unwrap</code>, <code>SaverSchema</code>, <code>initialize_tracer</code></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_tracer.jl#L81-L92" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.finalize_tracer-Tuple{PromptingTools.SaverSchema, Any, Union{PromptingTools.AbstractMessage, AbstractVector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.finalize_tracer-Tuple{PromptingTools.SaverSchema, Any, Union{PromptingTools.AbstractMessage, AbstractVector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.finalize_tracer</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">finalize_tracer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tracer_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SaverSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, tracer, msg_or_conv</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        AbstractMessage, AbstractVector{</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tracer_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Finalizes the calltracer by saving the provided conversation <code>msg_or_conv</code> to the disk.</p><p>Default path is <code>LOG_DIR/conversation__&lt;first_msg_hash&gt;__&lt;time_received_str&gt;.json</code>, where <code>LOG_DIR</code> is set by user preferences or ENV variable (defaults to <code>log/</code> in current working directory).</p><p>If you want to change the logging directory or the exact file name to log with, you can provide the following arguments to <code>tracer_kwargs</code>:</p><ul><li><p><code>log_dir</code> - used as the directory to save the log into when provided. Defaults to <code>LOG_DIR</code> if not provided.</p></li><li><p><code>log_file_path</code> - used as the file name to save the log into when provided. This value overrules the <code>log_dir</code> and <code>LOG_DIR</code> if provided.</p></li></ul><p>It can be composed with <code>TracerSchema</code> to also attach necessary metadata (see below).</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wrap_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SaverSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TracerSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">OpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(wrap_schema,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:BlankSystemUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; system</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You&#39;re a French-speaking assistant!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gpt-4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, api_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(;temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), return_all</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># conv is a vector of messages that will be saved to a JSON together with metadata about the template and api_kwargs</span></span></code></pre></div><p>See also: <code>meta</code>, <code>unwrap</code>, <code>TracerSchema</code>, <code>initialize_tracer</code></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_tracer.jl#L120-L147" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.find_subsequence_positions-Tuple{Any, Any}" href="#PromptingTools.find_subsequence_positions-Tuple{Any, Any}">#</a> <b><u>PromptingTools.find_subsequence_positions</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">find_subsequence_positions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(subseq, seq) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Vector{Int}</span></span></code></pre></div><p>Find all positions of a subsequence <code>subseq</code> within a larger sequence <code>seq</code>. Used to lookup positions of code blocks in markdown.</p><p>This function scans the sequence <code>seq</code> and identifies all starting positions where the subsequence <code>subseq</code> is found. Both <code>subseq</code> and <code>seq</code> should be vectors of integers, typically obtained using <code>codeunits</code> on strings.</p><p><strong>Arguments</strong></p><ul><li><p><code>subseq</code>: A vector of integers representing the subsequence to search for.</p></li><li><p><code>seq</code>: A vector of integers representing the larger sequence in which to search.</p></li></ul><p><strong>Returns</strong></p><ul><li><code>Vector{Int}</code>: A vector of starting positions (1-based indices) where the subsequence is found in the sequence.</li></ul><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">find_subsequence_positions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">codeunits</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ab&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">codeunits</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cababcab&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Returns [2, 5]</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/code_parsing.jl#L134-L152" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.generate_struct-Tuple{Vector}" href="#PromptingTools.generate_struct-Tuple{Vector}">#</a> <b><u>PromptingTools.generate_struct</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">generate_struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fields</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Generate a struct with the given name and fields. Fields can be specified simply as symbols (with default type <code>String</code>) or pairs of symbol and type. Field descriptions can be provided by adding a pair with the field name suffixed with &quot;**description&quot; (eg, <code>:myfield**description =&gt; &quot;My field description&quot;</code>).</p><p>Returns: A tuple of (struct type, descriptions)</p><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Weather, descriptions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> generate_struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:location</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     :temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Float64,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     :temperature__description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Temperature in degrees Fahrenheit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     :condition</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">String,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     :condition__description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Current weather condition (e.g., sunny, rainy, cloudy)&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ])</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L289-L307" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.get_arg_names-Tuple{Function}" href="#PromptingTools.get_arg_names-Tuple{Function}">#</a> <b><u>PromptingTools.get_arg_names</u></b> — <i>Method</i>. <p>Get the argument names from a function, ignores keyword arguments!!</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L173" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.get_arg_names-Tuple{Method}" href="#PromptingTools.get_arg_names-Tuple{Method}">#</a> <b><u>PromptingTools.get_arg_names</u></b> — <i>Method</i>. <p>Get the argument names from a method, ignores keyword arguments!!</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L160" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.get_arg_types-Tuple{Function}" href="#PromptingTools.get_arg_types-Tuple{Function}">#</a> <b><u>PromptingTools.get_arg_types</u></b> — <i>Method</i>. <p>Get the argument types from a function, ignores keyword arguments!!</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L175" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.get_arg_types-Tuple{Method}" href="#PromptingTools.get_arg_types-Tuple{Method}">#</a> <b><u>PromptingTools.get_arg_types</u></b> — <i>Method</i>. <p>Get the argument types from a method, ignores keyword arguments!!</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L169" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.get_last" href="#PromptingTools.get_last">#</a> <b><u>PromptingTools.get_last</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">get_last</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ConversationMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, n</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         batch_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing,Integer}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         explain</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Get the last n messages (but including system message) with intelligent batching to preserve caching.</p><p>Arguments:</p><ul><li><p>n::Integer: Maximum number of messages to return (default: 20)</p></li><li><p>batch_size::Union{Nothing,Integer}: If provided, ensures messages are truncated in fixed batches</p></li><li><p>verbose::Bool: Print detailed information about truncation</p></li><li><p>explain::Bool: Add explanation about truncation in the response</p></li></ul><p>Returns: Vector{AbstractMessage} with the selected messages, always including:</p><ol><li><p>The system message (if present)</p></li><li><p>First user message</p></li><li><p>Messages up to n, respecting batch_size boundaries</p></li></ol><p>Once you get your full conversation back, you can use <code>append!(mem, conversation)</code> to merge the new messages into the memory.</p><p><strong>Examples:</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Basic usage - get last 3 messages</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mem </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ConversationMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SystemMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You are helpful&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UserMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AIMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hi!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">UserMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;How are you?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AIMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;I&#39;m good!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> get_last</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Using batch_size for caching efficiency</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> get_last</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; batch_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Aligns to 5-message batches for caching</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Add explanation about truncation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> get_last</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; explain</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Adds truncation note to first AI message so the model knows it&#39;s truncated</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Get verbose output about truncation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> get_last</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Prints info about truncation</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/memory.jl#L107-L149" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.get_preferences-Tuple{String}" href="#PromptingTools.get_preferences-Tuple{String}">#</a> <b><u>PromptingTools.get_preferences</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">get_preferences</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Get preferences for PromptingTools. See <code>?PREFERENCES</code> for more information.</p><p>See also: <code>set_preferences!</code></p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PromptingTools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">get_preferences</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MODEL_CHAT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/user_preferences.jl#L132-L143" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.ggi_generate_content" href="#PromptingTools.ggi_generate_content">#</a> <b><u>PromptingTools.ggi_generate_content</u></b> — <i>Function</i>. <p>Stub - to be extended in extension: GoogleGenAIPromptingToolsExt. <code>ggi</code> stands for GoogleGenAI</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_google.jl#L120" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.has_julia_prompt-Tuple{T} where T&lt;:AbstractString" href="#PromptingTools.has_julia_prompt-Tuple{T} where T&lt;:AbstractString">#</a> <b><u>PromptingTools.has_julia_prompt</u></b> — <i>Method</i>. <p>Checks if a given string has a Julia prompt (<code>julia&gt;</code>) at the beginning of a line.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/code_parsing.jl#L94" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.initialize_tracer-Tuple{PromptingTools.AbstractTracerSchema}" href="#PromptingTools.initialize_tracer-Tuple{PromptingTools.AbstractTracerSchema}">#</a> <b><u>PromptingTools.initialize_tracer</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">initialize_tracer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tracer_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractTracerSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, tracer_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ALLOWED_PROMPT_TYPE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Initializes <code>tracer</code>/callback (if necessary). Can provide any keyword arguments in <code>tracer_kwargs</code> (eg, <code>parent_id</code>, <code>thread_id</code>, <code>run_id</code>). Is executed prior to the <code>ai*</code> calls.</p><p>By default it captures:</p><ul><li><p><code>time_sent</code>: the time the request was sent</p></li><li><p><code>model</code>: the model to use</p></li><li><p><code>meta</code>: a dictionary of additional metadata that is not part of the tracer itself</p><ul><li><p><code>template_name</code>: the template to use if any</p></li><li><p><code>template_version</code>: the template version to use if any</p></li><li><p>expanded <code>api_kwargs</code>, ie, the keyword arguments to pass to the API call</p></li></ul></li></ul><p>In the default implementation, we just collect the necessary data to build the tracer object in <code>finalize_tracer</code>.</p><p>See also: <code>meta</code>, <code>unwrap</code>, <code>TracerSchema</code>, <code>SaverSchema</code>, <code>finalize_tracer</code></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_tracer.jl#L33-L52" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.is_concrete_type-Tuple{Type}" href="#PromptingTools.is_concrete_type-Tuple{Type}">#</a> <b><u>PromptingTools.is_concrete_type</u></b> — <i>Method</i>. <p>Check if a type is concrete.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L112" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.isextracted-Tuple{Any}" href="#PromptingTools.isextracted-Tuple{Any}">#</a> <b><u>PromptingTools.isextracted</u></b> — <i>Method</i>. <p>Check if the object is an instance of <code>AbstractExtractedData</code></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L576" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.last_message-Tuple{AbstractVector{&lt;:PromptingTools.AbstractMessage}}" href="#PromptingTools.last_message-Tuple{AbstractVector{&lt;:PromptingTools.AbstractMessage}}">#</a> <b><u>PromptingTools.last_message</u></b> — <i>Method</i>. <p>Helpful accessor for the last message in <code>conversation</code>. Returns the last message in the conversation.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L529" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.last_message-Tuple{ConversationMemory}" href="#PromptingTools.last_message-Tuple{ConversationMemory}">#</a> <b><u>PromptingTools.last_message</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ConversationMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Get the last message in the conversation.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/memory.jl#L83-L87" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.last_output-Tuple{AbstractVector{&lt;:PromptingTools.AbstractMessage}}" href="#PromptingTools.last_output-Tuple{AbstractVector{&lt;:PromptingTools.AbstractMessage}}">#</a> <b><u>PromptingTools.last_output</u></b> — <i>Method</i>. <p>Helpful accessor for the last generated output (<code>msg.content</code>) in <code>conversation</code>. Returns the last output in the conversation (eg, the string/data in the last message).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L534" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.last_output-Tuple{ConversationMemory}" href="#PromptingTools.last_output-Tuple{ConversationMemory}">#</a> <b><u>PromptingTools.last_output</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">last_output</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ConversationMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Get the last AI message in the conversation.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/memory.jl#L92-L96" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.length_longest_common_subsequence-Tuple{AbstractString, AbstractString}" href="#PromptingTools.length_longest_common_subsequence-Tuple{AbstractString, AbstractString}">#</a> <b><u>PromptingTools.length_longest_common_subsequence</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length_longest_common_subsequence</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(itr1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, itr2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Compute the length of the longest common subsequence between two string sequences (ie, the higher the number, the better the match).</p><p>Source: <a href="https://cn.julialang.org/LeetCode.jl/dev/democards/problems/problems/1143.longest-common-subsequence/" target="_blank" rel="noreferrer">https://cn.julialang.org/LeetCode.jl/dev/democards/problems/problems/1143.longest-common-subsequence/</a></p><p><strong>Arguments</strong></p><ul><li><p><code>itr1</code>: The first sequence, eg, a String.</p></li><li><p><code>itr2</code>: The second sequence, eg, a String.</p></li></ul><p><strong>Returns</strong></p><p>The length of the longest common subsequence.</p><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;abc-abc----&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;___ab_c__abc&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">longest_common_subsequence</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text1, text2)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: 6 (-&gt; &quot;abcabc&quot;)</span></span></code></pre></div><p>It can be used to fuzzy match strings and find the similarity between them (Tip: normalize the match)</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">commands </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;product recommendation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;emotions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;specific product advice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;checkout advice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">query </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Which product can you recommend for me?&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> argmax</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length_longest_common_subsequence</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query), commands))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    dist </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> length_longest_common_subsequence</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query, commands[pos])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    norm </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dist </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(commands[pos]))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    @info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;The closest command to the query: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; is: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(commands[pos])</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; (distance: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(dist)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, normalized: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(norm)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><p>But it might be easier to use directly the convenience wrapper <code>distance_longest_common_subsequence</code>!</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>[source](https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/utils.jl#L255-L291)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&lt;/div&gt;</span></span>
<span class="line"><span>&lt;br&gt;</span></span>
<span class="line"><span>&lt;div style=&#39;border-width:1px; border-style:solid; border-color:black; padding: 1em; border-radius: 25px;&#39;&gt;</span></span>
<span class="line"><span>&lt;a id=&#39;PromptingTools.list_aliases-Tuple{}&#39; href=&#39;#PromptingTools.list_aliases-Tuple{}&#39;&gt;#&lt;/a&gt;&amp;nbsp;&lt;b&gt;&lt;u&gt;PromptingTools.list_aliases&lt;/u&gt;&lt;/b&gt; &amp;mdash; &lt;i&gt;Method&lt;/i&gt;.</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>Shows the Dictionary of model aliases in the registry. Add more with `MODEL_ALIASES[alias] = model_name`.</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>[source](https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/user_preferences.jl#L1497)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&lt;/div&gt;</span></span>
<span class="line"><span>&lt;br&gt;</span></span>
<span class="line"><span>&lt;div style=&#39;border-width:1px; border-style:solid; border-color:black; padding: 1em; border-radius: 25px;&#39;&gt;</span></span>
<span class="line"><span>&lt;a id=&#39;PromptingTools.list_registry-Tuple{}&#39; href=&#39;#PromptingTools.list_registry-Tuple{}&#39;&gt;#&lt;/a&gt;&amp;nbsp;&lt;b&gt;&lt;u&gt;PromptingTools.list_registry&lt;/u&gt;&lt;/b&gt; &amp;mdash; &lt;i&gt;Method&lt;/i&gt;.</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>Shows the list of models in the registry. Add more with `register_model!`.</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>[source](https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/user_preferences.jl#L1495)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&lt;/div&gt;</span></span>
<span class="line"><span>&lt;br&gt;</span></span>
<span class="line"><span>&lt;div style=&#39;border-width:1px; border-style:solid; border-color:black; padding: 1em; border-radius: 25px;&#39;&gt;</span></span>
<span class="line"><span>&lt;a id=&#39;PromptingTools.load_api_keys!-Tuple{}&#39; href=&#39;#PromptingTools.load_api_keys!-Tuple{}&#39;&gt;#&lt;/a&gt;&amp;nbsp;&lt;b&gt;&lt;u&gt;PromptingTools.load_api_keys!&lt;/u&gt;&lt;/b&gt; &amp;mdash; &lt;i&gt;Method&lt;/i&gt;.</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>Loads API keys from environment variables and preferences</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>[source](https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/user_preferences.jl#L186)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&lt;/div&gt;</span></span>
<span class="line"><span>&lt;br&gt;</span></span>
<span class="line"><span>&lt;div style=&#39;border-width:1px; border-style:solid; border-color:black; padding: 1em; border-radius: 25px;&#39;&gt;</span></span>
<span class="line"><span>&lt;a id=&#39;PromptingTools.load_conversation-Tuple{Union{AbstractString, IO}}&#39; href=&#39;#PromptingTools.load_conversation-Tuple{Union{AbstractString, IO}}&#39;&gt;#&lt;/a&gt;&amp;nbsp;&lt;b&gt;&lt;u&gt;PromptingTools.load_conversation&lt;/u&gt;&lt;/b&gt; &amp;mdash; &lt;i&gt;Method&lt;/i&gt;.</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>```julia</span></span>
<span class="line"><span>load_conversation(io_or_file::Union{IO, AbstractString})</span></span></code></pre></div><p>Loads a conversation (<code>messages</code>) from <code>io_or_file</code></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/serialization.jl#L55-L59" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.load_template-Tuple{Union{AbstractString, IO}}" href="#PromptingTools.load_template-Tuple{Union{AbstractString, IO}}">#</a> <b><u>PromptingTools.load_template</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">load_template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(io_or_file</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{IO, AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Loads messaging template from <code>io_or_file</code> and returns tuple of template messages and metadata.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/serialization.jl#L25-L29" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.load_templates!" href="#PromptingTools.load_templates!">#</a> <b><u>PromptingTools.load_templates!</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">load_templates!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dir_templates</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{String, Nothing}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    remember_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    remove_templates</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isnothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dir_templates),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dict{Symbol, &lt;:Any}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TEMPLATE_STORE,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    metadata_store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AITemplateMetadata}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TEMPLATE_METADATA)</span></span></code></pre></div><p>Loads templates from folder <code>templates/</code> in the package root and stores them in <code>TEMPLATE_STORE</code> and <code>TEMPLATE_METADATA</code>.</p><p>Note: Automatically removes any existing templates and metadata from <code>TEMPLATE_STORE</code> and <code>TEMPLATE_METADATA</code> if <code>remove_templates=true</code>.</p><p><strong>Arguments</strong></p><ul><li><p><code>dir_templates::Union{String, Nothing}</code>: The directory path to load templates from. If <code>nothing</code>, uses the default list of paths. It usually used only once &quot;to register&quot; a new template storage.</p></li><li><p><code>remember_path::Bool=true</code>: If true, remembers the path for future refresh (in <code>TEMPLATE_PATH</code>).</p></li><li><p><code>remove_templates::Bool=isnothing(dir_templates)</code>: If true, removes any existing templates and metadata from <code>store</code> and <code>metadata_store</code>.</p></li><li><p><code>store::Dict{Symbol, &lt;:Any}=TEMPLATE_STORE</code>: The store to load the templates into.</p></li><li><p><code>metadata_store::Vector{&lt;:AITemplateMetadata}=TEMPLATE_METADATA</code>: The metadata store to load the metadata into.</p></li></ul><p><strong>Example</strong></p><p>Load the default templates:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">load_templates!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># no path needed</span></span></code></pre></div><p>Load templates from a new custom path:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">load_templates!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;path/to/templates&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># we will remember this path for future refresh</span></span></code></pre></div><p>If you want to now refresh the default templates and the new path, just call <code>load_templates!()</code> without any arguments.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/templates.jl#L184-L215" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.meta-Tuple{Union{PromptingTools.AbstractTracer, PromptingTools.AbstractTracerMessage}}" href="#PromptingTools.meta-Tuple{Union{PromptingTools.AbstractTracer, PromptingTools.AbstractTracerMessage}}">#</a> <b><u>PromptingTools.meta</u></b> — <i>Method</i>. <p>Extracts the metadata dictionary from the tracer message or tracer-like object.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L503" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.ollama_api" href="#PromptingTools.ollama_api">#</a> <b><u>PromptingTools.ollama_api</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ollama_api</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(prompt_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{AbstractOllamaManagedSchema, AbstractOllamaSchema}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{AbstractString, Nothing}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    system</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractString}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    endpoint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;generate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;llama2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, http_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NamedTuple</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> NamedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://localhost&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 11434</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Simple wrapper for a call to Ollama API.</p><p><strong>Keyword Arguments</strong></p><ul><li><p><code>prompt_schema</code>: Defines which prompt template should be applied.</p></li><li><p><code>prompt</code>: Can be a string representing the prompt for the AI conversation, a <code>UserMessage</code>, a vector of <code>AbstractMessage</code></p></li><li><p><code>system</code>: An optional string representing the system message for the AI conversation. If not provided, a default message will be used.</p></li><li><p><code>endpoint</code>: The API endpoint to call, only &quot;generate&quot; and &quot;embeddings&quot; are currently supported. Defaults to &quot;generate&quot;.</p></li><li><p><code>model</code>: A string representing the model to use for generating the response. Can be an alias corresponding to a model ID defined in <code>MODEL_ALIASES</code>.</p></li><li><p><code>http_kwargs::NamedTuple</code>: Additional keyword arguments for the HTTP request. Defaults to empty <code>NamedTuple</code>.</p></li><li><p><code>stream</code>: A boolean indicating whether to stream the response. Defaults to <code>false</code>.</p></li><li><p><code>streamcallback::Any</code>: A callback function to handle streaming responses. Can be simply <code>stdout</code> or a <code>StreamCallback</code> object. See <code>?StreamCallback</code> for details.</p></li><li><p><code>url</code>: The URL of the Ollama API. Defaults to &quot;<a href="http://localhost" target="_blank" rel="noreferrer">http://localhost</a>&quot;. If no protocol is specified, &quot;http://&quot; will be automatically added.</p></li><li><p><code>port</code>: The port of the Ollama API. Defaults to 11434.</p></li><li><p><code>kwargs</code>: Prompt variables to be used to fill the prompt/template</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_ollama_managed.jl#L59-L84" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.parse_tool-Tuple{Type, AbstractString}" href="#PromptingTools.parse_tool-Tuple{Type, AbstractString}">#</a> <b><u>PromptingTools.parse_tool</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">parse_tool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(datatype</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, blob</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Parse the JSON blob into the specified datatype in try-catch mode.</p><p>If parsing fails, it tries to return the untyped JSON blob in a dictionary.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L761-L767" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.pprint" href="#PromptingTools.pprint">#</a> <b><u>PromptingTools.pprint</u></b> — <i>Function</i>. <p>Utility for pretty printing PromptingTools types in REPL.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/utils.jl#L626" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.pprint-Tuple{IO, AbstractVector{&lt;:PromptingTools.AbstractMessage}}" href="#PromptingTools.pprint-Tuple{IO, AbstractVector{&lt;:PromptingTools.AbstractMessage}}">#</a> <b><u>PromptingTools.pprint</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pprint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(io</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Pretty print a vector of <code>AbstractMessage</code> to the given IO stream.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L725-L729" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.pprint-Tuple{IO, PromptingTools.AbstractMessage}" href="#PromptingTools.pprint-Tuple{IO, PromptingTools.AbstractMessage}">#</a> <b><u>PromptingTools.pprint</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pprint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(io</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, msg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; text_width</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> displaysize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(io)[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span></code></pre></div><p>Pretty print a single <code>AbstractMessage</code> to the given IO stream.</p><p><code>text_width</code> is the width of the text to be displayed. If not provided, it defaults to the width of the given IO stream and add <code>newline</code> separators as needed.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L664-L670" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.preview" href="#PromptingTools.preview">#</a> <b><u>PromptingTools.preview</u></b> — <i>Function</i>. <p>Utility for rendering the conversation (vector of messages) as markdown. REQUIRES the Markdown package to load the extension! See also <code>pprint</code></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/utils.jl#L623" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.process_google_config-Tuple{Any, Any, Any}" href="#PromptingTools.process_google_config-Tuple{Any, Any, Any}">#</a> <b><u>PromptingTools.process_google_config</u></b> — <i>Method</i>. <p>Process Google API configuration arguments and create config dictionary. Returns a dictionary of config arguments that can be used to create GoogleGenAI.GenerateContentConfig.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_google.jl#L82-L85" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.push_conversation!-Tuple{Vector{&lt;:Vector}, AbstractVector, Union{Nothing, Int64}}" href="#PromptingTools.push_conversation!-Tuple{Vector{&lt;:Vector}, AbstractVector, Union{Nothing, Int64}}">#</a> <b><u>PromptingTools.push_conversation!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">push_conversation!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(conv_history, conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, max_history</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Int, Nothing}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Add a new conversation to the conversation history and resize the history if necessary.</p><p>This function appends a conversation to the <code>conv_history</code>, which is a vector of conversations. Each conversation is represented as a vector of <code>AbstractMessage</code> objects. After adding the new conversation, the history is resized according to the <code>max_history</code> parameter to ensure that the size of the history does not exceed the specified limit.</p><p><strong>Arguments</strong></p><ul><li><p><code>conv_history</code>: A vector that stores the history of conversations. Typically, this is <code>PT.CONV_HISTORY</code>.</p></li><li><p><code>conversation</code>: The new conversation to be added. It should be a vector of <code>AbstractMessage</code> objects.</p></li><li><p><code>max_history</code>: The maximum number of conversations to retain in the history. If <code>Nothing</code>, the history is not resized.</p></li></ul><p><strong>Returns</strong></p><p>The updated conversation history.</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">new_conversation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; return_all </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">push_conversation!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CONV_HISTORY, new_conversation, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>This is done automatically by the ai&quot;&quot; macros.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/utils.jl#L526-L548" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.recursive_splitter-Tuple{AbstractString, Vector{String}}" href="#PromptingTools.recursive_splitter-Tuple{AbstractString, Vector{String}}">#</a> <b><u>PromptingTools.recursive_splitter</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">recursive_splitter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, separators</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{String}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">35000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Vector{String}</span></span></code></pre></div><p>Split a given string <code>text</code> into chunks recursively using a series of separators, with each chunk having a maximum length of <code>max_length</code> (if it&#39;s achievable given the <code>separators</code> provided). This function is useful for splitting large documents or texts into smaller segments that are more manageable for processing, particularly for models or systems with limited context windows.</p><p>It was previously known as <code>split_by_length</code>.</p><p>This is similar to Langchain&#39;s <a href="https://python.langchain.com/docs/modules/data_connection/document_transformers/recursive_text_splitter" target="_blank" rel="noreferrer"><code>RecursiveCharacterTextSplitter</code></a>. To achieve the same behavior, use <code>separators=[&quot;\n\n&quot;, &quot;\n&quot;, &quot; &quot;, &quot;&quot;]</code>.</p><p><strong>Arguments</strong></p><ul><li><p><code>text::AbstractString</code>: The text to be split.</p></li><li><p><code>separators::Vector{String}</code>: An ordered list of separators used to split the text. The function iteratively applies these separators to split the text. Recommend to use <code>[&quot;\n\n&quot;, &quot;. &quot;, &quot;\n&quot;, &quot; &quot;]</code></p></li><li><p><code>max_length::Int</code>: The maximum length of each chunk. Defaults to 35,000 characters. This length is considered after each iteration of splitting, ensuring chunks fit within specified constraints.</p></li></ul><p><strong>Returns</strong></p><p><code>Vector{String}</code>: A vector of strings, where each string is a chunk of the original text that is smaller than or equal to <code>max_length</code>.</p><p><strong>Usage Tips</strong></p><ul><li><p>I tend to prefer splitting on sentences (<code>&quot;. &quot;</code>) before splitting on newline characters (<code>&quot;\n&quot;</code>) to preserve the structure of the text.</p></li><li><p>What&#39;s the difference between <code>separators=[&quot;\n&quot;,&quot; &quot;,&quot;&quot;]</code> and <code>separators=[&quot;\n&quot;,&quot; &quot;]</code>? The former will split down to character level (<code>&quot;&quot;</code>), so it will always achieve the <code>max_length</code> but it will split words (bad for context!) I prefer to instead set slightly smaller <code>max_length</code> but not split words.</p></li></ul><p><strong>How It Works</strong></p><ul><li><p>The function processes the text iteratively with each separator in the provided order. It then measures the length of each chunk and splits it further if it exceeds the <code>max_length</code>. If the chunks is &quot;short enough&quot;, the subsequent separators are not applied to it.</p></li><li><p>Each chunk is as close to <code>max_length</code> as possible (unless we cannot split it any further, eg, if the splitters are &quot;too big&quot; / there are not enough of them)</p></li><li><p>If the <code>text</code> is empty, the function returns an empty array.</p></li><li><p>Separators are re-added to the text chunks after splitting, preserving the original structure of the text as closely as possible. Apply <code>strip</code> if you do not need them.</p></li><li><p>The function provides <code>separators</code> as the second argument to distinguish itself from its single-separator counterpart dispatch.</p></li></ul><p><strong>Examples</strong></p><p>Splitting text using multiple separators:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Paragraph 1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Paragraph 2. Sentence 1. Sentence 2.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Paragraph 3&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">separators </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;. &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># split by paragraphs, sentences, and newlines (not by words)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chunks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> recursive_splitter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text, separators, max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Splitting text using multiple separators - with splitting on words:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Paragraph 1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Paragraph 2. Sentence 1. Sentence 2.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Paragraph 3&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">separators </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;. &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># split by paragraphs, sentences, and newlines, words</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chunks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> recursive_splitter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text, separators, max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Using a single separator:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Hello,World,&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2900</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # length 34900 characters</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chunks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> recursive_splitter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text, [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;,&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>To achieve the same behavior as Langchain&#39;s <code>RecursiveCharacterTextSplitter</code>, use <code>separators=[&quot;\n\n&quot;, &quot;\n&quot;, &quot; &quot;, &quot;&quot;]</code>.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Paragraph 1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Paragraph 2. Sentence 1. Sentence 2.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Paragraph 3&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">separators </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chunks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> recursive_splitter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text, separators, max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/utils.jl#L122-L185" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.recursive_splitter-Tuple{String}" href="#PromptingTools.recursive_splitter-Tuple{String}">#</a> <b><u>PromptingTools.recursive_splitter</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">recursive_splitter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; separator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">35000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Vector{String}</span></span></code></pre></div><p>Split a given string <code>text</code> into chunks of a specified maximum length <code>max_length</code>. This is particularly useful for splitting larger documents or texts into smaller segments, suitable for models or systems with smaller context windows.</p><p>There is a method for dispatching on multiple separators, <code>recursive_splitter(text::String, separators::Vector{String}; max_length::Int=35000) -&gt; Vector{String}</code> that mimics the logic of Langchain&#39;s <code>RecursiveCharacterTextSplitter</code>.</p><p><strong>Arguments</strong></p><ul><li><p><code>text::String</code>: The text to be split.</p></li><li><p><code>separator::String=&quot; &quot;</code>: The separator used to split the text into minichunks. Defaults to a space character.</p></li><li><p><code>max_length::Int=35000</code>: The maximum length of each chunk. Defaults to 35,000 characters, which should fit within 16K context window.</p></li></ul><p><strong>Returns</strong></p><p><code>Vector{String}</code>: A vector of strings, each representing a chunk of the original text that is smaller than or equal to <code>max_length</code>.</p><p><strong>Notes</strong></p><ul><li><p>The function ensures that each chunk is as close to <code>max_length</code> as possible without exceeding it.</p></li><li><p>If the <code>text</code> is empty, the function returns an empty array.</p></li><li><p>The <code>separator</code> is re-added to the text chunks after splitting, preserving the original structure of the text as closely as possible.</p></li></ul><p><strong>Examples</strong></p><p>Splitting text with the default separator (&quot; &quot;):</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Hello world. How are you?&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chunks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> recursive_splitter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text; max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">13</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunks) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: 2</span></span></code></pre></div><p>Using a custom separator and custom <code>max_length</code></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Hello,World,&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2900</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # length 34900 chars</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">recursive_splitter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text; separator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;,&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, max_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># for 4K context window</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(chunks[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: 4</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/utils.jl#L37-L74" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.register_model!" href="#PromptingTools.register_model!">#</a> <b><u>PromptingTools.register_model!</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">register_model!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(registry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MODEL_REGISTRY;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{AbstractPromptSchema, Nothing}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_of_token_prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Float64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cost_of_token_generation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Float64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Register a new AI model with <code>name</code> and its associated <code>schema</code>.</p><p>Registering a model helps with calculating the costs and automatically selecting the right prompt schema.</p><p><strong>Arguments</strong></p><ul><li><p><code>name</code>: The name of the model. This is the name that will be used to refer to the model in the <code>ai*</code> functions.</p></li><li><p><code>schema</code>: The schema of the model. This is the schema that will be used to generate prompts for the model, eg, <code>OpenAISchema()</code>.</p></li><li><p><code>cost_of_token_prompt</code>: The cost of a token in the prompt for this model. This is used to calculate the cost of a prompt. Note: It is often provided online as cost per 1000 tokens, so make sure to convert it correctly!</p></li><li><p><code>cost_of_token_generation</code>: The cost of a token generated by this model. This is used to calculate the cost of a generation. Note: It is often provided online as cost per 1000 tokens, so make sure to convert it correctly!</p></li><li><p><code>description</code>: A description of the model. This is used to provide more information about the model when it is queried.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/user_preferences.jl#L339-L359" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.remove_field!-Tuple{AbstractDict, AbstractString}" href="#PromptingTools.remove_field!-Tuple{AbstractDict, AbstractString}">#</a> <b><u>PromptingTools.remove_field!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">remove_field!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parameters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, field</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Utility to remove a specific top-level field from the parameters (and the <code>required</code> list if present) of the JSON schema.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L434-L438" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.remove_julia_prompt-Tuple{T} where T&lt;:AbstractString" href="#PromptingTools.remove_julia_prompt-Tuple{T} where T&lt;:AbstractString">#</a> <b><u>PromptingTools.remove_julia_prompt</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">remove_julia_prompt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(s</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">T</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {T</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>If it detects a julia prompt, it removes it and all lines that do not have it (except for those that belong to the code block).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/code_parsing.jl#L97-L101" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.remove_templates!-Tuple{}" href="#PromptingTools.remove_templates!-Tuple{}">#</a> <b><u>PromptingTools.remove_templates!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    remove_templates!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><p>Removes all templates from <code>TEMPLATE_STORE</code> and <code>TEMPLATE_METADATA</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/templates.jl#L175-L179" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.remove_unsafe_lines-Tuple{AbstractString}" href="#PromptingTools.remove_unsafe_lines-Tuple{AbstractString}">#</a> <b><u>PromptingTools.remove_unsafe_lines</u></b> — <i>Method</i>. <p>Iterates over the lines of a string and removes those that contain a package operation or a missing import.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/code_parsing.jl#L79" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.render-Tuple{AITemplate}" href="#PromptingTools.render-Tuple{AITemplate}">#</a> <b><u>PromptingTools.render</u></b> — <i>Method</i>. <p>Renders provided messaging template (<code>template</code>) under the default schema (<code>PROMPT_SCHEMA</code>).</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/templates.jl#L111" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.render-Tuple{PromptingTools.AbstractAnthropicSchema, PromptingTools.ToolRef}" href="#PromptingTools.render-Tuple{PromptingTools.AbstractAnthropicSchema, PromptingTools.ToolRef}">#</a> <b><u>PromptingTools.render</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractAnthropicSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ToolRef</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Renders the tool reference into the Anthropic format.</p><p>Available tools:</p><ul><li><p><code>:computer</code>: A tool for using the computer.</p></li><li><p><code>:str_replace_editor</code>: A tool for replacing text in a string (use with Sonnet 3.7 models).</p></li><li><p><code>:str_replace_based_edit_tool</code>: The newer Claude 4 text editor tool.</p></li><li><p><code>:bash</code>: A tool for running bash commands.</p></li><li><p><code>:code_execution</code>: A tool for executing code.</p></li><li><p><code>:web_search</code>: A tool for searching the web.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_anthropic.jl#L150-L164" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.render-Tuple{PromptingTools.AbstractAnthropicSchema, Vector{&lt;:PromptingTools.AbstractMessage}}" href="#PromptingTools.render-Tuple{PromptingTools.AbstractAnthropicSchema, Vector{&lt;:PromptingTools.AbstractMessage}}">#</a> <b><u>PromptingTools.render</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractAnthropicSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    aiprefill</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, AbstractString}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    no_system_message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Symbol}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Builds a history of the conversation to provide the prompt to the API. All unspecified kwargs are passed as replacements such that <code>=&gt;value</code> in the template.</p><p><strong>Keyword Arguments</strong></p><ul><li><p><code>aiprefill</code>: A string to be used as a prefill for the AI response. This steer the AI response in a certain direction (and potentially save output tokens).</p></li><li><p><code>conversation</code>: Past conversation to be included in the beginning of the prompt (for continued conversations).</p></li><li><p><code>no_system_message</code>: If <code>true</code>, do not include the default system message in the conversation history OR convert any provided system message to a user message.</p></li><li><p><code>cache</code>: A symbol representing the caching strategy to be used. Currently only <code>nothing</code> (no caching), <code>:system</code>, <code>:tools</code>,<code>:last</code>, <code>:all_but_last</code>, and <code>:all</code> are supported.</p><ul><li><p><code>:system</code>: Mark only the system message as cacheable. Best default if you have large system message and you will be sending short conversations (no replies / multi-turn conversations).</p></li><li><p><code>:all</code>: Mark SYSTEM, one before last and LAST user message as cacheable. Best for multi-turn conversations (you write cache point as &quot;last&quot; and it will be read in the next turn as &quot;preceding&quot; cache mark).</p></li><li><p><code>:last</code>: Mark only the last message as cacheable. Use ONLY if you want to send the SAME REQUEST multiple times (and want to save upto the last USER message). This will not work for multi-turn conversations, as the &quot;last&quot; message keeps moving.</p></li><li><p><code>:all_but_last</code>: Mark SYSTEM and one before LAST USER message. Use if you have a longer conversation that you want to re-use, but you will NOT CONTINUE it (no subsequent messages/follow-ups).</p></li><li><p>In short, use <code>:all</code> for multi-turn conversations, <code>:system</code> for repeated single-turn conversations with same system message, and <code>:all_but_last</code> for longer conversations that you want to re-use, but not continue.</p></li></ul></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_anthropic.jl#L7-L28" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.render-Tuple{PromptingTools.AbstractAnthropicSchema, Vector{&lt;:PromptingTools.AbstractTool}}" href="#PromptingTools.render-Tuple{PromptingTools.AbstractAnthropicSchema, Vector{&lt;:PromptingTools.AbstractTool}}">#</a> <b><u>PromptingTools.render</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractAnthropicSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractTool}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Renders the tool signatures into the Anthropic format.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_anthropic.jl#L128-L134" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.render-Tuple{PromptingTools.AbstractGoogleSchema, Vector{&lt;:PromptingTools.AbstractMessage}}" href="#PromptingTools.render-Tuple{PromptingTools.AbstractGoogleSchema, Vector{&lt;:PromptingTools.AbstractMessage}}">#</a> <b><u>PromptingTools.render</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractGoogleSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    no_system_message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Builds a history of the conversation to provide the prompt to the API. All unspecified kwargs are passed as replacements such that <code>=&gt;value</code> in the template.</p><p><strong>Keyword Arguments</strong></p><ul><li><p><code>conversation</code>: An optional vector of <code>AbstractMessage</code> objects representing the conversation history. If not provided, it is initialized as an empty vector.</p></li><li><p><code>no_system_message::Bool=false</code>: If <code>true</code>, do not include the default system message in the conversation history OR convert any provided system message to a user message.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_google.jl#L9-L21" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.render-Tuple{PromptingTools.AbstractOllamaManagedSchema, Vector{&lt;:PromptingTools.AbstractMessage}}" href="#PromptingTools.render-Tuple{PromptingTools.AbstractOllamaManagedSchema, Vector{&lt;:PromptingTools.AbstractMessage}}">#</a> <b><u>PromptingTools.render</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractOllamaManagedSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Builds a history of the conversation to provide the prompt to the API. All unspecified kwargs are passed as replacements such that <code>=&gt;value</code> in the template.</p><p>Note: Due to its &quot;managed&quot; nature, at most 2 messages can be provided (<code>system</code> and <code>prompt</code> inputs in the API).</p><p><strong>Keyword Arguments</strong></p><ul><li><code>conversation</code>: Not allowed for this schema. Provided only for compatibility.</li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_ollama_managed.jl#L9-L21" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.render-Tuple{PromptingTools.AbstractOllamaSchema, Vector{&lt;:PromptingTools.AbstractMessage}}" href="#PromptingTools.render-Tuple{PromptingTools.AbstractOllamaSchema, Vector{&lt;:PromptingTools.AbstractMessage}}">#</a> <b><u>PromptingTools.render</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractOllamaSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    no_system_message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Builds a history of the conversation to provide the prompt to the API. All unspecified kwargs are passed as replacements such that <code>=&gt;value</code> in the template.</p><p><strong>Keyword Arguments</strong></p><ul><li><p><code>conversation</code>: An optional vector of <code>AbstractMessage</code> objects representing the conversation history. If not provided, it is initialized as an empty vector.</p></li><li><p><code>no_system_message</code>: If <code>true</code>, do not include the default system message in the conversation history OR convert any provided system message to a user message.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_ollama.jl#L11-L23" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.render-Tuple{PromptingTools.AbstractOpenAISchema, Vector{&lt;:PromptingTools.AbstractMessage}}" href="#PromptingTools.render-Tuple{PromptingTools.AbstractOpenAISchema, Vector{&lt;:PromptingTools.AbstractMessage}}">#</a> <b><u>PromptingTools.render</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractOpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    image_detail</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;auto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    no_system_message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name_user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, String}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Builds a history of the conversation to provide the prompt to the API. All unspecified kwargs are passed as replacements such that <code>=&gt;value</code> in the template.</p><p><strong>Keyword Arguments</strong></p><ul><li><p><code>image_detail</code>: Only for <code>UserMessageWithImages</code>. It represents the level of detail to include for images. Can be <code>&quot;auto&quot;</code>, <code>&quot;high&quot;</code>, or <code>&quot;low&quot;</code>.</p></li><li><p><code>conversation</code>: An optional vector of <code>AbstractMessage</code> objects representing the conversation history. If not provided, it is initialized as an empty vector.</p></li><li><p><code>no_system_message</code>: If <code>true</code>, do not include the default system message in the conversation history OR convert any provided system message to a user message.</p></li><li><p><code>name_user</code>: No-op for consistency.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_openai.jl#L10-L26" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.render-Tuple{PromptingTools.AbstractOpenAISchema, Vector{&lt;:PromptingTools.AbstractTool}}" href="#PromptingTools.render-Tuple{PromptingTools.AbstractOpenAISchema, Vector{&lt;:PromptingTools.AbstractTool}}">#</a> <b><u>PromptingTools.render</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractOpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractTool}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    json_mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Bool}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Renders the tool signatures into the OpenAI format.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_openai.jl#L95-L102" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.render-Tuple{PromptingTools.AbstractTracerSchema, AbstractVector{&lt;:PromptingTools.AbstractMessage}}" href="#PromptingTools.render-Tuple{PromptingTools.AbstractTracerSchema, AbstractVector{&lt;:PromptingTools.AbstractMessage}}">#</a> <b><u>PromptingTools.render</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tracer_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractTracerSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conv</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Passthrough. No changes.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_tracer.jl#L22-L27" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.render-Tuple{PromptingTools.NoSchema, Vector{&lt;:PromptingTools.AbstractMessage}}" href="#PromptingTools.render-Tuple{PromptingTools.NoSchema, Vector{&lt;:PromptingTools.AbstractMessage}}">#</a> <b><u>PromptingTools.render</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">render</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NoSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    no_system_message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    replacement_kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Renders a conversation history from a vector of messages with all replacement variables specified in <code>replacement_kwargs</code>.</p><p>It is the first pass of the prompt rendering system, and is used by all other schemas.</p><p><strong>Keyword Arguments</strong></p><ul><li><p><code>image_detail</code>: Only for <code>UserMessageWithImages</code>. It represents the level of detail to include for images. Can be <code>&quot;auto&quot;</code>, <code>&quot;high&quot;</code>, or <code>&quot;low&quot;</code>.</p></li><li><p><code>conversation</code>: An optional vector of <code>AbstractMessage</code> objects representing the conversation history. If not provided, it is initialized as an empty vector.</p></li><li><p><code>no_system_message</code>: If <code>true</code>, do not include the default system message in the conversation history OR convert any provided system message to a user message.</p></li></ul><p><strong>Notes</strong></p><ul><li><p>All unspecified kwargs are passed as replacements such that <code>=&gt;value</code> in the template.</p></li><li><p>If a SystemMessage is missing, we inject a default one at the beginning of the conversation.</p></li><li><p>Only one SystemMessage is allowed (ie, cannot mix two conversations different system prompts).</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_shared.jl#L12-L32" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.replace_words-Tuple{AbstractString, Vector{&lt;:AbstractString}}" href="#PromptingTools.replace_words-Tuple{AbstractString, Vector{&lt;:AbstractString}}">#</a> <b><u>PromptingTools.replace_words</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">replace_words</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, words</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; replacement</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ABC&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Replace all occurrences of words in <code>words</code> with <code>replacement</code> in <code>text</code>. Useful to quickly remove specific names or entities from a text.</p><p><strong>Arguments</strong></p><ul><li><p><code>text::AbstractString</code>: The text to be processed.</p></li><li><p><code>words::Vector{&lt;:AbstractString}</code>: A vector of words to be replaced.</p></li><li><p><code>replacement::AbstractString=&quot;ABC&quot;</code>: The replacement string to be used. Defaults to &quot;ABC&quot;.</p></li></ul><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Disney is a great company&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">replace_words</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text, [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Disney&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Snow White&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Mickey Mouse&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output: &quot;ABC is a great company&quot;</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/utils.jl#L3-L19" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.resize_conversation!-Tuple{Any, Union{Nothing, Int64}}" href="#PromptingTools.resize_conversation!-Tuple{Any, Union{Nothing, Int64}}">#</a> <b><u>PromptingTools.resize_conversation!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">resize_conversation!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(conv_history, max_history</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Int, Nothing}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Resize the conversation history to a specified maximum length.</p><p>This function trims the <code>conv_history</code> to ensure that its size does not exceed <code>max_history</code>. It removes the oldest conversations first if the length of <code>conv_history</code> is greater than <code>max_history</code>.</p><p><strong>Arguments</strong></p><ul><li><p><code>conv_history</code>: A vector that stores the history of conversations. Typically, this is <code>PT.CONV_HISTORY</code>.</p></li><li><p><code>max_history</code>: The maximum number of conversations to retain in the history. If <code>Nothing</code>, the history is not resized.</p></li></ul><p><strong>Returns</strong></p><p>The resized conversation history.</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">resize_conversation!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CONV_HISTORY, PT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MAX_HISTORY_LENGTH)</span></span></code></pre></div><p>After the function call, <code>conv_history</code> will contain only the 10 most recent conversations.</p><p>This is done automatically by the ai&quot;&quot; macros.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/utils.jl#L557-L580" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.response_to_message-Tuple{PromptingTools.AbstractOpenAISchema, Type{AIMessage}, Any, Any}" href="#PromptingTools.response_to_message-Tuple{PromptingTools.AbstractOpenAISchema, Type{AIMessage}, Any, Any}">#</a> <b><u>PromptingTools.response_to_message</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">response_to_message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractOpenAISchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    MSG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Type{AIMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    choice,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    resp;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    time</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Float64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    run_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rand</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Int32)),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sample_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Integer}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    name_assistant</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, String}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Utility to facilitate unwrapping of HTTP response to a message type <code>MSG</code> provided for OpenAI-like responses</p><p>Note: Extracts <code>finish_reason</code> and <code>log_prob</code> if available in the response.</p><p><strong>Arguments</strong></p><ul><li><p><code>schema::AbstractOpenAISchema</code>: The schema for the prompt.</p></li><li><p><code>MSG::Type{AIMessage}</code>: The message type to be returned.</p></li><li><p><code>choice</code>: The choice from the response (eg, one of the completions).</p></li><li><p><code>resp</code>: The response from the OpenAI API.</p></li><li><p><code>model_id::AbstractString</code>: The model ID to use for generating the response. Defaults to an empty string.</p></li><li><p><code>time::Float64</code>: The elapsed time for the response. Defaults to <code>0.0</code>.</p></li><li><p><code>run_id::Integer</code>: The run ID for the response. Defaults to a random integer.</p></li><li><p><code>sample_id::Union{Nothing, Integer}</code>: The sample ID for the response (if there are multiple completions). Defaults to <code>nothing</code>.</p></li><li><p><code>name_assistant::Union{Nothing, String}</code>: The name to use for the assistant in the conversation history. Defaults to <code>nothing</code>.</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_openai.jl#L134-L159" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.response_to_message-Union{Tuple{T}, Tuple{PromptingTools.AbstractPromptSchema, Type{T}, Any, Any}} where T" href="#PromptingTools.response_to_message-Union{Tuple{T}, Tuple{PromptingTools.AbstractPromptSchema, Type{T}, Any, Any}} where T">#</a> <b><u>PromptingTools.response_to_message</u></b> — <i>Method</i>. <p>Utility to facilitate unwrapping of HTTP response to a message type <code>MSG</code> provided. Designed to handle multi-sample completions.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/llm_interface.jl#L559" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.save_conversation-Tuple{Union{AbstractString, IO}, AbstractVector{&lt;:PromptingTools.AbstractMessage}}" href="#PromptingTools.save_conversation-Tuple{Union{AbstractString, IO}, AbstractVector{&lt;:PromptingTools.AbstractMessage}}">#</a> <b><u>PromptingTools.save_conversation</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">save_conversation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(io_or_file</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{IO, AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Saves provided conversation (<code>messages</code>) to <code>io_or_file</code>. If you need to add some metadata, see <code>save_template</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/serialization.jl#L45-L50" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.save_conversations-Tuple{PromptingTools.AbstractPromptSchema, AbstractString, Vector{&lt;:AbstractVector{&lt;:PromptingTools.AbstractMessage}}}" href="#PromptingTools.save_conversations-Tuple{PromptingTools.AbstractPromptSchema, AbstractString, Vector{&lt;:AbstractVector{&lt;:PromptingTools.AbstractMessage}}}">#</a> <b><u>PromptingTools.save_conversations</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">save_conversations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractPromptSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, filename</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conversations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector{&lt;:AbstractVector{&lt;:PT.AbstractMessage}}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Saves provided conversations (vector of vectors of <code>messages</code>) to <code>filename</code> rendered in the particular <code>schema</code>.</p><p>Commonly used for finetuning models with <code>schema = ShareGPTSchema()</code></p><p>The format is JSON Lines, where each line is a JSON object representing one provided conversation.</p><p>See also: <code>save_conversation</code></p><p><strong>Examples</strong></p><p>You must always provide a VECTOR of conversations</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractMessage[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SystemMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;System message 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    UserMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;User message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    AIMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;AI message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conversation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [messages] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># vector of vectors</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tempdir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> joinpath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dir, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;conversations.jsonl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">save_conversations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fn, conversation)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Content of the file (one line for each conversation)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># {&quot;conversations&quot;:[{&quot;value&quot;:&quot;System message 1&quot;,&quot;from&quot;:&quot;system&quot;},{&quot;value&quot;:&quot;User message&quot;,&quot;from&quot;:&quot;human&quot;},{&quot;value&quot;:&quot;AI message&quot;,&quot;from&quot;:&quot;gpt&quot;}]}</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/serialization.jl#L64-L92" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.save_template-Tuple{Union{AbstractString, IO}, AbstractVector{&lt;:PromptingTools.AbstractChatMessage}}" href="#PromptingTools.save_template-Tuple{Union{AbstractString, IO}, AbstractVector{&lt;:PromptingTools.AbstractChatMessage}}">#</a> <b><u>PromptingTools.save_template</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">save_template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(io_or_file</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{IO, AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector{&lt;:AbstractChatMessage}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Template Metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Saves provided messaging template (<code>messages</code>) to <code>io_or_file</code>. Automatically adds metadata based on provided keyword arguments.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/serialization.jl#L2-L11" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.set_preferences!-Tuple{Vararg{Pair{String}}}" href="#PromptingTools.set_preferences!-Tuple{Vararg{Pair{String}}}">#</a> <b><u>PromptingTools.set_preferences!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set_preferences!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pairs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Pair{String, &lt;:Any}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">...)</span></span></code></pre></div><p>Set preferences for PromptingTools. See <code>?PREFERENCES</code> for more information.</p><p>See also: <code>get_preferences</code></p><p><strong>Example</strong></p><p>Change your API key and default model:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PromptingTools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set_preferences!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;OPENAI_API_KEY&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;key1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MODEL_CHAT&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;chat1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/user_preferences.jl#L104-L117" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.set_properties_strict!-Tuple{AbstractDict}" href="#PromptingTools.set_properties_strict!-Tuple{AbstractDict}">#</a> <b><u>PromptingTools.set_properties_strict!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set_properties_strict!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(properties</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractDict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Sets strict mode for the properties of a JSON schema.</p><p>Changes:</p><ul><li><p>Sets <code>additionalProperties</code> to <code>false</code>.</p></li><li><p>All keys must be included in <code>required</code>.</p></li><li><p>All optional keys will have <code>null</code> added to their type.</p></li></ul><p>Reference: <a href="https://platform.openai.com/docs/guides/structured-outputs/supported-schemas" target="_blank" rel="noreferrer">https://platform.openai.com/docs/guides/structured-outputs/supported-schemas</a></p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L396-L407" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.tool_call_signature-Tuple{Union{Method, Type}}" href="#PromptingTools.tool_call_signature-Tuple{Union{Method, Type}}">#</a> <b><u>PromptingTools.tool_call_signature</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tool_call_signature</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    type_or_method</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Type, Method}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; strict</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Bool}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    max_description_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, String}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    docs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, String}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, hidden_fields</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        AbstractString, Regex}} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String[])</span></span></code></pre></div><p>Extract the argument names, types and docstrings from a struct to create the function call signature in JSON schema.</p><p>You must provide a Struct type (not an instance of it) with some fields. The types must be CONCRETE, it helps with correct conversion to JSON schema and then conversion back to the struct.</p><p>Note: Fairly experimental, but works for combination of structs, arrays, strings and singletons.</p><p><strong>Arguments</strong></p><ul><li><p><code>type_or_method::Union{Type, Method}</code>: The struct type or method to extract the signature from.</p></li><li><p><code>strict::Union{Nothing, Bool}</code>: Whether to enforce strict mode for the schema. Defaults to <code>nothing</code>.</p></li><li><p><code>max_description_length::Int</code>: Maximum length for descriptions. Defaults to 200.</p></li><li><p><code>name::Union{Nothing, String}</code>: The name of the tool. Defaults to the name of the struct.</p></li><li><p><code>docs::Union{Nothing, String}</code>: The description of the tool. Defaults to the docstring of the struct/overall function.</p></li><li><p><code>hidden_fields::AbstractVector{&lt;:Union{AbstractString, Regex}}</code>: A list of fields to hide from the LLM (eg, <code>[&quot;ctx_user_id&quot;]</code> or <code>r&quot;ctx&quot;</code>).</p></li></ul><p><strong>Returns</strong></p><ul><li><code>Dict{String, AbstractTool}</code>: A dictionary representing the function call signature schema.</li></ul><p><strong>Tips</strong></p><ul><li>You can improve the quality of the extraction by writing a helpful docstring for your struct (or any nested struct). It will be provided as a description.</li></ul><p>You can even include comments/descriptions about the individual fields.</p><ul><li><p>All fields are assumed to be required, unless you allow null values (eg, <code>::Union{Nothing, Int}</code>). Fields with <code>Nothing</code> will be treated as optional.</p></li><li><p>Missing values are ignored (eg, <code>::Union{Missing, Int}</code> will be treated as Int). It&#39;s for broader compatibility and we cannot deserialize it as easily as <code>Nothing</code>.</p></li></ul><p><strong>Example</strong></p><p>Do you want to extract some specific measurements from a text like age, weight and height? You need to define the information you need as a struct (<code>return_type</code>):</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>struct MyMeasurement</span></span>
<span class="line"><span>    age::Int</span></span>
<span class="line"><span>    height::Union{Int,Nothing}</span></span>
<span class="line"><span>    weight::Union{Nothing,Float64}</span></span>
<span class="line"><span>end</span></span>
<span class="line"><span>tool_map = tool_call_signature(MyMeasurement)</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span># Dict{String, PromptingTools.AbstractTool}(&quot;MyMeasurement&quot; =&gt; PromptingTools.Tool</span></span>
<span class="line"><span>#   name: String &quot;MyMeasurement&quot;</span></span>
<span class="line"><span>#   parameters: Dict{String, Any}</span></span>
<span class="line"><span>#   description: Nothing nothing</span></span>
<span class="line"><span>#   strict: Nothing nothing</span></span>
<span class="line"><span>#   callable: MyMeasurement &lt;: Any</span></span>
<span class="line"><span>&quot;</span></span></code></pre></div><p>You can see that only the field <code>age</code> does not allow null values, hence, it&#39;s &quot;required&quot;. While <code>height</code> and <code>weight</code> are optional.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>tool_map[&quot;MyMeasurement&quot;].parameters[&quot;required&quot;]</span></span>
<span class="line"><span># [&quot;age&quot;]</span></span></code></pre></div><p>If there are multiple items you want to extract, define a wrapper struct to get a Vector of <code>MyMeasurement</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>struct MyMeasurementWrapper</span></span>
<span class="line"><span>    measurements::Vector{MyMeasurement}</span></span>
<span class="line"><span>end</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Or if you want your extraction to fail gracefully when data isn&#39;t found, use `MaybeExtract{T}` wrapper (inspired by Instructor package!):</span></span></code></pre></div><p>using PromptingTools: MaybeExtract</p><p MyMeasurement="">type = MaybeExtract</p><p><strong>Effectively the same as:</strong></p><p><strong>struct MaybeExtract{T}</strong></p><p><strong>result::Union{T, Nothing}</strong></p><p><strong>error::Bool // true if a result is found, false otherwise</strong></p><p><strong>message::Union{Nothing, String} // Only present if no result is found, should be short and concise</strong></p><p><strong>end</strong></p><p><strong>If LLM extraction fails, it will return a Dict with <code>error</code> and <code>message</code> fields instead of the result!</strong></p><p>msg = aiextract(&quot;Extract measurements from the text: I am giraffe&quot;, type)</p><hr><p><strong>Dict{Symbol, Any} with 2 entries:</strong></p><p><strong>:message =&gt; &quot;Sorry, this feature is only available for humans.&quot;</strong></p><p><strong>:error =&gt; true</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>That way, you can handle the error gracefully and get a reason why extraction failed.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>You can also hide certain fields in your function call signature with Strings or Regex patterns (eg, `r&quot;ctx&quot;`).</span></span></code></pre></div><p>tool_map = tool_call_signature(MyMeasurement; hidden_fields = [&quot;ctx_user_id&quot;]) ```</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L463-L555" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.tool_call_signature-Tuple{Vector}" href="#PromptingTools.tool_call_signature-Tuple{Vector}">#</a> <b><u>PromptingTools.tool_call_signature</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tool_call_signature</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fields</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Vector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    strict</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, Bool}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, max_description_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Nothing, String} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    docs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{Nothing, String}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Generate a function call signature schema for a dynamically generated struct based on the provided fields.</p><p><strong>Arguments</strong></p><ul><li><p><code>fields::Vector{Union{Symbol, Pair{Symbol, Type}, Pair{Symbol, String}}}</code>: A vector of field names or pairs of field name and type or string description, eg, <code>[:field1, :field2, :field3]</code> or <code>[:field1 =&gt; String, :field2 =&gt; Int, :field3 =&gt; Float64]</code> or <code>[:field1 =&gt; String, :field1__description =&gt; &quot;Field 1 has the name&quot;]</code>.</p></li><li><p><code>strict::Union{Nothing, Bool}</code>: Whether to enforce strict mode for the schema. Defaults to <code>nothing</code>.</p></li><li><p><code>max_description_length::Int</code>: Maximum length for descriptions. Defaults to 200.</p></li><li><p><code>name::Union{Nothing, String}</code>: The name of the tool. Defaults to the name of the struct.</p></li><li><p><code>docs::Union{Nothing, String}</code>: The description of the tool. Defaults to the docstring of the struct/overall function.</p></li></ul><p><strong>Returns a <code>tool_map</code> with the tool name as the key and the tool object as the value.</strong></p><p>See also <code>generate_struct</code>, <code>aiextract</code>, <code>update_field_descriptions!</code>.</p><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_map </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tool_call_signature</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:field1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:field2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:field3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span></code></pre></div><p>With the field types:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_map </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tool_call_signature</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:field1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:field2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Int, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:field3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Float64])</span></span></code></pre></div><p>And with the field descriptions:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tool_map </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tool_call_signature</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:field1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:field1__description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Field 1 has the name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L648-L681" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.tool_calls-Tuple{PromptingTools.AIToolRequest}" href="#PromptingTools.tool_calls-Tuple{PromptingTools.AIToolRequest}">#</a> <b><u>PromptingTools.tool_calls</u></b> — <i>Method</i>. <p>Get the vector of tool call requests from an AIToolRequest/message.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L239" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.unique_permutation-Tuple{AbstractVector}" href="#PromptingTools.unique_permutation-Tuple{AbstractVector}">#</a> <b><u>PromptingTools.unique_permutation</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">unique_permutation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(inputs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractVector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Returns indices of unique items in a vector <code>inputs</code>. Access the unique values as <code>inputs[unique_permutation(inputs)]</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/utils.jl#L678-L682" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.unwrap-Tuple{Union{PromptingTools.AbstractTracer, PromptingTools.AbstractTracerMessage}}" href="#PromptingTools.unwrap-Tuple{Union{PromptingTools.AbstractTracer, PromptingTools.AbstractTracerMessage}}">#</a> <b><u>PromptingTools.unwrap</u></b> — <i>Method</i>. <p>Unwraps the tracer message or tracer-like object, returning the original <code>object</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/messages.jl#L498" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.update_field_descriptions!-Tuple{Dict{String}, Dict{Symbol, &lt;:AbstractString}}" href="#PromptingTools.update_field_descriptions!-Tuple{Dict{String}, Dict{Symbol, &lt;:AbstractString}}">#</a> <b><u>PromptingTools.update_field_descriptions!</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">update_field_descriptions!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    parameters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dict{String, &lt;:Any}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, descriptions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dict{Symbol, &lt;:AbstractString}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    max_description_length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Update the given JSON schema with descriptions from the <code>descriptions</code> dictionary. This function modifies the schema in-place, adding a &quot;description&quot; field to each property that has a corresponding entry in the <code>descriptions</code> dictionary.</p><p>Note: It modifies the schema in place. Only the top-level &quot;properties&quot; are updated!</p><p>Returns: The modified schema dictionary.</p><p><strong>Arguments</strong></p><ul><li><p><code>parameters</code>: A dictionary representing the JSON schema to be updated.</p></li><li><p><code>descriptions</code>: A dictionary mapping field names (as symbols) to their descriptions.</p></li><li><p><code>max_description_length::Int</code>: Maximum length for descriptions. Defaults to 200.</p></li></ul><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    parameters </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Dict{String, Any}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;properties&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Dict{String, Any}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;location&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Dict{String, Any}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;condition&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Dict{String, Any}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;temperature&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Dict{String, Any}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;number&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;required&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;location&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;temperature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;condition&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;type&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;object&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    descriptions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Dict{Symbol, String}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        :temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Temperature in degrees Fahrenheit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        :condition</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Current weather condition (e.g., sunny, rainy, cloudy)&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    update_field_descriptions!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parameters, descriptions)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/extraction.jl#L344-L379" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.wrap_string" href="#PromptingTools.wrap_string">#</a> <b><u>PromptingTools.wrap_string</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">wrap_string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(str</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    text_width</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    newline</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Union{AbstractString, AbstractChar}</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;</span></span></code></pre></div><p>&#39;)</p><p>Breaks a string into lines of a given <code>text_width</code>. Optionally, you can specify the <code>newline</code> character or string to use.</p><p><strong>Example:</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">wrap_string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Certainly, here&#39;s a function in Julia that will wrap a string according to the specifications:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> print</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/utils.jl#L207-L221" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.@aai_str-Tuple{Any, Vararg{Any}}" href="#PromptingTools.@aai_str-Tuple{Any, Vararg{Any}}">#</a> <b><u>PromptingTools.@aai_str</u></b> — <i>Macro</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">aai</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user_prompt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[model_alias] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AIMessage</span></span></code></pre></div><p>Asynchronous version of <code>@ai_str</code> macro, which will log the result once it&#39;s ready.</p><p>See also <code>aai!&quot;&quot;</code> if you want an asynchronous reply to the provided message / continue the conversation.</p><p><strong>Example</strong></p><p>Send asynchronous request to GPT-4, so we don&#39;t have to wait for the response: Very practical with slow models, so you can keep working in the meantime.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">with some delay</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...**</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ Info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 29</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @ Cost</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0011</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2.7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> seconds</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ Info</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AIMessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Hello! How can I assist you today?</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[source](https</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">://</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">github</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">com</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">svilupp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PromptingTools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">jl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">blob</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">27f79</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ce69a4297a967bc8d611d0eb35c932b360c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">src</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">macros</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">jl</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#L99-L116)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">br</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">div style</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;border-width:1px; border-style:solid; border-color:black; padding: 1em; border-radius: 25px;&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;PromptingTools.@ai!_str-Tuple{Any, Vararg{Any}}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> href</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;#PromptingTools.@ai!_str-Tuple{Any, Vararg{Any}}&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#&lt;/a&gt;&amp;nbsp;&lt;b&gt;&lt;u&gt;PromptingTools.@ai!_str&lt;/u&gt;&lt;/b&gt; &amp;mdash; &lt;i&gt;Macro&lt;/i&gt;.</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">```julia</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ai!&quot;user_prompt&quot;[model_alias] -&gt; AIMessage</span></span></code></pre></div><p>The <code>ai!&quot;&quot;</code> string macro is used to continue a previous conversation with the AI model.</p><p>It appends the new user prompt to the last conversation in the tracked history (in <code>PromptingTools.CONV_HISTORY</code>) and generates a response based on the entire conversation context. If you want to see the previous conversation, you can access it via <code>PromptingTools.CONV_HISTORY</code>, which keeps at most last <code>PromptingTools.MAX_HISTORY_LENGTH</code> conversations.</p><p><strong>Arguments</strong></p><ul><li><p><code>user_prompt</code> (String): The new input prompt to be added to the existing conversation.</p></li><li><p><code>model_alias</code> (optional, any): Specify the model alias of the AI model to be used (see <code>MODEL_ALIASES</code>). If not provided, the default model is used.</p></li></ul><p><strong>Returns</strong></p><p><code>AIMessage</code> corresponding to the new user prompt, considering the entire conversation history.</p><p><strong>Example</strong></p><p>To continue a conversation:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># start conversation as normal</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ai</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Say hi.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ... wait for reply and then react to it:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># continue the conversation (notice that you can change the model, eg, to more powerful one for better answer)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ai!</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What do you think about that?&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">gpt4t</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage(&quot;Considering our previous discussion, I think that...&quot;)</span></span></code></pre></div><p><strong>Usage Notes</strong></p><ul><li><p>This macro should be used when you want to maintain the context of an ongoing conversation (ie, the last <code>ai&quot;&quot;</code> message).</p></li><li><p>It automatically accesses and updates the global conversation history.</p></li><li><p>If no conversation history is found, it raises an assertion error, suggesting to initiate a new conversation using <code>ai&quot;&quot;</code> instead.</p></li></ul><p><strong>Important</strong></p><p>Ensure that the conversation history is not too long to maintain relevancy and coherence in the AI&#39;s responses. The history length is managed by <code>MAX_HISTORY_LENGTH</code>.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/macros.jl#L45-L80" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.@ai_str-Tuple{Any, Vararg{Any}}" href="#PromptingTools.@ai_str-Tuple{Any, Vararg{Any}}">#</a> <b><u>PromptingTools.@ai_str</u></b> — <i>Macro</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ai</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user_prompt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[model_alias] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AIMessage</span></span></code></pre></div><p>The <code>ai&quot;&quot;</code> string macro generates an AI response to a given prompt by using <code>aigenerate</code> under the hood.</p><p>See also <code>ai!&quot;&quot;</code> if you want to reply to the provided message / continue the conversation.</p><p><strong>Arguments</strong></p><ul><li><p><code>user_prompt</code> (String): The input prompt for the AI model.</p></li><li><p><code>model_alias</code> (optional, any): Provide model alias of the AI model (see <code>MODEL_ALIASES</code>).</p></li></ul><p><strong>Returns</strong></p><p><code>AIMessage</code> corresponding to the input prompt.</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ai</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello, how are you?&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage(&quot;Hello! I&#39;m an AI assistant, so I don&#39;t have feelings, but I&#39;m here to help you. How can I assist you today?&quot;)</span></span></code></pre></div><p>If you want to interpolate some variables or additional context, simply use string interpolation:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ai</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is `$a+$a`?&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage(&quot;The sum of `1+1` is `2`.&quot;)</span></span></code></pre></div><p>If you want to use a different model, eg, GPT-4, you can provide its alias as a flag:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ai</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is `1.23 * 100 + 1`?&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">gpt4t</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AIMessage(&quot;The answer is 124.&quot;)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/macros.jl#L1-L33" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.@timeout-Tuple{Any, Any, Any}" href="#PromptingTools.@timeout-Tuple{Any, Any, Any}">#</a> <b><u>PromptingTools.@timeout</u></b> — <i>Macro</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">@timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(seconds, expr_to_run, expr_when_fails)</span></span></code></pre></div><p>Simple macro to run an expression with a timeout of <code>seconds</code>. If the <code>expr_to_run</code> fails to finish in <code>seconds</code> seconds, <code>expr_when_fails</code> is returned.</p><p><strong>Example</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> @timeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> begin</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;done&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;failed&quot;</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/utils.jl#L593-L607" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.CustomRetryLayer" href="#PromptingTools.CustomRetryLayer">#</a> <b><u>PromptingTools.CustomRetryLayer</u></b> — <i>Module</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CustomRetryLayer</span></span></code></pre></div><p>Custom retry layer for HTTP.jl. Once installed, it will catch all errors with status codes 429, 404, 503 and retry with exponential backoff (can be customized).</p><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HTTP</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Enable the retry layer</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">enable_retry!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># all subsequent requests will retry on 429 errors (rate-limiting)... There are many more options to customize.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Let&#39;s call the API - it fails with 404 Not Found (bad model name)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is the meaning of life?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;bad-name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Let&#39;s catch the 404 error in retry loop to demonstrate the retry logic -- watch for custom_retry_* kwargs!</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is the meaning of life?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;bad-name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, http_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; custom_retry_status_codes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># We can temporarily disable the custom retry logic by setting custom_retry_enabled = false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is the meaning of life?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;bad-name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, http_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; custom_retry_enabled </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Remove the retry layer completely</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">enable_retry!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># notice the `false` first arg!</span></span></code></pre></div><p>Low-level enable/disable usage:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Let&#39;s push the layer globally in all HTTP.jl requests</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HTTP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pushlayer!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PromptingTools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CustomRetryLayer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">custom_retry_layer, request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># for stream handling, we would set request=false</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># We can also remove the layer completely</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HTTP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">poplayer!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># you should see it pop off the stack</span></span></code></pre></div><p>The layer is generally in either <code>HTTP.REQUEST_LAYERS</code> or <code>HTTP.STREAM_LAYERS</code>, depending on whether you set <code>request=true</code> or <code>request=false</code> in the <code>pushlayer!</code> call. There is much more to customize, eg, <code>custom_retry_max_retries</code>, <code>custom_retry_base_delay</code>, <code>custom_retry_status_codes</code>).</p><p>You can also configure the default behavior of the layer with <code>enable_retry!</code> function - you must set it before the first call to <code>custom_retry_layer</code>! See the docs for <code>enable_retry!</code> for more details.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/retry_layer.jl#L4-L45" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.CustomRetryLayer.CustomRetryConfig" href="#PromptingTools.CustomRetryLayer.CustomRetryConfig">#</a> <b><u>PromptingTools.CustomRetryLayer.CustomRetryConfig</u></b> — <i>Type</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CustomRetryConfig</span></span></code></pre></div><p>Configuration settings for the HTTP retry layer.</p><p>Fields:</p><ul><li><p><code>max_retries::Int</code>: Maximum number of retries before failing</p></li><li><p><code>base_delay::Float64</code>: Base delay in seconds for exponential backoff</p></li><li><p><code>status_codes::Vector{Int}</code>: HTTP status codes that trigger a retry</p></li><li><p><code>show_headers::Bool</code>: Whether to show headers in warning messages</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/retry_layer.jl#L52-L62" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.CustomRetryLayer.custom_retry_layer-Tuple{Any}" href="#PromptingTools.CustomRetryLayer.custom_retry_layer-Tuple{Any}">#</a> <b><u>PromptingTools.CustomRetryLayer.custom_retry_layer</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">custom_retry_layer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    handler;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    custom_retry_enabled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    custom_retry_max_retries</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RETRY_CONFIG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">max_retries,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    custom_retry_base_delay</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Float64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RETRY_CONFIG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">base_delay,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    custom_retry_status_codes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RETRY_CONFIG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status_codes,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    custom_retry_show_headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RETRY_CONFIG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">show_headers</span></span></code></pre></div><p>)</p><p>HTTP-layer that retries requests with exponential backoff or with a delay specified in the headers. It uses the global configuration by default but can be overridden on a per-call basis.</p><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HTTP</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools    </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Let&#39;s push the layer globally in all HTTP.jl requests</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HTTP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pushlayer!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PromptingTools</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CustomRetryLayer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">custom_retry_layer, request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># All calls should have retry set for 429 errors</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is the meaning of life?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Override settings for a specific call</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> aigenerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;What is the meaning of life?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    http_kwargs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (; custom_retry_status_codes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">429</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">503</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], custom_retry_max_retries </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/retry_layer.jl#L219-L247" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.CustomRetryLayer.enable_retry!" href="#PromptingTools.CustomRetryLayer.enable_retry!">#</a> <b><u>PromptingTools.CustomRetryLayer.enable_retry!</u></b> — <i>Function</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">enable_retry!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(enable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; request</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Bool</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, kwargs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Enable or disable the custom retry layer for HTTP requests and configure its default behavior. This overrides the kwargs in the <code>custom_retry_layer</code> function, so it MUST BE SET BEFORE the first call to <code>custom_retry_layer</code>!</p><p>Configuration hierarchy (from lowest to highest priority):</p><ul><li><p>Default values in <code>RETRY_CONFIG</code></p></li><li><p><code>enable_retry!</code> function arguments – work only before the first call to <code>custom_retry_layer</code></p></li><li><p><code>custom_retry_layer</code> function arguments – passed as <code>http_kwargs = (; custom_retry_*...)</code>, works for any call</p></li></ul><p><strong>Arguments</strong></p><ul><li><p><code>enable::Bool = true</code>: Whether to enable (true) or disable (false) the retry layer</p></li><li><p><code>request::Bool = true</code>: Whether to install in request layers (true) or stream layers (false)</p></li></ul><p><strong>Keyword Arguments</strong></p><ul><li><p><code>max_retries::Int = 5</code>: Maximum number of retry attempts before failing</p></li><li><p><code>base_delay::Float64 = 2.0</code>: Base delay in seconds for exponential backoff</p></li><li><p><code>status_codes::Vector{Int} = [429]</code>: HTTP status codes that should trigger a retry</p></li><li><p><code>show_headers::Bool = true</code>: Whether to show response headers in warning messages</p></li></ul><p><strong>Examples</strong></p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HTTP</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PromptingTools</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Enable with default settings</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">enable_retry!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Enable with custom settings</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">enable_retry!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(; max_retries</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, status_codes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">429</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">503</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Disable the retry layer</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">enable_retry!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/retry_layer.jl#L341-L376" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.CustomRetryLayer.extract_retry_after-Tuple{Dict{String, String}}" href="#PromptingTools.CustomRetryLayer.extract_retry_after-Tuple{Dict{String, String}}">#</a> <b><u>PromptingTools.CustomRetryLayer.extract_retry_after</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">extract_retry_after</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Dict{String, String}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Extracts the retry-after time in seconds from the headers.</p><p>It checks for the following headers in order of priority:</p><ol><li><p><code>retry-after-ms</code> (milliseconds)</p></li><li><p><code>retry-after</code> (seconds)</p></li><li><p><code>X-Ratelimit-Reset</code> (seconds)</p></li><li><p><code>x-ratelimit-reset-requests</code> (seconds/minutes/both)</p></li><li><p><code>x-ratelimit-reset-tokens</code> (seconds/minutes/both)</p></li></ol><p>Returns the retry-after time in seconds as a Float64, or <code>nothing</code> if no such header is found.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/retry_layer.jl#L169-L182" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.CustomRetryLayer.is_paused-Tuple{}" href="#PromptingTools.CustomRetryLayer.is_paused-Tuple{}">#</a> <b><u>PromptingTools.CustomRetryLayer.is_paused</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">is_paused</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><p>Check if requests should be paused due to rate limiting. Returns a tuple (is_paused, seconds_remaining) where:</p><ul><li><p>is_paused: Boolean indicating if requests should be paused</p></li><li><p>seconds_remaining: How many seconds to wait if paused</p></li></ul><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/retry_layer.jl#L82-L89" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.CustomRetryLayer.parse_time_string-Tuple{AbstractString}" href="#PromptingTools.CustomRetryLayer.parse_time_string-Tuple{AbstractString}">#</a> <b><u>PromptingTools.CustomRetryLayer.parse_time_string</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">parse_time_string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(time_str</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">AbstractString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Parses a time string like &quot;1s&quot;, &quot;6m0s&quot;, &quot;1m30s&quot;, &quot;500ms&quot;, or &quot;1m30s500ms&quot; into seconds. Returns the time in seconds as a Float64, or <code>nothing</code> if parsing fails.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/retry_layer.jl#L127-L132" target="_blank" rel="noreferrer">source</a></p></div><br><div style="border-width:1px;border-style:solid;border-color:black;padding:1em;border-radius:25px;"><a id="PromptingTools.CustomRetryLayer.pause_requests-Tuple{Float64}" href="#PromptingTools.CustomRetryLayer.pause_requests-Tuple{Float64}">#</a> <b><u>PromptingTools.CustomRetryLayer.pause_requests</u></b> — <i>Method</i>. <div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">pause_requests</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(seconds</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Float64</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>Pause all requests for the specified number of seconds.</p><p><a href="https://github.com/svilupp/PromptingTools.jl/blob/27f79ce69a4297a967bc8d611d0eb35c932b360c/src/retry_layer.jl#L109-L113" target="_blank" rel="noreferrer">source</a></p></div><br></div></div></main><footer class="VPDocFooter" data-v-83890dd9 data-v-4f9813fa><!--[--><!--]--><div class="edit-info" data-v-4f9813fa><div class="edit-link" data-v-4f9813fa><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/svilupp/PromptingTools.jl/edit/main/docs/src/reference.md" target="_blank" rel="noreferrer" data-v-4f9813fa><!--[--><span class="vpi-square-pen edit-link-icon" data-v-4f9813fa></span> Edit this page<!--]--></a></div><!----></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-4f9813fa><span class="visually-hidden" id="doc-footer-aria-label" data-v-4f9813fa>Pager</span><div class="pager" data-v-4f9813fa><a class="VPLink link pager-link prev" href="/PromptingTools.jl/dev/prompts/RAG" data-v-4f9813fa><!--[--><span class="desc" data-v-4f9813fa>Previous page</span><span class="title" data-v-4f9813fa>RAG</span><!--]--></a></div><div class="pager" data-v-4f9813fa><a class="VPLink link pager-link next" href="/PromptingTools.jl/dev/reference_experimental" data-v-4f9813fa><!--[--><span class="desc" data-v-4f9813fa>Next page</span><span class="title" data-v-4f9813fa>Experimental Modules</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-a9a9e638 data-v-c970a860><div class="container" data-v-c970a860><p class="message" data-v-c970a860>Made with <a href="https://documenter.juliadocs.org/stable/" target="_blank"><strong>Documenter.jl</strong></a> & <a href="https://vitepress.dev" target="_blank"><strong>VitePress</strong></a> & Icons by <a target="_blank" href="https://icons8.com">Icons8</a> <br></p><p class="copyright" data-v-c970a860>© Copyright 2025.</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"coverage_of_model_providers.md\":\"iW4E5CFs\",\"examples_readme_examples.md\":\"D05aGEXO\",\"examples_working_with_aitemplates.md\":\"BdOEUbcW\",\"examples_working_with_custom_apis.md\":\"lHz2oDfS\",\"examples_working_with_google_ai_studio.md\":\"CA3KYw7F\",\"examples_working_with_ollama.md\":\"B96wwXKA\",\"extra_tools_agent_tools_intro.md\":\"CW52DVl5\",\"extra_tools_api_tools_intro.md\":\"COjE-Z_a\",\"extra_tools_rag_tools_intro.md\":\"Qa5kiw8S\",\"extra_tools_text_utilities_intro.md\":\"B-J-RNgi\",\"frequently_asked_questions.md\":\"BO49J4Wh\",\"getting_started.md\":\"BQ7IKQ4B\",\"how_it_works.md\":\"CWdi54NF\",\"index.md\":\"CoAwx-cq\",\"prompts_agents.md\":\"DprkBPv7\",\"prompts_classification.md\":\"ZI8V-jCc\",\"prompts_critic.md\":\"DWzhdRsb\",\"prompts_extraction.md\":\"BLXZQvvO\",\"prompts_general.md\":\"C0I3CDyW\",\"prompts_persona-task.md\":\"CCwWTOYb\",\"prompts_rag.md\":\"BQFVm2e7\",\"prompts_visual.md\":\"KE4DWbrB\",\"ragtools_migration.md\":\"Bw3r6JIJ\",\"reference.md\":\"CR1y9l-Q\",\"reference_agenttools.md\":\"BzPJdjWP\",\"reference_apitools.md\":\"DI9gPWLF\",\"reference_experimental.md\":\"CxqIvIjw\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"PromptingTools.jl\",\"description\":\"Streamline Your Interactions with GenAI Models. Discover the power of GenerativeAI and build mini workflows to save you 20 minutes every day.\",\"base\":\"/PromptingTools.jl/dev/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"outline\":\"deep\",\"logo\":{\"src\":\"/logo.png\",\"width\":24,\"height\":24},\"search\":{\"provider\":\"local\",\"options\":{\"detailedView\":true}},\"nav\":[{\"text\":\"Home\",\"link\":\"/index\"},{\"text\":\"Manual\",\"items\":[{\"text\":\"Getting Started\",\"link\":\"/getting_started\"},{\"text\":\"How It Works\",\"link\":\"/how_it_works\"},{\"text\":\"Coverage of Model Providers\",\"link\":\"/coverage_of_model_providers\"},{\"text\":\"Examples\",\"items\":[{\"text\":\"Various examples\",\"link\":\"/examples/readme_examples\"},{\"text\":\"Using AITemplates\",\"link\":\"/examples/working_with_aitemplates\"},{\"text\":\"Local models with Ollama.ai\",\"link\":\"/examples/working_with_ollama\"},{\"text\":\"Google AIStudio\",\"link\":\"/examples/working_with_google_ai_studio\"},{\"text\":\"Custom APIs (Mistral, Llama.cpp)\",\"link\":\"/examples/working_with_custom_apis\"}]},{\"text\":\"Extra Tools\",\"items\":[{\"text\":\"Text Utilities\",\"link\":\"/extra_tools/text_utilities_intro\"},{\"text\":\"AgentTools\",\"link\":\"/extra_tools/agent_tools_intro\"},{\"text\":\"RAGTools\",\"link\":\"/extra_tools/rag_tools_intro\"},{\"text\":\"RAGTools Migration\",\"link\":\"/ragtools_migration\"},{\"text\":\"APITools\",\"link\":\"/extra_tools/api_tools_intro\"}]}]},{\"text\":\"F.A.Q.\",\"link\":\"/frequently_asked_questions\"},{\"text\":\"Prompt Templates\",\"items\":[{\"text\":\"General\",\"link\":\"/prompts/general\"},{\"text\":\"Persona-Task\",\"link\":\"/prompts/persona-task\"},{\"text\":\"Visual\",\"link\":\"/prompts/visual\"},{\"text\":\"Classification\",\"link\":\"/prompts/classification\"},{\"text\":\"Extraction\",\"link\":\"/prompts/extraction\"},{\"text\":\"Agents\",\"link\":\"/prompts/agents\"},{\"text\":\"RAG\",\"link\":\"/prompts/RAG\"}]},{\"text\":\"Reference\",\"items\":[{\"text\":\"PromptingTools.jl\",\"link\":\"/reference\"},{\"text\":\"Experimental Modules\",\"link\":\"/reference_experimental\"},{\"text\":\"AgentTools\",\"link\":\"/reference_agenttools\"},{\"text\":\"APITools\",\"link\":\"/reference_apitools\"}]}],\"sidebar\":[{\"text\":\"Home\",\"link\":\"/index\"},{\"text\":\"Manual\",\"items\":[{\"text\":\"Getting Started\",\"link\":\"/getting_started\"},{\"text\":\"How It Works\",\"link\":\"/how_it_works\"},{\"text\":\"Coverage of Model Providers\",\"link\":\"/coverage_of_model_providers\"},{\"text\":\"Examples\",\"collapsed\":true,\"items\":[{\"text\":\"Various examples\",\"link\":\"/examples/readme_examples\"},{\"text\":\"Using AITemplates\",\"link\":\"/examples/working_with_aitemplates\"},{\"text\":\"Local models with Ollama.ai\",\"link\":\"/examples/working_with_ollama\"},{\"text\":\"Google AIStudio\",\"link\":\"/examples/working_with_google_ai_studio\"},{\"text\":\"Custom APIs (Mistral, Llama.cpp)\",\"link\":\"/examples/working_with_custom_apis\"}]},{\"text\":\"Extra Tools\",\"collapsed\":true,\"items\":[{\"text\":\"Text Utilities\",\"link\":\"/extra_tools/text_utilities_intro\"},{\"text\":\"AgentTools\",\"link\":\"/extra_tools/agent_tools_intro\"},{\"text\":\"APITools\",\"link\":\"/extra_tools/api_tools_intro\"}]}]},{\"text\":\"F.A.Q.\",\"link\":\"/frequently_asked_questions\"},{\"text\":\"Prompt Templates\",\"collapsed\":true,\"items\":[{\"text\":\"General\",\"link\":\"/prompts/general\"},{\"text\":\"Persona-Task\",\"link\":\"/prompts/persona-task\"},{\"text\":\"Visual\",\"link\":\"/prompts/visual\"},{\"text\":\"Classification\",\"link\":\"/prompts/classification\"},{\"text\":\"Extraction\",\"link\":\"/prompts/extraction\"},{\"text\":\"Agents\",\"link\":\"/prompts/agents\"},{\"text\":\"RAG\",\"link\":\"/prompts/RAG\"}]},{\"text\":\"Reference\",\"collapsed\":true,\"items\":[{\"text\":\"PromptingTools.jl\",\"link\":\"/reference\"},{\"text\":\"Experimental Modules\",\"link\":\"/reference_experimental\"},{\"text\":\"AgentTools\",\"link\":\"/reference_agenttools\"},{\"text\":\"APITools\",\"link\":\"/reference_apitools\"}]}],\"editLink\":{\"pattern\":\"https://github.com/svilupp/PromptingTools.jl/edit/main/docs/src/:path\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/svilupp/PromptingTools.jl\"}],\"footer\":{\"message\":\"Made with <a href=\\\"https://documenter.juliadocs.org/stable/\\\" target=\\\"_blank\\\"><strong>Documenter.jl</strong></a> & <a href=\\\"https://vitepress.dev\\\" target=\\\"_blank\\\"><strong>VitePress</strong></a> & Icons by <a target=\\\"_blank\\\" href=\\\"https://icons8.com\\\">Icons8</a> <br>\",\"copyright\":\"© Copyright 2025.\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>